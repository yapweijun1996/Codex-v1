{
  "version": 3,
  "sources": ["../utils/emitter.js", "../utils/async-event-queue.js", "../utils/agent-async-iterator.js", "../utils/self-heal.js", "../utils/agent-tool-approval-keys.js", "../utils/imda-constants.js", "../utils/agent-tools-registry.js", "../utils/imda-policy.js", "../utils/approval-copy.js", "../utils/agent-tool-approval-batch.js", "../utils/agent-self-heal.js", "../utils/mcp-adapter.js", "../utils/agent-tool-output-guard.js", "../utils/agent-tool-formatter.js", "../utils/agent-tool-approval-single.js", "../utils/agent-tool-approval.js", "../utils/agent-timeout.js", "../utils/agent-timing.js", "../utils/agent-tool-exec-helpers.js", "../utils/command-parser.js", "../utils/command-danger-zone.js", "../utils/security.js", "../utils/tools/special-run-command.js", "../utils/tools/special-update-plan.js", "../utils/tools/special-user-input.js", "../utils/agent-tool-specials.js", "../utils/agent-tool-exec.js", "../utils/agent-tool-runner.js", "../utils/token-estimator.js", "../utils/context-normalization.js", "../utils/context-manager.js", "../utils/agent-state.js", "../config.js", "../utils/config.js", "../utils/agent-setup.js", "../utils/agent-usage.js", "../utils/agent-completion.js", "../utils/agent-interaction.js", "../utils/agent-lifecycle.js", "../utils/agent-llm-stream.js", "../utils/decision-trace.js", "../utils/agent-llm.js", "../utils/agent-tool-flow-helpers.js", "../utils/rag/rag-autosave-policy.js", "../utils/knowledge-evidence.js", "../utils/agent-knowledge-selection.js", "../utils/agent-tool-flow.js", "../utils/agent-guards.js", "../utils/agent-history-helpers.js", "../utils/text-utils.js", "../utils/history-compactor.js", "../utils/agent-trace.js", "../agents.js"],
  "sourcesContent": ["// Minimal EventEmitter for Browser ESM.\n//\n// This is intentionally tiny and dependency-free so browser mode stays vanilla.\n\nexport class EventEmitter {\n    constructor() {\n        this._listeners = new Map();\n    }\n\n    on(event, fn) {\n        if (!this._listeners.has(event)) this._listeners.set(event, []);\n        this._listeners.get(event).push(fn);\n        return this;\n    }\n\n    once(event, fn) {\n        const wrapper = (...args) => {\n            this.off(event, wrapper);\n            fn(...args);\n        };\n        return this.on(event, wrapper);\n    }\n\n    off(event, fn) {\n        const listeners = this._listeners.get(event);\n        if (!listeners) return this;\n        this._listeners.set(event, listeners.filter((l) => l !== fn));\n        return this;\n    }\n\n    removeListener(event, fn) {\n        return this.off(event, fn);\n    }\n\n    removeAllListeners(event) {\n        if (event) this._listeners.delete(event);\n        else this._listeners.clear();\n        return this;\n    }\n\n    emit(event, ...args) {\n        const listeners = this._listeners.get(event);\n        if (!listeners || listeners.length === 0) return false;\n        for (const fn of listeners.slice()) {\n            try {\n                fn(...args);\n            } catch (err) {\n                // Avoid breaking the emitter loop.\n                console.error(`Error in listener for event \"${event}\":`, err);\n            }\n        }\n        return true;\n    }\n}\n", "function createAsyncEventQueue() {\n    const queue = [];\n    const waiters = [];\n    let closed = false;\n\n    const notify = () => {\n        while (waiters.length > 0) {\n            const w = waiters.shift();\n            if (typeof w === 'function') w();\n        }\n    };\n\n    return {\n        push: (value) => {\n            if (closed) return;\n            queue.push(value);\n            notify();\n        },\n        close: () => {\n            if (closed) return;\n            closed = true;\n            notify();\n        },\n        async *iterate() {\n            while (true) {\n                if (queue.length > 0) {\n                    yield queue.shift();\n                    continue;\n                }\n                if (closed) return;\n                await new Promise((resolve) => waiters.push(resolve));\n            }\n        },\n    };\n}\n\nmodule.exports = { createAsyncEventQueue };\n", "const { createAsyncEventQueue } = require('./async-event-queue');\n\nfunction runAsyncIterator(agent, userInput, options = {}) {\n    const { signal } = options;\n    const q = createAsyncEventQueue();\n\n    const on = (evt, fn) => agent.on(evt, fn);\n    const off = (evt, fn) => {\n        if (typeof agent.off === 'function') agent.off(evt, fn);\n        else agent.removeListener(evt, fn);\n    };\n\n    const handlers = {\n        start: (data) => q.push({ type: 'turn.started', input: data && data.message ? data.message : userInput }),\n        thinking: (data) => q.push({ type: 'thinking', step: data && data.step }),\n        state_changed: (data) => q.push({ type: 'state.changed', ...data }),\n        context_truncated: (data) => q.push({ type: 'context.truncated', ...data }),\n        assistant_message_started: (data) => q.push({ type: 'assistant_message_started', ...data }),\n        agent_message_content_delta: (data) => q.push({ type: 'response.chunk', delta: data && data.delta ? data.delta : '', step: data && data.step }),\n        tool_call: (data) => q.push({ type: 'tool.call', tools: data && data.tools ? data.tools : [], details: data && data.details ? data.details : [] }),\n        tool_call_begin: (data) => q.push({ type: 'tool.call.begin', ...data }),\n        tool_call_end: (data) => q.push({ type: 'tool.call.end', ...data }),\n        tool_result: (data) => q.push({ type: 'tool.result', tool: data && data.tool, args: data && data.args, result: data && data.result }),\n        knowledge_selected: (data) => q.push({ type: 'knowledge.selected', ...data }),\n        tool_error: (data) => q.push({ type: 'tool.error', tool: data && data.tool, error: data && data.error }),\n        plan_updated: (data) => q.push({ type: 'plan.updated', ...data }),\n        approval_required: (data) => q.push({ type: 'approval.required', ...data }),\n        approval_skipped: (data) => q.push({ type: 'approval.skipped', ...data }),\n        user_input_requested: (data) => q.push({ type: 'user_input.requested', ...data }),\n        user_input_response: (data) => q.push({ type: 'user_input.response', ...data }),\n        approval_blocked: (data) => q.push({ type: 'approval.blocked', ...data }),\n        decision_trace: (data) => q.push({ type: 'decision_trace', ...data }),\n        token_count: (data) => q.push({ type: 'token_count', info: data && data.info ? data.info : null }),\n        exec_command_begin: (data) => q.push({ type: 'exec_command.begin', ...data }),\n        exec_command_output: (data) => q.push({ type: 'exec_command.output', ...data }),\n        exec_command_end: (data) => q.push({ type: 'exec_command.end', ...data }),\n        done: (data) => {\n            q.push({\n                type: 'turn.completed',\n                finalResponse: data && typeof data.response === 'string' ? data.response : '',\n                turnCount: data && data.turnCount,\n                historyLength: data && data.historyLength,\n            });\n            q.close();\n        },\n    };\n\n    for (const [evt, fn] of Object.entries(handlers)) on(evt, fn);\n\n    let aborted = false;\n    const abortHandler = () => {\n        aborted = true;\n        q.push({ type: 'error', message: 'Aborted' });\n        q.close();\n    };\n    if (signal && typeof signal.addEventListener === 'function') {\n        if (signal.aborted) abortHandler();\n        else signal.addEventListener('abort', abortHandler, { once: true });\n    }\n\n    const runPromise = Promise.resolve()\n        .then(() => agent.run(userInput))\n        .catch((err) => {\n            const msg = err && err.message ? String(err.message) : String(err);\n            q.push({ type: 'error', message: msg });\n            q.close();\n            return null;\n        });\n\n    const iterator = (async function* iterate() {\n        try {\n            for await (const ev of q.iterate()) {\n                yield ev;\n            }\n        } finally {\n            for (const [evt, fn] of Object.entries(handlers)) off(evt, fn);\n            if (signal && typeof signal.removeEventListener === 'function') {\n                signal.removeEventListener('abort', abortHandler);\n            }\n            await runPromise;\n            if (aborted) return;\n        }\n    })();\n\n    return iterator;\n}\n\nmodule.exports = { runAsyncIterator };\n", "// Utilities for self-healing and loop detection.\n// Keep this module environment-agnostic (no Node-only deps).\n\nconst DEFAULT_TOOL_TIMEOUT_MS = 30_000;\n// Human approval should allow more time than tool execution.\nconst DEFAULT_APPROVAL_TIMEOUT_MS = 300_000;\nconst DEFAULT_REPEAT_FAILURE_THRESHOLD = 2;\nconst DEFAULT_LOOP_FINGERPRINT_THRESHOLD = 3;\n\nfunction isPlainObject(value) {\n    if (!value || typeof value !== 'object') return false;\n    const proto = Object.getPrototypeOf(value);\n    return proto === Object.prototype || proto === null;\n}\n\nfunction stableStringify(value) {\n    const seen = new WeakSet();\n\n    function normalize(v) {\n        if (v === null) return null;\n        const t = typeof v;\n        if (t === 'string' || t === 'number' || t === 'boolean') return v;\n        if (t === 'bigint') return String(v);\n        if (t === 'undefined') return null;\n        if (t === 'function') return '[Function]';\n        if (t === 'symbol') return String(v);\n\n        if (t === 'object') {\n            if (seen.has(v)) return '[Circular]';\n            seen.add(v);\n\n            if (Array.isArray(v)) return v.map(normalize);\n\n            if (v instanceof Date) return v.toISOString();\n            if (v instanceof Error) {\n                return {\n                    name: v.name,\n                    message: v.message,\n                };\n            }\n\n            if (!isPlainObject(v)) {\n                // Best-effort: preserve enumerable keys only.\n                const out = {};\n                for (const k of Object.keys(v).sort()) {\n                    out[k] = normalize(v[k]);\n                }\n                return out;\n            }\n\n            const out = {};\n            for (const k of Object.keys(v).sort()) {\n                out[k] = normalize(v[k]);\n            }\n            return out;\n        }\n\n        return String(v);\n    }\n\n    try {\n        return JSON.stringify(normalize(value));\n    } catch {\n        // Last resort: never throw from stableStringify.\n        return 'null';\n    }\n}\n\nfunction safeJsonStringify(value) {\n    // Prefer native JSON for compactness, but fall back to stableStringify on circulars.\n    try {\n        return JSON.stringify(value === undefined ? null : value);\n    } catch {\n        return stableStringify(value);\n    }\n}\n\nfunction isRateLimitLike(input) {\n    const text = String(input || '').toLowerCase();\n    if (!text) return false;\n    return (\n        text.includes('too many requests') ||\n        text.includes('rate limit') ||\n        text.includes('ratelimit') ||\n        text.includes('status: 429') ||\n        text.includes('http 429') ||\n        text.includes(' 429')\n    );\n}\n\n// Small deterministic hash (djb2) to keep fingerprints compact.\nfunction hashString(input) {\n    const str = String(input || '');\n    let hash = 5381;\n    for (let i = 0; i < str.length; i++) {\n        hash = ((hash << 5) + hash) ^ str.charCodeAt(i);\n    }\n    // Convert to unsigned 32-bit then base36.\n    return (hash >>> 0).toString(36);\n}\n\nfunction makeFailureFingerprint(toolName, failureType, args) {\n    const argsStable = stableStringify(args);\n    return `${toolName}:${String(failureType || 'unknown')}:${hashString(argsStable)}`;\n}\n\nmodule.exports = {\n    DEFAULT_TOOL_TIMEOUT_MS,\n    DEFAULT_APPROVAL_TIMEOUT_MS,\n    DEFAULT_REPEAT_FAILURE_THRESHOLD,\n    DEFAULT_LOOP_FINGERPRINT_THRESHOLD,\n    stableStringify,\n    safeJsonStringify,\n    isRateLimitLike,\n    hashString,\n    makeFailureFingerprint,\n};\n", "const { stableStringify } = require('./self-heal');\n\nfunction fnv1a32Hex(input) {\n    const str = String(input || '');\n    let hash = 2166136261;\n    for (let i = 0; i < str.length; i += 1) {\n        hash ^= str.charCodeAt(i);\n        hash = Math.imul(hash, 16777619);\n    }\n    return (hash >>> 0).toString(16);\n}\n\nfunction makeApprovalArgsHash(args) {\n    try {\n        return fnv1a32Hex(stableStringify(args));\n    } catch {\n        return '0';\n    }\n}\n\nfunction makeApprovalDenyKey(toolName, args) {\n    return `${String(toolName || '')}:${makeApprovalArgsHash(args)}`;\n}\n\nmodule.exports = {\n    makeApprovalArgsHash,\n    makeApprovalDenyKey,\n};\n", "const RiskLevel = Object.freeze({\n    NONE: 0,\n    LOW: 1,\n    MEDIUM: 2,\n    HIGH: 3,\n});\n\nconst RISK_LEVEL_VALUES = new Set(Object.values(RiskLevel));\n\nfunction normalizeRiskLevel(value, fallback = RiskLevel.NONE) {\n    return RISK_LEVEL_VALUES.has(value) ? value : fallback;\n}\n\nmodule.exports = { RiskLevel, normalizeRiskLevel };\n", "const { RiskLevel, normalizeRiskLevel } = require('./imda-constants');\n\nconst DEFAULT_AUDIT_FIELDS = ['tool_call_id', 'args_hash', 'duration_ms'];\n\nfunction truncate(text, maxLen) {\n    const s = String(text == null ? '' : text);\n    const n = Number(maxLen);\n    if (!Number.isFinite(n) || n <= 0) return s;\n    if (s.length <= n) return s;\n    return `${s.slice(0, Math.max(0, n - 3))}...`;\n}\n\nfunction toPlainObject(value) {\n    return value && typeof value === 'object' && !Array.isArray(value) ? value : null;\n}\n\nfunction normalizeSchema(raw, fallback) {\n    const candidate = toPlainObject(raw) || toPlainObject(fallback);\n    if (!candidate) return null;\n    const out = { ...candidate };\n    if (!out.type && out.properties && typeof out.properties === 'object') {\n        out.type = 'object';\n    }\n    return out;\n}\n\nfunction normalizeRateLimit(raw) {\n    const obj = toPlainObject(raw);\n    if (!obj) return null;\n    const maxCalls = Number(obj.maxCalls);\n    const perSeconds = Number(obj.perSeconds);\n    if (!Number.isFinite(maxCalls) || !Number.isFinite(perSeconds)) return null;\n    if (maxCalls <= 0 || perSeconds <= 0) return null;\n    return { maxCalls: Math.floor(maxCalls), perSeconds: Math.floor(perSeconds) };\n}\n\nfunction normalizeToolMeta(tool) {\n    const raw = toPlainObject(tool && tool.meta) || {};\n    const inputSchema = normalizeSchema(raw.inputSchema, tool.parameters);\n    const outputSchema = normalizeSchema(raw.outputSchema, tool.outputSchema);\n    const permissions = Array.isArray(raw.permissions)\n        ? raw.permissions.filter(Boolean).map((v) => String(v))\n        : [];\n    const rateLimit = normalizeRateLimit(raw.rateLimit);\n    const auditRaw = toPlainObject(raw.audit) || {};\n    const auditFields = Array.isArray(auditRaw.fields)\n        ? auditRaw.fields.filter(Boolean).map((v) => String(v))\n        : DEFAULT_AUDIT_FIELDS.slice();\n    const failureModes = Array.isArray(raw.failureModes) ? raw.failureModes : [];\n    const fallback = raw.fallback != null ? raw.fallback : null;\n    const intentTemplate = typeof raw.intentTemplate === 'string' ? raw.intentTemplate : '';\n    return {\n        inputSchema,\n        outputSchema,\n        permissions,\n        rateLimit,\n        audit: { fields: auditFields },\n        failureModes,\n        fallback,\n        intentTemplate,\n    };\n}\n\nfunction formatIntentValue(v) {\n    if (v === null || v === undefined) return '';\n    if (typeof v === 'string') return v;\n    if (typeof v === 'number' || typeof v === 'boolean') return String(v);\n    return '';\n}\n\nfunction renderIntentTemplate(template, args) {\n    const t = String(template || '');\n    if (!t) return '';\n    const a = (args && typeof args === 'object') ? args : null;\n    return t.replace(/\\{([a-zA-Z0-9_]+)\\}/g, (_m, key) => {\n        if (!a) return '';\n        if (key.endsWith('_len') || key.endsWith('_length')) {\n            const baseKey = key.replace(/_(len|length)$/, '');\n            const v = a[baseKey];\n            if (typeof v === 'string') return String(v.length);\n            if (Array.isArray(v)) return String(v.length);\n            return '';\n        }\n        return truncate(formatIntentValue(a[key]), 120);\n    }).trim();\n}\n\nfunction buildToolRegistry(tools) {\n    const toolMap = {};\n    const registry = {};\n    for (const tool of tools) {\n        if (!tool || !tool.name) continue;\n        const risk = normalizeRiskLevel(tool.risk, RiskLevel.MEDIUM);\n        tool.risk = risk;\n        const meta = normalizeToolMeta(tool);\n        tool.meta = meta;\n        toolMap[tool.name] = tool;\n        registry[tool.name] = {\n            name: tool.name,\n            description: typeof tool.description === 'string' ? tool.description : '',\n            risk,\n            permissions: meta.permissions,\n            inputSchema: meta.inputSchema,\n            outputSchema: meta.outputSchema,\n            rateLimit: meta.rateLimit,\n            audit: meta.audit,\n            failureModes: meta.failureModes,\n            fallback: meta.fallback,\n            intentTemplate: meta.intentTemplate,\n        };\n    }\n    return { toolMap, registry };\n}\n\nfunction registerTools(tools) {\n    return buildToolRegistry(tools);\n}\n\nfunction getToolMeta(agent, toolName) {\n    if (!agent || !agent.toolRegistry || !toolName) return null;\n    return agent.toolRegistry[toolName] || null;\n}\n\nfunction getToolRisk(agent, toolName, tool) {\n    const meta = getToolMeta(agent, toolName);\n    if (meta && typeof meta.risk === 'number') return meta.risk;\n    if (tool && typeof tool.risk === 'number') return tool.risk;\n    return RiskLevel.MEDIUM;\n}\n\nfunction getToolRegistrySnapshot(agent, toolNames) {\n    if (!agent || !agent.toolRegistry) return null;\n    if (!Array.isArray(toolNames)) return null;\n    const snapshot = {};\n    for (const name of toolNames) {\n        const entry = agent.toolRegistry[name];\n        if (entry) snapshot[name] = entry;\n    }\n    return Object.keys(snapshot).length > 0 ? snapshot : null;\n}\n\nfunction getToolIntent(agent, toolName, args) {\n    const meta = getToolMeta(agent, toolName);\n    if (!meta) return '';\n\n    if (toolName === 'request_user_input' && args && typeof args === 'object') {\n        const q = (typeof args.question === 'string') ? args.question.trim() : '';\n        if (q) return `request user input: \"${truncate(q, 100)}\"`;\n        const qs = Array.isArray(args.questions) ? args.questions : null;\n        if (qs && qs.length > 0) {\n            const first = qs[0] && typeof qs[0] === 'object' ? qs[0] : null;\n            const firstQ = first && typeof first.question === 'string' ? first.question.trim() : '';\n            if (firstQ) {\n                return `request user input (${qs.length} questions): \"${truncate(firstQ, 80)}\"`;\n            }\n            return `request user input (${qs.length} questions)`;\n        }\n        return 'request user input';\n    }\n\n    const rendered = renderIntentTemplate(meta.intentTemplate, args);\n    if (rendered) return rendered;\n    return meta.description ? truncate(meta.description, 140) : '';\n}\n\nmodule.exports = {\n    buildToolRegistry,\n    registerTools,\n    getToolMeta,\n    getToolRisk,\n    getToolRegistrySnapshot,\n    getToolIntent,\n};\n", "const { RiskLevel } = require('./imda-constants');\n\n// Control-plane tools must never require an IMDA approval gate.\n// Otherwise we'd deadlock (approval prompt itself relies on user input tools).\nconst APPROVAL_EXEMPT_TOOLS = new Set([\n    'request_user_input',\n    'update_plan',\n    'list_available_skills',\n    'read_skill_documentation',\n]);\n\nfunction riskLabel(tier) {\n    switch (tier) {\n        case RiskLevel.HIGH:\n            return 'Tier 3 (High Risk)';\n        case RiskLevel.MEDIUM:\n            return 'Tier 2 (Business Critical)';\n        case RiskLevel.LOW:\n            return 'Tier 1 (Reversible)';\n        case RiskLevel.NONE:\n        default:\n            return 'Tier 0 (Read-only)';\n    }\n}\n\nfunction normalizeApprovalPolicy(value) {\n    if (typeof value !== 'string') return 'always';\n    const v = value.trim().toLowerCase();\n    if (v === 'unless_trusted') return 'unless_trusted';\n    if (v === 'never') return 'never';\n    return 'always';\n}\n\nfunction normalizeTrustedTools(value) {\n    if (!Array.isArray(value)) return [];\n    const out = value.map((t) => String(t || '').trim()).filter(Boolean);\n    return Array.from(new Set(out));\n}\n\nfunction isTrustedTool(toolName, trustedTools) {\n    if (!toolName) return false;\n    const list = normalizeTrustedTools(trustedTools);\n    if (list.length === 0) return false;\n    return list.includes(String(toolName));\n}\n\nfunction baselineRequiresApproval({ toolName, toolRisk, agentTier }) {\n    if (toolName && APPROVAL_EXEMPT_TOOLS.has(String(toolName))) return false;\n\n    // IMDA baseline:\n    // - Tier 3 (HIGH): always require approval\n    // - Tier 2 (MEDIUM): always require approval (human approves business-critical steps)\n    if (toolRisk >= RiskLevel.MEDIUM) return true;\n\n    // Tier 1 (LOW): require approval for Tier 0 agents (read-only baseline).\n    if (toolRisk === RiskLevel.LOW) return agentTier === RiskLevel.NONE;\n\n    // Tier 0 (NONE): no approval required.\n    return false;\n}\n\nfunction getApprovalDecision({ toolName, toolRisk, agentTier, approvalPolicy, trustedTools }) {\n    const policy = normalizeApprovalPolicy(approvalPolicy);\n    const baseline = baselineRequiresApproval({ toolName, toolRisk, agentTier });\n    if (!baseline) return { requires: false, baselineRequires: false, bypassed: false, reason: 'not_required' };\n\n    if (toolName && APPROVAL_EXEMPT_TOOLS.has(String(toolName))) {\n        return { requires: false, baselineRequires: true, bypassed: true, reason: 'exempt' };\n    }\n\n    if (policy === 'never') {\n        return { requires: false, baselineRequires: true, bypassed: true, reason: 'policy_never' };\n    }\n\n    if (policy === 'unless_trusted') {\n        // Safety: never auto-bypass Tier 3.\n        if (toolRisk >= RiskLevel.HIGH) {\n            return { requires: true, baselineRequires: true, bypassed: false, reason: 'high_risk' };\n        }\n        if (isTrustedTool(toolName, trustedTools)) {\n            return { requires: false, baselineRequires: true, bypassed: true, reason: 'trusted' };\n        }\n    }\n\n    return { requires: true, baselineRequires: true, bypassed: false, reason: 'baseline' };\n}\n\nfunction requiresApproval({ toolName, toolRisk, agentTier }) {\n    return baselineRequiresApproval({ toolName, toolRisk, agentTier });\n}\n\nfunction isApprovedResponse(value) {\n    if (value == null) return false;\n    if (typeof value === 'string') {\n        const normalized = value.trim().toLowerCase();\n        return ['approve', 'allow', 'yes', 'y'].includes(normalized);\n    }\n    if (typeof value === 'object' && Array.isArray(value.answers) && value.answers.length > 0) {\n        return isApprovedResponse(value.answers[0]);\n    }\n    return false;\n}\n\nmodule.exports = {\n    riskLabel,\n    requiresApproval,\n    isApprovedResponse,\n    APPROVAL_EXEMPT_TOOLS,\n    baselineRequiresApproval,\n    getApprovalDecision,\n};\n", "const { RiskLevel } = require('./imda-constants');\n\nfunction describeToolAction(toolName) {\n    const name = String(toolName || '').trim();\n    if (!name) return 'use a tool';\n\n    if (name === 'run_command') return 'run a command on your computer';\n    if (name === 'apply_patch') return 'modify local files in your workspace';\n\n    if (name === 'read_file') return 'read a local file from your workspace';\n    if (name === 'list_dir') return 'list files in your workspace';\n    if (name === 'grep_files') return 'search text in your workspace files';\n    if (name === 'view_image') return 'open a local image from your workspace';\n\n    if (name === 'read_url') return 'fetch and read a URL';\n\n    if (name === 'memory_search' || name === 'kb_search' || name === 'memory_read_graph') return 'read local memory/knowledge';\n    if (name === 'memory_save') return 'save information into local episodic memory';\n    if (name.startsWith('memory__')) return 'read saved memory';\n    // External MCP tools are often namespaced as \"<server>__<tool>\".\n    if (name.includes('__')) return 'call an external MCP tool';\n\n    return `use \"${name}\"`;\n}\n\nfunction buildApprovalQuestion({ toolName, toolRisk, isDebug }) {\n    if (isDebug) {\n        return `Approve tool call: ${toolName}?`;\n    }\n\n    const action = describeToolAction(toolName);\n    const highRisk = (typeof toolRisk === 'number' && toolRisk >= RiskLevel.HIGH);\n    if (highRisk) {\n        return `High-risk action: allow the agent to ${action}?`;\n    }\n    return `Allow the agent to ${action}?`;\n}\n\nmodule.exports = {\n    describeToolAction,\n    buildApprovalQuestion,\n};\n", "const { stableStringify } = require('./self-heal');\nconst { RiskLevel } = require('./imda-constants');\nconst { getToolRisk, getToolIntent } = require('./agent-tools-registry');\nconst { getApprovalDecision, riskLabel, isApprovedResponse } = require('./imda-policy');\nconst { buildApprovalQuestion } = require('./approval-copy');\nconst { makeApprovalDenyKey } = require('./agent-tool-approval-keys');\n\nfunction parseCallArgs(call) {\n    try {\n        return typeof call.arguments === 'string' ? JSON.parse(call.arguments) : call.arguments;\n    } catch {\n        return undefined;\n    }\n}\n\nfunction summarizeApprovalArgs(args, { maxLen = 80 } = {}) {\n    if (args === undefined || args === null) return '';\n    let text = '';\n    try {\n        text = stableStringify(args);\n    } catch {\n        text = '';\n    }\n    text = String(text || '').trim();\n    if (!text || text === 'null' || text === '{}' || text === '[]') return '';\n    if (text.length <= maxLen) return text;\n    return `${text.slice(0, Math.max(0, maxLen - 3))}...`;\n}\n\nasync function prepareBatchApprovals({ agent, toolCalls }) {\n    const batchDecisions = new Map();\n    if (!agent._approvalDenies) agent._approvalDenies = new Set();\n    const needsApproval = toolCalls.some((call) => {\n        const tool = agent.tools[call.name];\n        if (!tool) return false;\n        const toolRisk = getToolRisk(agent, call.name, tool);\n        const agentTier = agent.riskProfile ? agent.riskProfile.tier : RiskLevel.NONE;\n        const decision = getApprovalDecision({\n            toolName: call.name,\n            toolRisk,\n            agentTier,\n            approvalPolicy: agent && agent.approvalPolicy,\n            trustedTools: agent && agent.trustedTools,\n        });\n        return Boolean(decision && decision.requires);\n    });\n\n    if (needsApproval) {\n        const pending = [];\n        const agentTier = agent.riskProfile ? agent.riskProfile.tier : RiskLevel.NONE;\n        for (const call of toolCalls) {\n            const tool = agent.tools[call.name];\n            if (!tool) continue;\n            if (!call.id) continue;\n            const args = parseCallArgs(call);\n            const denyKey = makeApprovalDenyKey(call.name, args);\n            if (agent && agent._approvalDenies && agent._approvalDenies.has(denyKey)) continue;\n            const toolRisk = getToolRisk(agent, call.name, tool);\n            const approvalMode = (tool && tool.approvalMode === 'per_turn') ? 'per_turn' : 'per_call';\n            const meta = tool && tool.meta ? tool.meta : null;\n            const cached = approvalMode === 'per_turn'\n                && toolRisk < RiskLevel.HIGH\n                && agent\n                && agent._approvalGrants\n                && agent._approvalGrants.has(call.name);\n            if (cached) continue;\n            const decision = getApprovalDecision({\n                toolName: call.name,\n                toolRisk,\n                agentTier,\n                approvalPolicy: agent && agent.approvalPolicy,\n                trustedTools: agent && agent.trustedTools,\n            });\n            if (decision && decision.requires) {\n                pending.push({\n                    id: call.id,\n                    name: call.name,\n                    risk: toolRisk,\n                    args,\n                    intent: getToolIntent(agent, call.name, args) || undefined,\n                    denyKey,\n                    approvalMode,\n                    permissions: meta && Array.isArray(meta.permissions) ? meta.permissions : [],\n                    rateLimit: meta && meta.rateLimit ? meta.rateLimit : null,\n                });\n            }\n        }\n\n        if (pending.length > 1) {\n            const approvalCallId = `approval:batch:${Date.now()}`;\n            const maxRisk = pending.reduce((m, p) => (p.risk > m ? p.risk : m), RiskLevel.NONE);\n            const question = (agent && agent.debug)\n                ? `Approve selected tool calls (${pending.length})?`\n                : buildApprovalQuestion({ toolName: `${pending.length} tool calls`, toolRisk: maxRisk, isDebug: false });\n\n            agent.emit('approval_required', {\n                callId: approvalCallId,\n                tool: '(batch)',\n                risk: maxRisk,\n                tools: pending,\n                batch: true,\n                promptSnapshot: question,\n            });\n            agent._setState('awaiting_input', { callId: approvalCallId, tool: '(batch)', risk: maxRisk, count: pending.length });\n            const approvalPromise = agent._awaitUserInput(approvalCallId, agent.approvalTimeoutMs);\n            agent.emit('user_input_requested', {\n                callId: approvalCallId,\n                questions: [{\n                    question,\n                    inputType: 'multi_select',\n                    options: pending.map((p) => ({\n                        title: (() => {\n                            const argsText = summarizeApprovalArgs(p.args, { maxLen: 90 });\n                            const argsPart = argsText ? ` args=${argsText}` : '';\n                            return `${p.name}${argsPart} (${riskLabel(p.risk)})`;\n                        })(),\n                        value: p.id,\n                        selected: true,\n                    })),\n                }],\n            });\n            const approval = await approvalPromise;\n            const approvedCallIds = new Set();\n            if (!approval.timedOut) {\n                const v = approval.value;\n                if (isApprovedResponse(v)) {\n                    for (const p of pending) approvedCallIds.add(p.id);\n                } else if (v && typeof v === 'object' && Array.isArray(v.approvedCallIds)) {\n                    for (const id of v.approvedCallIds) approvedCallIds.add(id);\n                } else if (Array.isArray(v)) {\n                    for (const id of v) approvedCallIds.add(id);\n                }\n            }\n\n            for (const p of pending) {\n                const ok = approvedCallIds.has(p.id);\n                batchDecisions.set(p.id, {\n                    approved: ok,\n                    timedOut: Boolean(approval.timedOut),\n                    args: p.args,\n                    risk: p.risk,\n                    approvalMode: p.approvalMode,\n                    toolName: p.name,\n                });\n                if (agent && agent._approvalDenies) {\n                    if (ok) agent._approvalDenies.delete(p.denyKey);\n                    else agent._approvalDenies.add(p.denyKey);\n                }\n                if (ok && p.approvalMode === 'per_turn' && agent && agent._approvalGrants && p.risk < RiskLevel.HIGH) {\n                    agent._approvalGrants.add(p.name);\n                }\n            }\n\n            agent._setState('thinking', { reason: approval.timedOut ? 'approval_timeout' : 'approval_batch_resolved' });\n        }\n    }\n\n    return { needsApproval, batchDecisions };\n}\n\nmodule.exports = {\n    prepareBatchApprovals,\n};\n", "function isBrowserRuntime() {\n    return typeof window !== 'undefined';\n}\n\nfunction isBrowserEnvRestrictionLikeMessage(message) {\n    const text = String(message || '').toLowerCase();\n    if (!text) return false;\n    return (\n        text.includes('cors') ||\n        text.includes('cross-origin') ||\n        text.includes('access-control-allow-origin') ||\n        text.includes('failed to fetch') ||\n        text.includes('networkerror when attempting to fetch') ||\n        text.includes('load failed') ||\n        text.includes('mixed content') ||\n        text.includes('blocked:mixed-content') ||\n        text.includes('insecure request') ||\n        text.includes('secure context') ||\n        text.includes('same origin') ||\n        text.includes('same-origin')\n    );\n}\n\nfunction getNodeErrorCode(output) {\n    if (!output || typeof output !== 'object') return null;\n    const code = output.code || output.errno || output.error_code;\n    return typeof code === 'string' && code.trim() ? code.trim() : null;\n}\n\nfunction classifyNodeError({ code, message }) {\n    const normalized = typeof code === 'string' ? code.toUpperCase() : '';\n    const msg = String(message || '').toLowerCase();\n    const ioCodes = new Set(['ENOENT', 'EACCES', 'EPERM', 'ENOTDIR', 'EISDIR']);\n    const netCodes = new Set(['ECONNREFUSED', 'ENOTFOUND', 'EHOSTUNREACH', 'ECONNRESET']);\n    if (ioCodes.has(normalized) || msg.includes('no such file') || msg.includes('permission denied')) {\n        return 'node_io_error';\n    }\n    if (netCodes.has(normalized) || msg.includes('connect') || msg.includes('econn')) {\n        return 'node_network_error';\n    }\n    return null;\n}\n\nfunction classifyToolFailure({ toolName, output, isRateLimitLike }) {\n    if (output && typeof output === 'object') {\n        if (output.error) {\n            if (String(output.error).toLowerCase() === 'timeout') {\n                return 'timeout';\n            }\n\n            if (\n                output.status === 429 ||\n                output.statusCode === 429 ||\n                output.code === 429 ||\n                (typeof isRateLimitLike === 'function' && (isRateLimitLike(output.error) || isRateLimitLike(output.message)))\n            ) {\n                return 'rate_limited';\n            }\n\n            if (isBrowserRuntime()) {\n                const err = String(output.error || '');\n                const meta = [output.message, output.reason, output.detail, output.hint]\n                    .filter(Boolean)\n                    .map((v) => String(v))\n                    .join(' ');\n                const combined = `${err} ${meta}`;\n                if (\n                    String(output.platform || '').toLowerCase() === 'browser' ||\n                    err.toLowerCase() === 'environment restriction' ||\n                    isBrowserEnvRestrictionLikeMessage(combined)\n                ) {\n                    return 'environment_restriction';\n                }\n            } else {\n                const code = getNodeErrorCode(output);\n                const message = output.message || output.error || '';\n                const nodeType = classifyNodeError({ code, message });\n                if (nodeType) return nodeType;\n            }\n\n            if (toolName === 'run_command' && String(output.error).toLowerCase().includes('access denied')) {\n                return 'access_denied';\n            }\n            if (toolName === 'apply_patch') {\n                const text = `${output.error || ''} ${output.message || ''}`.toLowerCase();\n                if (text.includes('invalid patch') || text.includes('unsupported patch')) {\n                    return 'patch_format_error';\n                }\n            }\n            return 'tool_error';\n        }\n\n        if (toolName === 'run_command' && typeof output.exitCode === 'number' && output.exitCode !== 0) {\n            return 'nonzero_exit';\n        }\n    }\n    return null;\n}\n\nfunction recordToolFailure({ toolFailureStreak, toolName, fingerprintOrType, args, makeFailureFingerprint }) {\n    if (!toolFailureStreak || !toolName) return;\n    let fingerprint = fingerprintOrType;\n    let failureType = undefined;\n    if (args !== undefined && typeof fingerprintOrType === 'string') {\n        failureType = fingerprintOrType;\n        fingerprint = makeFailureFingerprint(toolName, fingerprintOrType, args);\n    }\n\n    const prev = toolFailureStreak.get(toolName);\n    if (prev && prev.fingerprint === fingerprint) {\n        toolFailureStreak.set(toolName, {\n            count: prev.count + 1,\n            fingerprint,\n            failureType: failureType || prev.failureType,\n        });\n    } else {\n        toolFailureStreak.set(toolName, { count: 1, fingerprint, failureType });\n    }\n}\n\nfunction clearToolFailure({ toolFailureStreak, toolName }) {\n    if (!toolFailureStreak || !toolName) return;\n    toolFailureStreak.delete(toolName);\n}\n\nfunction withSelfHealHint({ toolFailureStreak, toolName, output, defaultLoopFingerprintThreshold }) {\n    if (!toolFailureStreak || !toolName) return output;\n    const state = toolFailureStreak.get(toolName);\n    if (!state || state.count < 2) return output;\n\n    const hardStop = state.count >= defaultLoopFingerprintThreshold;\n\n    const adviceByType = {\n        timeout: 'This tool timed out repeatedly. Reduce scope/complexity, verify network/connectivity, or use an alternative tool.',\n        rate_limited: 'This tool is being rate limited. Wait before retrying, reduce call frequency, or consolidate requests.',\n        format_error: 'This tool returned a non-JSON-serializable output. Adjust parameters to return structured JSON, or check read_skill_documentation.',\n        environment_restriction: 'This tool appears blocked by the browser environment (CORS / same-origin policy, mixed content, or blocked network request). Do NOT retry the same call. Explain the limitation to the user and suggest running in Node.js, or using an explicitly configured proxy/alternative source.',\n        node_io_error: 'This tool appears to have hit a Node.js filesystem error (missing file/dir or permissions). Verify the path, check permissions, and confirm the working directory before retrying.',\n        node_network_error: 'This tool appears to have hit a Node.js network error. Verify host/port, connectivity, and whether the service is running before retrying.',\n        patch_format_error: 'apply_patch format is invalid. Keep using apply_patch, fix to \"*** Begin Patch ... *** Delete File: <path> ... *** End Patch\", and retry once. Do not switch to list_available_skills for syntax-only failures.',\n    };\n\n    const baseAdvice = hardStop\n        ? [\n            'STOP: You have repeated the same failing tool call. You MUST change your approach.',\n            adviceByType[state.failureType] || 'Verify inputs and environment, then change approach.',\n            'Do not retry with the same parameters. Either adjust inputs materially, or switch tools. If unsure, use list_available_skills and read_skill_documentation.',\n        ].join(' ')\n        : [\n            'This tool has failed repeatedly. Change strategy instead of retrying the same call.',\n            adviceByType[state.failureType] || 'Verify inputs and environment first (e.g. for run_command: try \"pwd\" and \"ls\"; for file/path issues: confirm the path).',\n            'If unsure, use list_available_skills and read_skill_documentation to find an appropriate alternative.',\n        ].join(' ');\n\n    if (output && typeof output === 'object' && !Array.isArray(output)) {\n        return {\n            ...output,\n            _self_heal: {\n                repeatedFailures: state.count,\n                failureType: state.failureType || null,\n                intervention: hardStop ? 'hard_stop' : 'soft_hint',\n                advice: baseAdvice,\n            },\n        };\n    }\n\n    return {\n        result: output,\n        _self_heal: {\n            repeatedFailures: state.count,\n            failureType: state.failureType || null,\n            intervention: hardStop ? 'hard_stop' : 'soft_hint',\n            advice: baseAdvice,\n        },\n    };\n}\n\nmodule.exports = {\n    isBrowserRuntime,\n    isBrowserEnvRestrictionLikeMessage,\n    classifyToolFailure,\n    recordToolFailure,\n    clearToolFailure,\n    withSelfHealHint,\n};\n", "// MCP adapter helpers (pure JS, works in Node + Browser).\n//\n// Reference: codex-main/codex-rs/mcp-types/src/lib.rs\n// - Tool.inputSchema\n// - CallToolResult: { content: ContentBlock[], isError?: boolean, structuredContent?: any }\n\nfunction toMcpInputSchema(parameters) {\n    const p = parameters && typeof parameters === 'object' ? parameters : null;\n    const schema = {\n        type: 'object',\n        properties: {},\n    };\n\n    if (!p) return schema;\n\n    // Our existing tool shape uses `parameters` (OpenAI-like) with JSON Schema.\n    if (p.type) schema.type = p.type;\n    if (p.properties && typeof p.properties === 'object') schema.properties = p.properties;\n    if (Array.isArray(p.required)) schema.required = p.required;\n    if (p.description) schema.description = p.description;\n    if (p.title) schema.title = p.title;\n\n    return schema;\n}\n\nfunction _isContentBlockArray(content) {\n    return Array.isArray(content) && content.every((b) => b && typeof b === 'object' && typeof b.type === 'string');\n}\n\nfunction toMcpCallToolResult(output, { isError } = {}) {\n    // If the tool already returns MCP style, keep it (best-effort normalize).\n    if (output && typeof output === 'object' && !Array.isArray(output)) {\n        const hasContent = _isContentBlockArray(output.content);\n        const normalized = {\n            content: hasContent ? output.content : undefined,\n            structuredContent: output.structuredContent,\n            isError: (typeof output.isError === 'boolean') ? output.isError : undefined,\n        };\n\n        if (!normalized.content) {\n            // Fallback: stringify the object into a text block.\n            normalized.structuredContent = (normalized.structuredContent === undefined) ? output : normalized.structuredContent;\n            normalized.content = [{ type: 'text', text: JSON.stringify(output, null, 2) }];\n        }\n\n        if (typeof isError === 'boolean') normalized.isError = isError;\n        return normalized;\n    }\n\n    if (typeof output === 'string') {\n        return {\n            content: [{ type: 'text', text: output }],\n            ...(typeof isError === 'boolean' ? { isError } : null),\n        };\n    }\n\n    // numbers/booleans/null/arrays => stringify into text, preserve structuredContent.\n    return {\n        content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        structuredContent: output,\n        ...(typeof isError === 'boolean' ? { isError } : null),\n    };\n}\n\nmodule.exports = {\n    toMcpInputSchema,\n    toMcpCallToolResult,\n};\n", "function isPlainObject(value) {\n    if (!value || typeof value !== 'object') return false;\n    if (Array.isArray(value)) return false;\n    const proto = Object.getPrototypeOf(value);\n    return proto === Object.prototype || proto === null;\n}\n\nfunction toFiniteInt(value, fallback) {\n    const n = Number(value);\n    if (!Number.isFinite(n)) return fallback;\n    return Math.floor(n);\n}\n\nfunction byteLength(text) {\n    const s = String(text == null ? '' : text);\n    try {\n        if (typeof Buffer !== 'undefined' && Buffer && typeof Buffer.byteLength === 'function') {\n            return Buffer.byteLength(s, 'utf8');\n        }\n    } catch {\n        // ignore\n    }\n    try {\n        if (typeof TextEncoder !== 'undefined') {\n            return new TextEncoder().encode(s).length;\n        }\n    } catch {\n        // ignore\n    }\n    return s.length;\n}\n\nfunction safeJson(value) {\n    try {\n        return JSON.stringify(value);\n    } catch {\n        return null;\n    }\n}\n\nconst MAX_MEASURE_JSON_CHARS = 100000;\n\nconst DEFAULT_TOOL_OUTPUT_LIMITS = {\n    maxStringChars: 12000,\n    headChars: 8000,\n    tailChars: 2000,\n    maxArrayItems: 60,\n    maxObjectKeys: 60,\n    maxDepth: 5,\n};\n\nfunction mergeLimits(raw) {\n    const limits = isPlainObject(raw) ? raw : null;\n    const out = { ...DEFAULT_TOOL_OUTPUT_LIMITS };\n    if (!limits) return out;\n    out.maxStringChars = Math.max(256, toFiniteInt(limits.maxStringChars, out.maxStringChars));\n    out.headChars = Math.max(0, toFiniteInt(limits.headChars, out.headChars));\n    out.tailChars = Math.max(0, toFiniteInt(limits.tailChars, out.tailChars));\n    out.maxArrayItems = Math.max(0, toFiniteInt(limits.maxArrayItems, out.maxArrayItems));\n    out.maxObjectKeys = Math.max(0, toFiniteInt(limits.maxObjectKeys, out.maxObjectKeys));\n    out.maxDepth = Math.max(1, toFiniteInt(limits.maxDepth, out.maxDepth));\n    return out;\n}\n\nfunction buildGuarded({ toolName, kind, original, preview, meta }) {\n    const originalJson = safeJson(original);\n    const previewJson = safeJson(preview);\n    const originalBytes = (originalJson && originalJson.length <= MAX_MEASURE_JSON_CHARS)\n        ? byteLength(originalJson)\n        : null;\n    const keptBytes = (previewJson && previewJson.length <= MAX_MEASURE_JSON_CHARS)\n        ? byteLength(previewJson)\n        : null;\n    return {\n        _agentsjs_tool_output_guard: {\n            tool: toolName || '',\n            kind,\n            truncated: true,\n            originalBytes,\n            keptBytes,\n            ...meta,\n        },\n        preview,\n    };\n}\n\nfunction guardString({ toolName, value, limits }) {\n    const s = String(value);\n    const maxChars = limits.maxStringChars;\n    if (s.length <= maxChars) return s;\n\n    const head = s.slice(0, Math.min(limits.headChars, maxChars));\n    const tailBudget = Math.max(0, maxChars - head.length);\n    const tail = limits.tailChars > 0\n        ? s.slice(Math.max(0, s.length - Math.min(limits.tailChars, tailBudget)))\n        : '';\n    const sep = (tail && head) ? '\\n...\\n' : '...';\n    const preview = `${head}${sep}${tail}`;\n    return buildGuarded({\n        toolName,\n        kind: 'string',\n        original: s,\n        preview,\n        meta: {\n            originalChars: s.length,\n            keptChars: preview.length,\n        },\n    });\n}\n\nfunction guardValueInner({ toolName, value, limits, depth, seen }) {\n    if (value === null || value === undefined) return value;\n    const t = typeof value;\n    if (t === 'string') return guardString({ toolName, value, limits });\n    if (t === 'number' || t === 'boolean') return value;\n    if (t !== 'object') return String(value);\n\n    if (seen.has(value)) {\n        return buildGuarded({\n            toolName,\n            kind: 'circular',\n            original: '[Circular]',\n            preview: '[Circular]',\n            meta: {},\n        });\n    }\n\n    if (depth >= limits.maxDepth) {\n        return buildGuarded({\n            toolName,\n            kind: 'max_depth',\n            original: value,\n            preview: `[Truncated: maxDepth=${limits.maxDepth}]`,\n            meta: { maxDepth: limits.maxDepth },\n        });\n    }\n\n    seen.add(value);\n\n    if (Array.isArray(value)) {\n        const originalLen = value.length;\n        const maxItems = limits.maxArrayItems;\n        const kept = maxItems > 0 ? value.slice(0, maxItems) : [];\n        const preview = kept.map((item) => guardValueInner({ toolName, value: item, limits, depth: depth + 1, seen }));\n        if (originalLen <= maxItems) return preview;\n        return buildGuarded({\n            toolName,\n            kind: 'array',\n            original: value,\n            preview,\n            meta: { originalItems: originalLen, keptItems: preview.length },\n        });\n    }\n\n    if (!isPlainObject(value)) {\n        const json = safeJson(value);\n        if (json && json.length <= limits.maxStringChars) return value;\n        return buildGuarded({\n            toolName,\n            kind: 'non_plain_object',\n            original: json || String(value),\n            preview: (json && json.length > limits.maxStringChars)\n                ? guardString({ toolName, value: json, limits }).preview\n                : (json || String(value)),\n            meta: { originalType: Object.prototype.toString.call(value) },\n        });\n    }\n\n    const entries = Object.entries(value);\n    const maxKeys = limits.maxObjectKeys;\n    const keptEntries = maxKeys > 0 ? entries.slice(0, maxKeys) : [];\n    const preview = {};\n    for (const [k, v] of keptEntries) {\n        preview[k] = guardValueInner({ toolName, value: v, limits, depth: depth + 1, seen });\n    }\n    if (entries.length <= maxKeys) return preview;\n    return buildGuarded({\n        toolName,\n        kind: 'object',\n        original: value,\n        preview,\n        meta: { originalKeys: entries.length, keptKeys: keptEntries.length },\n    });\n}\n\nfunction guardToolOutput({ toolName, value, limits }) {\n    const merged = mergeLimits(limits);\n    const seen = new Set();\n    return guardValueInner({ toolName, value, limits: merged, depth: 0, seen });\n}\n\nmodule.exports = {\n    DEFAULT_TOOL_OUTPUT_LIMITS,\n    guardToolOutput,\n};\n", "const { toMcpCallToolResult } = require('./mcp-adapter');\nconst { guardToolOutput } = require('./agent-tool-output-guard');\nconst {\n    DEFAULT_LOOP_FINGERPRINT_THRESHOLD,\n    safeJsonStringify,\n} = require('./self-heal');\nconst {\n    withSelfHealHint,\n} = require('./agent-self-heal');\n\nfunction wrapToolOutput({ toolFailureStreak, toolName, output, isError, limits }) {\n    const alreadyGuarded = output\n        && typeof output === 'object'\n        && output._agentsjs_tool_output_guard\n        && Object.prototype.hasOwnProperty.call(output, 'preview');\n    const guardedOutput = alreadyGuarded ? output : guardToolOutput({ toolName, value: output, limits });\n    const wrapped = withSelfHealHint({\n        toolFailureStreak,\n        toolName,\n        output: guardedOutput,\n        defaultLoopFingerprintThreshold: DEFAULT_LOOP_FINGERPRINT_THRESHOLD,\n    });\n    return toMcpCallToolResult(wrapped, { isError });\n}\n\nfunction buildToolResultMessage({ callId, toolName, mcpResult }) {\n    return {\n        role: 'system',\n        tool_call_id: callId,\n        name: toolName,\n        content: safeJsonStringify(mcpResult),\n    };\n}\n\nmodule.exports = { wrapToolOutput, buildToolResultMessage };\n", "const { makeFailureFingerprint } = require('./self-heal');\nconst { recordToolFailure } = require('./agent-self-heal');\nconst { buildToolResultMessage, wrapToolOutput } = require('./agent-tool-formatter');\nconst { RiskLevel } = require('./imda-constants');\nconst { getToolIntent } = require('./agent-tools-registry');\nconst { getApprovalDecision, riskLabel, isApprovedResponse } = require('./imda-policy');\nconst { buildApprovalQuestion } = require('./approval-copy');\nconst { makeApprovalArgsHash, makeApprovalDenyKey } = require('./agent-tool-approval-keys');\n\nfunction buildApprovalDeniedResult({ agent, callId, toolName, args, timedOut }) {\n    const argsHash = makeApprovalArgsHash(args);\n    const output = timedOut\n        ? {\n            error: 'ApprovalTimeout',\n            timeoutMs: agent.approvalTimeoutMs,\n            message: 'Approval request timed out.',\n            tool: toolName,\n            argsHash,\n            guidance: 'Approval was not granted for this specific tool call. Do not retry the exact same call in this turn.'\n        }\n        : {\n            error: 'ApprovalDenied',\n            message: 'User denied approval.',\n            tool: toolName,\n            argsHash,\n            guidance: 'User denied approval for this specific tool call. Do not retry the exact same call in this turn.'\n        };\n    recordToolFailure({\n        toolFailureStreak: agent._toolFailureStreak,\n        toolName,\n        fingerprintOrType: 'approval_denied',\n        args,\n        makeFailureFingerprint,\n    });\n    const mcpResult = wrapToolOutput({\n        toolFailureStreak: agent._toolFailureStreak,\n        toolName,\n        output,\n        isError: true,\n        limits: agent && agent.toolOutputLimits,\n    });\n    return buildToolResultMessage({ callId, toolName, mcpResult });\n}\n\nasync function requireApprovalIfNeeded({ agent, call, tool, args, toolRisk, agentTier, batchDecisions }) {\n    const decisions = batchDecisions || new Map();\n\n    if (decisions.has(call.id)) {\n        const decision = decisions.get(call.id);\n        if (!decision.approved) {\n            agent._setState('thinking', { reason: decision.timedOut ? 'approval_timeout' : 'approval_denied' });\n            return {\n                deniedResultMessage: buildApprovalDeniedResult({\n                    agent,\n                    callId: call.id,\n                    toolName: call.name,\n                    args,\n                    timedOut: decision.timedOut,\n                })\n            };\n        }\n        return { deniedResultMessage: null };\n    }\n\n    const decision = getApprovalDecision({\n        toolName: call.name,\n        toolRisk,\n        agentTier,\n        approvalPolicy: agent && agent.approvalPolicy,\n        trustedTools: agent && agent.trustedTools,\n    });\n    if (decision && decision.bypassed && agent && typeof agent.emit === 'function') {\n        agent.emit('approval_skipped', {\n            tool: call.name,\n            risk: toolRisk,\n            policy: agent.approvalPolicy || 'always',\n            reason: decision.reason,\n            args,\n            timestamp: new Date().toISOString(),\n        });\n    }\n    if (!decision || !decision.requires) {\n        return { deniedResultMessage: null };\n    }\n\n    if (!agent._approvalDenies) agent._approvalDenies = new Set();\n    const denyKey = makeApprovalDenyKey(call.name, args);\n    if (agent._approvalDenies.has(denyKey)) {\n        agent._setState('thinking', { reason: 'approval_denied_cached' });\n        return {\n            deniedResultMessage: buildApprovalDeniedResult({\n                agent,\n                callId: call.id,\n                toolName: call.name,\n                args,\n                timedOut: false,\n            })\n        };\n    }\n\n    const approvalMode = (tool && tool.approvalMode === 'per_turn') ? 'per_turn' : 'per_call';\n    const cached = approvalMode === 'per_turn'\n        && toolRisk < RiskLevel.HIGH\n        && agent\n        && agent._approvalGrants\n        && agent._approvalGrants.has(call.name);\n    if (cached) return { deniedResultMessage: null };\n\n    const approvalCallId = `approval:${call.id || call.name}`;\n    const approvalQuestion = (agent && agent.debug)\n        ? `Approve tool call: ${call.name} (${riskLabel(toolRisk)})?`\n        : buildApprovalQuestion({ toolName: call.name, toolRisk, isDebug: false });\n    const meta = tool && tool.meta ? tool.meta : null;\n    const intent = getToolIntent(agent, call.name, args) || undefined;\n    agent.emit('approval_required', {\n        callId: approvalCallId,\n        tool: call.name,\n        risk: toolRisk,\n        args,\n        intent,\n        permissions: meta && Array.isArray(meta.permissions) ? meta.permissions : [],\n        rateLimit: meta && meta.rateLimit ? meta.rateLimit : null,\n        promptSnapshot: approvalQuestion,\n    });\n    agent._setState('awaiting_input', { callId: approvalCallId, tool: call.name, risk: toolRisk });\n    const approvalPromise = agent._awaitUserInput(approvalCallId, agent.approvalTimeoutMs);\n    agent.emit('user_input_requested', {\n        callId: approvalCallId,\n        questions: [{ question: approvalQuestion, options: ['Approve', 'Deny'] }],\n    });\n    const approval = await approvalPromise;\n    if (approval.timedOut || !isApprovedResponse(approval.value)) {\n        agent._setState('thinking', { reason: 'approval_denied' });\n        agent._approvalDenies.add(denyKey);\n        return {\n            deniedResultMessage: buildApprovalDeniedResult({\n                agent,\n                callId: call.id,\n                toolName: call.name,\n                args,\n                timedOut: approval.timedOut,\n            })\n        };\n    }\n    agent._approvalDenies.delete(denyKey);\n    if (approvalMode === 'per_turn' && agent && agent._approvalGrants) agent._approvalGrants.add(call.name);\n    agent._setState('thinking', { reason: 'approval_granted' });\n    return { deniedResultMessage: null };\n}\n\nmodule.exports = {\n    buildApprovalDeniedResult,\n    requireApprovalIfNeeded,\n};\n", "const { makeApprovalDenyKey } = require('./agent-tool-approval-keys');\nconst { prepareBatchApprovals } = require('./agent-tool-approval-batch');\nconst { buildApprovalDeniedResult, requireApprovalIfNeeded } = require('./agent-tool-approval-single');\n\nmodule.exports = {\n    buildApprovalDeniedResult,\n    requireApprovalIfNeeded,\n    makeApprovalDenyKey,\n    prepareBatchApprovals,\n};\n", "function callToolWithTimeout({ fn, timeoutMs, defaultTimeoutMs }) {\n    const ms = (typeof timeoutMs === 'number' && timeoutMs > 0) ? timeoutMs : defaultTimeoutMs;\n    let timer;\n\n    const timeoutPromise = new Promise((resolve) => {\n        timer = setTimeout(() => resolve({ timedOut: true }), ms);\n        if (timer && typeof timer.unref === 'function') timer.unref();\n    });\n\n    return Promise.resolve()\n        .then(() => Promise.race([\n            Promise.resolve().then(fn).then((v) => ({ timedOut: false, value: v })),\n            timeoutPromise,\n        ]))\n        .finally(() => {\n            if (timer) clearTimeout(timer);\n        });\n}\n\nmodule.exports = { callToolWithTimeout };\n", "function now() {\n    if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n        return performance.now();\n    }\n    return Date.now();\n}\n\nfunction getActiveToolsSnapshot(agent) {\n    const timestamp = now();\n    return Array.from(agent._activeTools.values()).map((entry) => ({\n        id: entry.id,\n        name: entry.name,\n        elapsedMs: Math.max(0, Math.round(timestamp - entry.startTime)),\n    }));\n}\n\nmodule.exports = { now, getActiveToolsSnapshot };\n", "const { guardToolOutput } = require('./agent-tool-output-guard');\nconst { now, getActiveToolsSnapshot } = require('./agent-timing');\n\nfunction beginToolCall({ agent, call, args, toolMeta }) {\n    const startTime = now();\n    agent._activeTools.set(call.id, { id: call.id, name: call.name, startTime });\n    agent.emit('tool_call_begin', {\n        id: call.id,\n        name: call.name,\n        args: args === undefined ? null : args,\n        timestamp: new Date().toISOString(),\n    });\n    agent._setState('executing', { toolCalls: toolMeta, active: getActiveToolsSnapshot(agent) });\n    return startTime;\n}\n\nfunction emitToolResult({ agent, toolName, args, output }) {\n    const guarded = guardToolOutput({\n        toolName,\n        value: output,\n        limits: agent && agent.toolOutputLimits,\n    });\n    agent.emit('tool_result', { tool: toolName, args: args === undefined ? null : args, result: guarded });\n    return guarded;\n}\n\nfunction endToolCall({ agent, callId, toolName, startTime, success }) {\n    const endTime = now();\n    agent._activeTools.delete(callId);\n    agent.emit('tool_call_end', {\n        id: callId,\n        name: toolName,\n        success: Boolean(success),\n        durationMs: Math.max(0, Math.round(endTime - (startTime || endTime))),\n    });\n    if (agent._activeTools.size > 0) {\n        agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n    }\n    return endTime;\n}\n\nmodule.exports = {\n    beginToolCall,\n    emitToolResult,\n    endToolCall,\n};\n", "function normalizeToken(token) {\n    return (token || '').trim().toLowerCase();\n}\n\nfunction isEnvAssignmentToken(token) {\n    const t = String(token || '').trim();\n    if (!t) return false;\n    if (t.startsWith('-')) return false;\n    const idx = t.indexOf('=');\n    if (idx <= 0) return false;\n    return idx < t.length - 1;\n}\n\nfunction splitCommandSegments(input) {\n    const s = String(input || '');\n    const segments = [];\n    let buf = '';\n    let quote = null; // '\\'' | '\"' | null\n    let escape = false;\n\n    const push = () => {\n        const out = buf.trim();\n        if (out) segments.push(out);\n        buf = '';\n    };\n\n    for (let i = 0; i < s.length; i++) {\n        const ch = s[i];\n\n        if (escape) {\n            buf += ch;\n            escape = false;\n            continue;\n        }\n\n        if (ch === '\\\\') {\n            // Keep escapes; only treat as escape outside single quotes.\n            if (quote !== \"'\") {\n                escape = true;\n            }\n            buf += ch;\n            continue;\n        }\n\n        if (quote) {\n            buf += ch;\n            if (ch === quote) quote = null;\n            continue;\n        }\n\n        if (ch === '\"' || ch === \"'\") {\n            quote = ch;\n            buf += ch;\n            continue;\n        }\n\n        // separators outside quotes\n        if (ch === ';' || ch === '\\n' || ch === '\\r') {\n            push();\n            continue;\n        }\n\n        if (ch === '&' && s[i + 1] === '&') {\n            push();\n            i++;\n            continue;\n        }\n\n        if (ch === '|' && s[i + 1] === '|') {\n            push();\n            i++;\n            continue;\n        }\n\n        if (ch === '|') {\n            push();\n            continue;\n        }\n\n        buf += ch;\n    }\n\n    push();\n    return segments;\n}\n\nfunction scanUnsafeOperators(command) {\n    const s = String(command || '');\n    let quote = null;\n    let escape = false;\n\n    const isShellName = (name) => {\n        const n = normalizeToken(name);\n        if (!n) return false;\n        if (n === 'sh' || n === 'bash' || n === 'zsh') return true;\n        if (n === 'powershell' || n === 'powershell.exe' || n === 'pwsh' || n === 'pwsh.exe') return true;\n        return false;\n    };\n\n    const basename = (p) => {\n        const raw = String(p || '');\n        const parts = raw.split(/[\\\\/]/).filter(Boolean);\n        return parts.length ? parts[parts.length - 1] : raw;\n    };\n\n    const readWord = (startIdx) => {\n        let i = startIdx;\n        while (i < s.length && /\\s/.test(s[i])) i++;\n        let j = i;\n        while (j < s.length && !/\\s/.test(s[j]) && !['|', '&', ';', '>', '<', '\\n', '\\r'].includes(s[j])) j++;\n        return { word: s.slice(i, j), next: j };\n    };\n\n    for (let i = 0; i < s.length; i++) {\n        const ch = s[i];\n\n        if (escape) {\n            escape = false;\n            continue;\n        }\n\n        if (ch === '\\\\') {\n            if (quote !== \"'\") escape = true;\n            continue;\n        }\n\n        if (quote) {\n            if (ch === quote) quote = null;\n            continue;\n        }\n\n        if (ch === '\"' || ch === \"'\") {\n            quote = ch;\n            continue;\n        }\n\n        // Redirection to absolute POSIX paths, e.g. > /etc/passwd, >>/root/x\n        if (ch === '>') {\n            let j = i + 1;\n            if (s[j] === '>') j++;\n            while (j < s.length && /\\s/.test(s[j])) j++;\n            if (s[j] === '/') {\n                return { safe: false, reason: 'redirection to absolute path is restricted' };\n            }\n            continue;\n        }\n\n        // Pipe-to-shell, e.g. curl ... | sh\n        if (ch === '|') {\n            if (s[i + 1] === '|') {\n                i++;\n                continue;\n            }\n            const first = readWord(i + 1);\n            let next = first.next;\n            const firstName = basename(first.word);\n            if (isShellName(firstName)) {\n                return { safe: false, reason: 'piping into a shell is restricted' };\n            }\n\n            // Handle wrappers like: curl ... | env sh\n            if (normalizeToken(firstName) === 'env') {\n                let second = readWord(next);\n                next = second.next;\n                while (second.word && (normalizeToken(second.word).startsWith('-') || isEnvAssignmentToken(second.word))) {\n                    second = readWord(next);\n                    next = second.next;\n                }\n                const secondName = basename(second.word);\n                if (isShellName(secondName)) {\n                    return { safe: false, reason: 'piping into a shell is restricted' };\n                }\n            }\n\n            i = next - 1;\n            continue;\n        }\n    }\n\n    return { safe: true };\n}\n\nfunction splitArgv(input) {\n    const s = String(input || '').trim();\n    if (!s) return [];\n\n    const out = [];\n    let buf = '';\n    let quote = null;\n    let escape = false;\n\n    const push = () => {\n        if (buf.length) out.push(buf);\n        buf = '';\n    };\n\n    for (let i = 0; i < s.length; i++) {\n        const ch = s[i];\n\n        if (escape) {\n            buf += ch;\n            escape = false;\n            continue;\n        }\n\n        if (ch === '\\\\') {\n            if (quote !== \"'\") {\n                escape = true;\n            }\n            continue;\n        }\n\n        if (quote) {\n            if (ch === quote) {\n                quote = null;\n            } else {\n                buf += ch;\n            }\n            continue;\n        }\n\n        if (ch === '\"' || ch === \"'\") {\n            quote = ch;\n            continue;\n        }\n\n        if (ch === ' ' || ch === '\\t' || ch === '\\n' || ch === '\\r') {\n            if (buf.length) push();\n            continue;\n        }\n\n        buf += ch;\n    }\n\n    if (buf.length) push();\n    return out;\n}\n\nfunction isShellWrapper(tokens) {\n    const filtered = tokens.filter(Boolean);\n    const t = filtered.map(normalizeToken).filter(Boolean);\n    let cmd0 = t[0];\n    if (!cmd0) return null;\n\n    // Support wrappers like: env FOO=bar bash -c \"...\"\n    let tokenBase = filtered;\n    let tBase = t;\n    if (cmd0 === 'env') {\n        let idx = 1;\n        while (idx < tBase.length) {\n            const tk = tBase[idx];\n            if (tk.startsWith('-') || isEnvAssignmentToken(tokenBase[idx])) {\n                idx++;\n                continue;\n            }\n            break;\n        }\n        if (idx >= tBase.length) return null;\n        tokenBase = tokenBase.slice(idx);\n        tBase = tBase.slice(idx);\n        cmd0 = tBase[0];\n    }\n\n    if (cmd0 === 'bash' || cmd0 === 'zsh' || cmd0 === 'sh') {\n        const idx = tBase.findIndex((x) => x === '-c' || x === '-lc');\n        if (idx !== -1 && tokenBase[idx + 1]) {\n            const payload = tokenBase.slice(idx + 1).join(' ');\n            if (payload) return { payload };\n        }\n    }\n\n    if (cmd0 === 'cmd' || cmd0 === 'cmd.exe') {\n        const idx = tBase.findIndex(x => x === '/c' || x === '/r' || x === '-c');\n        if (idx !== -1) {\n            const payload = tokenBase.slice(idx + 1).join(' ');\n            if (payload) return { payload };\n        }\n    }\n\n    if (cmd0 === 'powershell' || cmd0 === 'powershell.exe' || cmd0 === 'pwsh' || cmd0 === 'pwsh.exe') {\n        const idx = tBase.findIndex((x) => x === '-command' || x === '/command' || x === '-c');\n        if (idx !== -1 && tokenBase[idx + 1]) {\n            const payload = tokenBase.slice(idx + 1).join(' ');\n            if (payload) return { payload };\n        }\n    }\n\n    return null;\n}\n\nmodule.exports = {\n    normalizeToken,\n    isEnvAssignmentToken,\n    splitCommandSegments,\n    scanUnsafeOperators,\n    splitArgv,\n    isShellWrapper,\n};\n", "const { normalizeToken, isEnvAssignmentToken } = require('./command-parser');\n\nfunction looksLikeGitExecutable(cmd0) {\n    return !!cmd0 && (cmd0.endsWith('git') || cmd0.endsWith('/git') || cmd0.endsWith('\\\\git'));\n}\n\nfunction isDangerousTokens(tokens) {\n    const filtered = tokens.filter(Boolean);\n    const t = filtered.map(normalizeToken).filter(Boolean);\n    if (t.length === 0) return { dangerous: false };\n\n    const unwrapLeadingWrappers = (raw, norm) => {\n        let i = 0;\n        if (norm[i] === 'sudo') {\n            i++;\n            if (i >= norm.length) return { dangerous: true, reason: 'sudo without command' };\n        }\n        if (norm[i] === 'env') {\n            i++;\n            while (i < norm.length && (norm[i].startsWith('-') || isEnvAssignmentToken(raw[i]))) i++;\n        }\n        return { raw: raw.slice(i), norm: norm.slice(i) };\n    };\n\n    const unwrapped = unwrapLeadingWrappers(filtered, t);\n    if (unwrapped.dangerous) return { dangerous: true, reason: unwrapped.reason };\n    const raw = unwrapped.raw;\n    const n = unwrapped.norm;\n    if (n.length === 0) return { dangerous: false };\n\n    const first = n[0];\n\n    // git reset / git rm\n    if (looksLikeGitExecutable(first)) {\n        const sub = n[1];\n        if (sub === 'reset') return { dangerous: true, reason: 'git reset is restricted' };\n        if (sub === 'rm') return { dangerous: true, reason: 'git rm is restricted' };\n    }\n\n    // rm -f / rm -rf / rm -r -f\n    if (first === 'rm') {\n        const flags = new Set(n.slice(1).filter(x => x.startsWith('-')));\n        const hasF = flags.has('-f') || flags.has('-rf') || flags.has('-fr');\n        const hasR = flags.has('-r') || flags.has('-rf') || flags.has('-fr') || flags.has('-rr') || flags.has('-rR');\n        // Handle split flags: -r -f\n        if (hasF) return { dangerous: true, reason: 'rm with force is restricted' };\n        if (hasR && flags.has('-f')) return { dangerous: true, reason: 'rm -r -f is restricted' };\n    }\n\n    // chmod 777 (anywhere in token stream)\n    if (first === 'chmod') {\n        if (n.includes('777') || n.some(x => x === '-R' || x === '-r') && n.includes('777')) {\n            return { dangerous: true, reason: 'chmod 777 is restricted' };\n        }\n    }\n\n    // mkfs*, dd\n    if (first.startsWith('mkfs')) return { dangerous: true, reason: 'mkfs is restricted' };\n    if (first === 'dd') return { dangerous: true, reason: 'dd is restricted' };\n\n    // Windows CMD destructive patterns (best-effort)\n    if (first === 'del' || first === 'erase') {\n        if (n.includes('/f')) return { dangerous: true, reason: 'del/erase with /f is restricted' };\n    }\n    if (first === 'rd' || first === 'rmdir') {\n        if (n.includes('/s') && n.includes('/q')) return { dangerous: true, reason: 'rd/rmdir with /s /q is restricted' };\n    }\n\n    const interpreterFlagByCmd = {\n        python: '-c',\n        python3: '-c',\n        py: '-c',\n        node: '-e',\n        perl: '-e',\n        ruby: '-e',\n        php: '-r',\n    };\n    const evalFlag = interpreterFlagByCmd[first];\n    if (evalFlag) {\n        const idx = n.findIndex((x) => x === evalFlag || (first === 'node' && x === '--eval'));\n        if (idx !== -1 && raw[idx + 1]) {\n            const payload = String(raw.slice(idx + 1).join(' ')).toLowerCase();\n            const hasExecPrimitive = (\n                payload.includes('os.system') ||\n                payload.includes('subprocess') ||\n                payload.includes('child_process') ||\n                payload.includes('spawn(') ||\n                payload.includes('exec(') ||\n                payload.includes('popen(') ||\n                payload.includes('system(')\n            );\n            const hasDangerousCommand = (\n                /rm\\s+-[^\\n]*f/.test(payload) ||\n                payload.includes('git reset') ||\n                payload.includes('git rm') ||\n                payload.includes('mkfs') ||\n                /\\bdd\\s+if=/.test(payload) ||\n                payload.includes('chmod 777')\n            );\n            if (hasExecPrimitive && hasDangerousCommand) {\n                return { dangerous: true, reason: 'interpreter inline command execution is restricted' };\n            }\n        }\n    }\n\n    return { dangerous: false };\n}\n\nmodule.exports = { isDangerousTokens };\n", "const {\n    splitCommandSegments,\n    scanUnsafeOperators,\n    splitArgv,\n    isShellWrapper,\n} = require('./command-parser');\nconst { isDangerousTokens } = require('./command-danger-zone');\n\nfunction isNodeRuntime() {\n    return (\n        typeof window === 'undefined' &&\n        typeof process !== 'undefined' &&\n        !!(process.versions && process.versions.node)\n    );\n}\n\nfunction checkCommandString(command, depth = 0) {\n    if (depth > 5) {\n        return { safe: false, reason: 'command nesting too deep' };\n    }\n\n    const opScan = scanUnsafeOperators(command);\n    if (!opScan.safe) return opScan;\n\n    const segments = splitCommandSegments(command);\n    for (const seg of segments) {\n        const argv = splitArgv(seg);\n        const wrap = isShellWrapper(argv);\n        if (wrap && wrap.payload) {\n            const inner = checkCommandString(wrap.payload, depth + 1);\n            if (!inner.safe) return inner;\n        }\n\n        const tokenRes = isDangerousTokens(argv);\n        if (tokenRes.dangerous) {\n            return { safe: false, reason: tokenRes.reason || 'Restricted command' };\n        }\n    }\n    return { safe: true };\n}\n\nclass SecurityValidator {\n    static validateTool(toolName, args, context = {}) {\n        const runtime = context.runtime || (isNodeRuntime() ? 'node' : 'browser');\n\n        if (toolName === 'run_command') {\n            if (runtime !== 'node') {\n                return {\n                    safe: false,\n                    reason: 'run_command is not supported in browser runtime',\n                    platform: runtime,\n                };\n            }\n\n            const command = args && typeof args.command === 'string' ? args.command : '';\n            const res = checkCommandString(command);\n            return {\n                safe: res.safe,\n                reason: res.safe ? undefined : res.reason,\n                platform: runtime,\n            };\n        }\n\n        if (toolName === 'apply_patch') {\n            if (runtime !== 'node') {\n                return {\n                    safe: false,\n                    reason: 'apply_patch is not supported in browser runtime',\n                    platform: runtime,\n                };\n            }\n            return { safe: true, platform: runtime };\n        }\n\n        return { safe: true, platform: runtime };\n    }\n}\n\nmodule.exports = { SecurityValidator };\n", "function _isNodeRuntime() {\n    return (typeof window === 'undefined'\n        && typeof process !== 'undefined'\n        && !!(process.versions && process.versions.node));\n}\n\nfunction _getSpawn() {\n    if (!_isNodeRuntime()) return null;\n    try {\n        // Avoid static bundler resolution of Node core modules in browser builds.\n        // eslint-disable-next-line no-eval\n        const req = (typeof require === 'function') ? require : (0, eval)('require');\n        const mod = req('child_process');\n        return mod && typeof mod.spawn === 'function' ? mod.spawn : null;\n    } catch {\n        return null;\n    }\n}\nconst { makeFailureFingerprint, DEFAULT_TOOL_TIMEOUT_MS, isRateLimitLike } = require('../self-heal');\nconst { recordToolFailure, clearToolFailure, classifyToolFailure } = require('../agent-self-heal');\nconst { wrapToolOutput, buildToolResultMessage } = require('../agent-tool-formatter');\nconst { guardToolOutput } = require('../agent-tool-output-guard');\nconst { now, getActiveToolsSnapshot } = require('../agent-timing');\nconst { SecurityValidator } = require('../security');\nfunction emitToolResultGuarded({ agent, toolName, args, output }) {\n    const guarded = guardToolOutput({\n        toolName,\n        value: output,\n        limits: agent && agent.toolOutputLimits,\n    });\n    if (agent && typeof agent.emit === 'function') {\n        agent.emit('tool_result', {\n            tool: toolName,\n            args,\n            result: guarded,\n        });\n    }\n    return guarded;\n}\nasync function handleRunCommand({ agent, call, args, startTime, signal }) {\n    const spawn = _getSpawn();\n    const command = args && typeof args.command === 'string' ? args.command : '';\n    if (signal && signal.aborted) {\n        const output = { error: 'Aborted', message: 'Execution aborted.' };\n        const guardedOutput = emitToolResultGuarded({ agent, toolName: call.name, args, output });\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: true,\n            limits: agent && agent.toolOutputLimits,\n        });\n        const resultMessage = buildToolResultMessage({\n            callId: call.id,\n            toolName: call.name,\n            mcpResult,\n        });\n        const endTime = now();\n        agent._activeTools.delete(call.id);\n        agent.emit('tool_call_end', {\n            id: call.id,\n            name: call.name,\n            success: false,\n            durationMs: Math.max(0, Math.round(endTime - startTime)),\n        });\n        if (agent._activeTools.size > 0) {\n            agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n        } else {\n            agent._setState('thinking', { reason: 'tool_aborted' });\n        }\n        return { handled: true, resultMessage };\n    }\n    const verdict = SecurityValidator.validateTool('run_command', { command });\n    if (!verdict.safe) {\n        const output = {\n            error: 'Access Denied',\n            reason: verdict.reason || 'Restricted command',\n            platform: verdict.platform,\n        };\n\n        const guardedOutput = emitToolResultGuarded({ agent, toolName: call.name, args, output });\n\n        recordToolFailure({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            fingerprintOrType: 'access_denied',\n            args,\n            makeFailureFingerprint,\n        });\n\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: true,\n            limits: agent && agent.toolOutputLimits,\n        });\n\n        const endTime = now();\n        agent._activeTools.delete(call.id);\n        agent.emit('tool_call_end', {\n            id: call.id,\n            name: call.name,\n            success: false,\n            durationMs: Math.max(0, Math.round(endTime - startTime)),\n        });\n        if (agent._activeTools.size > 0) {\n            agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n        }\n\n        const resultMessage = buildToolResultMessage({\n            callId: call.id,\n            toolName: call.name,\n            mcpResult,\n        });\n\n        return { handled: true, resultMessage };\n    }\n\n    const timeoutMs = (args && typeof args.timeoutMs === 'number' && Number.isFinite(args.timeoutMs) && args.timeoutMs > 0)\n        ? args.timeoutMs\n        : agent.toolTimeoutMs || DEFAULT_TOOL_TIMEOUT_MS;\n\n    agent.emit('exec_command_begin', {\n        id: call.id,\n        command,\n        timestamp: new Date().toISOString(),\n    });\n\n    let stdout = '';\n    let stderr = '';\n    let timedOut = false;\n\n    if (!spawn) {\n        const output = {\n            error: 'Environment Restriction',\n            message: 'run_command is not available in this runtime.',\n        };\n\n        const guardedOutput = emitToolResultGuarded({ agent, toolName: call.name, args, output });\n\n        recordToolFailure({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            fingerprintOrType: 'environment_restriction',\n            args,\n            makeFailureFingerprint,\n        });\n\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: true,\n            limits: agent && agent.toolOutputLimits,\n        });\n\n        const endTime = now();\n        agent._activeTools.delete(call.id);\n        agent.emit('tool_call_end', {\n            id: call.id,\n            name: call.name,\n            success: false,\n            durationMs: Math.max(0, Math.round(endTime - startTime)),\n        });\n        if (agent._activeTools.size > 0) {\n            agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n        }\n\n        const resultMessage = buildToolResultMessage({\n            callId: call.id,\n            toolName: call.name,\n            mcpResult,\n        });\n\n        return { handled: true, resultMessage };\n    }\n\n    const child = spawn(command, { shell: true });\n    let spawnError = null;\n    let aborted = false;\n    const timeout = setTimeout(() => {\n        timedOut = true;\n        child.kill('SIGKILL');\n    }, timeoutMs);\n\n    let abortHandler = null;\n    if (signal && typeof signal.addEventListener === 'function') {\n        abortHandler = () => {\n            aborted = true;\n            child.kill('SIGTERM');\n        };\n        if (signal.aborted) abortHandler();\n        else signal.addEventListener('abort', abortHandler, { once: true });\n    }\n\n    if (child.stdout) {\n        child.stdout.on('data', (chunk) => {\n            const text = String(chunk);\n            stdout += text;\n            agent.emit('exec_command_output', { id: call.id, stream: 'stdout', chunk: text });\n        });\n    }\n    if (child.stderr) {\n        child.stderr.on('data', (chunk) => {\n            const text = String(chunk);\n            stderr += text;\n            agent.emit('exec_command_output', { id: call.id, stream: 'stderr', chunk: text });\n        });\n    }\n\n    const exitCode = await new Promise((resolve) => {\n        child.on('error', (error) => {\n            spawnError = error;\n            resolve(1);\n        });\n        child.on('close', (code, signalName) => {\n            clearTimeout(timeout);\n            if (signalName === 'SIGTERM' || signalName === 'SIGKILL') timedOut = true;\n            resolve(typeof code === 'number' ? code : 0);\n        });\n    });\n    if (abortHandler && signal && typeof signal.removeEventListener === 'function') {\n        signal.removeEventListener('abort', abortHandler);\n    }\n\n    const output = {\n        stdout: String(stdout).trim(),\n        stderr: String(stderr).trim(),\n        exitCode: typeof exitCode === 'number' ? exitCode : 0,\n    };\n\n    if (spawnError) {\n        output.error = 'Tool execution failed';\n        output.message = String(spawnError.message || spawnError);\n    } else if (aborted) {\n        output.error = 'Aborted';\n        output.exitCode = 130;\n    } else if (timedOut) {\n        output.error = 'Timeout';\n        output.timeoutMs = timeoutMs;\n        output.exitCode = 124;\n    }\n\n    const failureType = timedOut\n        ? 'timeout'\n        : classifyToolFailure({ toolName: call.name, output, isRateLimitLike });\n\n    if (failureType) {\n        recordToolFailure({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            fingerprintOrType: failureType,\n            args,\n            makeFailureFingerprint,\n        });\n    } else {\n        clearToolFailure({ toolFailureStreak: agent._toolFailureStreak, toolName: call.name });\n    }\n\n    const mcpResult = wrapToolOutput({\n        toolFailureStreak: agent._toolFailureStreak,\n        toolName: call.name,\n        output: emitToolResultGuarded({ agent, toolName: call.name, args, output }),\n        isError: Boolean(failureType),\n        limits: agent && agent.toolOutputLimits,\n    });\n\n    const endTime = now();\n    agent._activeTools.delete(call.id);\n    agent.emit('exec_command_end', {\n        id: call.id,\n        command,\n        exitCode: output.exitCode,\n        success: !failureType,\n        durationMs: Math.max(0, Math.round(endTime - startTime)),\n    });\n    agent.emit('tool_call_end', {\n        id: call.id,\n        name: call.name,\n        success: !failureType,\n        durationMs: Math.max(0, Math.round(endTime - startTime)),\n    });\n    if (agent._activeTools.size > 0) {\n        agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n    }\n\n    const resultMessage = buildToolResultMessage({\n        callId: call.id,\n        toolName: call.name,\n        mcpResult,\n    });\n\n    return { handled: true, resultMessage };\n}\n\nmodule.exports = { handleRunCommand };\n", "function handleUpdatePlan({ agent, args }) {\n    const explanation = (args && typeof args.explanation === 'string') ? args.explanation : undefined;\n    const plan = (args && Array.isArray(args.plan)) ? args.plan : [];\n    agent.currentPlan = plan;\n    agent.emit('plan_updated', { explanation, plan });\n    return { handled: false };\n}\n\nmodule.exports = { handleUpdatePlan };\n", "const { makeFailureFingerprint } = require('../self-heal');\nconst { recordToolFailure, clearToolFailure } = require('../agent-self-heal');\nconst { wrapToolOutput, buildToolResultMessage } = require('../agent-tool-formatter');\nconst { guardToolOutput } = require('../agent-tool-output-guard');\nconst { now, getActiveToolsSnapshot } = require('../agent-timing');\n\nasync function handleRequestUserInput({ agent, call, args, startTime }) {\n    const questions = Array.isArray(args && args.questions)\n        ? args.questions\n        : (typeof (args && args.question) === 'string'\n            ? [{ question: args.question, options: Array.isArray(args.options) ? args.options : undefined }]\n            : []);\n    const waitPromise = agent._awaitUserInput(call.id, agent.toolTimeoutMs);\n    const payload = { callId: call.id, questions };\n    agent.emit('user_input_requested', payload);\n    agent._setState('awaiting_input', { callId: call.id, questions });\n\n    const result = await waitPromise;\n    const output = result.timedOut\n        ? { error: 'Timeout', timeoutMs: agent.toolTimeoutMs, message: 'User input timed out.' }\n        : { response: result.value };\n\n    const guardedOutput = guardToolOutput({\n        toolName: call.name,\n        value: output,\n        limits: agent && agent.toolOutputLimits,\n    });\n    agent.emit('tool_result', { tool: call.name, args, result: guardedOutput });\n\n    if (result.timedOut) {\n        recordToolFailure({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            fingerprintOrType: 'timeout',\n            args,\n            makeFailureFingerprint,\n        });\n    } else {\n        clearToolFailure({ toolFailureStreak: agent._toolFailureStreak, toolName: call.name });\n    }\n\n    const mcpResult = wrapToolOutput({\n        toolFailureStreak: agent._toolFailureStreak,\n        toolName: call.name,\n        output: guardedOutput,\n        isError: result.timedOut,\n        limits: agent && agent.toolOutputLimits,\n    });\n\n    const endTime = now();\n    agent._activeTools.delete(call.id);\n    agent.emit('tool_call_end', {\n        id: call.id,\n        name: call.name,\n        success: !result.timedOut,\n        durationMs: Math.max(0, Math.round(endTime - startTime)),\n    });\n    if (agent._activeTools.size > 0) {\n        agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n    } else {\n        agent._setState('thinking', { reason: 'user_input_received' });\n    }\n\n    const resultMessage = buildToolResultMessage({\n        callId: call.id,\n        toolName: call.name,\n        mcpResult,\n    });\n\n    return { handled: true, resultMessage };\n}\n\nmodule.exports = { handleRequestUserInput };\n", "const { handleRunCommand } = require('./tools/special-run-command');\nconst { handleUpdatePlan } = require('./tools/special-update-plan');\nconst { handleRequestUserInput } = require('./tools/special-user-input');\n\nasync function handleSpecialTool({ agent, call, args, startTime, signal }) {\n    if (call.name === 'run_command') {\n        return handleRunCommand({ agent, call, args, startTime, signal });\n    }\n\n    if (call.name === 'update_plan') {\n        return handleUpdatePlan({ agent, call, args, startTime, signal });\n    }\n\n    if (call.name !== 'request_user_input') {\n        return { handled: false };\n    }\n\n    return handleRequestUserInput({ agent, call, args, startTime, signal });\n}\n\nmodule.exports = { handleSpecialTool };\n", "const {\n    DEFAULT_TOOL_TIMEOUT_MS,\n    makeFailureFingerprint,\n    stableStringify,\n    isRateLimitLike,\n} = require('./self-heal');\nconst {\n    isBrowserRuntime,\n    isBrowserEnvRestrictionLikeMessage,\n    classifyToolFailure,\n    recordToolFailure,\n    clearToolFailure,\n} = require('./agent-self-heal');\nconst { callToolWithTimeout } = require('./agent-timeout');\nconst { buildToolResultMessage, wrapToolOutput } = require('./agent-tool-formatter');\nconst { guardToolOutput } = require('./agent-tool-output-guard');\nconst { beginToolCall, emitToolResult, endToolCall } = require('./agent-tool-exec-helpers');\nconst { handleSpecialTool } = require('./agent-tool-specials');\nconst { now, getActiveToolsSnapshot } = require('./agent-timing');\nconst { RiskLevel } = require('./imda-constants');\nconst { getToolRisk } = require('./agent-tools-registry');\nconst { requireApprovalIfNeeded } = require('./agent-tool-approval');\n\nasync function executeToolCall({ agent, call, toolMeta, batchDecisions, signal }) {\n    let startTime = null;\n    let began = false;\n    if (signal && signal.aborted) {\n        let argsForBegin = null;\n        try {\n            argsForBegin = typeof call.arguments === 'string' ? JSON.parse(call.arguments) : call.arguments;\n        } catch {\n            argsForBegin = null;\n        }\n        startTime = beginToolCall({ agent, call, args: argsForBegin, toolMeta });\n        began = true;\n\n        const output = { error: 'Aborted', message: 'Execution aborted.' };\n        const guardedOutput = emitToolResult({ agent, toolName: call.name, args: argsForBegin, output });\n\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: true,\n            limits: agent && agent.toolOutputLimits,\n        });\n        endToolCall({ agent, callId: call.id, toolName: call.name, startTime, success: false });\n        return buildToolResultMessage({ callId: call.id, toolName: call.name, mcpResult });\n    }\n    const tool = agent.tools[call.name];\n    if (!tool) {\n        startTime = now();\n        agent._activeTools.set(call.id, { id: call.id, name: call.name, startTime });\n        began = true;\n        agent.emit('tool_call_begin', { id: call.id, name: call.name, args: null, timestamp: new Date().toISOString() });\n        agent._setState('executing', { toolCalls: toolMeta, active: getActiveToolsSnapshot(agent) });\n        let argsForFingerprint;\n        try {\n            argsForFingerprint = typeof call.arguments === 'string' ? JSON.parse(call.arguments) : call.arguments;\n        } catch {\n            argsForFingerprint = undefined;\n        }\n\n        const output = {\n            error: 'Tool not found',\n            tool: call.name,\n            hint: \"Use list_available_skills to discover the correct tool, then read_skill_documentation before calling it.\",\n        };\n        const guardedOutput = emitToolResult({ agent, toolName: call.name, args: null, output });\n        recordToolFailure({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            fingerprintOrType: 'tool_not_found',\n            args: argsForFingerprint,\n            makeFailureFingerprint,\n        });\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: true,\n            limits: agent && agent.toolOutputLimits,\n        });\n        const endTime = now();\n        agent._activeTools.delete(call.id);\n        agent.emit('tool_call_end', {\n            id: call.id,\n            name: call.name,\n            success: false,\n            durationMs: Math.max(0, Math.round(endTime - startTime)),\n        });\n        agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n        return buildToolResultMessage({ callId: call.id, toolName: call.name, mcpResult });\n    }\n    try {\n        let args;\n        args = typeof call.arguments === 'string' ? JSON.parse(call.arguments) : call.arguments;\n        const toolRisk = getToolRisk(agent, call.name, tool);\n        const agentTier = agent.riskProfile ? agent.riskProfile.tier : RiskLevel.NONE;\n\n        const approval = await requireApprovalIfNeeded({\n            agent,\n            call,\n            tool,\n            args,\n            toolRisk,\n            agentTier,\n            batchDecisions,\n        });\n        if (approval && approval.deniedResultMessage) return approval.deniedResultMessage;\n\n        startTime = now();\n        agent._activeTools.set(call.id, { id: call.id, name: call.name, startTime });\n        began = true;\n        agent.emit('tool_call_begin', { id: call.id, name: call.name, args, timestamp: new Date().toISOString() });\n        agent._setState('executing', { toolCalls: toolMeta, active: getActiveToolsSnapshot(agent) });\n\n        const special = await handleSpecialTool({ agent, call, args, startTime, signal });\n        if (special && special.handled) {\n            return special.resultMessage;\n        }\n        console.log(`  > Executing ${call.name} with args:`, args);\n        const toolPromise = callToolWithTimeout({\n            fn: () => tool.func(args),\n            timeoutMs: agent.toolTimeoutMs,\n            defaultTimeoutMs: DEFAULT_TOOL_TIMEOUT_MS,\n        }).then((value) => ({ kind: 'tool', value })).catch((error) => ({ kind: 'error', error }));\n\n        const abortPromise = (signal && typeof signal.addEventListener === 'function')\n            ? new Promise((resolve) => {\n                if (signal.aborted) resolve({ kind: 'abort' });\n                else signal.addEventListener('abort', () => resolve({ kind: 'abort' }), { once: true });\n            })\n            : null;\n\n        const outcome = abortPromise\n            ? await Promise.race([toolPromise, abortPromise])\n            : await toolPromise;\n\n        if (outcome && outcome.kind === 'abort') {\n            toolPromise.then(() => null, () => null);\n            const output = { error: 'Aborted', message: 'Execution aborted.' };\n            const guardedOutput = emitToolResult({ agent, toolName: call.name, args, output });\n            const mcpResult = wrapToolOutput({\n                toolFailureStreak: agent._toolFailureStreak,\n                toolName: call.name,\n                output: guardedOutput,\n                isError: true,\n                limits: agent && agent.toolOutputLimits,\n            });\n            endToolCall({ agent, callId: call.id, toolName: call.name, startTime, success: false });\n            return buildToolResultMessage({ callId: call.id, toolName: call.name, mcpResult });\n        }\n\n        if (outcome && outcome.kind === 'error') throw outcome.error;\n        const timed = outcome.value;\n        const rawOutput = timed.timedOut\n            ? {\n                error: 'Timeout',\n                timeoutMs: agent.toolTimeoutMs,\n                message: `Tool execution exceeded ${agent.toolTimeoutMs}ms`,\n            }\n            : timed.value;\n        let output = (rawOutput === undefined) ? null : rawOutput;\n        let formatError = false;\n        if (!timed.timedOut) {\n            try {\n                JSON.stringify(output);\n            } catch {\n                formatError = true;\n                try {\n                    output = JSON.parse(stableStringify(output));\n                } catch {\n                    output = { error: 'Format Error', message: 'Tool output was not JSON serializable.' };\n                }\n            }\n        }\n        const failureType = timed.timedOut\n            ? 'timeout'\n            : (formatError ? 'format_error' : classifyToolFailure({\n                toolName: call.name,\n                output,\n                isRateLimitLike,\n            }));\n        if (failureType) {\n            recordToolFailure({\n                toolFailureStreak: agent._toolFailureStreak,\n                toolName: call.name,\n                fingerprintOrType: failureType,\n                args,\n                makeFailureFingerprint,\n            });\n        } else {\n            clearToolFailure({ toolFailureStreak: agent._toolFailureStreak, toolName: call.name });\n        }\n        const guardedOutput = guardToolOutput({\n            toolName: call.name,\n            value: output,\n            limits: agent && agent.toolOutputLimits,\n        });\n        agent.emit('tool_result', {\n            tool: call.name,\n            args,\n            result: guardedOutput\n        });\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: Boolean(failureType),\n            limits: agent && agent.toolOutputLimits,\n        });\n        const endTime = now();\n        agent._activeTools.delete(call.id);\n        agent.emit('tool_call_end', {\n            id: call.id,\n            name: call.name,\n            success: !failureType,\n            durationMs: Math.max(0, Math.round(endTime - startTime)),\n        });\n        if (agent._activeTools.size > 0) {\n            agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n        }\n        return buildToolResultMessage({ callId: call.id, toolName: call.name, mcpResult });\n    } catch (error) {\n        console.error(`  > Error executing ${call.name}:`, error);\n        agent.emit('tool_error', {\n            tool: call.name,\n            error: error.message\n        });\n        const errorMessage = String(error && error.message ? error.message : error);\n        const errorCode = error && typeof error.code === 'string' ? error.code : undefined;\n        let argsForFingerprint;\n        try {\n            argsForFingerprint = typeof call.arguments === 'string' ? JSON.parse(call.arguments) : call.arguments;\n        } catch {\n            argsForFingerprint = undefined;\n        }\n        const output = {\n            error: 'Tool execution failed',\n            message: errorMessage,\n            code: errorCode,\n        };\n        const guardedOutput = emitToolResult({ agent, toolName: call.name, args: began ? argsForFingerprint : null, output });\n        const failureType = classifyToolFailure({\n            toolName: call.name,\n            output,\n            isRateLimitLike,\n        }) || (() => {\n            if (isBrowserRuntime() && isBrowserEnvRestrictionLikeMessage(errorMessage)) {\n                return 'environment_restriction';\n            }\n            return isRateLimitLike(errorMessage) ? 'rate_limited' : `exception:${errorMessage}`;\n        })();\n        recordToolFailure({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            fingerprintOrType: failureType,\n            args: argsForFingerprint,\n            makeFailureFingerprint,\n        });\n        const mcpResult = wrapToolOutput({\n            toolFailureStreak: agent._toolFailureStreak,\n            toolName: call.name,\n            output: guardedOutput,\n            isError: true,\n            limits: agent && agent.toolOutputLimits,\n        });\n        const endTime = now();\n        if (began) {\n            endToolCall({ agent, callId: call.id, toolName: call.name, startTime, success: false });\n        }\n        if (agent._activeTools.size > 0) {\n            agent._setState('executing', { active: getActiveToolsSnapshot(agent) });\n        } else {\n            agent._setState('thinking', { reason: 'tool_error' });\n        }\n        return buildToolResultMessage({ callId: call.id, toolName: call.name, mcpResult });\n    }\n}\n\nmodule.exports = { executeToolCall };\n", "const { prepareBatchApprovals } = require('./agent-tool-approval');\nconst { executeToolCall } = require('./agent-tool-exec');\nfunction buildSyntheticToolPlan(toolCalls) {\n    const lines = [];\n    lines.push('Thought: I need to use tools to gather required information before answering.');\n    lines.push('Plan:');\n    toolCalls.forEach((call, idx) => {\n        let argsPreview = '';\n        try {\n            const args = typeof call.arguments === 'string' ? JSON.parse(call.arguments) : (call.arguments || {});\n            const compact = JSON.stringify(args);\n            argsPreview = compact && compact !== '{}' ? ` with ${compact}` : '';\n        } catch {\n            argsPreview = '';\n        }\n        lines.push(`${idx + 1}. Call ${call.name}${argsPreview}.`);\n    });\n    lines.push('Action: Calling tool(s) now.');\n    return lines.join('\\n') + '\\n';\n}\nasync function executeTools(agent, toolCalls, options = {}) {\n    const results = [];\n    agent._activeTools.clear();\n    const toolMeta = toolCalls.map((call) => ({ id: call.id, name: call.name }));\n    // Do not mark tools as executing before approvals are granted.\n    agent._setState('thinking', { reason: 'tools_planned', toolCalls: toolMeta });\n    const { needsApproval, batchDecisions } = await prepareBatchApprovals({ agent, toolCalls });\n    const signal = options && options.signal ? options.signal : null;\n    const handleCall = (call) => executeToolCall({ agent, call, toolMeta, batchDecisions, signal });\n    const outputs = needsApproval\n        ? await (async () => {\n            const ordered = [];\n            for (const call of toolCalls) {\n                ordered.push(await handleCall(call));\n            }\n            return ordered;\n        })()\n        : await Promise.all(toolCalls.map(handleCall));\n    agent._activeTools.clear();\n    agent._setState('thinking', { reason: 'tools_completed', toolCount: toolCalls.length });\n    return outputs.length ? outputs : results;\n}\nmodule.exports = { executeTools, buildSyntheticToolPlan };\n", "const APPROX_BYTES_PER_TOKEN = 4;\nlet cachedEncoder = null;\n\nfunction getTextEncoder() {\n    if (cachedEncoder) return cachedEncoder;\n    if (typeof TextEncoder !== 'undefined') {\n        cachedEncoder = new TextEncoder();\n    }\n    return cachedEncoder;\n}\n\nfunction byteLength(text) {\n    if (typeof text !== 'string' || text.length === 0) return 0;\n    const encoder = getTextEncoder();\n    if (encoder) return encoder.encode(text).length;\n    if (typeof Buffer !== 'undefined') return Buffer.byteLength(text, 'utf8');\n    return text.length;\n}\n\nfunction approxTokensFromBytes(bytes) {\n    const count = Number(bytes) || 0;\n    return Math.ceil(count / APPROX_BYTES_PER_TOKEN);\n}\n\nfunction estimateTextTokens(text) {\n    return approxTokensFromBytes(byteLength(text));\n}\n\nfunction estimateStructuredTokens(text) {\n    return approxTokensFromBytes(byteLength(text));\n}\n\nfunction isToolResultMessage(msg) {\n    return !!(msg\n        && (msg.role === 'system' || msg.role === 'tool')\n        && typeof msg.tool_call_id === 'string');\n}\n\nfunction estimateTokensForMessage(msg) {\n    if (!msg || typeof msg !== 'object') return 0;\n    try {\n        const serialized = JSON.stringify(msg);\n        return estimateStructuredTokens(serialized);\n    } catch {\n        return 0;\n    }\n}\n\nfunction estimateTokensHeuristic(history) {\n    if (!Array.isArray(history)) return 0;\n    let tokens = 0;\n    for (const msg of history) {\n        tokens += estimateTokensForMessage(msg);\n    }\n    return tokens;\n}\n\nfunction estimateTokens(history) {\n    if (!Array.isArray(history)) return 0;\n    let baselineIdx = -1;\n    let baselineTokens = 0;\n\n    for (let i = history.length - 1; i >= 0; i--) {\n        const msg = history[i];\n        const value = msg && Object.prototype.hasOwnProperty.call(msg, '_tokenUsagePrompt')\n            ? Number(msg._tokenUsagePrompt)\n            : NaN;\n        if (Number.isFinite(value)) {\n            baselineIdx = i;\n            baselineTokens = value;\n            break;\n        }\n    }\n\n    if (baselineIdx >= 0) {\n        const tail = history.slice(baselineIdx + 1);\n        return baselineTokens + estimateTokensHeuristic(tail);\n    }\n\n    return estimateTokensHeuristic(history);\n}\n\nmodule.exports = {\n    APPROX_BYTES_PER_TOKEN,\n    estimateTokens,\n    estimateTokensHeuristic,\n    estimateTokensForMessage,\n    estimateTextTokens,\n    estimateStructuredTokens,\n    approxTokensFromBytes,\n    isToolResultMessage,\n};\n", "const { isToolResultMessage } = require('./token-estimator');\n\nfunction buildToolCallMaps(history) {\n    const callIdToAssistantIndex = new Map();\n    const callIdToResultIndices = new Map();\n\n    for (let i = 0; i < history.length; i++) {\n        const msg = history[i];\n        if (!msg || typeof msg !== 'object') continue;\n\n        if (msg.role === 'assistant' && Array.isArray(msg.tool_calls)) {\n            for (const tc of msg.tool_calls) {\n                if (!tc || typeof tc.id !== 'string') continue;\n                if (!callIdToAssistantIndex.has(tc.id)) callIdToAssistantIndex.set(tc.id, i);\n            }\n        }\n\n        if (isToolResultMessage(msg) && typeof msg.tool_call_id === 'string') {\n            const list = callIdToResultIndices.get(msg.tool_call_id) || [];\n            list.push(i);\n            callIdToResultIndices.set(msg.tool_call_id, list);\n        }\n    }\n\n    return { callIdToAssistantIndex, callIdToResultIndices };\n}\n\nfunction buildAbortedToolResult(callId, name) {\n    const msg = {\n        role: 'system',\n        tool_call_id: callId,\n        content: JSON.stringify({\n            content: [{ type: 'text', text: 'aborted' }],\n            isError: true,\n        }),\n    };\n\n    if (typeof name === 'string') msg.name = name;\n    return msg;\n}\n\nfunction normalizeToolResultMessage(msg, name) {\n    if (!msg || typeof msg !== 'object') return msg;\n    if (typeof name !== 'string' || msg.name) return msg;\n    return { ...msg, name };\n}\n\nfunction enforceToolIntegrity(selectedIndices, history) {\n    const kept = new Set(selectedIndices);\n    const { callIdToAssistantIndex, callIdToResultIndices } = buildToolCallMaps(history);\n\n    for (const [callId, resIdxs] of callIdToResultIndices.entries()) {\n        const assistantIdx = callIdToAssistantIndex.get(callId);\n        const assistantKept = typeof assistantIdx === 'number' && kept.has(assistantIdx);\n        if (!assistantKept) {\n            for (const idx of resIdxs) kept.delete(idx);\n        }\n    }\n\n    return Array.from(kept).sort((a, b) => a - b);\n}\n\nfunction normalizeHistory(history) {\n    if (!Array.isArray(history)) return history;\n\n    const assistantCallIds = new Set();\n    const callIdToToolName = new Map();\n    for (const msg of history) {\n        if (!msg || msg.role !== 'assistant' || !Array.isArray(msg.tool_calls)) continue;\n        for (const tc of msg.tool_calls) {\n            if (!tc || typeof tc.id !== 'string') continue;\n            assistantCallIds.add(tc.id);\n            if (typeof tc.name === 'string' && !callIdToToolName.has(tc.id)) {\n                callIdToToolName.set(tc.id, tc.name);\n            }\n        }\n    }\n\n    const callIdToResultMsg = new Map();\n    for (const msg of history) {\n        if (!isToolResultMessage(msg)) continue;\n        if (!assistantCallIds.has(msg.tool_call_id)) continue;\n        if (!callIdToResultMsg.has(msg.tool_call_id)) {\n            callIdToResultMsg.set(msg.tool_call_id, msg);\n        }\n    }\n\n    const out = [];\n\n    for (const msg of history) {\n        if (isToolResultMessage(msg)) {\n            continue;\n        }\n\n        out.push(msg);\n\n        if (!msg || msg.role !== 'assistant' || !Array.isArray(msg.tool_calls)) continue;\n        for (const tc of msg.tool_calls) {\n            if (!tc || typeof tc.id !== 'string') continue;\n            const name = typeof tc.name === 'string' ? tc.name : callIdToToolName.get(tc.id);\n            const existing = callIdToResultMsg.get(tc.id);\n            if (existing) {\n                out.push(normalizeToolResultMessage(existing, name));\n                continue;\n            }\n\n            out.push(buildAbortedToolResult(tc.id, name));\n        }\n    }\n\n    return out;\n}\n\nmodule.exports = {\n    enforceToolIntegrity,\n    normalizeHistory,\n};\n", "const { estimateTokens, isToolResultMessage } = require('./token-estimator');\nconst { enforceToolIntegrity, normalizeHistory } = require('./context-normalization');\n\nfunction getToolCallIdsFromAssistantMessage(msg) {\n    if (!msg || msg.role !== 'assistant' || !Array.isArray(msg.tool_calls)) return [];\n    return msg.tool_calls\n        .map(tc => (tc && typeof tc.id === 'string') ? tc.id : null)\n        .filter(Boolean);\n}\n\nfunction isInstructionLikeUserMessage(msg) {\n    if (!msg || msg.role !== 'user') return false;\n    if (typeof msg.content !== 'string') return false;\n\n    const trimmed = msg.content.trimStart();\n    const lowered = trimmed.toLowerCase();\n    const summaryPrefix = 'Another language model started to solve this problem';\n\n    return trimmed.startsWith('# AGENTS.md instructions for ')\n        || trimmed.startsWith('<user_instructions>')\n        || trimmed.startsWith('<skill')\n        || lowered.startsWith('<environment_context>')\n        || lowered.startsWith('<turn_aborted>')\n        || trimmed.startsWith(summaryPrefix);\n}\n\nfunction filterPromptHistory(history) {\n    if (!Array.isArray(history)) return [];\n    return history.filter((msg) => {\n        if (!msg || typeof msg !== 'object') return false;\n        if (msg.role !== 'system' && msg.role !== 'tool') return true;\n        return isToolResultMessage(msg);\n    });\n}\n\nfunction groupSelectedIntoAtoms(selectedIndices, history, headCount, protectedIndices) {\n    const selectedSet = new Set(selectedIndices);\n    const protectedSet = protectedIndices instanceof Set ? protectedIndices : new Set();\n    const callIdToAssistantIndex = new Map();\n    const callIdToResultIndices = new Map();\n\n    for (const idx of selectedIndices) {\n        const msg = history[idx];\n        if (!msg || typeof msg !== 'object') continue;\n\n        if (msg.role === 'assistant' && Array.isArray(msg.tool_calls)) {\n            for (const tc of msg.tool_calls) {\n                if (!tc || typeof tc.id !== 'string') continue;\n                if (!callIdToAssistantIndex.has(tc.id)) callIdToAssistantIndex.set(tc.id, idx);\n            }\n        }\n\n        if (isToolResultMessage(msg)) {\n            const list = callIdToResultIndices.get(msg.tool_call_id) || [];\n            list.push(idx);\n            callIdToResultIndices.set(msg.tool_call_id, list);\n        }\n    }\n\n    const assistantIndexToResultIndices = new Map();\n    for (const [callId, resIdxs] of callIdToResultIndices.entries()) {\n        const assistantIdx = callIdToAssistantIndex.get(callId);\n        if (typeof assistantIdx !== 'number') continue;\n        const list = assistantIndexToResultIndices.get(assistantIdx) || [];\n        for (const rIdx of resIdxs) list.push(rIdx);\n        assistantIndexToResultIndices.set(assistantIdx, list);\n    }\n\n    const assigned = new Set();\n    const atoms = [];\n\n    for (const idx of selectedIndices) {\n        if (assigned.has(idx)) continue;\n        const msg = history[idx];\n        let atomIndices = [idx];\n\n        if (msg && msg.role === 'assistant' && Array.isArray(msg.tool_calls)) {\n            const resIdxs = assistantIndexToResultIndices.get(idx) || [];\n            for (const rIdx of resIdxs) {\n                if (selectedSet.has(rIdx)) atomIndices.push(rIdx);\n            }\n        }\n\n        atomIndices = Array.from(new Set(atomIndices)).sort((a, b) => a - b);\n        for (const i of atomIndices) assigned.add(i);\n\n        atoms.push({\n            indices: atomIndices,\n            protected: atomIndices.some((i) => i < headCount || protectedSet.has(i)),\n            minIndex: atomIndices[0],\n        });\n    }\n\n    return atoms.sort((a, b) => a.minIndex - b.minIndex);\n}\n\nfunction truncateWithMarker(text, maxChars) {\n    if (typeof text !== 'string') return text;\n    if (!Number.isFinite(maxChars) || maxChars <= 0) {\n        const removed = text.length;\n        return `\u2026${removed} chars truncated\u2026`;\n    }\n    if (text.length <= maxChars) return text;\n\n    const removed = text.length - maxChars;\n    const left = Math.floor(maxChars / 2);\n    const right = Math.max(0, maxChars - left);\n    const prefix = text.slice(0, left);\n    const suffix = right > 0 ? text.slice(text.length - right) : '';\n    return `${prefix}\u2026${removed} chars truncated\u2026${suffix}`;\n}\n\nfunction maybeTruncateLargeToolOutputs(history, { maxToolOutputChars } = {}) {\n    if (!maxToolOutputChars || !Array.isArray(history)) return history;\n    const cap = Number(maxToolOutputChars);\n    if (!Number.isFinite(cap) || cap <= 0) return history;\n\n    return history.map((msg) => {\n        if (!msg || typeof msg !== 'object') return msg;\n        if (msg.role !== 'system' && msg.role !== 'tool') return msg;\n        if (typeof msg.content !== 'string') return msg;\n        if (msg.content.length <= cap) return msg;\n\n        return {\n            ...msg,\n            content: truncateWithMarker(msg.content, cap),\n        };\n    });\n}\n\nclass ContextManager {\n    constructor(options = {}) {\n        this.defaults = {\n            maxMessages: 16,\n            preserveHeadMessages: 2,\n            protectRecentMessages: 0,\n            maxEstimatedTokens: undefined,\n            maxToolOutputChars: undefined,\n            ...options,\n        };\n    }\n\n    process(history, options = {}) {\n        const cfg = { ...this.defaults, ...options };\n        const fullLength = Array.isArray(history) ? history.length : 0;\n        const original = filterPromptHistory(history);\n\n        const maxMessages = Math.max(1, Number(cfg.maxMessages) || 16);\n        const preserveHeadMessages = Math.max(0, Math.min(maxMessages, Number(cfg.preserveHeadMessages) || 0));\n        const protectRecentMessages = Math.max(0, Math.min(original.length, Number(cfg.protectRecentMessages) || 0));\n        const protectedIndices = new Set();\n        if (protectRecentMessages > 0) {\n            const start = Math.max(0, original.length - protectRecentMessages);\n            for (let i = start; i < original.length; i++) protectedIndices.add(i);\n        }\n        for (let i = 0; i < original.length; i++) {\n            if (isInstructionLikeUserMessage(original[i])) protectedIndices.add(i);\n        }\n\n        const headCount = Math.min(preserveHeadMessages, original.length, maxMessages);\n        let selected;\n\n        if (original.length <= maxMessages) {\n            selected = Array.from({ length: original.length }, (_, i) => i);\n        } else {\n            const tailCount = Math.max(0, maxMessages - headCount);\n            const indices = new Set();\n            for (let i = 0; i < headCount; i++) indices.add(i);\n            const tailStart = Math.max(headCount, original.length - tailCount);\n            for (let i = tailStart; i < original.length; i++) indices.add(i);\n            for (const idx of protectedIndices) indices.add(idx);\n            selected = Array.from(indices).sort((a, b) => a - b);\n        }\n\n        selected = enforceToolIntegrity(selected, original);\n\n        // Token-driven trimming: drop oldest non-head messages until under limit.\n        const maxEstimatedTokens = cfg.maxEstimatedTokens;\n        if (Number.isFinite(Number(maxEstimatedTokens))) {\n            const cap = Number(maxEstimatedTokens);\n\n            // Keep dropping from just after the head, respecting tool integrity.\n            // Stop when nothing removable remains.\n            while (true) {\n                const current = selected.map(i => original[i]);\n                const currentTokens = estimateTokens(normalizeHistory(current));\n                if (currentTokens <= cap) break;\n\n                const atoms = groupSelectedIntoAtoms(selected, original, headCount, protectedIndices);\n                const removableAtoms = atoms.filter(atom => !atom.protected);\n                if (removableAtoms.length === 0) break;\n\n                const dropAtom = removableAtoms[0];\n                const dropSet = new Set(dropAtom.indices);\n                selected = selected.filter(i => !dropSet.has(i));\n                selected = enforceToolIntegrity(selected, original);\n            }\n        }\n\n        let outHistory = selected.map(i => original[i]);\n        outHistory = normalizeHistory(outHistory);\n        outHistory = maybeTruncateLargeToolOutputs(outHistory, cfg);\n\n        return {\n            history: outHistory,\n            meta: {\n                dropped: Math.max(0, fullLength - outHistory.length),\n                estimatedTokens: estimateTokens(outHistory),\n            },\n        };\n    }\n}\n\nmodule.exports = { ContextManager, estimateTokens };\n", "const { estimateTokens } = require('./context-manager');\nconst { safeJsonStringify } = require('./self-heal');\n\nfunction dumpSnapshot(agent) {\n    const toolFailureStreak = agent._toolFailureStreak instanceof Map\n        ? Object.fromEntries(agent._toolFailureStreak.entries())\n        : {};\n\n    return {\n        version: '1.0',\n        timestamp: new Date().toISOString(),\n        status: agent.status,\n        systemPrompt: agent.systemPrompt,\n        history: agent.history,\n        currentPlan: agent.currentPlan,\n        decisionTraces: Array.isArray(agent._decisionTraces) ? agent._decisionTraces : [],\n        toolFailureStreak,\n    };\n}\n\nfunction loadSnapshot(agent, snapshot, { emitPlanEvent = true } = {}) {\n    if (!snapshot || typeof snapshot !== 'object') return false;\n\n    if (Array.isArray(snapshot.history)) {\n        agent.history = snapshot.history;\n    }\n\n    if (typeof snapshot.systemPrompt === 'string') {\n        agent.systemPrompt = snapshot.systemPrompt;\n    }\n\n    agent.currentPlan = Array.isArray(snapshot.currentPlan) ? snapshot.currentPlan : snapshot.currentPlan || null;\n    agent.status = typeof snapshot.status === 'string' ? snapshot.status : 'idle';\n\n    if (snapshot.toolFailureStreak && typeof snapshot.toolFailureStreak === 'object') {\n        agent._toolFailureStreak = new Map(Object.entries(snapshot.toolFailureStreak));\n    }\n\n    agent._decisionTraces = Array.isArray(snapshot.decisionTraces) ? snapshot.decisionTraces : [];\n\n    if (emitPlanEvent && agent.currentPlan) {\n        agent.emit('plan_updated', { explanation: 'Snapshot restored', plan: agent.currentPlan });\n    }\n\n    return true;\n}\n\nfunction setState(agent, status, metadata = {}) {\n    const previous = agent.status;\n    const snapshot = {\n        ...metadata,\n        historyLength: agent.history.length,\n        estimatedTokens: estimateTokens(agent.history),\n    };\n    const metaString = safeJsonStringify(snapshot);\n    if (previous === status && metaString === agent._lastStateMeta) return;\n\n    agent.status = status;\n    agent._lastStateMeta = metaString;\n    agent.emit('state_changed', {\n        status,\n        previous,\n        metadata: snapshot,\n        timestamp: new Date().toISOString(),\n    });\n}\n\nfunction getState(agent) {\n    return {\n        status: agent.status,\n        currentPlan: agent.currentPlan,\n        historyLength: agent.history.length,\n        estimatedTokens: estimateTokens(agent.history),\n    };\n}\n\nmodule.exports = {\n    dumpSnapshot,\n    loadSnapshot,\n    setState,\n    getState,\n};\n", "const CONFIG = {\n    agent: {\n        maxTurns: 50,\n        maxProtectedRecentMessages: 12,\n        // Optional: Tool output guard limits.\n        // This prevents huge tool results (stdout/html/json) from bloating history/trace/UI.\n        // toolOutputLimits: {\n        //     maxStringChars: 12000,\n        //     headChars: 8000,\n        //     tailChars: 2000,\n        //     maxArrayItems: 60,\n        //     maxObjectKeys: 60,\n        //     maxDepth: 5,\n        // },\n        compaction: {\n            enabled: true,\n            triggerMessages: 30,\n            triggerTokens: null,\n            keepRecentMessages: 8,\n            maxSummaryChars: 20000,\n            maxMessageChars: 2000,\n            maxUserMessageTokens: 20000,\n        },\n    },\n};\n\nif (typeof globalThis !== 'undefined') {\n    if (!globalThis.AGENTS_DEFAULT_CONFIG) {\n        globalThis.AGENTS_DEFAULT_CONFIG = CONFIG;\n    }\n}\n\nmodule.exports = CONFIG;\n", "const DEFAULT_EPISODIC_NODE_PATH = 'memory/episodic-memory.jsonl';\nconst RAG_DEFAULTS = Object.freeze({\n    enabled: true,\n    topK: 5,\n    minScore: 0.2,\n    maxContextChars: 6000,\n    autoSave: true,\n    memoryFirst: false,\n    autoMemoryPrecheck: false,\n    browserStoreName: 'agents_memory_v1',\n});\n\nconst DEFAULT_CONFIG = {\n    agent: {\n        maxTurns: 50,\n        maxProtectedRecentMessages: 12,\n        debug: false,\n        approvalPolicy: 'always',\n        trustedTools: [],\n        toolOutputLimits: null,\n        compaction: {\n            enabled: true,\n            triggerMessages: 30,\n            triggerTokens: null,\n            keepRecentMessages: 8,\n            maxSummaryChars: 20000,\n            maxMessageChars: 2000,\n            maxUserMessageTokens: 20000,\n        },\n        rag: {\n            enabled: RAG_DEFAULTS.enabled,\n            topK: RAG_DEFAULTS.topK,\n            minScore: RAG_DEFAULTS.minScore,\n            maxContextChars: RAG_DEFAULTS.maxContextChars,\n            autoSave: RAG_DEFAULTS.autoSave,\n            memoryFirst: RAG_DEFAULTS.memoryFirst,\n            autoMemoryPrecheck: RAG_DEFAULTS.autoMemoryPrecheck,\n            fixedJsonlPaths: [],\n            episodicStoreNodePath: DEFAULT_EPISODIC_NODE_PATH,\n            browserStoreName: RAG_DEFAULTS.browserStoreName,\n        },\n    },\n};\n\nconst TOOL_OUTPUT_LIMIT_KEYS = ['maxStringChars', 'headChars', 'tailChars', 'maxArrayItems', 'maxObjectKeys', 'maxDepth'];\nconst APPROVAL_POLICY_VALUES = new Set(['always', 'unless_trusted', 'never']);\n\nfunction normalizeApprovalPolicy(value) {\n    if (typeof value !== 'string') return null;\n    const v = value.trim().toLowerCase();\n    return APPROVAL_POLICY_VALUES.has(v) ? v : null;\n}\n\nfunction normalizeStringList(input) {\n    if (!input) return [];\n    if (Array.isArray(input)) {\n        const out = input.map((v) => (typeof v === 'string' ? v.trim() : String(v || '').trim())).filter(Boolean);\n        return Array.from(new Set(out));\n    }\n    if (typeof input === 'string') {\n        const out = input.split(',').map((s) => s.trim()).filter(Boolean);\n        return Array.from(new Set(out));\n    }\n    return [];\n}\n\nfunction toBoolean(value, fallback) {\n    if (typeof value === 'boolean') return value;\n    if (typeof value === 'number') return value !== 0;\n    if (typeof value !== 'string') return fallback;\n    const v = value.trim().toLowerCase();\n    if (['1', 'true', 'yes', 'on'].includes(v)) return true;\n    if (['0', 'false', 'no', 'off'].includes(v)) return false;\n    return fallback;\n}\n\nfunction loadFileConfig() {\n    try {\n        return require('../config');\n    } catch {\n        return null;\n    }\n}\n\nfunction loadGlobalConfig() {\n    if (typeof globalThis === 'undefined') return null;\n    return globalThis.AGENTS_CONFIG || globalThis.AGENTS_DEFAULT_CONFIG || null;\n}\n\nfunction normalizeConfig(input) {\n    return (input && typeof input === 'object') ? input : {};\n}\n\nfunction normalizeToolOutputLimits(input) {\n    if (!input || typeof input !== 'object' || Array.isArray(input)) return null;\n    const out = {};\n    for (const key of TOOL_OUTPUT_LIMIT_KEYS) {\n        if (!Object.prototype.hasOwnProperty.call(input, key)) continue;\n        const n = Number(input[key]);\n        if (!Number.isFinite(n)) continue;\n        const v = Math.floor(n);\n        if (v < 0) continue;\n        if (key === 'maxDepth' && v < 1) continue;\n        out[key] = v;\n    }\n    return Object.keys(out).length > 0 ? out : null;\n}\n\nfunction mergeAgentConfig(base, override) {\n    const out = { ...base };\n    if (!override || typeof override !== 'object') return out;\n    if (!override.agent || typeof override.agent !== 'object') return out;\n\n    const src = override.agent;\n    out.agent = { ...out.agent };\n\n    if (Number.isFinite(src.maxTurns)) out.agent.maxTurns = src.maxTurns;\n    if (Number.isFinite(src.maxProtectedRecentMessages)) out.agent.maxProtectedRecentMessages = src.maxProtectedRecentMessages;\n    if (typeof src.debug === 'boolean') out.agent.debug = src.debug;\n\n    if (Object.prototype.hasOwnProperty.call(src, 'approvalPolicy')) {\n        const normalized = normalizeApprovalPolicy(src.approvalPolicy);\n        if (normalized) out.agent.approvalPolicy = normalized;\n    }\n\n    if (Object.prototype.hasOwnProperty.call(src, 'trustedTools')) {\n        const raw = src.trustedTools;\n        if (Array.isArray(raw) || typeof raw === 'string') {\n            out.agent.trustedTools = normalizeStringList(raw);\n        }\n    }\n\n    if (Object.prototype.hasOwnProperty.call(src, 'toolOutputLimits')) {\n        const normalized = normalizeToolOutputLimits(src.toolOutputLimits);\n        if (normalized) out.agent.toolOutputLimits = normalized;\n    }\n\n    if (src.compaction && typeof src.compaction === 'object') {\n        out.agent.compaction = { ...out.agent.compaction };\n        const c = src.compaction;\n        if (typeof c.enabled === 'boolean') out.agent.compaction.enabled = c.enabled;\n        if (Number.isFinite(c.triggerMessages)) out.agent.compaction.triggerMessages = c.triggerMessages;\n        if (Number.isFinite(c.triggerTokens)) out.agent.compaction.triggerTokens = c.triggerTokens;\n        if (Number.isFinite(c.keepRecentMessages)) out.agent.compaction.keepRecentMessages = c.keepRecentMessages;\n        if (Number.isFinite(c.maxSummaryChars)) out.agent.compaction.maxSummaryChars = c.maxSummaryChars;\n        if (Number.isFinite(c.maxMessageChars)) out.agent.compaction.maxMessageChars = c.maxMessageChars;\n        if (Number.isFinite(c.maxUserMessageTokens)) out.agent.compaction.maxUserMessageTokens = c.maxUserMessageTokens;\n    }\n\n    if (src.rag && typeof src.rag === 'object') {\n        out.agent.rag = { ...out.agent.rag };\n        const r = src.rag;\n        if (Object.prototype.hasOwnProperty.call(r, 'enabled')) out.agent.rag.enabled = toBoolean(r.enabled, out.agent.rag.enabled);\n        if (Number.isFinite(r.topK)) out.agent.rag.topK = Math.max(1, Math.floor(r.topK));\n        if (Number.isFinite(r.minScore)) out.agent.rag.minScore = Number(r.minScore);\n        if (Number.isFinite(r.maxContextChars)) out.agent.rag.maxContextChars = Math.max(256, Math.floor(r.maxContextChars));\n        if (Object.prototype.hasOwnProperty.call(r, 'autoSave')) out.agent.rag.autoSave = toBoolean(r.autoSave, out.agent.rag.autoSave);\n        if (Object.prototype.hasOwnProperty.call(r, 'memoryFirst')) out.agent.rag.memoryFirst = toBoolean(r.memoryFirst, out.agent.rag.memoryFirst);\n        if (Object.prototype.hasOwnProperty.call(r, 'autoMemoryPrecheck')) out.agent.rag.autoMemoryPrecheck = toBoolean(r.autoMemoryPrecheck, out.agent.rag.autoMemoryPrecheck);\n        if (Array.isArray(r.fixedJsonlPaths) || typeof r.fixedJsonlPaths === 'string') {\n            out.agent.rag.fixedJsonlPaths = normalizeStringList(r.fixedJsonlPaths);\n        }\n        if (typeof r.episodicStoreNodePath === 'string' && r.episodicStoreNodePath.trim()) {\n            out.agent.rag.episodicStoreNodePath = r.episodicStoreNodePath.trim();\n        }\n        if (typeof r.browserStoreName === 'string' && r.browserStoreName.trim()) {\n            out.agent.rag.browserStoreName = r.browserStoreName.trim();\n        }\n    }\n\n    return out;\n}\n\nfunction applyEnvOverrides(inputConfig) {\n    if (typeof process === 'undefined' || !process || !process.env) return inputConfig;\n    let config = inputConfig;\n\n    const maxTurnsRaw = process.env.AGENTS_MAX_TURNS;\n    if (maxTurnsRaw && Number.isFinite(Number(maxTurnsRaw))) {\n        const parsed = Number(maxTurnsRaw);\n        if (parsed > 0) config = mergeAgentConfig(config, { agent: { maxTurns: parsed } });\n    }\n\n    const debugRaw = process.env.AGENTS_DEBUG;\n    if (debugRaw !== undefined) {\n        const normalized = String(debugRaw).toLowerCase();\n        const enabled = normalized === '1' || normalized === 'true' || normalized === 'yes';\n        config = mergeAgentConfig(config, { agent: { debug: enabled } });\n    }\n\n    const maxProtectedRaw = process.env.AGENTS_MAX_PROTECTED_RECENT;\n    if (maxProtectedRaw && Number.isFinite(Number(maxProtectedRaw))) {\n        const parsed = Number(maxProtectedRaw);\n        if (parsed > 0) config = mergeAgentConfig(config, { agent: { maxProtectedRecentMessages: parsed } });\n    }\n\n    const approvalPolicyRaw = process.env.AGENTS_APPROVAL_POLICY;\n    if (approvalPolicyRaw) {\n        const normalized = normalizeApprovalPolicy(String(approvalPolicyRaw));\n        if (normalized) config = mergeAgentConfig(config, { agent: { approvalPolicy: normalized } });\n    }\n\n    const trustedToolsJson = process.env.AGENTS_TRUSTED_TOOLS_JSON;\n    if (trustedToolsJson) {\n        try {\n            const parsed = JSON.parse(String(trustedToolsJson));\n            config = mergeAgentConfig(config, { agent: { trustedTools: parsed } });\n        } catch {\n            // ignore invalid json\n        }\n    }\n\n    const trustedToolsRaw = process.env.AGENTS_TRUSTED_TOOLS;\n    if (trustedToolsRaw) {\n        config = mergeAgentConfig(config, { agent: { trustedTools: String(trustedToolsRaw) } });\n    }\n\n    const triggerTokensRaw = process.env.AGENTS_COMPACTION_TRIGGER_TOKENS;\n    if (triggerTokensRaw && Number.isFinite(Number(triggerTokensRaw))) {\n        const parsed = Number(triggerTokensRaw);\n        if (parsed > 0) config = mergeAgentConfig(config, { agent: { compaction: { triggerTokens: parsed } } });\n    }\n\n    const toolOutputLimitsJson = process.env.AGENTS_TOOL_OUTPUT_LIMITS_JSON;\n    if (toolOutputLimitsJson) {\n        try {\n            const parsed = JSON.parse(String(toolOutputLimitsJson));\n            config = mergeAgentConfig(config, { agent: { toolOutputLimits: parsed } });\n        } catch {\n            // ignore invalid json\n        }\n    }\n\n    if (process.env.AGENTS_RAG_ENABLED !== undefined) {\n        config = mergeAgentConfig(config, { agent: { rag: { enabled: process.env.AGENTS_RAG_ENABLED } } });\n    }\n    if (process.env.AGENTS_RAG_TOPK !== undefined && Number.isFinite(Number(process.env.AGENTS_RAG_TOPK))) {\n        config = mergeAgentConfig(config, { agent: { rag: { topK: Number(process.env.AGENTS_RAG_TOPK) } } });\n    }\n    if (process.env.AGENTS_RAG_MIN_SCORE !== undefined && Number.isFinite(Number(process.env.AGENTS_RAG_MIN_SCORE))) {\n        config = mergeAgentConfig(config, { agent: { rag: { minScore: Number(process.env.AGENTS_RAG_MIN_SCORE) } } });\n    }\n\n    return config;\n}\n\nfunction getAgentConfig(overrides = null) {\n    const fileConfig = normalizeConfig(loadFileConfig());\n    const globalConfig = normalizeConfig(loadGlobalConfig());\n    const overrideConfig = normalizeConfig(overrides);\n\n    let config = mergeAgentConfig(DEFAULT_CONFIG, fileConfig);\n    config = mergeAgentConfig(config, globalConfig);\n    config = mergeAgentConfig(config, overrideConfig);\n    config = applyEnvOverrides(config);\n    return config;\n}\n\nmodule.exports = {\n    DEFAULT_CONFIG,\n    getAgentConfig,\n};\n", "const { ContextManager } = require('./context-manager');\nconst { registerTools } = require('./agent-tools-registry');\nconst { DEFAULT_TOOL_TIMEOUT_MS, DEFAULT_APPROVAL_TIMEOUT_MS } = require('./self-heal');\nconst { getAgentConfig } = require('./config');\nconst { RiskLevel, normalizeRiskLevel } = require('./imda-constants');\n\nfunction normalizeRagConfigLite(input) {\n    const raw = (input && typeof input === 'object') ? input : {};\n    return {\n        enabled: raw.enabled !== false,\n        topK: Number.isFinite(Number(raw.topK)) ? Math.max(1, Math.floor(Number(raw.topK))) : 5,\n        minScore: Number.isFinite(Number(raw.minScore)) ? Number(raw.minScore) : 0.2,\n        maxContextChars: Number.isFinite(Number(raw.maxContextChars)) ? Math.max(256, Math.floor(Number(raw.maxContextChars))) : 6000,\n        autoSave: raw.autoSave !== false,\n        memoryFirst: raw.memoryFirst === true,\n        autoMemoryPrecheck: raw.autoMemoryPrecheck === true,\n        fixedJsonlPaths: Array.isArray(raw.fixedJsonlPaths) ? raw.fixedJsonlPaths : [],\n        episodicStoreNodePath: typeof raw.episodicStoreNodePath === 'string' ? raw.episodicStoreNodePath : '',\n        browserStoreName: typeof raw.browserStoreName === 'string' ? raw.browserStoreName : 'agents_memory_v1',\n    };\n}\n\nfunction initializeAgentState(agent, {\n    llm,\n    tools = [],\n    systemPrompt = \"You are a helpful AI assistant.\",\n    toolTimeoutMs,\n    approvalTimeoutMs,\n    approvalPolicy,\n    trustedTools,\n    toolOutputLimits,\n    maxTurns,\n    compaction,\n    maxProtectedRecentMessages,\n    identity,\n    riskProfile,\n    ragConfig,\n    ragService,\n} = {}) {\n    agent.llm = llm;\n    const { toolMap, registry } = registerTools(tools);\n    agent.tools = toolMap;\n    agent.toolRegistry = registry;\n    agent.systemPrompt = systemPrompt;\n    agent.history = [];\n    agent.status = 'idle';\n    agent.currentPlan = null;\n    agent._decisionTraces = [];\n    agent._pendingUserInputs = new Map();\n    agent._pendingInputs = [];\n    agent._activeTools = new Map();\n    agent._lastStateMeta = null;\n\n    const cfg = getAgentConfig({ agent: { maxTurns, compaction, toolOutputLimits, approvalPolicy, trustedTools } });\n    agent.maxTurns =\n        (typeof maxTurns === 'number' && Number.isFinite(maxTurns) && maxTurns > 0)\n            ? Math.floor(maxTurns)\n            : cfg.agent.maxTurns;\n    agent.debug = Boolean(cfg.agent.debug);\n    agent.compaction = cfg.agent.compaction || null;\n    agent.maxProtectedRecentMessages =\n        (typeof maxProtectedRecentMessages === 'number'\n            && Number.isFinite(maxProtectedRecentMessages)\n            && maxProtectedRecentMessages > 0)\n            ? Math.floor(maxProtectedRecentMessages)\n            : cfg.agent.maxProtectedRecentMessages;\n\n    agent.toolTimeoutMs =\n        (typeof toolTimeoutMs === 'number' && Number.isFinite(toolTimeoutMs) && toolTimeoutMs > 0)\n            ? toolTimeoutMs\n            : DEFAULT_TOOL_TIMEOUT_MS;\n\n    agent.approvalTimeoutMs =\n        (typeof approvalTimeoutMs === 'number' && Number.isFinite(approvalTimeoutMs) && approvalTimeoutMs > 0)\n            ? approvalTimeoutMs\n            : DEFAULT_APPROVAL_TIMEOUT_MS;\n\n    agent.approvalPolicy = (cfg.agent && typeof cfg.agent.approvalPolicy === 'string')\n        ? String(cfg.agent.approvalPolicy)\n        : 'always';\n    agent.trustedTools = (cfg.agent && Array.isArray(cfg.agent.trustedTools))\n        ? cfg.agent.trustedTools.map((t) => String(t)).filter(Boolean)\n        : [];\n\n    agent.toolOutputLimits = (cfg.agent && cfg.agent.toolOutputLimits && typeof cfg.agent.toolOutputLimits === 'object')\n        ? { ...cfg.agent.toolOutputLimits }\n        : null;\n    const mergedRag = {\n        ...(cfg.agent && cfg.agent.rag && typeof cfg.agent.rag === 'object' ? cfg.agent.rag : null),\n        ...(ragConfig && typeof ragConfig === 'object' ? ragConfig : null),\n    };\n    agent.ragConfig = normalizeRagConfigLite(mergedRag);\n    agent.ragService = ragService || null;\n\n    agent._toolFailureStreak = new Map();\n    agent._approvalGrants = new Set();\n    agent._approvalDenies = new Set();\n    agent._approvalDeniedThisTurn = false;\n    agent._approvalDenyHints = new Set();\n    agent._memoryFirstGuardCount = 0;\n    agent._citationGuardCount = 0;\n    agent._knowledgeSelectedThisTurn = [];\n    agent._knowledgeSelectedIdSet = new Set();\n    agent._abortController = null;\n    agent._abortReason = null;\n    agent._traceCollector = null;\n\n    const baseIdentity = { id: 'anonymous', tenantId: 'default', role: 'user' };\n    const resolvedIdentity = (identity && typeof identity === 'object')\n        ? { ...baseIdentity, ...identity }\n        : baseIdentity;\n    agent.identity = Object.freeze({ ...resolvedIdentity });\n\n    const resolvedTier = normalizeRiskLevel(riskProfile && riskProfile.tier, RiskLevel.NONE);\n    agent.riskProfile = Object.freeze({ tier: resolvedTier });\n\n    agent.contextManager = new ContextManager();\n}\n\nmodule.exports = { initializeAgentState };\n", "function toNumber(value) {\n    const num = Number(value);\n    return Number.isFinite(num) ? num : null;\n}\n\nfunction normalizeUsage(usage) {\n    if (!usage || typeof usage !== 'object') return null;\n    const input = toNumber(usage.input_tokens ?? usage.promptTokenCount ?? usage.prompt_tokens);\n    const cachedInput = toNumber(\n        usage.cached_input_tokens ?? usage.cachedContentTokenCount ?? usage.cached_prompt_tokens ?? usage.cachedPromptTokens\n    );\n    const output = toNumber(\n        usage.output_tokens ?? usage.candidatesTokenCount ?? usage.completionTokenCount ?? usage.completion_tokens\n    );\n    const reasoningOutput = toNumber(\n        usage.reasoning_output_tokens ?? usage.reasoningTokenCount ?? usage.thoughtsTokenCount ?? usage.reasoning_tokens\n    );\n    const total = toNumber(usage.total_tokens ?? usage.totalTokenCount ?? usage.total_tokens);\n    if (input === null && cachedInput === null && output === null && reasoningOutput === null && total === null) return null;\n    return {\n        input,\n        cachedInput,\n        output,\n        reasoningOutput,\n        total,\n    };\n}\n\nfunction applyUsageToEntry(entry, usage) {\n    if (!entry || typeof entry !== 'object') return false;\n    const normalized = normalizeUsage(usage);\n    if (!normalized) return false;\n    if (normalized.input !== null) entry._tokenUsagePrompt = normalized.input;\n    if (normalized.cachedInput !== null) entry._tokenUsageCachedInput = normalized.cachedInput;\n    if (normalized.output !== null) entry._tokenUsageCompletion = normalized.output;\n    if (normalized.reasoningOutput !== null) entry._tokenUsageReasoningOutput = normalized.reasoningOutput;\n    if (normalized.total !== null) entry._tokenUsageTotal = normalized.total;\n    return true;\n}\n\nfunction getUsageFromEntry(entry) {\n    if (!entry || typeof entry !== 'object') return null;\n    const input = toNumber(entry._tokenUsagePrompt);\n    const cachedInput = toNumber(entry._tokenUsageCachedInput);\n    const output = toNumber(entry._tokenUsageCompletion);\n    const reasoningOutput = toNumber(entry._tokenUsageReasoningOutput);\n    let total = toNumber(entry._tokenUsageTotal);\n    if (total === null && (input !== null || output !== null)) {\n        total = (input || 0) + (output || 0);\n    }\n    if (input === null && cachedInput === null && output === null && reasoningOutput === null && total === null) {\n        return null;\n    }\n    return {\n        input_tokens: input || 0,\n        cached_input_tokens: cachedInput || 0,\n        output_tokens: output || 0,\n        reasoning_output_tokens: reasoningOutput || 0,\n        total_tokens: total || 0,\n    };\n}\n\nfunction getTotalUsageFromHistory(history) {\n    if (!Array.isArray(history)) return null;\n    let totalInput = 0;\n    let totalCachedInput = 0;\n    let totalOutput = 0;\n    let totalReasoningOutput = 0;\n    let totalTokens = 0;\n    let hasAny = false;\n\n    for (const entry of history) {\n        const usage = getUsageFromEntry(entry);\n        if (!usage) continue;\n        hasAny = true;\n        totalInput += usage.input_tokens;\n        totalCachedInput += usage.cached_input_tokens;\n        totalOutput += usage.output_tokens;\n        totalReasoningOutput += usage.reasoning_output_tokens;\n        totalTokens += usage.total_tokens;\n    }\n\n    if (!hasAny) return null;\n    if (!totalTokens && (totalInput || totalOutput)) {\n        totalTokens = totalInput + totalOutput;\n    }\n    return {\n        input_tokens: totalInput,\n        cached_input_tokens: totalCachedInput,\n        output_tokens: totalOutput,\n        reasoning_output_tokens: totalReasoningOutput,\n        total_tokens: totalTokens,\n    };\n}\n\nfunction buildTokenUsageInfo(history, modelContextWindow = null) {\n    const lastUsage = Array.isArray(history) && history.length > 0\n        ? getUsageFromEntry(history[history.length - 1])\n        : null;\n    const totalUsage = getTotalUsageFromHistory(history);\n    return {\n        info: {\n            total_token_usage: totalUsage || null,\n            last_token_usage: lastUsage || null,\n            model_context_window: modelContextWindow,\n        },\n        rate_limits: null,\n    };\n}\n\nmodule.exports = {\n    applyUsageToEntry,\n    getUsageFromEntry,\n    getTotalUsageFromHistory,\n    buildTokenUsageInfo,\n};\n", "const {\n    getUsageFromEntry,\n    getTotalUsageFromHistory,\n} = require('./agent-usage');\n\nfunction extractFinalAnswer(text) {\n    if (typeof text !== 'string') return null;\n    const matches = Array.from(text.matchAll(/<final_answer>([\\s\\S]*?)<\\/final_answer>/gi));\n    if (matches.length === 0) return null;\n    const last = matches[matches.length - 1];\n    return typeof last[1] === 'string' ? last[1].trim() : null;\n}\n\nfunction stripThoughtPlanActionPrefix(text) {\n    if (typeof text !== 'string') return text;\n    const lines = text.split('\\n');\n    let i = 0;\n    while (i < lines.length && !lines[i].trim()) i += 1;\n    const first = lines[i] || '';\n    if (!/^\\s*Thought\\s*:/i.test(first)) return text;\n\n    const out = [];\n    let skipping = true;\n    for (let idx = i; idx < lines.length; idx += 1) {\n        const line = lines[idx];\n        const trimmed = line.trim();\n        if (skipping) {\n            if (!trimmed) continue;\n            if (/^\\s*(Thought|Plan|Action)\\s*:/i.test(line)) continue;\n            if (/^\\s*(\\d+\\.|[-*])\\s+/.test(line)) continue;\n            skipping = false;\n        }\n        out.push(line);\n    }\n\n    return out.join('\\n');\n}\n\nfunction sanitizeFinalResponse(text) {\n    if (typeof text !== 'string' || !text.trim()) return text;\n    const extracted = extractFinalAnswer(text);\n    let candidate = (typeof extracted === 'string' && extracted.trim()) ? extracted : text;\n    if (candidate === text) {\n        candidate = stripThoughtPlanActionPrefix(candidate);\n    }\n    const patterns = [\n        /without explicitly stating/i,\n        /do not include/i,\n        /forbidden/i,\n        /i will now summarize/i,\n        /the previous model has already completed/i,\n        /the information has been retrieved/i,\n    ];\n    const lines = candidate.split('\\n');\n    const filtered = lines.filter((line) => {\n        const trimmed = line.trim();\n        if (!trimmed) return true;\n        return !patterns.some((re) => re.test(trimmed));\n    });\n    return filtered.join('\\n').trim();\n}\n\nfunction buildCompletionData({ history, finalResponseText, turnCount, modelContextWindow = null }) {\n    const lastUsage = getUsageFromEntry(history[history.length - 1]);\n    const totalUsage = getTotalUsageFromHistory(history);\n    return {\n        response: finalResponseText || 'Agent failed to produce a response within turn limit.',\n        turnCount,\n        historyLength: history.length,\n        tokenUsage: {\n            info: {\n                total_token_usage: totalUsage || null,\n                last_token_usage: lastUsage || null,\n                model_context_window: modelContextWindow,\n            },\n        },\n    };\n}\n\nmodule.exports = { buildCompletionData, sanitizeFinalResponse };\n", "const { DEFAULT_TOOL_TIMEOUT_MS } = require('./self-heal');\n\nfunction formatTimezoneOffset(minutes) {\n    if (!Number.isFinite(minutes) || minutes === 0) return 'Z';\n    const sign = minutes > 0 ? '-' : '+';\n    const abs = Math.abs(minutes);\n    const hours = String(Math.floor(abs / 60)).padStart(2, '0');\n    const mins = String(abs % 60).padStart(2, '0');\n    return `${sign}${hours}:${mins}`;\n}\n\nfunction buildEnvironmentContext() {\n    const now = new Date();\n    const iso = now.toISOString();\n    const offset = formatTimezoneOffset(now.getTimezoneOffset());\n    let cwd = null;\n    try {\n        if (typeof process !== 'undefined' && process && typeof process.cwd === 'function') {\n            cwd = process.cwd();\n        }\n    } catch {\n        cwd = null;\n    }\n\n    const lines = [\n        '<environment_context>',\n        `  <timestamp>${iso}</timestamp>`,\n        `  <timezone_offset>${offset}</timezone_offset>`,\n    ];\n    if (typeof cwd === 'string' && cwd.length > 0) {\n        lines.push(`  <cwd>${cwd}</cwd>`);\n    }\n    lines.push('</environment_context>');\n    return lines.join('\\n');\n}\n\nfunction awaitUserInput(agent, callId, timeoutMs) {\n    const ms = (typeof timeoutMs === 'number' && Number.isFinite(timeoutMs) && timeoutMs > 0)\n        ? timeoutMs\n        : DEFAULT_TOOL_TIMEOUT_MS;\n    return new Promise((resolve) => {\n        const existing = agent._pendingUserInputs.get(callId);\n        if (existing && typeof existing.reject === 'function') {\n            existing.reject(new Error('Superseded by new request'));\n        }\n\n        const entry = {\n            done: false,\n            resolve: (value) => {\n                if (entry.done) return;\n                entry.done = true;\n                if (entry.timer) clearTimeout(entry.timer);\n                agent._pendingUserInputs.delete(callId);\n                if (agent && typeof agent.emit === 'function') {\n                    agent.emit('user_input_response', {\n                        callId,\n                        timedOut: false,\n                        value,\n                        timestamp: new Date().toISOString(),\n                    });\n                }\n                resolve({ timedOut: false, value });\n            },\n            reject: () => {\n                if (entry.done) return;\n                entry.done = true;\n                if (entry.timer) clearTimeout(entry.timer);\n                agent._pendingUserInputs.delete(callId);\n                if (agent && typeof agent.emit === 'function') {\n                    agent.emit('user_input_response', {\n                        callId,\n                        timedOut: true,\n                        value: null,\n                        timestamp: new Date().toISOString(),\n                    });\n                }\n                resolve({ timedOut: true });\n            },\n            timer: null,\n        };\n\n        entry.timer = setTimeout(() => {\n            if (entry.done) return;\n            entry.done = true;\n            agent._pendingUserInputs.delete(callId);\n            if (agent && typeof agent.emit === 'function') {\n                agent.emit('user_input_response', {\n                    callId,\n                    timedOut: true,\n                    value: null,\n                    timestamp: new Date().toISOString(),\n                });\n            }\n            resolve({ timedOut: true });\n        }, ms);\n        if (entry.timer && typeof entry.timer.unref === 'function') entry.timer.unref();\n\n        agent._pendingUserInputs.set(callId, entry);\n    });\n}\n\nfunction respondToUserInput(agent, callId, response) {\n    let targetId = callId;\n    if (!targetId) {\n        if (agent._pendingUserInputs.size !== 1) return false;\n        targetId = Array.from(agent._pendingUserInputs.keys())[0];\n    }\n    const entry = agent._pendingUserInputs.get(targetId);\n    if (!entry || typeof entry.resolve !== 'function') return false;\n    entry.resolve(response);\n    return true;\n}\n\nfunction submitPendingInput(agent, text) {\n    const value = (typeof text === 'string') ? text.trim() : '';\n    if (!value) return false;\n    if (!Array.isArray(agent._pendingInputs)) agent._pendingInputs = [];\n    agent._pendingInputs.push(value);\n    agent.emit('pending_input_queued', { content: value, timestamp: new Date().toISOString() });\n    return true;\n}\n\nfunction drainPendingInputs(agent) {\n    if (!Array.isArray(agent._pendingInputs) || agent._pendingInputs.length === 0) return [];\n    const items = agent._pendingInputs.slice();\n    agent._pendingInputs = [];\n    return items;\n}\n\nmodule.exports = {\n    awaitUserInput,\n    respondToUserInput,\n    submitPendingInput,\n    drainPendingInputs,\n    buildEnvironmentContext,\n};\n", "const { buildCompletionData } = require('./agent-completion');\nconst { buildEnvironmentContext } = require('./agent-interaction');\n\nfunction buildDebugLogger(agent) {\n    return (...args) => {\n        if (!agent.debug) return;\n        console.log('[Debug]', ...args);\n    };\n}\n\nfunction resetTurnState(agent) {\n    agent.currentPlan = null;\n    agent._decisionTraces = [];\n    agent._pendingInputs = [];\n    agent._toolFailureStreak = new Map();\n    agent._approvalGrants.clear();\n    agent._approvalDenies.clear();\n    agent._approvalDeniedThisTurn = false;\n    agent._memoryFirstGuardCount = 0;\n    agent._citationGuardCount = 0;\n    if (agent._approvalDenyHints) agent._approvalDenyHints.clear();\n    if (Array.isArray(agent._knowledgeSelectedThisTurn)) agent._knowledgeSelectedThisTurn.length = 0;\n    else agent._knowledgeSelectedThisTurn = [];\n    if (agent._knowledgeSelectedIdSet instanceof Set) agent._knowledgeSelectedIdSet.clear();\n    else agent._knowledgeSelectedIdSet = new Set();\n    const turnStartIndex = agent.history.length;\n    agent._turnStartIndex = turnStartIndex;\n    return turnStartIndex;\n}\n\nfunction startAgentTurn(agent, userInput) {\n    console.log(`\\n--- [Agent] Starting Turn: \"${userInput}\" ---`);\n    const dbg = buildDebugLogger(agent);\n    const turnStartIndex = resetTurnState(agent);\n\n    agent.emit('start', { message: userInput });\n    agent.emit('turn_started', {\n        message: userInput,\n        timestamp: new Date().toISOString()\n    });\n\n    agent.history.push({ role: 'user', content: buildEnvironmentContext() });\n    agent.history.push({ role: 'user', content: userInput });\n    agent._setState('thinking', { input: userInput, step: 0 });\n\n    return { dbg, turnStartIndex };\n}\n\nfunction finalizeAgentTurn({ agent, finalResponseText, turnCount, maxTurns, dbg }) {\n    agent._setState('idle', { finalResponse: finalResponseText || null, turnCount });\n    agent.emit('autosave', agent.dumpSnapshot());\n    agent._turnStartIndex = null;\n\n    const completionData = buildCompletionData({\n        history: agent.history,\n        finalResponseText,\n        turnCount,\n    });\n\n    agent.emit('done', completionData);\n    agent.emit('agent_turn_complete', completionData);\n\n    if (!finalResponseText) {\n        dbg('Turn limit reached', {\n            turnCount,\n            maxTurns,\n            historyLength: agent.history.length,\n        });\n    }\n\n    return finalResponseText || \"Agent failed to produce a response within turn limit.\";\n}\n\nmodule.exports = { startAgentTurn, finalizeAgentTurn };\n", "async function runLlmStreamStep({ agent, stream, turnCount, currentStepResponse, signal }) {\n    let messageStarted = false;\n\n    for await (const chunk of stream) {\n        if (signal && signal.aborted) {\n            const err = signal.reason instanceof Error ? signal.reason : new Error('Aborted');\n            err.name = 'AbortError';\n            throw err;\n        }\n        if (chunk.type === 'text') {\n            if (!messageStarted) {\n                agent.emit('assistant_message_started', { step: turnCount });\n                messageStarted = true;\n            }\n            currentStepResponse.content += chunk.delta;\n            agent.emit('agent_message_content_delta', {\n                delta: chunk.delta,\n                step: turnCount,\n            });\n        } else if (chunk.type === 'tool_calls') {\n            currentStepResponse.tool_calls.push(...chunk.tool_calls);\n        }\n    }\n\n    return currentStepResponse;\n}\n\nmodule.exports = { runLlmStreamStep };\n", "function extractFirstSentence(text) {\n    if (typeof text !== 'string') return '';\n    const trimmed = text.trim();\n    if (!trimmed) return '';\n    const match = trimmed.match(/^(.+?[.!?])\\s/);\n    return match ? match[1] : trimmed;\n}\n\nfunction sanitizeSummary(text, maxChars = 160) {\n    const sentence = extractFirstSentence(text).replace(/\\s+/g, ' ').trim();\n    if (sentence.length <= maxChars) return sentence;\n    return `${sentence.slice(0, maxChars)}...`;\n}\n\nfunction parseThought(content) {\n    if (typeof content !== 'string') return '';\n    const match = content.match(/(?:^|\\n)\\s*Thought:\\s*(.+)/i);\n    if (!match) return '';\n    return sanitizeSummary(match[1]);\n}\n\nfunction parsePlanSteps(content) {\n    if (typeof content !== 'string') return null;\n    const lines = content.split('\\n');\n    const planIdx = lines.findIndex((line) => /^\\s*Plan\\s*:/i.test(line));\n    if (planIdx < 0) return null;\n    let count = 0;\n    for (let i = planIdx + 1; i < lines.length; i += 1) {\n        const line = lines[i].trim();\n        if (!line) continue;\n        if (/^\\s*Action\\s*:/i.test(line)) break;\n        if (/^(\\d+\\.|[-*])\\s+/.test(line)) count += 1;\n    }\n    return count > 0 ? count : null;\n}\n\nfunction buildDecisionTrace(content) {\n    const thought = parseThought(content);\n    const planSteps = parsePlanSteps(content);\n    if (!thought && planSteps == null) return null;\n    return { thought, planSteps };\n}\n\nfunction canExtractDecisionTrace(content) {\n    return Boolean(buildDecisionTrace(content));\n}\n\nfunction emitToolCallDecisionTrace(agent, toolCalls, step) {\n    if (!agent || typeof agent.emit !== 'function') return;\n    if (!Array.isArray(toolCalls) || toolCalls.length === 0) return;\n    const names = Array.from(new Set(\n        toolCalls\n            .map((tc) => (tc && tc.name ? String(tc.name) : ''))\n            .filter(Boolean)\n    ));\n    const label = names.length ? names.join(', ') : 'unknown_tool';\n    const thought = sanitizeSummary(`Calling tools: ${label}.`, 160);\n    agent.emit('decision_trace', {\n        step,\n        thought,\n        planSteps: toolCalls.length,\n        timestamp: new Date().toISOString(),\n    });\n}\n\nfunction emitDecisionTrace(agent, content, step) {\n    if (!agent || typeof agent.emit !== 'function') return;\n    const trace = buildDecisionTrace(content);\n    if (!trace) return;\n    const entry = {\n        step,\n        thought: trace.thought || null,\n        planSteps: trace.planSteps,\n        timestamp: new Date().toISOString(),\n    };\n    if (Array.isArray(agent._decisionTraces)) {\n        agent._decisionTraces.push(entry);\n        if (agent._decisionTraces.length > 200) {\n            agent._decisionTraces = agent._decisionTraces.slice(-200);\n        }\n    }\n    agent.emit('decision_trace', {\n        step: entry.step,\n        thought: entry.thought,\n        planSteps: entry.planSteps,\n        timestamp: entry.timestamp,\n    });\n}\n\nmodule.exports = { emitDecisionTrace, canExtractDecisionTrace, emitToolCallDecisionTrace };\n", "const { runLlmStreamStep } = require('./agent-llm-stream');\nconst { emitDecisionTrace, canExtractDecisionTrace, emitToolCallDecisionTrace } = require('./decision-trace');\nconst { getToolIntent, getToolRisk } = require('./agent-tools-registry');\n\nfunction tryParseToolArgs(raw) {\n    if (raw === null || raw === undefined) return null;\n    if (typeof raw === 'object') return raw;\n    if (typeof raw !== 'string') return { _raw: String(raw) };\n    try {\n        return JSON.parse(raw);\n    } catch {\n        return { _raw: raw };\n    }\n}\n\nfunction hasMissingThoughtSignature(toolCalls) {\n    return toolCalls.some((tc) => tc && !(tc.thought_signature || tc.thoughtSignature));\n}\n\nasync function runLlmStep({ agent, llm, systemPrompt, llmHistory, turnCount, signal }) {\n    let currentStepResponse = { content: '', tool_calls: [] };\n    let usedStreaming = false;\n\n    if (signal && signal.aborted) {\n        const err = signal.reason instanceof Error ? signal.reason : new Error('Aborted');\n        err.name = 'AbortError';\n        throw err;\n    }\n\n    if (typeof llm.chatStream === 'function') {\n        const stream = llm.chatStream(systemPrompt, llmHistory, { signal });\n        currentStepResponse = await runLlmStreamStep({\n            agent,\n            stream,\n            turnCount,\n            currentStepResponse,\n            signal,\n        });\n        usedStreaming = true;\n    } else {\n        const response = await llm.chat(systemPrompt, llmHistory, { signal });\n        currentStepResponse = response;\n        if (response && response.usage) currentStepResponse._usage = response.usage;\n\n        // Non-streaming responses are emitted only at turn completion.\n        // This avoids duplicated UI output when guards cause multiple LLM retries.\n\n    }\n\n    const retryToolCalls = async () => {\n        if (!usedStreaming || typeof llm.chat !== 'function') return;\n        const toolCalls = Array.isArray(currentStepResponse.tool_calls) ? currentStepResponse.tool_calls : [];\n        if (toolCalls.length === 0 || !hasMissingThoughtSignature(toolCalls)) return;\n\n        try {\n            const retry = await llm.chat(systemPrompt, llmHistory, { signal });\n            if (retry && retry.usage) currentStepResponse._usage = retry.usage;\n            if (retry && Array.isArray(retry.tool_calls) && retry.tool_calls.length > 0) {\n                currentStepResponse.tool_calls = retry.tool_calls;\n            }\n        } catch {\n            // Keep streaming result if retry fails.\n        }\n    };\n\n    await retryToolCalls();\n\n    const content = currentStepResponse && typeof currentStepResponse.content === 'string'\n        ? currentStepResponse.content\n        : '';\n    const toolCalls = currentStepResponse && Array.isArray(currentStepResponse.tool_calls)\n        ? currentStepResponse.tool_calls\n        : [];\n\n    if (signal && signal.aborted) {\n        const err = signal.reason instanceof Error ? signal.reason : new Error('Aborted');\n        err.name = 'AbortError';\n        throw err;\n    }\n\n    if (content) {\n        emitDecisionTrace(agent, content, turnCount);\n    }\n    // Avoid double decision traces for tool-only steps: agent-tool-flow will emit\n    // a synthetic Thought/Plan when content is empty.\n    if (toolCalls.length > 0 && content && !canExtractDecisionTrace(content)) {\n        emitToolCallDecisionTrace(agent, toolCalls, turnCount);\n    }\n\n    if (toolCalls.length > 0) {\n        const enriched = toolCalls.map((tc) => {\n            const toolName = tc && tc.name ? String(tc.name) : '';\n            const args = tryParseToolArgs(tc && tc.arguments);\n            const intent = getToolIntent(agent, toolName, args);\n            const risk = getToolRisk(agent, toolName, tc);\n            return {\n                ...tc,\n                intent: intent || undefined,\n                risk,\n            };\n        });\n        agent.emit('tool_call', {\n            tools: toolCalls.map(tc => tc.name),\n            details: enriched,\n        });\n    }\n\n    return currentStepResponse;\n}\n\nmodule.exports = { runLlmStep };\n", "function isRealtimeQuery(text) {\n    if (typeof text !== 'string') return false;\n    const value = text.toLowerCase();\n    const realtimeTopics = [\n        'weather',\n        'forecast',\n        'stock',\n        'price',\n        'prices',\n        'exchange rate',\n        'fx',\n        'news',\n    ];\n    const hasTopic = realtimeTopics.some((topic) => value.includes(topic));\n    const hasTimeQuery = /\\b(current time|time now)\\b/i.test(value);\n    const hasRate = /\\brate\\b/i.test(value);\n    const hasCurrencyCode = /\\b[a-z]{3}\\b/i.test(value);\n\n    return hasTimeQuery || hasTopic || (hasRate && hasCurrencyCode);\n}\n\nconst MEMORY_TOOL_NAMES = new Set([\n    'memory_search',\n    'kb_search',\n    'memory__search_nodes',\n    'memory_read_graph',\n    'memory__read_graph',\n]);\n\nconst WEB_SEARCH_TOOL_NAMES = new Set([\n    'searxng_query',\n    'read_url',\n]);\n\nfunction normalizeToolName(name) {\n    return String(name || '').trim().toLowerCase();\n}\n\nfunction isMemoryToolName(name) {\n    return MEMORY_TOOL_NAMES.has(normalizeToolName(name));\n}\n\nfunction isWebSearchToolName(name) {\n    return WEB_SEARCH_TOOL_NAMES.has(normalizeToolName(name));\n}\n\nfunction hasToolActivitySince(history, startIndex) {\n    if (!Array.isArray(history)) return false;\n    for (let i = Math.max(0, startIndex); i < history.length; i++) {\n        const msg = history[i];\n        if (!msg || typeof msg !== 'object') continue;\n        if ((msg.role === 'system' || msg.role === 'tool') && msg.tool_call_id) return true;\n        if (msg.role === 'assistant' && Array.isArray(msg.tool_calls) && msg.tool_calls.length > 0) return true;\n    }\n    return false;\n}\n\nfunction hasMemoryToolActivitySince(history, startIndex) {\n    if (!Array.isArray(history)) return false;\n    for (let i = Math.max(0, startIndex); i < history.length; i++) {\n        const msg = history[i];\n        if (!msg || typeof msg !== 'object') continue;\n        if ((msg.role !== 'system' && msg.role !== 'tool') || !msg.tool_call_id) continue;\n        if (isMemoryToolName(msg.name)) return true;\n    }\n    return false;\n}\n\nfunction hasWebSearchToolRequested(toolCalls) {\n    if (!Array.isArray(toolCalls)) return false;\n    for (const tc of toolCalls) {\n        if (!tc || typeof tc !== 'object') continue;\n        if (isWebSearchToolName(tc.name)) return true;\n    }\n    return false;\n}\n\nfunction hasEvidenceToolActivitySince(history, startIndex) {\n    if (!Array.isArray(history)) return false;\n    const ignored = new Set([\n        'update_plan',\n        'list_available_skills',\n        'read_skill_documentation',\n        'request_user_input',\n    ]);\n    for (let i = Math.max(0, startIndex); i < history.length; i++) {\n        const msg = history[i];\n        if (!msg || typeof msg !== 'object') continue;\n        if (msg.role === 'assistant' && Array.isArray(msg.tool_calls) && msg.tool_calls.length > 0) {\n            for (const tc of msg.tool_calls) {\n                const name = tc && tc.name ? String(tc.name) : '';\n                if (name && !ignored.has(name)) return true;\n            }\n        }\n    }\n    return false;\n}\n\nfunction getPendingPlanSteps(plan) {\n    if (!Array.isArray(plan)) return [];\n    return plan\n        .filter((item) => item && typeof item === 'object')\n        .filter((item) => item.status === 'pending' || item.status === 'in_progress')\n        .map((item) => (typeof item.step === 'string' ? item.step : ''))\n        .filter(Boolean);\n}\n\nfunction isPersonalMemoryQuery(text) {\n    if (typeof text !== 'string') return false;\n    const value = text.toLowerCase();\n    return /(?:\\bmy\\b|\\bmine\\b|\\bme\\b|\\bi\\s+am\\b|\\bi'm\\b|\\bremember\\b|\\bdo you remember\\b|\\bwhat(?:'s| is)\\s+my\\b|\\bwho am i\\b|\\bmy\\s+favorite\\b|\\bmy\\s+car\\b|\\bmy\\s+name\\b)/i.test(value);\n}\n\nfunction buildMemoryQueries(text) {\n    if (typeof text !== 'string') return [];\n    const value = text.toLowerCase();\n    const tokens = value\n        .replace(/[^a-z0-9\\s_-]/g, ' ')\n        .split(/\\s+/)\n        .filter(Boolean);\n\n    const stopwords = new Set([\n        'the', 'a', 'an', 'and', 'or', 'but', 'to', 'of', 'for', 'with', 'in', 'on', 'at', 'by', 'about',\n        'what', 'whats', \"what's\", 'is', 'are', 'was', 'were', 'do', 'does', 'did', 'my', 'mine', 'me', 'i',\n        'am', \"i'm\", 'remember', 'please', 'tell', 'color',\n    ]);\n\n    const keywords = tokens.filter((token) => token.length > 1 && !stopwords.has(token));\n    const hasCar = keywords.includes('car') || value.includes('car');\n    const hasColor = value.includes('color') || value.includes('colour');\n\n    const queries = [];\n    if (hasCar && hasColor) queries.push('car color');\n    if (hasCar) queries.push('car');\n    if (hasColor) queries.push('color');\n\n    for (const word of keywords) {\n        if (!queries.includes(word)) queries.push(word);\n    }\n\n    return queries.slice(0, 3);\n}\n\nfunction parseToolResultContent(resultMessage) {\n    if (!resultMessage || typeof resultMessage.content !== 'string') return null;\n    try {\n        return JSON.parse(resultMessage.content);\n    } catch {\n        return null;\n    }\n}\n\nfunction detectApprovalBlock(toolResults) {\n    if (!Array.isArray(toolResults) || toolResults.length === 0) return null;\n    const blocked = [];\n    for (const msg of toolResults) {\n        const parsed = parseToolResultContent(msg);\n        if (!parsed || typeof parsed !== 'object') continue;\n        const structured = parsed.structuredContent && typeof parsed.structuredContent === 'object'\n            ? parsed.structuredContent\n            : null;\n        const err = structured && typeof structured.error === 'string' ? structured.error : null;\n        if (err === 'ApprovalDenied' || err === 'ApprovalTimeout') {\n            blocked.push({\n                tool: msg && msg.name ? String(msg.name) : null,\n                callId: msg && msg.tool_call_id ? String(msg.tool_call_id) : null,\n                error: err,\n            });\n        }\n    }\n    return blocked.length > 0 ? blocked : null;\n}\n\nfunction formatApprovalBlockedHint(blocked) {\n    const tools = blocked.map((b) => b && b.tool ? b.tool : '').filter(Boolean);\n    const unique = Array.from(new Set(tools));\n    const list = unique.length ? unique.join(', ') : 'the requested tool(s)';\n    return (\n        `User denied approval for: ${list}.\\n` +\n        `Update your plan: mark the related step(s) as blocked/cannot-complete, then continue with a partial answer using the approved tool results.\\n` +\n        `Do not keep re-requesting the same tool unless the user explicitly asks to try again or changes their decision.`\n    );\n}\n\nfunction countSuccessfulEvidenceTools({ toolResults }) {\n    if (!Array.isArray(toolResults) || toolResults.length === 0) return 0;\n    const ignored = new Set([\n        'update_plan',\n        'list_available_skills',\n        'read_skill_documentation',\n        'request_user_input',\n    ]);\n    let count = 0;\n    for (const msg of toolResults) {\n        const name = msg && msg.name ? String(msg.name) : '';\n        if (name && ignored.has(name)) continue;\n        const parsed = parseToolResultContent(msg);\n        if (!parsed || typeof parsed !== 'object') continue;\n        if (parsed.isError === false) {\n            count += 1;\n            continue;\n        }\n        const structured = parsed.structuredContent && typeof parsed.structuredContent === 'object'\n            ? parsed.structuredContent\n            : null;\n        const hasErr = structured && typeof structured.error === 'string' && structured.error.length > 0;\n        if (!hasErr && parsed.isError !== true) {\n            count += 1;\n        }\n    }\n    return count;\n}\n\nfunction hasAnyTurnEvidence({ history, startIndex }) {\n    if (!Array.isArray(history)) return false;\n    const from = (typeof startIndex === 'number' && Number.isFinite(startIndex)) ? Math.max(0, startIndex) : 0;\n    const ignored = new Set([\n        'update_plan',\n        'list_available_skills',\n        'read_skill_documentation',\n        'request_user_input',\n    ]);\n\n    for (let i = from; i < history.length; i += 1) {\n        const msg = history[i];\n        if (!msg || typeof msg !== 'object') continue;\n        const name = msg && msg.name ? String(msg.name) : '';\n        if (name && ignored.has(name)) continue;\n        if (!((msg.role === 'system' || msg.role === 'tool') && msg.tool_call_id && name)) continue;\n\n        const parsed = parseToolResultContent(msg);\n        if (!parsed || typeof parsed !== 'object') continue;\n        if (parsed.isError === false) return true;\n\n        const structured = parsed.structuredContent && typeof parsed.structuredContent === 'object'\n            ? parsed.structuredContent\n            : null;\n        const hasErr = structured && typeof structured.error === 'string' && structured.error.length > 0;\n        if (!hasErr && parsed.isError !== true) return true;\n    }\n    return false;\n}\n\nfunction formatMemoryResult(mcpResult) {\n    if (!mcpResult || typeof mcpResult !== 'object') return '';\n    if (Array.isArray(mcpResult.content)) {\n        const text = mcpResult.content\n            .filter((b) => b && b.type === 'text' && typeof b.text === 'string')\n            .map((b) => b.text)\n            .join('\\n');\n        if (text.trim()) return text.trim();\n    }\n    if (mcpResult.structuredContent !== undefined) {\n        try {\n            return JSON.stringify(mcpResult.structuredContent, null, 2);\n        } catch {\n            return String(mcpResult.structuredContent);\n        }\n    }\n    return '';\n}\n\nfunction isEmptyMemorySearchResult(mcpResult) {\n    if (!mcpResult || typeof mcpResult !== 'object') return true;\n    if (Array.isArray(mcpResult.structuredContent)) return mcpResult.structuredContent.length === 0;\n    if (mcpResult.structuredContent && typeof mcpResult.structuredContent === 'object') {\n        const hits = mcpResult.structuredContent.hits;\n        if (Array.isArray(hits)) return hits.length === 0;\n        const nodes = mcpResult.structuredContent.nodes;\n        if (Array.isArray(nodes)) return nodes.length === 0;\n    }\n    if (Array.isArray(mcpResult.content)) {\n        const text = mcpResult.content.map((c) => c && c.text ? String(c.text) : '').join(' ');\n        if (!text.trim()) return true;\n        if (/\\bno\\s+results\\b|\\bnone\\b|\\bempty\\b|\\[\\s*\\]/i.test(text)) return true;\n    }\n    return false;\n}\n\nmodule.exports = {\n    buildMemoryQueries,\n    countSuccessfulEvidenceTools,\n    detectApprovalBlock,\n    formatApprovalBlockedHint,\n    formatMemoryResult,\n    getPendingPlanSteps,\n    hasAnyTurnEvidence,\n    hasMemoryToolActivitySince,\n    hasEvidenceToolActivitySince,\n    hasToolActivitySince,\n    hasWebSearchToolRequested,\n    isEmptyMemorySearchResult,\n    isMemoryToolName,\n    isPersonalMemoryQuery,\n    isRealtimeQuery,\n    isWebSearchToolName,\n    parseToolResultContent,\n};\n", "function compactText(input, maxLen = 240) {\n    const text = String(input || '').trim().replace(/\\s+/g, ' ');\n    if (text.length <= maxLen) return text;\n    return `${text.slice(0, Math.max(0, maxLen - 3))}...`;\n}\n\nfunction buildAutoSavePayload({ userInput }) {\n    const text = String(userInput || '').trim();\n    if (!text) return null;\n\n    const patterns = [\n        {\n            type: 'fact',\n            title: 'User name',\n            regex: /\\bmy\\s+name\\s+is\\s+([^\\n.,!?]{2,80})/i,\n            map: (m) => `User says their name is ${m[1].trim()}.`,\n        },\n        {\n            type: 'preference',\n            title: 'User preference',\n            regex: /\\bmy\\s+favorite\\s+([^\\n.,!?]{2,60})\\s+is\\s+([^\\n.,!?]{2,120})/i,\n            map: (m) => `Favorite ${m[1].trim()}: ${m[2].trim()}.`,\n        },\n        {\n            type: 'preference',\n            title: 'User preference',\n            regex: /\\bi\\s+(?:like|love|prefer)\\s+([^\\n.,!?]{3,120})/i,\n            map: (m) => `User preference: ${m[1].trim()}.`,\n        },\n        {\n            type: 'note',\n            title: 'Remembered note',\n            regex: /\\bremember\\s+that\\s+([^\\n]{4,200})/i,\n            map: (m) => m[1].trim(),\n        },\n    ];\n\n    for (const p of patterns) {\n        const match = text.match(p.regex);\n        if (!match) continue;\n\n        const content = compactText(p.map(match), 220);\n        if (!content) return null;\n\n        return {\n            type: p.type,\n            title: p.title,\n            content,\n            metadata: {\n                tags: ['auto_saved'],\n                source: 'agentic_rag_policy',\n            },\n        };\n    }\n\n    return null;\n}\n\nfunction shouldAutoSave(agent) {\n    return Boolean(agent && agent.ragConfig && agent.ragConfig.enabled && agent.ragConfig.autoSave);\n}\n\nmodule.exports = {\n    buildAutoSavePayload,\n    shouldAutoSave,\n};\n", "function toText(value) {\n    return String(value == null ? '' : value).trim();\n}\n\nconst KNOWLEDGE_TOOL_NAMES = new Set([\n    'kb_search',\n    'memory_search',\n    'memory__search_nodes',\n]);\n\nfunction isKnowledgeToolName(name) {\n    return KNOWLEDGE_TOOL_NAMES.has(toText(name).toLowerCase());\n}\n\nfunction toFiniteScore(value) {\n    const n = Number(value);\n    return Number.isFinite(n) ? n : null;\n}\n\nfunction normalizeHitItem(item) {\n    if (!item || typeof item !== 'object') return null;\n    const id = toText(item.id);\n    if (!id) return null;\n    const title = toText(item.title) || id;\n    const score = toFiniteScore(item.score);\n    const source = toText(item.source || item.source_path || item.file || '');\n    const sourcePages = Array.isArray(item.source_pages)\n        ? item.source_pages.map((n) => Number(n)).filter((n) => Number.isFinite(n)).map((n) => Math.trunc(n))\n        : [];\n    return {\n        id,\n        title,\n        score,\n        source,\n        sourcePages,\n        type: toText(item.type || ''),\n        updatedAt: toText(item.updated_at || ''),\n    };\n}\n\nfunction normalizeHitsFromStructured(toolName, structured) {\n    if (!structured || typeof structured !== 'object') return [];\n    if (Array.isArray(structured.hits)) {\n        return structured.hits.map(normalizeHitItem).filter(Boolean);\n    }\n    if (toolName === 'memory__search_nodes' && Array.isArray(structured.nodes)) {\n        return structured.nodes.map(normalizeHitItem).filter(Boolean);\n    }\n    return [];\n}\n\nfunction extractStructuredContent(parsedToolResult) {\n    if (!parsedToolResult || typeof parsedToolResult !== 'object') return null;\n    const structured = parsedToolResult.structuredContent;\n    if (structured && typeof structured === 'object') return structured;\n    return null;\n}\n\nfunction extractKnowledgeSelectionFromParsed({\n    toolName,\n    args,\n    parsedToolResult,\n    maxSelected = 6,\n    minScore = null,\n} = {}) {\n    if (!isKnowledgeToolName(toolName)) return null;\n    const structured = extractStructuredContent(parsedToolResult);\n    if (!structured) return null;\n    let hits = normalizeHitsFromStructured(toolName, structured);\n    if (hits.length === 0) return null;\n\n    if (typeof minScore === 'number' && Number.isFinite(minScore)) {\n        hits = hits.filter((h) => !(typeof h.score === 'number' && h.score < minScore));\n    }\n\n    if (hits.length === 0) return null;\n    const n = Number.isFinite(Number(maxSelected)) ? Math.max(1, Math.floor(Number(maxSelected))) : 6;\n    const selected = hits.slice(0, n);\n    return {\n        tool: toText(toolName),\n        query: toText(args && args.query),\n        scope: toText(args && args.scope),\n        count: selected.length,\n        totalHits: hits.length,\n        selected,\n    };\n}\n\nfunction extractCitationEntriesFromText(text) {\n    const input = String(text || '');\n    if (!input) return [];\n    const pattern = /\\[source:\\s*#?([a-z0-9._:-]+)(?:\\s+p\\.?\\s*(\\d+))?\\s*\\]/ig;\n    const out = [];\n    let match = pattern.exec(input);\n    while (match) {\n        const id = toText(match[1]);\n        const pageRaw = match[2];\n        const page = Number.isFinite(Number(pageRaw)) ? Math.trunc(Number(pageRaw)) : null;\n        if (id) out.push({ id, page });\n        match = pattern.exec(input);\n    }\n    return out;\n}\n\nfunction extractCitationIdsFromText(text) {\n    const entries = extractCitationEntriesFromText(text);\n    return Array.from(new Set(entries.map((e) => e.id).filter(Boolean)));\n}\n\nfunction hasCitationForKnowledge({\n    text,\n    knowledgeIds,\n} = {}) {\n    const ids = Array.isArray(knowledgeIds) ? knowledgeIds.map((v) => toText(v)).filter(Boolean) : [];\n    if (ids.length === 0) return true;\n    const cited = new Set(extractCitationIdsFromText(text));\n    for (const id of ids) {\n        if (cited.has(id)) return true;\n    }\n    return false;\n}\n\nfunction buildCitationReminder({ knowledgeIds = [] } = {}) {\n    const list = Array.isArray(knowledgeIds) ? knowledgeIds.map((v) => toText(v)).filter(Boolean).slice(0, 6) : [];\n    const sample = list.length > 0 ? list.join(', ') : 'knowledge_id';\n    return (\n        'Citation required: Your final answer used knowledge evidence. '\n        + 'Add inline citations in this exact format: [source:#<id> p.<page>]. '\n        + `Example ids from this turn: ${sample}.`\n    );\n}\n\nmodule.exports = {\n    extractCitationEntriesFromText,\n    extractCitationIdsFromText,\n    extractKnowledgeSelectionFromParsed,\n    hasCitationForKnowledge,\n    isKnowledgeToolName,\n    buildCitationReminder,\n};\n", "const { parseToolResultContent } = require('./agent-tool-flow-helpers');\nconst { extractKnowledgeSelectionFromParsed, isKnowledgeToolName } = require('./knowledge-evidence');\n\nfunction parseToolArgs(raw) {\n    if (!raw) return null;\n    if (typeof raw === 'object') return raw;\n    if (typeof raw !== 'string') return null;\n    try {\n        const parsed = JSON.parse(raw);\n        return parsed && typeof parsed === 'object' ? parsed : null;\n    } catch {\n        return null;\n    }\n}\n\nfunction buildToolCallMap(toolCalls) {\n    const map = new Map();\n    if (!Array.isArray(toolCalls)) return map;\n    for (const call of toolCalls) {\n        if (!call || typeof call !== 'object') continue;\n        const id = call.id ? String(call.id) : '';\n        if (!id) continue;\n        map.set(id, call);\n    }\n    return map;\n}\n\nfunction toSelectedIds(selection) {\n    const list = Array.isArray(selection && selection.selected) ? selection.selected : [];\n    return list\n        .map((item) => (item && item.id ? String(item.id).trim() : ''))\n        .filter(Boolean);\n}\n\nfunction recordKnowledgeSelections({\n    agent,\n    toolCalls,\n    toolResults,\n    turnCount,\n}) {\n    if (!agent || typeof agent !== 'object') return 0;\n    if (!Array.isArray(toolResults) || toolResults.length === 0) return 0;\n\n    if (!Array.isArray(agent._knowledgeSelectedThisTurn)) agent._knowledgeSelectedThisTurn = [];\n    if (!(agent._knowledgeSelectedIdSet instanceof Set)) agent._knowledgeSelectedIdSet = new Set();\n    const idSet = agent._knowledgeSelectedIdSet;\n    const callMap = buildToolCallMap(toolCalls);\n\n    let emitted = 0;\n    for (let i = 0; i < toolResults.length; i += 1) {\n        const result = toolResults[i];\n        const callId = result && result.tool_call_id ? String(result.tool_call_id) : '';\n        const linkedCall = (callId && callMap.get(callId)) || (Array.isArray(toolCalls) ? toolCalls[i] : null);\n        const toolName = String((result && result.name) || (linkedCall && linkedCall.name) || '').trim();\n        if (!isKnowledgeToolName(toolName)) continue;\n\n        const parsed = parseToolResultContent(result);\n        const args = parseToolArgs(linkedCall && linkedCall.arguments);\n        const selection = extractKnowledgeSelectionFromParsed({\n            toolName,\n            args,\n            parsedToolResult: parsed,\n            maxSelected: 6,\n            minScore: Number.isFinite(Number(agent.ragConfig && agent.ragConfig.minScore))\n                ? Number(agent.ragConfig.minScore)\n                : null,\n        });\n        if (!selection) continue;\n\n        const selectedIds = toSelectedIds(selection);\n        if (selectedIds.length === 0) continue;\n\n        const newSelectedIds = [];\n        for (const id of selectedIds) {\n            if (idSet.has(id)) continue;\n            idSet.add(id);\n            newSelectedIds.push(id);\n        }\n\n        const payload = {\n            ...selection,\n            callId: callId || (linkedCall && linkedCall.id ? String(linkedCall.id) : ''),\n            step: Number.isFinite(Number(turnCount)) ? Number(turnCount) : null,\n            selectedIds,\n            newSelectedIds,\n            timestamp: new Date().toISOString(),\n        };\n        agent._knowledgeSelectedThisTurn.push(payload);\n        if (typeof agent.emit === 'function') agent.emit('knowledge_selected', payload);\n        emitted += 1;\n    }\n\n    return emitted;\n}\n\nmodule.exports = { recordKnowledgeSelections };\n", "const { buildSyntheticToolPlan } = require('./agent-tool-runner');\nconst { applyUsageToEntry, buildTokenUsageInfo } = require('./agent-usage');\nconst { emitDecisionTrace } = require('./decision-trace');\nconst {\n    buildMemoryQueries,\n    countSuccessfulEvidenceTools,\n    detectApprovalBlock,\n    formatApprovalBlockedHint,\n    formatMemoryResult,\n    getPendingPlanSteps,\n    hasAnyTurnEvidence,\n    hasMemoryToolActivitySince,\n    hasEvidenceToolActivitySince,\n    hasToolActivitySince,\n    hasWebSearchToolRequested,\n    isEmptyMemorySearchResult,\n    isPersonalMemoryQuery,\n    isRealtimeQuery,\n    parseToolResultContent,\n} = require('./agent-tool-flow-helpers');\nconst { buildAutoSavePayload, shouldAutoSave } = require('./rag/rag-autosave-policy');\nconst { recordKnowledgeSelections } = require('./agent-knowledge-selection');\n\nfunction hasMemoryTools(agent) {\n    if (!agent || !agent.tools) return false;\n    const tools = agent.tools;\n    return Boolean(\n        tools.memory_search\n        || tools.kb_search\n        || tools.memory__search_nodes\n        || tools.memory_read_graph\n        || tools.memory__read_graph\n    );\n}\n\nasync function maybeAutoMemoryLookup({ agent, userInput }) {\n    if (!agent || !hasMemoryTools(agent)) return false;\n    const preferRagSearch = Boolean(agent.ragConfig && agent.ragConfig.enabled && agent.tools.memory_search);\n    if (!preferRagSearch && !isPersonalMemoryQuery(userInput)) return false;\n\n    const directSearchTool = agent.tools.memory_search;\n    const kbSearchTool = agent.tools.kb_search;\n    const searchTool = agent.tools['memory__search_nodes'];\n    const readTool = agent.tools.memory_read_graph || agent.tools['memory__read_graph'];\n    if (!kbSearchTool && !directSearchTool && !searchTool && !readTool) return false;\n\n    const queries = buildMemoryQueries(userInput);\n    if (!preferRagSearch && queries.length === 0) return false;\n\n    let searchHit = false;\n    let lastResult = null;\n    const makeCallId = (idx) => `auto_mem_${Date.now()}_${idx}`;\n    const recordAutoKnowledgeSelections = (toolCall, toolResults) => {\n        if (!toolCall || !Array.isArray(toolResults) || toolResults.length === 0) return;\n        recordKnowledgeSelections({\n            agent,\n            toolCalls: [toolCall],\n            toolResults,\n            turnCount: null,\n        });\n    };\n\n    if (preferRagSearch) {\n        const topK = agent.ragConfig && Number.isFinite(Number(agent.ragConfig.topK))\n            ? Number(agent.ragConfig.topK)\n            : 5;\n        const minScoreBase = agent.ragConfig && Number.isFinite(Number(agent.ragConfig.minScore))\n            ? Number(agent.ragConfig.minScore)\n            : 0.2;\n        const minScore = Math.max(minScoreBase, 0.35);\n\n        if (kbSearchTool) {\n            const kbCall = {\n                id: makeCallId('kb'),\n                name: 'kb_search',\n                arguments: JSON.stringify({\n                    query: userInput,\n                    topK,\n                    minScore,\n                }),\n            };\n            const kbResults = await agent._executeTools([kbCall]);\n            recordAutoKnowledgeSelections(kbCall, kbResults);\n            const kbParsed = parseToolResultContent(kbResults[0]);\n            lastResult = kbParsed;\n            if (kbParsed && kbParsed.structuredContent && Array.isArray(kbParsed.structuredContent.hits) && kbParsed.structuredContent.hits.length > 0) {\n                searchHit = true;\n            }\n        }\n\n        if (!searchHit && directSearchTool) {\n            const ragCall = {\n                id: makeCallId('rag'),\n                name: 'memory_search',\n                arguments: JSON.stringify({\n                    query: userInput,\n                    topK,\n                    minScore,\n                    scope: 'all',\n                }),\n            };\n            const results = await agent._executeTools([ragCall]);\n            recordAutoKnowledgeSelections(ragCall, results);\n            const parsed = parseToolResultContent(results[0]);\n            lastResult = parsed;\n            if (parsed && parsed.structuredContent && Array.isArray(parsed.structuredContent.hits) && parsed.structuredContent.hits.length > 0) {\n                searchHit = true;\n            }\n        }\n    }\n\n    for (let i = 0; i < queries.length; i += 1) {\n        if (searchHit) break;\n        if (!searchTool) break;\n        const call = {\n            id: makeCallId(i),\n            name: 'memory__search_nodes',\n            arguments: JSON.stringify({ query: queries[i] }),\n        };\n        const results = await agent._executeTools([call]);\n        recordAutoKnowledgeSelections(call, results);\n        const parsed = parseToolResultContent(results[0]);\n        lastResult = parsed;\n        if (parsed && !isEmptyMemorySearchResult(parsed)) {\n            searchHit = true;\n            break;\n        }\n    }\n\n    if (!searchHit && readTool) {\n        const readCall = {\n            id: makeCallId('read'),\n            name: 'memory__read_graph',\n            arguments: JSON.stringify({}),\n        };\n        const results = await agent._executeTools([readCall]);\n        lastResult = parseToolResultContent(results[0]);\n    }\n\n    const summary = formatMemoryResult(lastResult);\n    if (summary) {\n        agent.history.push({ role: 'user', content: `Memory lookup (auto):\\n${summary}` });\n    } else {\n        agent.history.push({ role: 'user', content: 'Memory lookup (auto): no results found.' });\n    }\n\n    return true;\n}\n\nasync function maybeAutoMemorySave({ agent, userInput }) {\n    if (!agent || !agent.tools || !agent.tools.memory_save) return false;\n    if (!shouldAutoSave(agent)) return false;\n\n    const payload = buildAutoSavePayload({ userInput });\n    if (!payload) return false;\n\n    const call = {\n        id: `auto_mem_save_${Date.now()}`,\n        name: 'memory_save',\n        arguments: JSON.stringify(payload),\n    };\n    const results = await agent._executeTools([call]);\n    const parsed = parseToolResultContent(results[0]);\n    if (!parsed || !parsed.structuredContent || parsed.structuredContent.ok !== true) return false;\n\n    agent.history.push({\n        role: 'user',\n        content: `Memory autosave (auto): saved id=${parsed.structuredContent.id}`,\n    });\n    return true;\n}\n\nasync function handleToolCalls({ agent, currentStepResponse, turnCount }) {\n    if (!currentStepResponse.tool_calls || currentStepResponse.tool_calls.length === 0) {\n        return { handled: false };\n    }\n\n    const hasMemoryCapability = hasMemoryTools(agent);\n    const webSearchRequested = hasWebSearchToolRequested(currentStepResponse.tool_calls);\n    const memoryAlreadyChecked = hasMemoryToolActivitySince(agent.history, agent && agent._turnStartIndex);\n    const memoryFirstEnabled = Boolean(agent && agent.ragConfig && agent.ragConfig.memoryFirst === true);\n    const shouldGuardMemoryFirst = (\n        memoryFirstEnabled\n        && hasMemoryCapability\n        && webSearchRequested\n        && !memoryAlreadyChecked\n    );\n    if (shouldGuardMemoryFirst) {\n        const guardCount = Number(agent._memoryFirstGuardCount || 0);\n        if (guardCount < 2) {\n            agent._memoryFirstGuardCount = guardCount + 1;\n            agent.history.push({\n                role: 'user',\n                content: 'Policy reminder: Call kb_search or memory_search first. Use web search only if local JSONL/memory evidence is insufficient.',\n            });\n            if (typeof agent.emit === 'function') {\n                agent.emit('memory_first_guard', {\n                    attempt: agent._memoryFirstGuardCount,\n                    tools: currentStepResponse.tool_calls.map((tc) => (tc && tc.name ? String(tc.name) : '')).filter(Boolean),\n                });\n            }\n            return { handled: true };\n        }\n    }\n\n    if (!currentStepResponse.content) {\n        const synthetic = buildSyntheticToolPlan(currentStepResponse.tool_calls);\n        emitDecisionTrace(agent, synthetic, turnCount);\n        agent.emit('assistant_message_started', { step: turnCount });\n        agent.emit('agent_message_content_delta', { delta: synthetic, step: turnCount });\n        agent.history.push({ role: 'assistant', content: synthetic });\n    }\n\n    const assistantEntry = {\n        role: 'assistant',\n        content: currentStepResponse.content || null,\n        tool_calls: currentStepResponse.tool_calls,\n    };\n    const applied = applyUsageToEntry(assistantEntry, currentStepResponse._usage);\n    agent.history.push(assistantEntry);\n    if (applied) {\n        agent.emit('token_count', buildTokenUsageInfo(agent.history));\n    }\n\n    const toolResults = await agent._executeTools(currentStepResponse.tool_calls);\n    agent.history.push(...toolResults);\n    recordKnowledgeSelections({\n        agent,\n        toolCalls: currentStepResponse.tool_calls,\n        toolResults,\n        turnCount,\n    });\n\n    const approvalBlocked = detectApprovalBlock(toolResults);\n    if (approvalBlocked) {\n        if (agent) agent._approvalDeniedThisTurn = true;\n        let maxRisk = 0;\n        if (agent && agent.tools) {\n            for (const b of approvalBlocked) {\n                const t = b && b.tool ? agent.tools[b.tool] : null;\n                const r = t && typeof t.risk === 'number' ? t.risk : 2;\n                if (r > maxRisk) maxRisk = r;\n            }\n        }\n\n        if (maxRisk >= 2) {\n            const tools = approvalBlocked.map((b) => b.tool).filter(Boolean).join(', ');\n            const reason = approvalBlocked[0] && approvalBlocked[0].error ? approvalBlocked[0].error : 'ApprovalDenied';\n            const successCount = countSuccessfulEvidenceTools({ toolResults });\n            const turnEvidence = hasAnyTurnEvidence({ history: agent && agent.history, startIndex: agent && agent._turnStartIndex });\n            if (agent && typeof agent.emit === 'function') {\n                agent.emit('approval_blocked', {\n                    tools: approvalBlocked,\n                    reason,\n                    successCount,\n                    turnEvidence,\n                    timestamp: new Date().toISOString(),\n                });\n            }\n            if (successCount === 0 && !turnEvidence) {\n                const message = `I can't continue because approval was not granted for tool(s): ${tools}.\\n\\nIf you want me to use those tools, please approve. Otherwise, tell me what assumptions/region you want and I can give a best-effort, non-verified answer.`;\n                return { handled: true, stopTurn: true, stopReason: reason, message };\n            }\n\n            if (agent && Array.isArray(agent.history)) {\n                if (!agent._approvalDenyHints) agent._approvalDenyHints = new Set();\n                const key = `${reason}:${tools}`;\n                if (!agent._approvalDenyHints.has(key)) {\n                    agent._approvalDenyHints.add(key);\n                    agent.history.push({ role: 'user', content: formatApprovalBlockedHint(approvalBlocked) });\n                }\n            }\n        }\n    }\n\n    return { handled: true };\n}\n\nmodule.exports = {\n    handleToolCalls,\n    isRealtimeQuery,\n    hasToolActivitySince,\n    hasEvidenceToolActivitySince,\n    getPendingPlanSteps,\n    maybeAutoMemoryLookup,\n    maybeAutoMemorySave,\n};\n", "const { isRealtimeQuery, hasEvidenceToolActivitySince, getPendingPlanSteps } = require('./agent-tool-flow');\nconst { hasCitationForKnowledge, buildCitationReminder } = require('./knowledge-evidence');\n\nfunction applyTurnGuards({\n    agent,\n    userInput,\n    turnStartIndex,\n    currentStepResponse,\n    realtimeGuardCount,\n    planGuardCount,\n}) {\n    const isRealtime = isRealtimeQuery(userInput);\n    const hasToolActivity = hasEvidenceToolActivitySince(agent.history, turnStartIndex);\n    const isEmptyAnswer = !currentStepResponse.content || !String(currentStepResponse.content).trim();\n\n    if (isRealtime && !hasToolActivity && realtimeGuardCount < 2) {\n        const nextCount = realtimeGuardCount + 1;\n        const reminder = (nextCount === 1)\n            ? 'Reminder: This request asks for real-time data. You MUST call the relevant tools before providing a final answer.'\n            : 'Final reminder: Call the relevant tools for real-time data before responding.';\n        agent.history.push({ role: 'user', content: reminder });\n        agent.emit('realtime_tool_guard', {\n            message: userInput,\n            attempt: nextCount,\n            emptyAnswer: isEmptyAnswer,\n        });\n        return { shouldContinue: true, realtimeGuardCount: nextCount, planGuardCount };\n    }\n\n    const selectedKnowledgeIds = (agent && agent._knowledgeSelectedIdSet instanceof Set)\n        ? Array.from(agent._knowledgeSelectedIdSet)\n        : [];\n    if (selectedKnowledgeIds.length > 0) {\n        const citationGuardCount = Number(agent && agent._citationGuardCount || 0);\n        const hasCitation = hasCitationForKnowledge({\n            text: currentStepResponse && currentStepResponse.content,\n            knowledgeIds: selectedKnowledgeIds,\n        });\n        if (!hasCitation && citationGuardCount < 2) {\n            const nextCount = citationGuardCount + 1;\n            if (agent) agent._citationGuardCount = nextCount;\n            agent.history.push({\n                role: 'user',\n                content: buildCitationReminder({ knowledgeIds: selectedKnowledgeIds }),\n            });\n            agent.emit('citation_guard', { attempt: nextCount, knowledgeIds: selectedKnowledgeIds });\n            return { shouldContinue: true, realtimeGuardCount, planGuardCount };\n        }\n    }\n\n    const pendingSteps = getPendingPlanSteps(agent.currentPlan);\n    // If the user denied a gated tool in this turn, don't nag the model to \"complete\" pending plan steps.\n    // Instead, let it revise the plan (e.g., mark blocked) and provide a partial answer.\n    if (pendingSteps.length > 0 && planGuardCount < 1 && !(agent && agent._approvalDeniedThisTurn)) {\n        const nextCount = planGuardCount + 1;\n        agent.history.push({\n            role: 'user',\n            content: `Reminder: You have pending plan steps. Complete them (use tools) before final answer. Pending: ${pendingSteps.join(' | ')}`,\n        });\n        agent.emit('plan_completion_guard', { attempt: nextCount, pendingCount: pendingSteps.length });\n        return { shouldContinue: true, realtimeGuardCount, planGuardCount: nextCount };\n    }\n\n    return { shouldContinue: false, realtimeGuardCount, planGuardCount };\n}\n\nmodule.exports = { applyTurnGuards };\n", "/**\n * Helpers for analyzing and classifying agent history messages.\n * Pure JS; Node + Browser compatible.\n */\n\nconst SUMMARY_PREFIX = 'Another language model started to solve this problem and produced a summary of its thinking process. You also have access to the state of the tools that were used by that language model. Use this to build on the work that has already been done and avoid duplicating work. Here is the summary produced by the other language model, use the information in this summary to assist with your own analysis:';\n\nfunction isStrongInstruction(msg) {\n    if (!msg || msg.role !== 'user') return false;\n    if (typeof msg.content !== 'string') return false;\n    const trimmed = msg.content.trimStart();\n    return trimmed.startsWith('# AGENTS.md instructions for ')\n        || trimmed.startsWith('<user_instructions>')\n        || trimmed.startsWith('<skill');\n}\n\nfunction isEnvironmentContext(msg) {\n    if (!msg || msg.role !== 'user' || typeof msg.content !== 'string') return false;\n    return msg.content.trimStart().toLowerCase().startsWith('<environment_context>');\n}\n\nfunction isTurnAborted(msg) {\n    if (!msg || msg.role !== 'user' || typeof msg.content !== 'string') return false;\n    return msg.content.trimStart().toLowerCase().startsWith('<turn_aborted>');\n}\n\nfunction isSummaryMessage(msg) {\n    if (!msg || msg.role !== 'user' || typeof msg.content !== 'string') return false;\n    return msg.content.startsWith(SUMMARY_PREFIX);\n}\n\nfunction isSessionPrefixMessage(msg) {\n    return isStrongInstruction(msg) || isEnvironmentContext(msg) || isSummaryMessage(msg);\n}\n\nfunction isInstructionLikeUserMessage(msg) {\n    if (!msg || msg.role !== 'user') return false;\n    if (typeof msg.content !== 'string') return false;\n    const trimmed = msg.content.trimStart();\n    const lowered = trimmed.toLowerCase();\n    return trimmed.startsWith('# AGENTS.md instructions for ')\n        || trimmed.startsWith('<user_instructions>')\n        || trimmed.startsWith('<skill')\n        || lowered.startsWith('<environment_context>')\n        || lowered.startsWith('<turn_aborted>');\n}\n\nmodule.exports = {\n    SUMMARY_PREFIX,\n    isStrongInstruction,\n    isEnvironmentContext,\n    isTurnAborted,\n    isSummaryMessage,\n    isSessionPrefixMessage,\n    isInstructionLikeUserMessage,\n};\n", "/**\n * General text processing and sanitization utilities.\n * Pure JS; Node + Browser compatible.\n */\n\n/**\n * Truncates text to a maximum number of characters.\n */\nfunction truncateText(text, maxChars) {\n    const s = typeof text === 'string' ? text : '';\n    if (!Number.isFinite(maxChars) || maxChars <= 0) return s;\n    if (s.length <= maxChars) return s;\n    return s.slice(0, maxChars) + '...';\n}\n\n/**\n * Filters out instructional/rule lines from LLM-generated summaries to prevent policy leakage.\n */\nfunction sanitizeSummaryText(text) {\n    if (typeof text !== 'string') return '';\n    const lines = text.split('\\n');\n    const filtered = lines.filter((line) => {\n        const trimmed = line.trim();\n        if (!trimmed) return false;\n        const lower = trimmed.toLowerCase();\n        if (lower.startsWith('rules:') || lower.startsWith('rule:')) return false;\n        if (lower.includes('forbidden')) return false;\n        if (lower.includes('do not')) return false;\n        if (lower.includes('must')) return false;\n        if (lower.includes('should')) return false;\n        if (lower.includes('not listing')) return false;\n        if (lower.includes('summary prompt')) return false;\n        return true;\n    });\n    return filtered.join('\\n').trim();\n}\n\nmodule.exports = {\n    truncateText,\n    sanitizeSummaryText,\n};\n", "const { estimateTextTokens } = require('./token-estimator');\nconst {\n    SUMMARY_PREFIX,\n    isStrongInstruction,\n    isEnvironmentContext,\n    isTurnAborted,\n} = require('./agent-history-helpers');\nconst { truncateText, sanitizeSummaryText } = require('./text-utils');\n\nconst SUMMARY_PROMPT = [\n    'You are performing a CONTEXT CHECKPOINT COMPACTION. Create a handoff summary for another LLM that will resume the task.',\n    '',\n    'Include:',\n    '- Current progress and key decisions made',\n    '- Important context, constraints, or user preferences',\n    '- What remains to be done (clear next steps)',\n    '- Any critical data, examples, or references needed to continue',\n    '',\n    'Rules:',\n    '- Do NOT include real-time or volatile values (prices, exchange rates, news details). Instead, say they were retrieved.',\n    '- Do NOT introduce unrelated topics from older tasks unless they are still active requirements.',\n    '- Keep the summary focused on the current user intent and active work.',\n    '- You are FORBIDDEN from listing specific numeric values, timestamps, or prices.',\n    '- Summarize only task state, constraints, and decisions; omit detailed observations.',\n    '',\n    'Be concise, structured, and focused on helping the next LLM seamlessly continue the work.'\n].join('\\n');\n\nfunction estimateMessageTokens(msg) {\n    if (!msg || typeof msg !== 'object') return 0;\n    let content = '';\n    if (typeof msg.content === 'string') {\n        content = msg.content;\n    } else if (msg.content != null) {\n        try {\n            content = JSON.stringify(msg.content);\n        } catch {\n            content = '[unserializable content]';\n        }\n    }\n    let toolCalls = '';\n    if (msg.tool_calls != null) {\n        try {\n            toolCalls = JSON.stringify(msg.tool_calls);\n        } catch {\n            toolCalls = '[unserializable tool_calls]';\n        }\n    }\n    const role = typeof msg.role === 'string' ? msg.role : '';\n    return estimateTextTokens(`${role}:${content}${toolCalls ? `\\n${toolCalls}` : ''}`);\n}\n\nfunction estimateHistoryTokens(history) {\n    if (!Array.isArray(history) || history.length === 0) return 0;\n    let total = 0;\n    for (const msg of history) {\n        total += estimateMessageTokens(msg);\n    }\n    return total;\n}\n\nfunction serializeMessage(msg, perMessageLimit) {\n    if (!msg || typeof msg !== 'object') return '';\n    const role = typeof msg.role === 'string' ? msg.role : 'unknown';\n    let content = '';\n    if (typeof msg.content === 'string') {\n        content = msg.content;\n    } else {\n        try {\n            content = JSON.stringify(msg.content);\n        } catch {\n            content = '[unserializable content]';\n        }\n    }\n    return `${role.toUpperCase()}: ${truncateText(content, perMessageLimit)}`;\n}\n\nfunction serializeHistory(messages, { maxChars = 20000, perMessageLimit = 2000 } = {}) {\n    const lines = [];\n    let used = 0;\n    for (const msg of messages) {\n        const line = serializeMessage(msg, perMessageLimit);\n        if (!line) continue;\n        const nextUsed = used + line.length + 1;\n        if (nextUsed > maxChars) break;\n        lines.push(line);\n        used = nextUsed;\n    }\n    return lines.join('\\n');\n}\n\nfunction collectFixedPrefixIndices(history, tailStart) {\n    const indices = new Set();\n    let lastEnv = -1;\n    let lastAbort = -1;\n\n    for (let i = 0; i < history.length; i++) {\n        const msg = history[i];\n        if (isEnvironmentContext(msg)) lastEnv = i;\n        if (isTurnAborted(msg)) lastAbort = i;\n        if (isStrongInstruction(msg)) indices.add(i);\n    }\n\n    if (lastEnv >= 0) indices.add(lastEnv);\n    if (lastAbort >= 0) indices.add(lastAbort);\n\n    // Filter out indices that are part of the protected tail (if any).\n    for (const idx of Array.from(indices)) {\n        if (idx >= tailStart) indices.delete(idx);\n    }\n    return indices;\n}\n\nasync function compactHistory({ history, llm, config, signal }) {\n    if (!Array.isArray(history) || history.length === 0) {\n        return { history: Array.isArray(history) ? history : [], compacted: false, originalLength: 0 };\n    }\n    const cfg = config || {};\n    if (cfg.enabled === false) return { history, compacted: false, originalLength: history.length };\n    const triggerMessages = Number.isFinite(cfg.triggerMessages) ? cfg.triggerMessages : 120;\n    const triggerTokens = Number.isFinite(cfg.triggerTokens) ? cfg.triggerTokens : null;\n    const estimatedTokens = (triggerTokens && triggerTokens > 0)\n        ? estimateHistoryTokens(history)\n        : null;\n    const overTokenTrigger = (estimatedTokens != null) ? estimatedTokens > triggerTokens : false;\n    const overMessageTrigger = history.length > triggerMessages;\n\n    if (!overMessageTrigger && !overTokenTrigger) {\n        return { history, compacted: false, originalLength: history.length };\n    }\n\n    const keepRecent = Number.isFinite(cfg.keepRecentMessages) ? cfg.keepRecentMessages : 10;\n    const tailStartIndex = Math.max(0, history.length - keepRecent);\n\n    const fixedPrefixIndices = collectFixedPrefixIndices(history, tailStartIndex);\n    const fixedPrefix = Array.from(fixedPrefixIndices).sort((a, b) => a - b).map(idx => history[idx]);\n\n    const compactCandidates = history.filter((_, idx) => !fixedPrefixIndices.has(idx) && idx < tailStartIndex);\n    if (compactCandidates.length === 0) {\n        return { history, compacted: false, originalLength: history.length };\n    }\n\n    const summaryInput = serializeHistory(compactCandidates, {\n        maxChars: Number.isFinite(cfg.maxSummaryChars) ? cfg.maxSummaryChars : 20000,\n        perMessageLimit: Number.isFinite(cfg.maxMessageChars) ? cfg.maxMessageChars : 2000,\n    });\n\n    if (!summaryInput || !llm || typeof llm.chat !== 'function') {\n        return { history, compacted: false, originalLength: history.length };\n    }\n\n    const summaryResponse = await llm.chat(SUMMARY_PROMPT, [{ role: 'user', content: summaryInput }], { signal });\n    const rawSummaryText = summaryResponse && typeof summaryResponse.content === 'string' ? summaryResponse.content.trim() : '';\n    const summaryText = sanitizeSummaryText(rawSummaryText);\n\n    if (!summaryText) return { history, compacted: false, originalLength: history.length };\n\n    const summaryMessage = { role: 'user', content: `${SUMMARY_PREFIX}\\n${summaryText}` };\n    const tailMessages = history.slice(tailStartIndex);\n\n    return {\n        history: [...fixedPrefix, summaryMessage, ...tailMessages],\n        compacted: true,\n        summary: summaryText,\n        originalLength: history.length,\n    };\n}\n\nasync function maybeCompactAgentHistory(agent, options = {}) {\n    if (!agent || !agent.compaction || agent.compaction.enabled === false) return null;\n\n    const signal = options && options.signal ? options.signal : null;\n\n    const result = await compactHistory({\n        history: agent.history,\n        llm: agent.llm,\n        config: agent.compaction,\n        signal,\n    });\n\n    if (result && result.compacted) {\n        agent.history = result.history;\n        const summaryLength = result.summary ? result.summary.length : 0;\n        console.log(`[Agent] History compacted: ${result.originalLength} -> ${agent.history.length} (summary ${summaryLength} chars)`);\n        if (typeof agent.emit === 'function') {\n            agent.emit('context_compacted', {\n                originalLength: result.originalLength,\n                newLength: agent.history.length,\n                summary: result.summary || null,\n                summaryLength,\n            });\n        }\n    }\n\n    return result || null;\n}\n\nmodule.exports = {\n    compactHistory,\n    maybeCompactAgentHistory,\n    SUMMARY_PROMPT,\n    SUMMARY_PREFIX,\n};\n", "const { getTotalUsageFromHistory } = require('./agent-usage');\nconst { riskLabel } = require('./imda-policy');\nconst { getToolRegistrySnapshot } = require('./agent-tools-registry');\n\nconst DEFAULT_MAX_EVENTS = 1000;\nconst SENSITIVE_KEYS = [\n    'api_key',\n    'apikey',\n    'secret',\n    'password',\n    'credential',\n    'authorization',\n    'bearer',\n];\n\nfunction isSensitiveKey(key) {\n    if (!key) return false;\n    const lowered = String(key).toLowerCase();\n    if (SENSITIVE_KEYS.includes(lowered)) return true;\n    return lowered.endsWith('token');\n}\n\nfunction redactValue(value, seen) {\n    if (value === null || value === undefined) return value;\n    if (typeof value === 'string') return value;\n    if (typeof value !== 'object') return value;\n    if (seen.has(value)) return '[Circular]';\n    seen.add(value);\n\n    if (Array.isArray(value)) {\n        return value.map((item) => redactValue(item, seen));\n    }\n\n    const out = {};\n    for (const [key, val] of Object.entries(value)) {\n        if (isSensitiveKey(key)) {\n            out[key] = '[REDACTED]';\n            continue;\n        }\n        out[key] = redactValue(val, seen);\n    }\n    return out;\n}\n\nfunction normalizePayload(payload) {\n    if (payload === undefined) return null;\n    if (payload === null) return null;\n    if (typeof payload === 'string' || typeof payload === 'number' || typeof payload === 'boolean') return payload;\n    const seen = new Set();\n    return redactValue(payload, seen);\n}\n\nfunction detectPlatform() {\n    if (typeof window !== 'undefined' && typeof window.document !== 'undefined') return 'browser';\n    return 'node';\n}\n\nfunction createTraceCollector(agent, options = {}) {\n    const maxEvents = (options && Number.isFinite(options.maxEvents) && options.maxEvents > 0)\n        ? Math.floor(options.maxEvents)\n        : DEFAULT_MAX_EVENTS;\n    const sessionId = `session_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n    const events = [];\n    const handlers = new Map();\n\n    const push = (type, payload) => {\n        events.push({\n            timestamp: new Date().toISOString(),\n            type,\n            payload,\n        });\n        if (events.length > maxEvents) events.splice(0, events.length - maxEvents);\n    };\n\n    const on = (event, type, mapper) => {\n        const handler = (payload) => {\n            const mapped = mapper ? mapper(payload) : payload;\n            push(type, mapped);\n        };\n        handlers.set(event, handler);\n        if (agent && typeof agent.on === 'function') agent.on(event, handler);\n    };\n\n    on('turn_started', 'turn.started', (payload) => ({\n        message: payload && payload.message ? String(payload.message) : '',\n        timestamp: payload && payload.timestamp ? payload.timestamp : undefined,\n    }));\n    on('decision_trace', 'decision.trace');\n    on('approval_required', 'approval.required');\n    on('approval_skipped', 'approval.skipped');\n    on('user_input_requested', 'user_input.requested');\n    on('user_input_response', 'user_input.response');\n    on('tool_call', 'tool.call.requested');\n    on('tool_call_begin', 'tool.call.begin');\n    on('tool_call_end', 'tool.call.end');\n    on('tool_result', 'tool.result');\n    on('knowledge_selected', 'knowledge.selected');\n    on('tool_error', 'tool.error');\n    on('plan_updated', 'plan.updated');\n    on('context_compacted', 'context.compacted');\n    on('state_changed', 'state.changed');\n    on('turn_aborted', 'turn.aborted');\n    on('agent_turn_complete', 'turn.completed');\n\n    const exportSessionTrace = (exportOptions = {}) => {\n        const platform = detectPlatform();\n        const identity = agent && agent.identity ? agent.identity : null;\n        const riskProfile = agent && agent.riskProfile ? agent.riskProfile : null;\n        const modelName = agent && agent.llm && agent.llm.modelName ? agent.llm.modelName : null;\n        const usage = getTotalUsageFromHistory(agent && agent.history ? agent.history : []);\n\n        const turnCount = events.filter((ev) => ev.type === 'turn.started').length;\n        const toolsUsed = Array.from(new Set(\n            events\n                .filter((ev) => ev.type === 'tool.call.begin' || ev.type === 'tool.result')\n                .map((ev) => ev && ev.payload && ev.payload.name ? ev.payload.name : (ev.payload && ev.payload.tool ? ev.payload.tool : null))\n                .filter(Boolean)\n        ));\n        let maxRisk = null;\n        for (const ev of events) {\n            if (ev.type !== 'approval.required' && ev.type !== 'approval.skipped') continue;\n            const risk = ev && ev.payload && typeof ev.payload.risk === 'number' ? ev.payload.risk : null;\n            if (risk === null) continue;\n            if (maxRisk === null || risk > maxRisk) maxRisk = risk;\n        }\n\n        const summary = {\n            totalTurns: turnCount,\n            totalTokens: usage && typeof usage.total_tokens === 'number' ? usage.total_tokens : null,\n            maxRiskLevel: maxRisk === null ? null : riskLabel(maxRisk),\n            toolsUsed,\n        };\n        const toolRegistrySnapshot = getToolRegistrySnapshot(agent, toolsUsed);\n\n        const normalizedEvents = events.map((ev, idx) => {\n            const base = {\n                idx,\n                timestamp: ev.timestamp,\n                type: ev.type,\n                payload: normalizePayload(ev.payload),\n            };\n            return base;\n        });\n\n        return {\n            version: '1.0-opencode',\n            metadata: {\n                sessionId,\n                exportedAt: new Date().toISOString(),\n                platform,\n                agent: {\n                    model: modelName,\n                    tier: riskProfile && typeof riskProfile.tier === 'number' ? riskProfile.tier : null,\n                    identity,\n                },\n            },\n            summary,\n            snapshot: agent && typeof agent.dumpSnapshot === 'function' ? agent.dumpSnapshot() : null,\n            toolRegistrySnapshot,\n            events: normalizedEvents,\n        };\n    };\n\n    const dispose = () => {\n        for (const [event, handler] of handlers.entries()) {\n            if (agent && typeof agent.off === 'function') agent.off(event, handler);\n            else if (agent && typeof agent.removeListener === 'function') agent.removeListener(event, handler);\n        }\n        handlers.clear();\n    };\n\n    return { sessionId, events, exportSessionTrace, dispose };\n}\n\nmodule.exports = { createTraceCollector };\n", "const { EventEmitter } = require('events');\nconst { runAsyncIterator: runAgentAsyncIterator } = require('./utils/agent-async-iterator');\nconst { executeTools } = require('./utils/agent-tool-runner');\nconst { dumpSnapshot, loadSnapshot, setState, getState } = require('./utils/agent-state');\nconst { initializeAgentState } = require('./utils/agent-setup');\nconst { startAgentTurn, finalizeAgentTurn } = require('./utils/agent-lifecycle');\nconst {\n    awaitUserInput,\n    respondToUserInput,\n    submitPendingInput,\n    drainPendingInputs,\n} = require('./utils/agent-interaction');\nconst {\n    applyUsageToEntry,\n    buildTokenUsageInfo,\n} = require('./utils/agent-usage');\nconst { sanitizeFinalResponse } = require('./utils/agent-completion');\nconst { runLlmStep } = require('./utils/agent-llm');\nconst { handleToolCalls, maybeAutoMemoryLookup, maybeAutoMemorySave } = require('./utils/agent-tool-flow');\nconst { applyTurnGuards } = require('./utils/agent-guards');\nconst { maybeCompactAgentHistory } = require('./utils/history-compactor');\nconst { createTraceCollector } = require('./utils/agent-trace');\n\nclass Agent extends EventEmitter {\n    constructor({\n        llm,\n        tools = [],\n        systemPrompt = \"You are a helpful AI assistant.\",\n        toolTimeoutMs,\n        approvalTimeoutMs,\n        approvalPolicy,\n        trustedTools,\n        toolOutputLimits,\n        snapshot,\n        maxTurns,\n        compaction,\n        maxProtectedRecentMessages,\n        identity,\n        riskProfile,\n        ragConfig,\n        ragService,\n        skillsDir,\n    } = {}) {\n        super();\n        initializeAgentState(this, {\n            llm,\n            tools,\n            systemPrompt,\n            toolTimeoutMs,\n            approvalTimeoutMs,\n            approvalPolicy,\n            trustedTools,\n            toolOutputLimits,\n            maxTurns,\n            compaction,\n            maxProtectedRecentMessages,\n            identity,\n            riskProfile,\n            ragConfig,\n            ragService,\n            skillsDir,\n        });\n\n        if (snapshot) {\n            this.loadSnapshot(snapshot, { emitPlanEvent: false });\n        }\n\n        this._traceCollector = createTraceCollector(this);\n    }\n\n    dumpSnapshot() {\n        return dumpSnapshot(this);\n    }\n\n    loadSnapshot(snapshot, { emitPlanEvent = true } = {}) {\n        return loadSnapshot(this, snapshot, { emitPlanEvent });\n    }\n\n    _setState(status, metadata = {}) {\n        return setState(this, status, metadata);\n    }\n\n    getState() {\n        return getState(this);\n    }\n\n    getIdentity() {\n        return this.identity;\n    }\n\n    getRiskProfile() {\n        return this.riskProfile;\n    }\n\n    _awaitUserInput(callId, timeoutMs) {\n        return awaitUserInput(this, callId, timeoutMs);\n    }\n\n    respondToUserInput(callId, response) {\n        return respondToUserInput(this, callId, response);\n    }\n\n    submitInput(text) {\n        return submitPendingInput(this, text);\n    }\n\n    async run(userInput) {\n        const controller = (typeof AbortController !== 'undefined') ? new AbortController() : null;\n        if (this._abortController && this._abortController !== controller && !this._abortController.signal?.aborted) {\n            this._abortController.abort();\n        }\n        this._abortController = controller;\n        this._abortReason = null;\n        const signal = controller ? controller.signal : null;\n\n        const { dbg, turnStartIndex } = startAgentTurn(this, userInput);\n\n        const compactResult = await this._maybeCompactHistory({ signal });\n        if (compactResult && this.debug) dbg('Compaction result', { compacted: Boolean(compactResult.compacted), originalLength: compactResult.originalLength, newLength: Array.isArray(this.history) ? this.history.length : 0 });\n        let finalResponseText = \"\";\n        let turnCount = 0;\n        const MAX_TURNS = this.maxTurns;\n        let realtimeGuardCount = 0;\n        let planGuardCount = 0;\n        let memoryPrecheckDone = false;\n        let memoryAutoSaveDone = false;\n\n        try {\n            while (turnCount < MAX_TURNS) {\n                if (signal && signal.aborted) {\n                    const err = signal.reason instanceof Error ? signal.reason : new Error('Aborted');\n                    err.name = 'AbortError';\n                    throw err;\n                }\n                turnCount++;\n                console.log(`[Agent] Step ${turnCount}: Thinking...`);\n\n                this._setState('thinking', { step: turnCount, maxTurns: MAX_TURNS });\n\n                this.emit('thinking', { step: turnCount });\n\n                const pending = drainPendingInputs(this);\n                if (pending.length > 0) {\n                    for (const text of pending) {\n                        this.history.push({ role: 'user', content: text });\n                    }\n                    this.emit('pending_input_applied', { count: pending.length });\n                }\n\n                const autoMemoryPrecheck = Boolean(this.ragConfig && this.ragConfig.autoMemoryPrecheck === true);\n                if (autoMemoryPrecheck && !memoryPrecheckDone) {\n                    const didLookup = await maybeAutoMemoryLookup({ agent: this, userInput });\n                    memoryPrecheckDone = didLookup || memoryPrecheckDone;\n                }\n                if (signal && signal.aborted) {\n                    const err = signal.reason instanceof Error ? signal.reason : new Error('Aborted');\n                    err.name = 'AbortError';\n                    throw err;\n                }\n\n                let currentStepResponse = { content: \"\", tool_calls: [] };\n\n                const protectRecentMessages = Math.min(\n                    this.maxProtectedRecentMessages,\n                    Math.max(0, this.history.length - turnStartIndex)\n                );\n                const pruned = this.contextManager.process(this.history, { protectRecentMessages });\n                const llmHistory = pruned.history;\n                if (pruned.meta && pruned.meta.dropped > 0) {\n                    this.emit('context_truncated', {\n                        dropped: pruned.meta.dropped,\n                        estimatedTokens: pruned.meta.estimatedTokens,\n                        fullHistoryLength: this.history.length,\n                        sentHistoryLength: llmHistory.length,\n                    });\n                }\n\n                currentStepResponse = await runLlmStep({\n                    agent: this,\n                    llm: this.llm,\n                    systemPrompt: this.systemPrompt,\n                    llmHistory,\n                    turnCount,\n                    signal,\n                });\n                dbg(`Step ${turnCount} LLM response`, { contentLength: currentStepResponse && currentStepResponse.content ? String(currentStepResponse.content).length : 0, toolCalls: Array.isArray(currentStepResponse.tool_calls) ? currentStepResponse.tool_calls.length : 0 });\n\n                const toolFlow = await handleToolCalls({ agent: this, currentStepResponse, turnCount });\n                dbg(`Step ${turnCount} tool flow`, { handled: toolFlow.handled, stopTurn: Boolean(toolFlow && toolFlow.stopTurn) });\n                if (!toolFlow.handled) {\n                    const guard = applyTurnGuards({\n                        agent: this,\n                        userInput,\n                        turnStartIndex,\n                        currentStepResponse,\n                        realtimeGuardCount,\n                        planGuardCount,\n                    });\n                    if (guard.shouldContinue) {\n                        dbg(`Step ${turnCount} guard triggered`, {\n                            realtimeGuardCount: guard.realtimeGuardCount,\n                            planGuardCount: guard.planGuardCount,\n                        });\n                    }\n                    realtimeGuardCount = guard.realtimeGuardCount;\n                    planGuardCount = guard.planGuardCount;\n                    if (guard.shouldContinue) continue;\n\n                    console.log(`[Agent] Final Answer Generated.`);\n                    const cleaned = sanitizeFinalResponse(currentStepResponse.content || '');\n                    const assistantEntry = { role: 'assistant', content: cleaned };\n                    const applied = applyUsageToEntry(assistantEntry, currentStepResponse._usage);\n                    this.history.push(assistantEntry);\n                    if (applied) {\n                        this.emit('token_count', buildTokenUsageInfo(this.history));\n                    }\n                    finalResponseText = cleaned;\n\n                    if (!memoryAutoSaveDone) {\n                        try {\n                            memoryAutoSaveDone = await maybeAutoMemorySave({\n                                agent: this,\n                                userInput,\n                            });\n                        } catch {\n                            // Autosave is best-effort only.\n                        }\n                    }\n\n                    this.emit('response', { content: finalResponseText });\n                    break;\n                }\n\n                if (toolFlow && toolFlow.stopTurn) {\n                    console.log(`[Agent] Turn stopped: ${toolFlow.stopReason || 'approval_blocked'}`);\n                    const content = sanitizeFinalResponse(toolFlow.message || 'Approval was not granted.');\n                    const assistantEntry = { role: 'assistant', content };\n                    this.history.push(assistantEntry);\n                    finalResponseText = content;\n                    this.emit('response', { content: finalResponseText });\n                    break;\n                }\n            }\n        } catch (error) {\n            if (error && error.name === 'AbortError') {\n                const reason = this._abortReason || (error && error.message ? String(error.message) : 'aborted');\n                this.history.push({ role: 'user', content: `<turn_aborted> ${reason}`.trim() });\n                finalResponseText = 'Aborted.';\n            } else {\n                const message = error && error.message ? String(error.message) : String(error);\n                this._setState('error', { message });\n                this.emit('autosave', this.dumpSnapshot());\n                throw error;\n            }\n        }\n\n        try {\n            return finalizeAgentTurn({\n                agent: this,\n                finalResponseText,\n                turnCount,\n                maxTurns: MAX_TURNS,\n                dbg,\n            });\n        } finally {\n            this._abortController = null;\n            this._abortReason = null;\n        }\n    }\n\n    async _executeTools(toolCalls) {\n        const signal = this._abortController ? this._abortController.signal : null;\n        return executeTools(this, toolCalls, { signal });\n    }\n\n    async _maybeCompactHistory(options = {}) {\n        return await maybeCompactAgentHistory(this, options);\n    }\n\n    exportSessionTrace(options = {}) {\n        if (!this._traceCollector || typeof this._traceCollector.exportSessionTrace !== 'function') return null;\n        return this._traceCollector.exportSessionTrace(options);\n    }\n\n    /**\n     * Streaming interface for UI consumption.\n     */\n    async *runAsyncIterator(userInput, options = {}) {\n        const signal = (options && options.signal)\n            ? options.signal\n            : (this._abortController ? this._abortController.signal : undefined);\n        if (signal && typeof signal.addEventListener === 'function') {\n            if (signal.aborted) this.stop('external_abort');\n            else signal.addEventListener('abort', () => this.stop('external_abort'), { once: true });\n        }\n        yield* runAgentAsyncIterator(this, userInput, { ...options, signal });\n    }\n\n    stop(reason = 'user_stop') {\n        this._abortReason = reason;\n        if (this._abortController && this._abortController.signal && !this._abortController.signal.aborted) {\n            const abortError = new Error('Aborted');\n            abortError.name = 'AbortError';\n            abortError.reason = reason;\n            this._abortController.abort(abortError);\n            this.emit('turn_aborted', { reason, timestamp: new Date().toISOString() });\n        }\n    }\n}\n\nmodule.exports = { Agent };\n"],
  "mappings": "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",
  "names": ["out", "preview", "decision", "raw", "output", "mcpResult", "resultMessage", "endTime", "output", "guardedOutput", "mcpResult", "removed", "require_config", "toolCalls", "EventEmitter"]
}
