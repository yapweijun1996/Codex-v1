var TP=Object.create;var sf=Object.defineProperty;var EP=Object.getOwnPropertyDescriptor;var wP=Object.getOwnPropertyNames;var vP=Object.getPrototypeOf,AP=Object.prototype.hasOwnProperty;var qe=(t,e)=>()=>(t&&(e=t(t=0)),e);var k=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Vy=(t,e)=>{for(var n in e)sf(t,n,{get:e[n],enumerable:!0})},CP=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of wP(e))!AP.call(t,o)&&o!==n&&sf(t,o,{get:()=>e[o],enumerable:!(r=EP(e,o))||r.enumerable});return t};var dn=(t,e,n)=>(n=t!=null?TP(vP(t)):{},CP(e||!t||!t.__esModule?sf(n,"default",{value:t,enumerable:!0}):n,t));var Jy=k((X4,Wy)=>{function bP(){let t=[],e=[],n=!1,r=()=>{for(;e.length>0;){let o=e.shift();typeof o=="function"&&o()}};return{push:o=>{n||(t.push(o),r())},close:()=>{n||(n=!0,r())},async*iterate(){for(;;){if(t.length>0){yield t.shift();continue}if(n)return;await new Promise(o=>e.push(o))}}}}Wy.exports={createAsyncEventQueue:bP}});var Ky=k((Q4,zy)=>{var{createAsyncEventQueue:RP}=Jy();function IP(t,e,n={}){let{signal:r}=n,o=RP(),i=(h,y)=>t.on(h,y),s=(h,y)=>{typeof t.off=="function"?t.off(h,y):t.removeListener(h,y)},a={start:h=>o.push({type:"turn.started",input:h&&h.message?h.message:e}),thinking:h=>o.push({type:"thinking",step:h&&h.step}),state_changed:h=>o.push({type:"state.changed",...h}),context_truncated:h=>o.push({type:"context.truncated",...h}),assistant_message_started:h=>o.push({type:"assistant_message_started",...h}),agent_message_content_delta:h=>o.push({type:"response.chunk",delta:h&&h.delta?h.delta:"",step:h&&h.step}),tool_call:h=>o.push({type:"tool.call",tools:h&&h.tools?h.tools:[],details:h&&h.details?h.details:[]}),tool_call_begin:h=>o.push({type:"tool.call.begin",...h}),tool_call_end:h=>o.push({type:"tool.call.end",...h}),tool_result:h=>o.push({type:"tool.result",tool:h&&h.tool,args:h&&h.args,result:h&&h.result}),knowledge_selected:h=>o.push({type:"knowledge.selected",...h}),tool_error:h=>o.push({type:"tool.error",tool:h&&h.tool,error:h&&h.error}),plan_updated:h=>o.push({type:"plan.updated",...h}),approval_required:h=>o.push({type:"approval.required",...h}),approval_skipped:h=>o.push({type:"approval.skipped",...h}),user_input_requested:h=>o.push({type:"user_input.requested",...h}),user_input_response:h=>o.push({type:"user_input.response",...h}),approval_blocked:h=>o.push({type:"approval.blocked",...h}),decision_trace:h=>o.push({type:"decision_trace",...h}),token_count:h=>o.push({type:"token_count",info:h&&h.info?h.info:null}),exec_command_begin:h=>o.push({type:"exec_command.begin",...h}),exec_command_output:h=>o.push({type:"exec_command.output",...h}),exec_command_end:h=>o.push({type:"exec_command.end",...h}),done:h=>{o.push({type:"turn.completed",finalResponse:h&&typeof h.response=="string"?h.response:"",turnCount:h&&h.turnCount,historyLength:h&&h.historyLength}),o.close()}};for(let[h,y]of Object.entries(a))i(h,y);let l=!1,c=()=>{l=!0,o.push({type:"error",message:"Aborted"}),o.close()};r&&typeof r.addEventListener=="function"&&(r.aborted?c():r.addEventListener("abort",c,{once:!0}));let f=Promise.resolve().then(()=>t.run(e)).catch(h=>{let y=h&&h.message?String(h.message):String(h);return o.push({type:"error",message:y}),o.close(),null});return(async function*(){try{for await(let y of o.iterate())yield y}finally{for(let[y,_]of Object.entries(a))s(y,_);if(r&&typeof r.removeEventListener=="function"&&r.removeEventListener("abort",c),await f,l)return}})()}zy.exports={runAsyncIterator:IP}});var Nt=k((Z4,jy)=>{function xP(t){if(!t||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}function af(t){let e=new WeakSet;function n(r){if(r===null)return null;let o=typeof r;if(o==="string"||o==="number"||o==="boolean")return r;if(o==="bigint")return String(r);if(o==="undefined")return null;if(o==="function")return"[Function]";if(o==="symbol")return String(r);if(o==="object"){if(e.has(r))return"[Circular]";if(e.add(r),Array.isArray(r))return r.map(n);if(r instanceof Date)return r.toISOString();if(r instanceof Error)return{name:r.name,message:r.message};if(!xP(r)){let s={};for(let a of Object.keys(r).sort())s[a]=n(r[a]);return s}let i={};for(let s of Object.keys(r).sort())i[s]=n(r[s]);return i}return String(r)}try{return JSON.stringify(n(t))}catch{return"null"}}function PP(t){try{return JSON.stringify(t===void 0?null:t)}catch{return af(t)}}function kP(t){let e=String(t||"").toLowerCase();return e?e.includes("too many requests")||e.includes("rate limit")||e.includes("ratelimit")||e.includes("status: 429")||e.includes("http 429")||e.includes(" 429"):!1}function Yy(t){let e=String(t||""),n=5381;for(let r=0;r<e.length;r++)n=(n<<5)+n^e.charCodeAt(r);return(n>>>0).toString(36)}function NP(t,e,n){let r=af(n);return`${t}:${String(e||"unknown")}:${Yy(r)}`}jy.exports={DEFAULT_TOOL_TIMEOUT_MS:3e4,DEFAULT_APPROVAL_TIMEOUT_MS:3e5,DEFAULT_REPEAT_FAILURE_THRESHOLD:2,DEFAULT_LOOP_FINGERPRINT_THRESHOLD:3,stableStringify:af,safeJsonStringify:PP,isRateLimitLike:kP,hashString:Yy,makeFailureFingerprint:NP}});var ba=k((ej,Qy)=>{var{stableStringify:MP}=Nt();function OP(t){let e=String(t||""),n=2166136261;for(let r=0;r<e.length;r+=1)n^=e.charCodeAt(r),n=Math.imul(n,16777619);return(n>>>0).toString(16)}function Xy(t){try{return OP(MP(t))}catch{return"0"}}function DP(t,e){return`${String(t||"")}:${Xy(e)}`}Qy.exports={makeApprovalArgsHash:Xy,makeApprovalDenyKey:DP}});var yt=k((tj,Zy)=>{var lf=Object.freeze({NONE:0,LOW:1,MEDIUM:2,HIGH:3}),FP=new Set(Object.values(lf));function LP(t,e=lf.NONE){return FP.has(t)?t:e}Zy.exports={RiskLevel:lf,normalizeRiskLevel:LP}});var kr=k((nj,r_)=>{var{RiskLevel:t_,normalizeRiskLevel:UP}=yt(),qP=["tool_call_id","args_hash","duration_ms"];function Ra(t,e){let n=String(t??""),r=Number(e);return!Number.isFinite(r)||r<=0||n.length<=r?n:`${n.slice(0,Math.max(0,r-3))}...`}function Pi(t){return t&&typeof t=="object"&&!Array.isArray(t)?t:null}function e_(t,e){let n=Pi(t)||Pi(e);if(!n)return null;let r={...n};return!r.type&&r.properties&&typeof r.properties=="object"&&(r.type="object"),r}function BP(t){let e=Pi(t);if(!e)return null;let n=Number(e.maxCalls),r=Number(e.perSeconds);return!Number.isFinite(n)||!Number.isFinite(r)||n<=0||r<=0?null:{maxCalls:Math.floor(n),perSeconds:Math.floor(r)}}function GP(t){let e=Pi(t&&t.meta)||{},n=e_(e.inputSchema,t.parameters),r=e_(e.outputSchema,t.outputSchema),o=Array.isArray(e.permissions)?e.permissions.filter(Boolean).map(m=>String(m)):[],i=BP(e.rateLimit),s=Pi(e.audit)||{},a=Array.isArray(s.fields)?s.fields.filter(Boolean).map(m=>String(m)):qP.slice(),l=Array.isArray(e.failureModes)?e.failureModes:[],c=e.fallback!=null?e.fallback:null,f=typeof e.intentTemplate=="string"?e.intentTemplate:"";return{inputSchema:n,outputSchema:r,permissions:o,rateLimit:i,audit:{fields:a},failureModes:l,fallback:c,intentTemplate:f}}function HP(t){return t==null?"":typeof t=="string"?t:typeof t=="number"||typeof t=="boolean"?String(t):""}function $P(t,e){let n=String(t||"");if(!n)return"";let r=e&&typeof e=="object"?e:null;return n.replace(/\{([a-zA-Z0-9_]+)\}/g,(o,i)=>{if(!r)return"";if(i.endsWith("_len")||i.endsWith("_length")){let s=i.replace(/_(len|length)$/,""),a=r[s];return typeof a=="string"||Array.isArray(a)?String(a.length):""}return Ra(HP(r[i]),120)}).trim()}function n_(t){let e={},n={};for(let r of t){if(!r||!r.name)continue;let o=UP(r.risk,t_.MEDIUM);r.risk=o;let i=GP(r);r.meta=i,e[r.name]=r,n[r.name]={name:r.name,description:typeof r.description=="string"?r.description:"",risk:o,permissions:i.permissions,inputSchema:i.inputSchema,outputSchema:i.outputSchema,rateLimit:i.rateLimit,audit:i.audit,failureModes:i.failureModes,fallback:i.fallback,intentTemplate:i.intentTemplate}}return{toolMap:e,registry:n}}function VP(t){return n_(t)}function uf(t,e){return!t||!t.toolRegistry||!e?null:t.toolRegistry[e]||null}function WP(t,e,n){let r=uf(t,e);return r&&typeof r.risk=="number"?r.risk:n&&typeof n.risk=="number"?n.risk:t_.MEDIUM}function JP(t,e){if(!t||!t.toolRegistry||!Array.isArray(e))return null;let n={};for(let r of e){let o=t.toolRegistry[r];o&&(n[r]=o)}return Object.keys(n).length>0?n:null}function zP(t,e,n){let r=uf(t,e);if(!r)return"";if(e==="request_user_input"&&n&&typeof n=="object"){let i=typeof n.question=="string"?n.question.trim():"";if(i)return`request user input: "${Ra(i,100)}"`;let s=Array.isArray(n.questions)?n.questions:null;if(s&&s.length>0){let a=s[0]&&typeof s[0]=="object"?s[0]:null,l=a&&typeof a.question=="string"?a.question.trim():"";return l?`request user input (${s.length} questions): "${Ra(l,80)}"`:`request user input (${s.length} questions)`}return"request user input"}let o=$P(r.intentTemplate,n);return o||(r.description?Ra(r.description,140):"")}r_.exports={buildToolRegistry:n_,registerTools:VP,getToolMeta:uf,getToolRisk:WP,getToolRegistrySnapshot:JP,getToolIntent:zP}});var Ia=k((rj,i_)=>{var{RiskLevel:or}=yt(),cf=new Set(["request_user_input","update_plan","list_available_skills","read_skill_documentation"]);function KP(t){switch(t){case or.HIGH:return"Tier 3 (High Risk)";case or.MEDIUM:return"Tier 2 (Business Critical)";case or.LOW:return"Tier 1 (Reversible)";case or.NONE:default:return"Tier 0 (Read-only)"}}function YP(t){if(typeof t!="string")return"always";let e=t.trim().toLowerCase();return e==="unless_trusted"?"unless_trusted":e==="never"?"never":"always"}function jP(t){if(!Array.isArray(t))return[];let e=t.map(n=>String(n||"").trim()).filter(Boolean);return Array.from(new Set(e))}function XP(t,e){if(!t)return!1;let n=jP(e);return n.length===0?!1:n.includes(String(t))}function ff({toolName:t,toolRisk:e,agentTier:n}){return t&&cf.has(String(t))?!1:e>=or.MEDIUM?!0:e===or.LOW?n===or.NONE:!1}function QP({toolName:t,toolRisk:e,agentTier:n,approvalPolicy:r,trustedTools:o}){let i=YP(r);if(!ff({toolName:t,toolRisk:e,agentTier:n}))return{requires:!1,baselineRequires:!1,bypassed:!1,reason:"not_required"};if(t&&cf.has(String(t)))return{requires:!1,baselineRequires:!0,bypassed:!0,reason:"exempt"};if(i==="never")return{requires:!1,baselineRequires:!0,bypassed:!0,reason:"policy_never"};if(i==="unless_trusted"){if(e>=or.HIGH)return{requires:!0,baselineRequires:!0,bypassed:!1,reason:"high_risk"};if(XP(t,o))return{requires:!1,baselineRequires:!0,bypassed:!0,reason:"trusted"}}return{requires:!0,baselineRequires:!0,bypassed:!1,reason:"baseline"}}function ZP({toolName:t,toolRisk:e,agentTier:n}){return ff({toolName:t,toolRisk:e,agentTier:n})}function o_(t){if(t==null)return!1;if(typeof t=="string"){let e=t.trim().toLowerCase();return["approve","allow","yes","y"].includes(e)}return typeof t=="object"&&Array.isArray(t.answers)&&t.answers.length>0?o_(t.answers[0]):!1}i_.exports={riskLabel:KP,requiresApproval:ZP,isApprovedResponse:o_,APPROVAL_EXEMPT_TOOLS:cf,baselineRequiresApproval:ff,getApprovalDecision:QP}});var df=k((oj,a_)=>{var{RiskLevel:ek}=yt();function s_(t){let e=String(t||"").trim();return e?e==="run_command"?"run a command on your computer":e==="apply_patch"?"modify local files in your workspace":e==="read_file"?"read a local file from your workspace":e==="list_dir"?"list files in your workspace":e==="grep_files"?"search text in your workspace files":e==="view_image"?"open a local image from your workspace":e==="read_url"?"fetch and read a URL":e==="memory_search"||e==="kb_search"||e==="memory_read_graph"?"read local memory/knowledge":e==="memory_save"?"save information into local episodic memory":e.startsWith("memory__")?"read saved memory":e.includes("__")?"call an external MCP tool":`use "${e}"`:"use a tool"}function tk({toolName:t,toolRisk:e,isDebug:n}){if(n)return`Approve tool call: ${t}?`;let r=s_(t);return typeof e=="number"&&e>=ek.HIGH?`High-risk action: allow the agent to ${r}?`:`Allow the agent to ${r}?`}a_.exports={describeToolAction:s_,buildApprovalQuestion:tk}});var f_=k((ij,c_)=>{var{stableStringify:nk}=Nt(),{RiskLevel:ki}=yt(),{getToolRisk:l_,getToolIntent:rk}=kr(),{getApprovalDecision:u_,riskLabel:ok,isApprovedResponse:ik}=Ia(),{buildApprovalQuestion:sk}=df(),{makeApprovalDenyKey:ak}=ba();function lk(t){try{return typeof t.arguments=="string"?JSON.parse(t.arguments):t.arguments}catch{return}}function uk(t,{maxLen:e=80}={}){if(t==null)return"";let n="";try{n=nk(t)}catch{n=""}return n=String(n||"").trim(),!n||n==="null"||n==="{}"||n==="[]"?"":n.length<=e?n:`${n.slice(0,Math.max(0,e-3))}...`}async function ck({agent:t,toolCalls:e}){let n=new Map;t._approvalDenies||(t._approvalDenies=new Set);let r=e.some(o=>{let i=t.tools[o.name];if(!i)return!1;let s=l_(t,o.name,i),a=t.riskProfile?t.riskProfile.tier:ki.NONE,l=u_({toolName:o.name,toolRisk:s,agentTier:a,approvalPolicy:t&&t.approvalPolicy,trustedTools:t&&t.trustedTools});return!!(l&&l.requires)});if(r){let o=[],i=t.riskProfile?t.riskProfile.tier:ki.NONE;for(let s of e){let a=t.tools[s.name];if(!a||!s.id)continue;let l=lk(s),c=ak(s.name,l);if(t&&t._approvalDenies&&t._approvalDenies.has(c))continue;let f=l_(t,s.name,a),m=a&&a.approvalMode==="per_turn"?"per_turn":"per_call",h=a&&a.meta?a.meta:null;if(m==="per_turn"&&f<ki.HIGH&&t&&t._approvalGrants&&t._approvalGrants.has(s.name))continue;let _=u_({toolName:s.name,toolRisk:f,agentTier:i,approvalPolicy:t&&t.approvalPolicy,trustedTools:t&&t.trustedTools});_&&_.requires&&o.push({id:s.id,name:s.name,risk:f,args:l,intent:rk(t,s.name,l)||void 0,denyKey:c,approvalMode:m,permissions:h&&Array.isArray(h.permissions)?h.permissions:[],rateLimit:h&&h.rateLimit?h.rateLimit:null})}if(o.length>1){let s=`approval:batch:${Date.now()}`,a=o.reduce((h,y)=>y.risk>h?y.risk:h,ki.NONE),l=t&&t.debug?`Approve selected tool calls (${o.length})?`:sk({toolName:`${o.length} tool calls`,toolRisk:a,isDebug:!1});t.emit("approval_required",{callId:s,tool:"(batch)",risk:a,tools:o,batch:!0,promptSnapshot:l}),t._setState("awaiting_input",{callId:s,tool:"(batch)",risk:a,count:o.length});let c=t._awaitUserInput(s,t.approvalTimeoutMs);t.emit("user_input_requested",{callId:s,questions:[{question:l,inputType:"multi_select",options:o.map(h=>({title:(()=>{let y=uk(h.args,{maxLen:90}),_=y?` args=${y}`:"";return`${h.name}${_} (${ok(h.risk)})`})(),value:h.id,selected:!0}))}]});let f=await c,m=new Set;if(!f.timedOut){let h=f.value;if(ik(h))for(let y of o)m.add(y.id);else if(h&&typeof h=="object"&&Array.isArray(h.approvedCallIds))for(let y of h.approvedCallIds)m.add(y);else if(Array.isArray(h))for(let y of h)m.add(y)}for(let h of o){let y=m.has(h.id);n.set(h.id,{approved:y,timedOut:!!f.timedOut,args:h.args,risk:h.risk,approvalMode:h.approvalMode,toolName:h.name}),t&&t._approvalDenies&&(y?t._approvalDenies.delete(h.denyKey):t._approvalDenies.add(h.denyKey)),y&&h.approvalMode==="per_turn"&&t&&t._approvalGrants&&h.risk<ki.HIGH&&t._approvalGrants.add(h.name)}t._setState("thinking",{reason:f.timedOut?"approval_timeout":"approval_batch_resolved"})}}return{needsApproval:r,batchDecisions:n}}c_.exports={prepareBatchApprovals:ck}});var yo=k((sj,h_)=>{function d_(){return typeof window<"u"}function p_(t){let e=String(t||"").toLowerCase();return e?e.includes("cors")||e.includes("cross-origin")||e.includes("access-control-allow-origin")||e.includes("failed to fetch")||e.includes("networkerror when attempting to fetch")||e.includes("load failed")||e.includes("mixed content")||e.includes("blocked:mixed-content")||e.includes("insecure request")||e.includes("secure context")||e.includes("same origin")||e.includes("same-origin"):!1}function fk(t){if(!t||typeof t!="object")return null;let e=t.code||t.errno||t.error_code;return typeof e=="string"&&e.trim()?e.trim():null}function dk({code:t,message:e}){let n=typeof t=="string"?t.toUpperCase():"",r=String(e||"").toLowerCase(),o=new Set(["ENOENT","EACCES","EPERM","ENOTDIR","EISDIR"]),i=new Set(["ECONNREFUSED","ENOTFOUND","EHOSTUNREACH","ECONNRESET"]);return o.has(n)||r.includes("no such file")||r.includes("permission denied")?"node_io_error":i.has(n)||r.includes("connect")||r.includes("econn")?"node_network_error":null}function pk({toolName:t,output:e,isRateLimitLike:n}){if(e&&typeof e=="object"){if(e.error){if(String(e.error).toLowerCase()==="timeout")return"timeout";if(e.status===429||e.statusCode===429||e.code===429||typeof n=="function"&&(n(e.error)||n(e.message)))return"rate_limited";if(d_()){let r=String(e.error||""),o=[e.message,e.reason,e.detail,e.hint].filter(Boolean).map(s=>String(s)).join(" "),i=`${r} ${o}`;if(String(e.platform||"").toLowerCase()==="browser"||r.toLowerCase()==="environment restriction"||p_(i))return"environment_restriction"}else{let r=fk(e),o=e.message||e.error||"",i=dk({code:r,message:o});if(i)return i}if(t==="run_command"&&String(e.error).toLowerCase().includes("access denied"))return"access_denied";if(t==="apply_patch"){let r=`${e.error||""} ${e.message||""}`.toLowerCase();if(r.includes("invalid patch")||r.includes("unsupported patch"))return"patch_format_error"}return"tool_error"}if(t==="run_command"&&typeof e.exitCode=="number"&&e.exitCode!==0)return"nonzero_exit"}return null}function hk({toolFailureStreak:t,toolName:e,fingerprintOrType:n,args:r,makeFailureFingerprint:o}){if(!t||!e)return;let i=n,s;r!==void 0&&typeof n=="string"&&(s=n,i=o(e,n,r));let a=t.get(e);a&&a.fingerprint===i?t.set(e,{count:a.count+1,fingerprint:i,failureType:s||a.failureType}):t.set(e,{count:1,fingerprint:i,failureType:s})}function mk({toolFailureStreak:t,toolName:e}){!t||!e||t.delete(e)}function gk({toolFailureStreak:t,toolName:e,output:n,defaultLoopFingerprintThreshold:r}){if(!t||!e)return n;let o=t.get(e);if(!o||o.count<2)return n;let i=o.count>=r,s={timeout:"This tool timed out repeatedly. Reduce scope/complexity, verify network/connectivity, or use an alternative tool.",rate_limited:"This tool is being rate limited. Wait before retrying, reduce call frequency, or consolidate requests.",format_error:"This tool returned a non-JSON-serializable output. Adjust parameters to return structured JSON, or check read_skill_documentation.",environment_restriction:"This tool appears blocked by the browser environment (CORS / same-origin policy, mixed content, or blocked network request). Do NOT retry the same call. Explain the limitation to the user and suggest running in Node.js, or using an explicitly configured proxy/alternative source.",node_io_error:"This tool appears to have hit a Node.js filesystem error (missing file/dir or permissions). Verify the path, check permissions, and confirm the working directory before retrying.",node_network_error:"This tool appears to have hit a Node.js network error. Verify host/port, connectivity, and whether the service is running before retrying.",patch_format_error:'apply_patch format is invalid. Keep using apply_patch, fix to "*** Begin Patch ... *** Delete File: <path> ... *** End Patch", and retry once. Do not switch to list_available_skills for syntax-only failures.'},a=i?["STOP: You have repeated the same failing tool call. You MUST change your approach.",s[o.failureType]||"Verify inputs and environment, then change approach.","Do not retry with the same parameters. Either adjust inputs materially, or switch tools. If unsure, use list_available_skills and read_skill_documentation."].join(" "):["This tool has failed repeatedly. Change strategy instead of retrying the same call.",s[o.failureType]||'Verify inputs and environment first (e.g. for run_command: try "pwd" and "ls"; for file/path issues: confirm the path).',"If unsure, use list_available_skills and read_skill_documentation to find an appropriate alternative."].join(" ");return n&&typeof n=="object"&&!Array.isArray(n)?{...n,_self_heal:{repeatedFailures:o.count,failureType:o.failureType||null,intervention:i?"hard_stop":"soft_hint",advice:a}}:{result:n,_self_heal:{repeatedFailures:o.count,failureType:o.failureType||null,intervention:i?"hard_stop":"soft_hint",advice:a}}}h_.exports={isBrowserRuntime:d_,isBrowserEnvRestrictionLikeMessage:p_,classifyToolFailure:pk,recordToolFailure:hk,clearToolFailure:mk,withSelfHealHint:gk}});var g_=k((aj,m_)=>{function yk(t){let e=t&&typeof t=="object"?t:null,n={type:"object",properties:{}};return e&&(e.type&&(n.type=e.type),e.properties&&typeof e.properties=="object"&&(n.properties=e.properties),Array.isArray(e.required)&&(n.required=e.required),e.description&&(n.description=e.description),e.title&&(n.title=e.title)),n}function _k(t){return Array.isArray(t)&&t.every(e=>e&&typeof e=="object"&&typeof e.type=="string")}function Sk(t,{isError:e}={}){if(t&&typeof t=="object"&&!Array.isArray(t)){let r={content:_k(t.content)?t.content:void 0,structuredContent:t.structuredContent,isError:typeof t.isError=="boolean"?t.isError:void 0};return r.content||(r.structuredContent=r.structuredContent===void 0?t:r.structuredContent,r.content=[{type:"text",text:JSON.stringify(t,null,2)}]),typeof e=="boolean"&&(r.isError=e),r}return typeof t=="string"?{content:[{type:"text",text:t}],...typeof e=="boolean"?{isError:e}:null}:{content:[{type:"text",text:JSON.stringify(t,null,2)}],structuredContent:t,...typeof e=="boolean"?{isError:e}:null}}m_.exports={toMcpInputSchema:yk,toMcpCallToolResult:Sk}});var To=k((lj,w_)=>{function T_(t){if(!t||typeof t!="object"||Array.isArray(t))return!1;let e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}function _o(t,e){let n=Number(t);return Number.isFinite(n)?Math.floor(n):e}function y_(t){let e=String(t??"");try{if(typeof Buffer<"u"&&Buffer&&typeof Buffer.byteLength=="function")return Buffer.byteLength(e,"utf8")}catch{}try{if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length}catch{}return e.length}function pf(t){try{return JSON.stringify(t)}catch{return null}}var __=1e5,E_={maxStringChars:12e3,headChars:8e3,tailChars:2e3,maxArrayItems:60,maxObjectKeys:60,maxDepth:5};function Tk(t){let e=T_(t)?t:null,n={...E_};return e&&(n.maxStringChars=Math.max(256,_o(e.maxStringChars,n.maxStringChars)),n.headChars=Math.max(0,_o(e.headChars,n.headChars)),n.tailChars=Math.max(0,_o(e.tailChars,n.tailChars)),n.maxArrayItems=Math.max(0,_o(e.maxArrayItems,n.maxArrayItems)),n.maxObjectKeys=Math.max(0,_o(e.maxObjectKeys,n.maxObjectKeys)),n.maxDepth=Math.max(1,_o(e.maxDepth,n.maxDepth))),n}function So({toolName:t,kind:e,original:n,preview:r,meta:o}){let i=pf(n),s=pf(r),a=i&&i.length<=__?y_(i):null,l=s&&s.length<=__?y_(s):null;return{_agentsjs_tool_output_guard:{tool:t||"",kind:e,truncated:!0,originalBytes:a,keptBytes:l,...o},preview:r}}function S_({toolName:t,value:e,limits:n}){let r=String(e),o=n.maxStringChars;if(r.length<=o)return r;let i=r.slice(0,Math.min(n.headChars,o)),s=Math.max(0,o-i.length),a=n.tailChars>0?r.slice(Math.max(0,r.length-Math.min(n.tailChars,s))):"",c=`${i}${a&&i?`
...
`:"..."}${a}`;return So({toolName:t,kind:"string",original:r,preview:c,meta:{originalChars:r.length,keptChars:c.length}})}function hf({toolName:t,value:e,limits:n,depth:r,seen:o}){if(e==null)return e;let i=typeof e;if(i==="string")return S_({toolName:t,value:e,limits:n});if(i==="number"||i==="boolean")return e;if(i!=="object")return String(e);if(o.has(e))return So({toolName:t,kind:"circular",original:"[Circular]",preview:"[Circular]",meta:{}});if(r>=n.maxDepth)return So({toolName:t,kind:"max_depth",original:e,preview:`[Truncated: maxDepth=${n.maxDepth}]`,meta:{maxDepth:n.maxDepth}});if(o.add(e),Array.isArray(e)){let f=e.length,m=n.maxArrayItems,y=(m>0?e.slice(0,m):[]).map(_=>hf({toolName:t,value:_,limits:n,depth:r+1,seen:o}));return f<=m?y:So({toolName:t,kind:"array",original:e,preview:y,meta:{originalItems:f,keptItems:y.length}})}if(!T_(e)){let f=pf(e);return f&&f.length<=n.maxStringChars?e:So({toolName:t,kind:"non_plain_object",original:f||String(e),preview:f&&f.length>n.maxStringChars?S_({toolName:t,value:f,limits:n}).preview:f||String(e),meta:{originalType:Object.prototype.toString.call(e)}})}let s=Object.entries(e),a=n.maxObjectKeys,l=a>0?s.slice(0,a):[],c={};for(let[f,m]of l)c[f]=hf({toolName:t,value:m,limits:n,depth:r+1,seen:o});return s.length<=a?c:So({toolName:t,kind:"object",original:e,preview:c,meta:{originalKeys:s.length,keptKeys:l.length}})}function Ek({toolName:t,value:e,limits:n}){let r=Tk(n);return hf({toolName:t,value:e,limits:r,depth:0,seen:new Set})}w_.exports={DEFAULT_TOOL_OUTPUT_LIMITS:E_,guardToolOutput:Ek}});var Ni=k((uj,v_)=>{var{toMcpCallToolResult:wk}=g_(),{guardToolOutput:vk}=To(),{DEFAULT_LOOP_FINGERPRINT_THRESHOLD:Ak,safeJsonStringify:Ck}=Nt(),{withSelfHealHint:bk}=yo();function Rk({toolFailureStreak:t,toolName:e,output:n,isError:r,limits:o}){let s=n&&typeof n=="object"&&n._agentsjs_tool_output_guard&&Object.prototype.hasOwnProperty.call(n,"preview")?n:vk({toolName:e,value:n,limits:o}),a=bk({toolFailureStreak:t,toolName:e,output:s,defaultLoopFingerprintThreshold:Ak});return wk(a,{isError:r})}function Ik({callId:t,toolName:e,mcpResult:n}){return{role:"system",tool_call_id:t,name:e,content:Ck(n)}}v_.exports={wrapToolOutput:Rk,buildToolResultMessage:Ik}});var C_=k((cj,A_)=>{var{makeFailureFingerprint:xk}=Nt(),{recordToolFailure:Pk}=yo(),{buildToolResultMessage:kk,wrapToolOutput:Nk}=Ni(),{RiskLevel:Mk}=yt(),{getToolIntent:Ok}=kr(),{getApprovalDecision:Dk,riskLabel:Fk,isApprovedResponse:Lk}=Ia(),{buildApprovalQuestion:Uk}=df(),{makeApprovalArgsHash:qk,makeApprovalDenyKey:Bk}=ba();function xa({agent:t,callId:e,toolName:n,args:r,timedOut:o}){let i=qk(r),s=o?{error:"ApprovalTimeout",timeoutMs:t.approvalTimeoutMs,message:"Approval request timed out.",tool:n,argsHash:i,guidance:"Approval was not granted for this specific tool call. Do not retry the exact same call in this turn."}:{error:"ApprovalDenied",message:"User denied approval.",tool:n,argsHash:i,guidance:"User denied approval for this specific tool call. Do not retry the exact same call in this turn."};Pk({toolFailureStreak:t._toolFailureStreak,toolName:n,fingerprintOrType:"approval_denied",args:r,makeFailureFingerprint:xk});let a=Nk({toolFailureStreak:t._toolFailureStreak,toolName:n,output:s,isError:!0,limits:t&&t.toolOutputLimits});return kk({callId:e,toolName:n,mcpResult:a})}async function Gk({agent:t,call:e,tool:n,args:r,toolRisk:o,agentTier:i,batchDecisions:s}){let a=s||new Map;if(a.has(e.id)){let b=a.get(e.id);return b.approved?{deniedResultMessage:null}:(t._setState("thinking",{reason:b.timedOut?"approval_timeout":"approval_denied"}),{deniedResultMessage:xa({agent:t,callId:e.id,toolName:e.name,args:r,timedOut:b.timedOut})})}let l=Dk({toolName:e.name,toolRisk:o,agentTier:i,approvalPolicy:t&&t.approvalPolicy,trustedTools:t&&t.trustedTools});if(l&&l.bypassed&&t&&typeof t.emit=="function"&&t.emit("approval_skipped",{tool:e.name,risk:o,policy:t.approvalPolicy||"always",reason:l.reason,args:r,timestamp:new Date().toISOString()}),!l||!l.requires)return{deniedResultMessage:null};t._approvalDenies||(t._approvalDenies=new Set);let c=Bk(e.name,r);if(t._approvalDenies.has(c))return t._setState("thinking",{reason:"approval_denied_cached"}),{deniedResultMessage:xa({agent:t,callId:e.id,toolName:e.name,args:r,timedOut:!1})};let f=n&&n.approvalMode==="per_turn"?"per_turn":"per_call";if(f==="per_turn"&&o<Mk.HIGH&&t&&t._approvalGrants&&t._approvalGrants.has(e.name))return{deniedResultMessage:null};let h=`approval:${e.id||e.name}`,y=t&&t.debug?`Approve tool call: ${e.name} (${Fk(o)})?`:Uk({toolName:e.name,toolRisk:o,isDebug:!1}),_=n&&n.meta?n.meta:null,T=Ok(t,e.name,r)||void 0;t.emit("approval_required",{callId:h,tool:e.name,risk:o,args:r,intent:T,permissions:_&&Array.isArray(_.permissions)?_.permissions:[],rateLimit:_&&_.rateLimit?_.rateLimit:null,promptSnapshot:y}),t._setState("awaiting_input",{callId:h,tool:e.name,risk:o});let E=t._awaitUserInput(h,t.approvalTimeoutMs);t.emit("user_input_requested",{callId:h,questions:[{question:y,options:["Approve","Deny"]}]});let w=await E;return w.timedOut||!Lk(w.value)?(t._setState("thinking",{reason:"approval_denied"}),t._approvalDenies.add(c),{deniedResultMessage:xa({agent:t,callId:e.id,toolName:e.name,args:r,timedOut:w.timedOut})}):(t._approvalDenies.delete(c),f==="per_turn"&&t&&t._approvalGrants&&t._approvalGrants.add(e.name),t._setState("thinking",{reason:"approval_granted"}),{deniedResultMessage:null})}A_.exports={buildApprovalDeniedResult:xa,requireApprovalIfNeeded:Gk}});var mf=k((fj,b_)=>{var{makeApprovalDenyKey:Hk}=ba(),{prepareBatchApprovals:$k}=f_(),{buildApprovalDeniedResult:Vk,requireApprovalIfNeeded:Wk}=C_();b_.exports={buildApprovalDeniedResult:Vk,requireApprovalIfNeeded:Wk,makeApprovalDenyKey:Hk,prepareBatchApprovals:$k}});var I_=k((dj,R_)=>{function Jk({fn:t,timeoutMs:e,defaultTimeoutMs:n}){let r=typeof e=="number"&&e>0?e:n,o,i=new Promise(s=>{o=setTimeout(()=>s({timedOut:!0}),r),o&&typeof o.unref=="function"&&o.unref()});return Promise.resolve().then(()=>Promise.race([Promise.resolve().then(t).then(s=>({timedOut:!1,value:s})),i])).finally(()=>{o&&clearTimeout(o)})}R_.exports={callToolWithTimeout:Jk}});var Mi=k((pj,P_)=>{function x_(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function zk(t){let e=x_();return Array.from(t._activeTools.values()).map(n=>({id:n.id,name:n.name,elapsedMs:Math.max(0,Math.round(e-n.startTime))}))}P_.exports={now:x_,getActiveToolsSnapshot:zk}});var O_=k((hj,M_)=>{var{guardToolOutput:Kk}=To(),{now:k_,getActiveToolsSnapshot:N_}=Mi();function Yk({agent:t,call:e,args:n,toolMeta:r}){let o=k_();return t._activeTools.set(e.id,{id:e.id,name:e.name,startTime:o}),t.emit("tool_call_begin",{id:e.id,name:e.name,args:n===void 0?null:n,timestamp:new Date().toISOString()}),t._setState("executing",{toolCalls:r,active:N_(t)}),o}function jk({agent:t,toolName:e,args:n,output:r}){let o=Kk({toolName:e,value:r,limits:t&&t.toolOutputLimits});return t.emit("tool_result",{tool:e,args:n===void 0?null:n,result:o}),o}function Xk({agent:t,callId:e,toolName:n,startTime:r,success:o}){let i=k_();return t._activeTools.delete(e),t.emit("tool_call_end",{id:e,name:n,success:!!o,durationMs:Math.max(0,Math.round(i-(r||i)))}),t._activeTools.size>0&&t._setState("executing",{active:N_(t)}),i}M_.exports={beginToolCall:Yk,emitToolResult:jk,endToolCall:Xk}});var yf=k((mj,D_)=>{function Oi(t){return(t||"").trim().toLowerCase()}function gf(t){let e=String(t||"").trim();if(!e||e.startsWith("-"))return!1;let n=e.indexOf("=");return n<=0?!1:n<e.length-1}function Qk(t){let e=String(t||""),n=[],r="",o=null,i=!1,s=()=>{let a=r.trim();a&&n.push(a),r=""};for(let a=0;a<e.length;a++){let l=e[a];if(i){r+=l,i=!1;continue}if(l==="\\"){o!=="'"&&(i=!0),r+=l;continue}if(o){r+=l,l===o&&(o=null);continue}if(l==='"'||l==="'"){o=l,r+=l;continue}if(l===";"||l===`
`||l==="\r"){s();continue}if(l==="&"&&e[a+1]==="&"){s(),a++;continue}if(l==="|"&&e[a+1]==="|"){s(),a++;continue}if(l==="|"){s();continue}r+=l}return s(),n}function Zk(t){let e=String(t||""),n=null,r=!1,o=a=>{let l=Oi(a);return l?l==="sh"||l==="bash"||l==="zsh"||l==="powershell"||l==="powershell.exe"||l==="pwsh"||l==="pwsh.exe":!1},i=a=>{let l=String(a||""),c=l.split(/[\\/]/).filter(Boolean);return c.length?c[c.length-1]:l},s=a=>{let l=a;for(;l<e.length&&/\s/.test(e[l]);)l++;let c=l;for(;c<e.length&&!/\s/.test(e[c])&&!["|","&",";",">","<",`
`,"\r"].includes(e[c]);)c++;return{word:e.slice(l,c),next:c}};for(let a=0;a<e.length;a++){let l=e[a];if(r){r=!1;continue}if(l==="\\"){n!=="'"&&(r=!0);continue}if(n){l===n&&(n=null);continue}if(l==='"'||l==="'"){n=l;continue}if(l===">"){let c=a+1;for(e[c]===">"&&c++;c<e.length&&/\s/.test(e[c]);)c++;if(e[c]==="/")return{safe:!1,reason:"redirection to absolute path is restricted"};continue}if(l==="|"){if(e[a+1]==="|"){a++;continue}let c=s(a+1),f=c.next,m=i(c.word);if(o(m))return{safe:!1,reason:"piping into a shell is restricted"};if(Oi(m)==="env"){let h=s(f);for(f=h.next;h.word&&(Oi(h.word).startsWith("-")||gf(h.word));)h=s(f),f=h.next;let y=i(h.word);if(o(y))return{safe:!1,reason:"piping into a shell is restricted"}}a=f-1;continue}}return{safe:!0}}function eN(t){let e=String(t||"").trim();if(!e)return[];let n=[],r="",o=null,i=!1,s=()=>{r.length&&n.push(r),r=""};for(let a=0;a<e.length;a++){let l=e[a];if(i){r+=l,i=!1;continue}if(l==="\\"){o!=="'"&&(i=!0);continue}if(o){l===o?o=null:r+=l;continue}if(l==='"'||l==="'"){o=l;continue}if(l===" "||l==="	"||l===`
`||l==="\r"){r.length&&s();continue}r+=l}return r.length&&s(),n}function tN(t){let e=t.filter(Boolean),n=e.map(Oi).filter(Boolean),r=n[0];if(!r)return null;let o=e,i=n;if(r==="env"){let s=1;for(;s<i.length;){if(i[s].startsWith("-")||gf(o[s])){s++;continue}break}if(s>=i.length)return null;o=o.slice(s),i=i.slice(s),r=i[0]}if(r==="bash"||r==="zsh"||r==="sh"){let s=i.findIndex(a=>a==="-c"||a==="-lc");if(s!==-1&&o[s+1]){let a=o.slice(s+1).join(" ");if(a)return{payload:a}}}if(r==="cmd"||r==="cmd.exe"){let s=i.findIndex(a=>a==="/c"||a==="/r"||a==="-c");if(s!==-1){let a=o.slice(s+1).join(" ");if(a)return{payload:a}}}if(r==="powershell"||r==="powershell.exe"||r==="pwsh"||r==="pwsh.exe"){let s=i.findIndex(a=>a==="-command"||a==="/command"||a==="-c");if(s!==-1&&o[s+1]){let a=o.slice(s+1).join(" ");if(a)return{payload:a}}}return null}D_.exports={normalizeToken:Oi,isEnvAssignmentToken:gf,splitCommandSegments:Qk,scanUnsafeOperators:Zk,splitArgv:eN,isShellWrapper:tN}});var L_=k((gj,F_)=>{var{normalizeToken:nN,isEnvAssignmentToken:rN}=yf();function oN(t){return!!t&&(t.endsWith("git")||t.endsWith("/git")||t.endsWith("\\git"))}function iN(t){let e=t.filter(Boolean),n=e.map(nN).filter(Boolean);if(n.length===0)return{dangerous:!1};let o=((f,m)=>{let h=0;if(m[h]==="sudo"&&(h++,h>=m.length))return{dangerous:!0,reason:"sudo without command"};if(m[h]==="env")for(h++;h<m.length&&(m[h].startsWith("-")||rN(f[h]));)h++;return{raw:f.slice(h),norm:m.slice(h)}})(e,n);if(o.dangerous)return{dangerous:!0,reason:o.reason};let i=o.raw,s=o.norm;if(s.length===0)return{dangerous:!1};let a=s[0];if(oN(a)){let f=s[1];if(f==="reset")return{dangerous:!0,reason:"git reset is restricted"};if(f==="rm")return{dangerous:!0,reason:"git rm is restricted"}}if(a==="rm"){let f=new Set(s.slice(1).filter(y=>y.startsWith("-"))),m=f.has("-f")||f.has("-rf")||f.has("-fr"),h=f.has("-r")||f.has("-rf")||f.has("-fr")||f.has("-rr")||f.has("-rR");if(m)return{dangerous:!0,reason:"rm with force is restricted"};if(h&&f.has("-f"))return{dangerous:!0,reason:"rm -r -f is restricted"}}if(a==="chmod"&&(s.includes("777")||s.some(f=>f==="-R"||f==="-r")&&s.includes("777")))return{dangerous:!0,reason:"chmod 777 is restricted"};if(a.startsWith("mkfs"))return{dangerous:!0,reason:"mkfs is restricted"};if(a==="dd")return{dangerous:!0,reason:"dd is restricted"};if((a==="del"||a==="erase")&&s.includes("/f"))return{dangerous:!0,reason:"del/erase with /f is restricted"};if((a==="rd"||a==="rmdir")&&s.includes("/s")&&s.includes("/q"))return{dangerous:!0,reason:"rd/rmdir with /s /q is restricted"};let c={python:"-c",python3:"-c",py:"-c",node:"-e",perl:"-e",ruby:"-e",php:"-r"}[a];if(c){let f=s.findIndex(m=>m===c||a==="node"&&m==="--eval");if(f!==-1&&i[f+1]){let m=String(i.slice(f+1).join(" ")).toLowerCase(),h=m.includes("os.system")||m.includes("subprocess")||m.includes("child_process")||m.includes("spawn(")||m.includes("exec(")||m.includes("popen(")||m.includes("system("),y=/rm\s+-[^\n]*f/.test(m)||m.includes("git reset")||m.includes("git rm")||m.includes("mkfs")||/\bdd\s+if=/.test(m)||m.includes("chmod 777");if(h&&y)return{dangerous:!0,reason:"interpreter inline command execution is restricted"}}}return{dangerous:!1}}F_.exports={isDangerousTokens:iN}});var Sf=k((yj,q_)=>{var{splitCommandSegments:sN,scanUnsafeOperators:aN,splitArgv:lN,isShellWrapper:uN}=yf(),{isDangerousTokens:cN}=L_();function fN(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function U_(t,e=0){if(e>5)return{safe:!1,reason:"command nesting too deep"};let n=aN(t);if(!n.safe)return n;let r=sN(t);for(let o of r){let i=lN(o),s=uN(i);if(s&&s.payload){let l=U_(s.payload,e+1);if(!l.safe)return l}let a=cN(i);if(a.dangerous)return{safe:!1,reason:a.reason||"Restricted command"}}return{safe:!0}}var _f=class{static validateTool(e,n,r={}){let o=r.runtime||(fN()?"node":"browser");if(e==="run_command"){if(o!=="node")return{safe:!1,reason:"run_command is not supported in browser runtime",platform:o};let i=n&&typeof n.command=="string"?n.command:"",s=U_(i);return{safe:s.safe,reason:s.safe?void 0:s.reason,platform:o}}return e==="apply_patch"?o!=="node"?{safe:!1,reason:"apply_patch is not supported in browser runtime",platform:o}:{safe:!0,platform:o}:{safe:!0,platform:o}}};q_.exports={SecurityValidator:_f}});var G_=k((_j,B_)=>{function dN(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function pN(){if(!dN())return null;try{let e=(typeof require=="function"?require:(0,eval)("require"))("child_process");return e&&typeof e.spawn=="function"?e.spawn:null}catch{return null}}var{makeFailureFingerprint:Tf,DEFAULT_TOOL_TIMEOUT_MS:hN,isRateLimitLike:mN}=Nt(),{recordToolFailure:Ef,clearToolFailure:gN,classifyToolFailure:yN}=yo(),{wrapToolOutput:Pa,buildToolResultMessage:ka}=Ni(),{guardToolOutput:_N}=To(),{now:Na,getActiveToolsSnapshot:Ma}=Mi(),{SecurityValidator:SN}=Sf();function Oa({agent:t,toolName:e,args:n,output:r}){let o=_N({toolName:e,value:r,limits:t&&t.toolOutputLimits});return t&&typeof t.emit=="function"&&t.emit("tool_result",{tool:e,args:n,result:o}),o}async function TN({agent:t,call:e,args:n,startTime:r,signal:o}){let i=pN(),s=n&&typeof n.command=="string"?n.command:"";if(o&&o.aborted){let q={error:"Aborted",message:"Execution aborted."},K=Oa({agent:t,toolName:e.name,args:n,output:q}),B=Pa({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:K,isError:!0,limits:t&&t.toolOutputLimits}),j=ka({callId:e.id,toolName:e.name,mcpResult:B}),Q=Na();return t._activeTools.delete(e.id),t.emit("tool_call_end",{id:e.id,name:e.name,success:!1,durationMs:Math.max(0,Math.round(Q-r))}),t._activeTools.size>0?t._setState("executing",{active:Ma(t)}):t._setState("thinking",{reason:"tool_aborted"}),{handled:!0,resultMessage:j}}let a=SN.validateTool("run_command",{command:s});if(!a.safe){let q={error:"Access Denied",reason:a.reason||"Restricted command",platform:a.platform},K=Oa({agent:t,toolName:e.name,args:n,output:q});Ef({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:"access_denied",args:n,makeFailureFingerprint:Tf});let B=Pa({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:K,isError:!0,limits:t&&t.toolOutputLimits}),j=Na();return t._activeTools.delete(e.id),t.emit("tool_call_end",{id:e.id,name:e.name,success:!1,durationMs:Math.max(0,Math.round(j-r))}),t._activeTools.size>0&&t._setState("executing",{active:Ma(t)}),{handled:!0,resultMessage:ka({callId:e.id,toolName:e.name,mcpResult:B})}}let l=n&&typeof n.timeoutMs=="number"&&Number.isFinite(n.timeoutMs)&&n.timeoutMs>0?n.timeoutMs:t.toolTimeoutMs||hN;t.emit("exec_command_begin",{id:e.id,command:s,timestamp:new Date().toISOString()});let c="",f="",m=!1;if(!i){let q={error:"Environment Restriction",message:"run_command is not available in this runtime."},K=Oa({agent:t,toolName:e.name,args:n,output:q});Ef({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:"environment_restriction",args:n,makeFailureFingerprint:Tf});let B=Pa({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:K,isError:!0,limits:t&&t.toolOutputLimits}),j=Na();return t._activeTools.delete(e.id),t.emit("tool_call_end",{id:e.id,name:e.name,success:!1,durationMs:Math.max(0,Math.round(j-r))}),t._activeTools.size>0&&t._setState("executing",{active:Ma(t)}),{handled:!0,resultMessage:ka({callId:e.id,toolName:e.name,mcpResult:B})}}let h=i(s,{shell:!0}),y=null,_=!1,T=setTimeout(()=>{m=!0,h.kill("SIGKILL")},l),E=null;o&&typeof o.addEventListener=="function"&&(E=()=>{_=!0,h.kill("SIGTERM")},o.aborted?E():o.addEventListener("abort",E,{once:!0})),h.stdout&&h.stdout.on("data",q=>{let K=String(q);c+=K,t.emit("exec_command_output",{id:e.id,stream:"stdout",chunk:K})}),h.stderr&&h.stderr.on("data",q=>{let K=String(q);f+=K,t.emit("exec_command_output",{id:e.id,stream:"stderr",chunk:K})});let w=await new Promise(q=>{h.on("error",K=>{y=K,q(1)}),h.on("close",(K,B)=>{clearTimeout(T),(B==="SIGTERM"||B==="SIGKILL")&&(m=!0),q(typeof K=="number"?K:0)})});E&&o&&typeof o.removeEventListener=="function"&&o.removeEventListener("abort",E);let b={stdout:String(c).trim(),stderr:String(f).trim(),exitCode:typeof w=="number"?w:0};y?(b.error="Tool execution failed",b.message=String(y.message||y)):_?(b.error="Aborted",b.exitCode=130):m&&(b.error="Timeout",b.timeoutMs=l,b.exitCode=124);let L=m?"timeout":yN({toolName:e.name,output:b,isRateLimitLike:mN});L?Ef({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:L,args:n,makeFailureFingerprint:Tf}):gN({toolFailureStreak:t._toolFailureStreak,toolName:e.name});let D=Pa({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:Oa({agent:t,toolName:e.name,args:n,output:b}),isError:!!L,limits:t&&t.toolOutputLimits}),I=Na();return t._activeTools.delete(e.id),t.emit("exec_command_end",{id:e.id,command:s,exitCode:b.exitCode,success:!L,durationMs:Math.max(0,Math.round(I-r))}),t.emit("tool_call_end",{id:e.id,name:e.name,success:!L,durationMs:Math.max(0,Math.round(I-r))}),t._activeTools.size>0&&t._setState("executing",{active:Ma(t)}),{handled:!0,resultMessage:ka({callId:e.id,toolName:e.name,mcpResult:D})}}B_.exports={handleRunCommand:TN}});var $_=k((Sj,H_)=>{function EN({agent:t,args:e}){let n=e&&typeof e.explanation=="string"?e.explanation:void 0,r=e&&Array.isArray(e.plan)?e.plan:[];return t.currentPlan=r,t.emit("plan_updated",{explanation:n,plan:r}),{handled:!1}}H_.exports={handleUpdatePlan:EN}});var W_=k((Tj,V_)=>{var{makeFailureFingerprint:wN}=Nt(),{recordToolFailure:vN,clearToolFailure:AN}=yo(),{wrapToolOutput:CN,buildToolResultMessage:bN}=Ni(),{guardToolOutput:RN}=To(),{now:IN,getActiveToolsSnapshot:xN}=Mi();async function PN({agent:t,call:e,args:n,startTime:r}){let o=Array.isArray(n&&n.questions)?n.questions:typeof(n&&n.question)=="string"?[{question:n.question,options:Array.isArray(n.options)?n.options:void 0}]:[],i=t._awaitUserInput(e.id,t.toolTimeoutMs),s={callId:e.id,questions:o};t.emit("user_input_requested",s),t._setState("awaiting_input",{callId:e.id,questions:o});let a=await i,l=a.timedOut?{error:"Timeout",timeoutMs:t.toolTimeoutMs,message:"User input timed out."}:{response:a.value},c=RN({toolName:e.name,value:l,limits:t&&t.toolOutputLimits});t.emit("tool_result",{tool:e.name,args:n,result:c}),a.timedOut?vN({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:"timeout",args:n,makeFailureFingerprint:wN}):AN({toolFailureStreak:t._toolFailureStreak,toolName:e.name});let f=CN({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:c,isError:a.timedOut,limits:t&&t.toolOutputLimits}),m=IN();return t._activeTools.delete(e.id),t.emit("tool_call_end",{id:e.id,name:e.name,success:!a.timedOut,durationMs:Math.max(0,Math.round(m-r))}),t._activeTools.size>0?t._setState("executing",{active:xN(t)}):t._setState("thinking",{reason:"user_input_received"}),{handled:!0,resultMessage:bN({callId:e.id,toolName:e.name,mcpResult:f})}}V_.exports={handleRequestUserInput:PN}});var z_=k((Ej,J_)=>{var{handleRunCommand:kN}=G_(),{handleUpdatePlan:NN}=$_(),{handleRequestUserInput:MN}=W_();async function ON({agent:t,call:e,args:n,startTime:r,signal:o}){return e.name==="run_command"?kN({agent:t,call:e,args:n,startTime:r,signal:o}):e.name==="update_plan"?NN({agent:t,call:e,args:n,startTime:r,signal:o}):e.name!=="request_user_input"?{handled:!1}:MN({agent:t,call:e,args:n,startTime:r,signal:o})}J_.exports={handleSpecialTool:ON}});var j_=k((wj,Y_)=>{var{DEFAULT_TOOL_TIMEOUT_MS:DN,makeFailureFingerprint:wf,stableStringify:FN,isRateLimitLike:vf}=Nt(),{isBrowserRuntime:LN,isBrowserEnvRestrictionLikeMessage:UN,classifyToolFailure:K_,recordToolFailure:Af,clearToolFailure:qN}=yo(),{callToolWithTimeout:BN}=I_(),{buildToolResultMessage:Di,wrapToolOutput:Fi}=Ni(),{guardToolOutput:GN}=To(),{beginToolCall:HN,emitToolResult:Da,endToolCall:Cf}=O_(),{handleSpecialTool:$N}=z_(),{now:Li,getActiveToolsSnapshot:Ui}=Mi(),{RiskLevel:VN}=yt(),{getToolRisk:WN}=kr(),{requireApprovalIfNeeded:JN}=mf();async function zN({agent:t,call:e,toolMeta:n,batchDecisions:r,signal:o}){let i=null,s=!1;if(o&&o.aborted){let l=null;try{l=typeof e.arguments=="string"?JSON.parse(e.arguments):e.arguments}catch{l=null}i=HN({agent:t,call:e,args:l,toolMeta:n}),s=!0;let c={error:"Aborted",message:"Execution aborted."},f=Da({agent:t,toolName:e.name,args:l,output:c}),m=Fi({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:f,isError:!0,limits:t&&t.toolOutputLimits});return Cf({agent:t,callId:e.id,toolName:e.name,startTime:i,success:!1}),Di({callId:e.id,toolName:e.name,mcpResult:m})}let a=t.tools[e.name];if(!a){i=Li(),t._activeTools.set(e.id,{id:e.id,name:e.name,startTime:i}),s=!0,t.emit("tool_call_begin",{id:e.id,name:e.name,args:null,timestamp:new Date().toISOString()}),t._setState("executing",{toolCalls:n,active:Ui(t)});let l;try{l=typeof e.arguments=="string"?JSON.parse(e.arguments):e.arguments}catch{l=void 0}let c={error:"Tool not found",tool:e.name,hint:"Use list_available_skills to discover the correct tool, then read_skill_documentation before calling it."},f=Da({agent:t,toolName:e.name,args:null,output:c});Af({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:"tool_not_found",args:l,makeFailureFingerprint:wf});let m=Fi({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:f,isError:!0,limits:t&&t.toolOutputLimits}),h=Li();return t._activeTools.delete(e.id),t.emit("tool_call_end",{id:e.id,name:e.name,success:!1,durationMs:Math.max(0,Math.round(h-i))}),t._setState("executing",{active:Ui(t)}),Di({callId:e.id,toolName:e.name,mcpResult:m})}try{let l;l=typeof e.arguments=="string"?JSON.parse(e.arguments):e.arguments;let c=WN(t,e.name,a),f=t.riskProfile?t.riskProfile.tier:VN.NONE,m=await JN({agent:t,call:e,tool:a,args:l,toolRisk:c,agentTier:f,batchDecisions:r});if(m&&m.deniedResultMessage)return m.deniedResultMessage;i=Li(),t._activeTools.set(e.id,{id:e.id,name:e.name,startTime:i}),s=!0,t.emit("tool_call_begin",{id:e.id,name:e.name,args:l,timestamp:new Date().toISOString()}),t._setState("executing",{toolCalls:n,active:Ui(t)});let h=await $N({agent:t,call:e,args:l,startTime:i,signal:o});if(h&&h.handled)return h.resultMessage;console.log(`  > Executing ${e.name} with args:`,l);let y=BN({fn:()=>a.func(l),timeoutMs:t.toolTimeoutMs,defaultTimeoutMs:DN}).then(K=>({kind:"tool",value:K})).catch(K=>({kind:"error",error:K})),_=o&&typeof o.addEventListener=="function"?new Promise(K=>{o.aborted?K({kind:"abort"}):o.addEventListener("abort",()=>K({kind:"abort"}),{once:!0})}):null,T=_?await Promise.race([y,_]):await y;if(T&&T.kind==="abort"){y.then(()=>null,()=>null);let K={error:"Aborted",message:"Execution aborted."},B=Da({agent:t,toolName:e.name,args:l,output:K}),j=Fi({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:B,isError:!0,limits:t&&t.toolOutputLimits});return Cf({agent:t,callId:e.id,toolName:e.name,startTime:i,success:!1}),Di({callId:e.id,toolName:e.name,mcpResult:j})}if(T&&T.kind==="error")throw T.error;let E=T.value,w=E.timedOut?{error:"Timeout",timeoutMs:t.toolTimeoutMs,message:`Tool execution exceeded ${t.toolTimeoutMs}ms`}:E.value,b=w===void 0?null:w,L=!1;if(!E.timedOut)try{JSON.stringify(b)}catch{L=!0;try{b=JSON.parse(FN(b))}catch{b={error:"Format Error",message:"Tool output was not JSON serializable."}}}let D=E.timedOut?"timeout":L?"format_error":K_({toolName:e.name,output:b,isRateLimitLike:vf});D?Af({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:D,args:l,makeFailureFingerprint:wf}):qN({toolFailureStreak:t._toolFailureStreak,toolName:e.name});let I=GN({toolName:e.name,value:b,limits:t&&t.toolOutputLimits});t.emit("tool_result",{tool:e.name,args:l,result:I});let P=Fi({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:I,isError:!!D,limits:t&&t.toolOutputLimits}),q=Li();return t._activeTools.delete(e.id),t.emit("tool_call_end",{id:e.id,name:e.name,success:!D,durationMs:Math.max(0,Math.round(q-i))}),t._activeTools.size>0&&t._setState("executing",{active:Ui(t)}),Di({callId:e.id,toolName:e.name,mcpResult:P})}catch(l){console.error(`  > Error executing ${e.name}:`,l),t.emit("tool_error",{tool:e.name,error:l.message});let c=String(l&&l.message?l.message:l),f=l&&typeof l.code=="string"?l.code:void 0,m;try{m=typeof e.arguments=="string"?JSON.parse(e.arguments):e.arguments}catch{m=void 0}let h={error:"Tool execution failed",message:c,code:f},y=Da({agent:t,toolName:e.name,args:s?m:null,output:h}),_=K_({toolName:e.name,output:h,isRateLimitLike:vf})||(LN()&&UN(c)?"environment_restriction":vf(c)?"rate_limited":`exception:${c}`);Af({toolFailureStreak:t._toolFailureStreak,toolName:e.name,fingerprintOrType:_,args:m,makeFailureFingerprint:wf});let T=Fi({toolFailureStreak:t._toolFailureStreak,toolName:e.name,output:y,isError:!0,limits:t&&t.toolOutputLimits}),E=Li();return s&&Cf({agent:t,callId:e.id,toolName:e.name,startTime:i,success:!1}),t._activeTools.size>0?t._setState("executing",{active:Ui(t)}):t._setState("thinking",{reason:"tool_error"}),Di({callId:e.id,toolName:e.name,mcpResult:T})}}Y_.exports={executeToolCall:zN}});var bf=k((vj,X_)=>{var{prepareBatchApprovals:KN}=mf(),{executeToolCall:YN}=j_();function jN(t){let e=[];return e.push("Thought: I need to use tools to gather required information before answering."),e.push("Plan:"),t.forEach((n,r)=>{let o="";try{let i=typeof n.arguments=="string"?JSON.parse(n.arguments):n.arguments||{},s=JSON.stringify(i);o=s&&s!=="{}"?` with ${s}`:""}catch{o=""}e.push(`${r+1}. Call ${n.name}${o}.`)}),e.push("Action: Calling tool(s) now."),e.join(`
`)+`
`}async function XN(t,e,n={}){let r=[];t._activeTools.clear();let o=e.map(f=>({id:f.id,name:f.name}));t._setState("thinking",{reason:"tools_planned",toolCalls:o});let{needsApproval:i,batchDecisions:s}=await KN({agent:t,toolCalls:e}),a=n&&n.signal?n.signal:null,l=f=>YN({agent:t,call:f,toolMeta:o,batchDecisions:s,signal:a}),c=i?await(async()=>{let f=[];for(let m of e)f.push(await l(m));return f})():await Promise.all(e.map(l));return t._activeTools.clear(),t._setState("thinking",{reason:"tools_completed",toolCount:e.length}),c.length?c:r}X_.exports={executeTools:XN,buildSyntheticToolPlan:jN}});var La=k((Aj,tS)=>{var Fa=null;function QN(){return Fa||(typeof TextEncoder<"u"&&(Fa=new TextEncoder),Fa)}function Q_(t){if(typeof t!="string"||t.length===0)return 0;let e=QN();return e?e.encode(t).length:typeof Buffer<"u"?Buffer.byteLength(t,"utf8"):t.length}function If(t){let e=Number(t)||0;return Math.ceil(e/4)}function ZN(t){return If(Q_(t))}function Z_(t){return If(Q_(t))}function eM(t){return!!(t&&(t.role==="system"||t.role==="tool")&&typeof t.tool_call_id=="string")}function eS(t){if(!t||typeof t!="object")return 0;try{let e=JSON.stringify(t);return Z_(e)}catch{return 0}}function Rf(t){if(!Array.isArray(t))return 0;let e=0;for(let n of t)e+=eS(n);return e}function tM(t){if(!Array.isArray(t))return 0;let e=-1,n=0;for(let r=t.length-1;r>=0;r--){let o=t[r],i=o&&Object.prototype.hasOwnProperty.call(o,"_tokenUsagePrompt")?Number(o._tokenUsagePrompt):NaN;if(Number.isFinite(i)){e=r,n=i;break}}if(e>=0){let r=t.slice(e+1);return n+Rf(r)}return Rf(t)}tS.exports={APPROX_BYTES_PER_TOKEN:4,estimateTokens:tM,estimateTokensHeuristic:Rf,estimateTokensForMessage:eS,estimateTextTokens:ZN,estimateStructuredTokens:Z_,approxTokensFromBytes:If,isToolResultMessage:eM}});var rS=k((Cj,nS)=>{var{isToolResultMessage:xf}=La();function nM(t){let e=new Map,n=new Map;for(let r=0;r<t.length;r++){let o=t[r];if(!(!o||typeof o!="object")){if(o.role==="assistant"&&Array.isArray(o.tool_calls))for(let i of o.tool_calls)!i||typeof i.id!="string"||e.has(i.id)||e.set(i.id,r);if(xf(o)&&typeof o.tool_call_id=="string"){let i=n.get(o.tool_call_id)||[];i.push(r),n.set(o.tool_call_id,i)}}}return{callIdToAssistantIndex:e,callIdToResultIndices:n}}function rM(t,e){let n={role:"system",tool_call_id:t,content:JSON.stringify({content:[{type:"text",text:"aborted"}],isError:!0})};return typeof e=="string"&&(n.name=e),n}function oM(t,e){return!t||typeof t!="object"||typeof e!="string"||t.name?t:{...t,name:e}}function iM(t,e){let n=new Set(t),{callIdToAssistantIndex:r,callIdToResultIndices:o}=nM(e);for(let[i,s]of o.entries()){let a=r.get(i);if(!(typeof a=="number"&&n.has(a)))for(let c of s)n.delete(c)}return Array.from(n).sort((i,s)=>i-s)}function sM(t){if(!Array.isArray(t))return t;let e=new Set,n=new Map;for(let i of t)if(!(!i||i.role!=="assistant"||!Array.isArray(i.tool_calls)))for(let s of i.tool_calls)!s||typeof s.id!="string"||(e.add(s.id),typeof s.name=="string"&&!n.has(s.id)&&n.set(s.id,s.name));let r=new Map;for(let i of t)xf(i)&&e.has(i.tool_call_id)&&(r.has(i.tool_call_id)||r.set(i.tool_call_id,i));let o=[];for(let i of t)if(!xf(i)&&(o.push(i),!(!i||i.role!=="assistant"||!Array.isArray(i.tool_calls))))for(let s of i.tool_calls){if(!s||typeof s.id!="string")continue;let a=typeof s.name=="string"?s.name:n.get(s.id),l=r.get(s.id);if(l){o.push(oM(l,a));continue}o.push(rM(s.id,a))}return o}nS.exports={enforceToolIntegrity:iM,normalizeHistory:sM}});var Nf=k((bj,aS)=>{var{estimateTokens:Pf,isToolResultMessage:sS}=La(),{enforceToolIntegrity:oS,normalizeHistory:iS}=rS();function aM(t){if(!t||t.role!=="user"||typeof t.content!="string")return!1;let e=t.content.trimStart(),n=e.toLowerCase();return e.startsWith("# AGENTS.md instructions for ")||e.startsWith("<user_instructions>")||e.startsWith("<skill")||n.startsWith("<environment_context>")||n.startsWith("<turn_aborted>")||e.startsWith("Another language model started to solve this problem")}function lM(t){return Array.isArray(t)?t.filter(e=>!e||typeof e!="object"?!1:e.role!=="system"&&e.role!=="tool"?!0:sS(e)):[]}function uM(t,e,n,r){let o=new Set(t),i=r instanceof Set?r:new Set,s=new Map,a=new Map;for(let m of t){let h=e[m];if(!(!h||typeof h!="object")){if(h.role==="assistant"&&Array.isArray(h.tool_calls))for(let y of h.tool_calls)!y||typeof y.id!="string"||s.has(y.id)||s.set(y.id,m);if(sS(h)){let y=a.get(h.tool_call_id)||[];y.push(m),a.set(h.tool_call_id,y)}}}let l=new Map;for(let[m,h]of a.entries()){let y=s.get(m);if(typeof y!="number")continue;let _=l.get(y)||[];for(let T of h)_.push(T);l.set(y,_)}let c=new Set,f=[];for(let m of t){if(c.has(m))continue;let h=e[m],y=[m];if(h&&h.role==="assistant"&&Array.isArray(h.tool_calls)){let _=l.get(m)||[];for(let T of _)o.has(T)&&y.push(T)}y=Array.from(new Set(y)).sort((_,T)=>_-T);for(let _ of y)c.add(_);f.push({indices:y,protected:y.some(_=>_<n||i.has(_)),minIndex:y[0]})}return f.sort((m,h)=>m.minIndex-h.minIndex)}function cM(t,e){if(typeof t!="string")return t;if(!Number.isFinite(e)||e<=0)return`\u2026${t.length} chars truncated\u2026`;if(t.length<=e)return t;let n=t.length-e,r=Math.floor(e/2),o=Math.max(0,e-r),i=t.slice(0,r),s=o>0?t.slice(t.length-o):"";return`${i}\u2026${n} chars truncated\u2026${s}`}function fM(t,{maxToolOutputChars:e}={}){if(!e||!Array.isArray(t))return t;let n=Number(e);return!Number.isFinite(n)||n<=0?t:t.map(r=>!r||typeof r!="object"||r.role!=="system"&&r.role!=="tool"||typeof r.content!="string"||r.content.length<=n?r:{...r,content:cM(r.content,n)})}var kf=class{constructor(e={}){this.defaults={maxMessages:16,preserveHeadMessages:2,protectRecentMessages:0,maxEstimatedTokens:void 0,maxToolOutputChars:void 0,...e}}process(e,n={}){let r={...this.defaults,...n},o=Array.isArray(e)?e.length:0,i=lM(e),s=Math.max(1,Number(r.maxMessages)||16),a=Math.max(0,Math.min(s,Number(r.preserveHeadMessages)||0)),l=Math.max(0,Math.min(i.length,Number(r.protectRecentMessages)||0)),c=new Set;if(l>0){let _=Math.max(0,i.length-l);for(let T=_;T<i.length;T++)c.add(T)}for(let _=0;_<i.length;_++)aM(i[_])&&c.add(_);let f=Math.min(a,i.length,s),m;if(i.length<=s)m=Array.from({length:i.length},(_,T)=>T);else{let _=Math.max(0,s-f),T=new Set;for(let w=0;w<f;w++)T.add(w);let E=Math.max(f,i.length-_);for(let w=E;w<i.length;w++)T.add(w);for(let w of c)T.add(w);m=Array.from(T).sort((w,b)=>w-b)}m=oS(m,i);let h=r.maxEstimatedTokens;if(Number.isFinite(Number(h))){let _=Number(h);for(;;){let T=m.map(I=>i[I]);if(Pf(iS(T))<=_)break;let b=uM(m,i,f,c).filter(I=>!I.protected);if(b.length===0)break;let L=b[0],D=new Set(L.indices);m=m.filter(I=>!D.has(I)),m=oS(m,i)}}let y=m.map(_=>i[_]);return y=iS(y),y=fM(y,r),{history:y,meta:{dropped:Math.max(0,o-y.length),estimatedTokens:Pf(y)}}}};aS.exports={ContextManager:kf,estimateTokens:Pf}});var cS=k((Rj,uS)=>{var{estimateTokens:lS}=Nf(),{safeJsonStringify:dM}=Nt();function pM(t){let e=t._toolFailureStreak instanceof Map?Object.fromEntries(t._toolFailureStreak.entries()):{};return{version:"1.0",timestamp:new Date().toISOString(),status:t.status,systemPrompt:t.systemPrompt,history:t.history,currentPlan:t.currentPlan,decisionTraces:Array.isArray(t._decisionTraces)?t._decisionTraces:[],toolFailureStreak:e}}function hM(t,e,{emitPlanEvent:n=!0}={}){return!e||typeof e!="object"?!1:(Array.isArray(e.history)&&(t.history=e.history),typeof e.systemPrompt=="string"&&(t.systemPrompt=e.systemPrompt),t.currentPlan=Array.isArray(e.currentPlan)?e.currentPlan:e.currentPlan||null,t.status=typeof e.status=="string"?e.status:"idle",e.toolFailureStreak&&typeof e.toolFailureStreak=="object"&&(t._toolFailureStreak=new Map(Object.entries(e.toolFailureStreak))),t._decisionTraces=Array.isArray(e.decisionTraces)?e.decisionTraces:[],n&&t.currentPlan&&t.emit("plan_updated",{explanation:"Snapshot restored",plan:t.currentPlan}),!0)}function mM(t,e,n={}){let r=t.status,o={...n,historyLength:t.history.length,estimatedTokens:lS(t.history)},i=dM(o);r===e&&i===t._lastStateMeta||(t.status=e,t._lastStateMeta=i,t.emit("state_changed",{status:e,previous:r,metadata:o,timestamp:new Date().toISOString()}))}function gM(t){return{status:t.status,currentPlan:t.currentPlan,historyLength:t.history.length,estimatedTokens:lS(t.history)}}uS.exports={dumpSnapshot:pM,loadSnapshot:hM,setState:mM,getState:gM}});var pS=k((Ij,dS)=>{var fS={agent:{maxTurns:50,maxProtectedRecentMessages:12,compaction:{enabled:!0,triggerMessages:30,triggerTokens:null,keepRecentMessages:8,maxSummaryChars:2e4,maxMessageChars:2e3,maxUserMessageTokens:2e4}}};typeof globalThis<"u"&&(globalThis.AGENTS_DEFAULT_CONFIG||(globalThis.AGENTS_DEFAULT_CONFIG=fS));dS.exports=fS});var Of=k((xj,yS)=>{var yM="memory/episodic-memory.jsonl",ir=Object.freeze({enabled:!0,topK:5,minScore:.2,maxContextChars:6e3,autoSave:!0,memoryFirst:!1,autoMemoryPrecheck:!1,browserStoreName:"agents_memory_v1"}),mS={agent:{maxTurns:50,maxProtectedRecentMessages:12,debug:!1,approvalPolicy:"always",trustedTools:[],toolOutputLimits:null,compaction:{enabled:!0,triggerMessages:30,triggerTokens:null,keepRecentMessages:8,maxSummaryChars:2e4,maxMessageChars:2e3,maxUserMessageTokens:2e4},rag:{enabled:ir.enabled,topK:ir.topK,minScore:ir.minScore,maxContextChars:ir.maxContextChars,autoSave:ir.autoSave,memoryFirst:ir.memoryFirst,autoMemoryPrecheck:ir.autoMemoryPrecheck,fixedJsonlPaths:[],episodicStoreNodePath:yM,browserStoreName:ir.browserStoreName}}},_M=["maxStringChars","headChars","tailChars","maxArrayItems","maxObjectKeys","maxDepth"],SM=new Set(["always","unless_trusted","never"]);function gS(t){if(typeof t!="string")return null;let e=t.trim().toLowerCase();return SM.has(e)?e:null}function hS(t){if(!t)return[];if(Array.isArray(t)){let e=t.map(n=>typeof n=="string"?n.trim():String(n||"").trim()).filter(Boolean);return Array.from(new Set(e))}if(typeof t=="string"){let e=t.split(",").map(n=>n.trim()).filter(Boolean);return Array.from(new Set(e))}return[]}function Ua(t,e){if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t!="string")return e;let n=t.trim().toLowerCase();return["1","true","yes","on"].includes(n)?!0:["0","false","no","off"].includes(n)?!1:e}function TM(){try{return pS()}catch{return null}}function EM(){return typeof globalThis>"u"?null:globalThis.AGENTS_CONFIG||globalThis.AGENTS_DEFAULT_CONFIG||null}function Mf(t){return t&&typeof t=="object"?t:{}}function wM(t){if(!t||typeof t!="object"||Array.isArray(t))return null;let e={};for(let n of _M){if(!Object.prototype.hasOwnProperty.call(t,n))continue;let r=Number(t[n]);if(!Number.isFinite(r))continue;let o=Math.floor(r);o<0||n==="maxDepth"&&o<1||(e[n]=o)}return Object.keys(e).length>0?e:null}function at(t,e){let n={...t};if(!e||typeof e!="object"||!e.agent||typeof e.agent!="object")return n;let r=e.agent;if(n.agent={...n.agent},Number.isFinite(r.maxTurns)&&(n.agent.maxTurns=r.maxTurns),Number.isFinite(r.maxProtectedRecentMessages)&&(n.agent.maxProtectedRecentMessages=r.maxProtectedRecentMessages),typeof r.debug=="boolean"&&(n.agent.debug=r.debug),Object.prototype.hasOwnProperty.call(r,"approvalPolicy")){let o=gS(r.approvalPolicy);o&&(n.agent.approvalPolicy=o)}if(Object.prototype.hasOwnProperty.call(r,"trustedTools")){let o=r.trustedTools;(Array.isArray(o)||typeof o=="string")&&(n.agent.trustedTools=hS(o))}if(Object.prototype.hasOwnProperty.call(r,"toolOutputLimits")){let o=wM(r.toolOutputLimits);o&&(n.agent.toolOutputLimits=o)}if(r.compaction&&typeof r.compaction=="object"){n.agent.compaction={...n.agent.compaction};let o=r.compaction;typeof o.enabled=="boolean"&&(n.agent.compaction.enabled=o.enabled),Number.isFinite(o.triggerMessages)&&(n.agent.compaction.triggerMessages=o.triggerMessages),Number.isFinite(o.triggerTokens)&&(n.agent.compaction.triggerTokens=o.triggerTokens),Number.isFinite(o.keepRecentMessages)&&(n.agent.compaction.keepRecentMessages=o.keepRecentMessages),Number.isFinite(o.maxSummaryChars)&&(n.agent.compaction.maxSummaryChars=o.maxSummaryChars),Number.isFinite(o.maxMessageChars)&&(n.agent.compaction.maxMessageChars=o.maxMessageChars),Number.isFinite(o.maxUserMessageTokens)&&(n.agent.compaction.maxUserMessageTokens=o.maxUserMessageTokens)}if(r.rag&&typeof r.rag=="object"){n.agent.rag={...n.agent.rag};let o=r.rag;Object.prototype.hasOwnProperty.call(o,"enabled")&&(n.agent.rag.enabled=Ua(o.enabled,n.agent.rag.enabled)),Number.isFinite(o.topK)&&(n.agent.rag.topK=Math.max(1,Math.floor(o.topK))),Number.isFinite(o.minScore)&&(n.agent.rag.minScore=Number(o.minScore)),Number.isFinite(o.maxContextChars)&&(n.agent.rag.maxContextChars=Math.max(256,Math.floor(o.maxContextChars))),Object.prototype.hasOwnProperty.call(o,"autoSave")&&(n.agent.rag.autoSave=Ua(o.autoSave,n.agent.rag.autoSave)),Object.prototype.hasOwnProperty.call(o,"memoryFirst")&&(n.agent.rag.memoryFirst=Ua(o.memoryFirst,n.agent.rag.memoryFirst)),Object.prototype.hasOwnProperty.call(o,"autoMemoryPrecheck")&&(n.agent.rag.autoMemoryPrecheck=Ua(o.autoMemoryPrecheck,n.agent.rag.autoMemoryPrecheck)),(Array.isArray(o.fixedJsonlPaths)||typeof o.fixedJsonlPaths=="string")&&(n.agent.rag.fixedJsonlPaths=hS(o.fixedJsonlPaths)),typeof o.episodicStoreNodePath=="string"&&o.episodicStoreNodePath.trim()&&(n.agent.rag.episodicStoreNodePath=o.episodicStoreNodePath.trim()),typeof o.browserStoreName=="string"&&o.browserStoreName.trim()&&(n.agent.rag.browserStoreName=o.browserStoreName.trim())}return n}function vM(t){if(typeof process>"u"||!process||!process.env)return t;let e=t,n=process.env.AGENTS_MAX_TURNS;if(n&&Number.isFinite(Number(n))){let f=Number(n);f>0&&(e=at(e,{agent:{maxTurns:f}}))}let r=process.env.AGENTS_DEBUG;if(r!==void 0){let f=String(r).toLowerCase();e=at(e,{agent:{debug:f==="1"||f==="true"||f==="yes"}})}let o=process.env.AGENTS_MAX_PROTECTED_RECENT;if(o&&Number.isFinite(Number(o))){let f=Number(o);f>0&&(e=at(e,{agent:{maxProtectedRecentMessages:f}}))}let i=process.env.AGENTS_APPROVAL_POLICY;if(i){let f=gS(String(i));f&&(e=at(e,{agent:{approvalPolicy:f}}))}let s=process.env.AGENTS_TRUSTED_TOOLS_JSON;if(s)try{let f=JSON.parse(String(s));e=at(e,{agent:{trustedTools:f}})}catch{}let a=process.env.AGENTS_TRUSTED_TOOLS;a&&(e=at(e,{agent:{trustedTools:String(a)}}));let l=process.env.AGENTS_COMPACTION_TRIGGER_TOKENS;if(l&&Number.isFinite(Number(l))){let f=Number(l);f>0&&(e=at(e,{agent:{compaction:{triggerTokens:f}}}))}let c=process.env.AGENTS_TOOL_OUTPUT_LIMITS_JSON;if(c)try{let f=JSON.parse(String(c));e=at(e,{agent:{toolOutputLimits:f}})}catch{}return process.env.AGENTS_RAG_ENABLED!==void 0&&(e=at(e,{agent:{rag:{enabled:process.env.AGENTS_RAG_ENABLED}}})),process.env.AGENTS_RAG_TOPK!==void 0&&Number.isFinite(Number(process.env.AGENTS_RAG_TOPK))&&(e=at(e,{agent:{rag:{topK:Number(process.env.AGENTS_RAG_TOPK)}}})),process.env.AGENTS_RAG_MIN_SCORE!==void 0&&Number.isFinite(Number(process.env.AGENTS_RAG_MIN_SCORE))&&(e=at(e,{agent:{rag:{minScore:Number(process.env.AGENTS_RAG_MIN_SCORE)}}})),e}function AM(t=null){let e=Mf(TM()),n=Mf(EM()),r=Mf(t),o=at(mS,e);return o=at(o,n),o=at(o,r),o=vM(o),o}yS.exports={DEFAULT_CONFIG:mS,getAgentConfig:AM}});var SS=k((Pj,_S)=>{var{ContextManager:CM}=Nf(),{registerTools:bM}=kr(),{DEFAULT_TOOL_TIMEOUT_MS:RM,DEFAULT_APPROVAL_TIMEOUT_MS:IM}=Nt(),{getAgentConfig:xM}=Of(),{RiskLevel:PM,normalizeRiskLevel:kM}=yt();function NM(t){let e=t&&typeof t=="object"?t:{};return{enabled:e.enabled!==!1,topK:Number.isFinite(Number(e.topK))?Math.max(1,Math.floor(Number(e.topK))):5,minScore:Number.isFinite(Number(e.minScore))?Number(e.minScore):.2,maxContextChars:Number.isFinite(Number(e.maxContextChars))?Math.max(256,Math.floor(Number(e.maxContextChars))):6e3,autoSave:e.autoSave!==!1,memoryFirst:e.memoryFirst===!0,autoMemoryPrecheck:e.autoMemoryPrecheck===!0,fixedJsonlPaths:Array.isArray(e.fixedJsonlPaths)?e.fixedJsonlPaths:[],episodicStoreNodePath:typeof e.episodicStoreNodePath=="string"?e.episodicStoreNodePath:"",browserStoreName:typeof e.browserStoreName=="string"?e.browserStoreName:"agents_memory_v1"}}function MM(t,{llm:e,tools:n=[],systemPrompt:r="You are a helpful AI assistant.",toolTimeoutMs:o,approvalTimeoutMs:i,approvalPolicy:s,trustedTools:a,toolOutputLimits:l,maxTurns:c,compaction:f,maxProtectedRecentMessages:m,identity:h,riskProfile:y,ragConfig:_,ragService:T}={}){t.llm=e;let{toolMap:E,registry:w}=bM(n);t.tools=E,t.toolRegistry=w,t.systemPrompt=r,t.history=[],t.status="idle",t.currentPlan=null,t._decisionTraces=[],t._pendingUserInputs=new Map,t._pendingInputs=[],t._activeTools=new Map,t._lastStateMeta=null;let b=xM({agent:{maxTurns:c,compaction:f,toolOutputLimits:l,approvalPolicy:s,trustedTools:a}});t.maxTurns=typeof c=="number"&&Number.isFinite(c)&&c>0?Math.floor(c):b.agent.maxTurns,t.debug=!!b.agent.debug,t.compaction=b.agent.compaction||null,t.maxProtectedRecentMessages=typeof m=="number"&&Number.isFinite(m)&&m>0?Math.floor(m):b.agent.maxProtectedRecentMessages,t.toolTimeoutMs=typeof o=="number"&&Number.isFinite(o)&&o>0?o:RM,t.approvalTimeoutMs=typeof i=="number"&&Number.isFinite(i)&&i>0?i:IM,t.approvalPolicy=b.agent&&typeof b.agent.approvalPolicy=="string"?String(b.agent.approvalPolicy):"always",t.trustedTools=b.agent&&Array.isArray(b.agent.trustedTools)?b.agent.trustedTools.map(q=>String(q)).filter(Boolean):[],t.toolOutputLimits=b.agent&&b.agent.toolOutputLimits&&typeof b.agent.toolOutputLimits=="object"?{...b.agent.toolOutputLimits}:null;let L={...b.agent&&b.agent.rag&&typeof b.agent.rag=="object"?b.agent.rag:null,..._&&typeof _=="object"?_:null};t.ragConfig=NM(L),t.ragService=T||null,t._toolFailureStreak=new Map,t._approvalGrants=new Set,t._approvalDenies=new Set,t._approvalDeniedThisTurn=!1,t._approvalDenyHints=new Set,t._memoryFirstGuardCount=0,t._citationGuardCount=0,t._knowledgeSelectedThisTurn=[],t._knowledgeSelectedIdSet=new Set,t._abortController=null,t._abortReason=null,t._traceCollector=null;let D={id:"anonymous",tenantId:"default",role:"user"},I=h&&typeof h=="object"?{...D,...h}:D;t.identity=Object.freeze({...I});let P=kM(y&&y.tier,PM.NONE);t.riskProfile=Object.freeze({tier:P}),t.contextManager=new CM}_S.exports={initializeAgentState:MM}});var qi=k((kj,ES)=>{function pn(t){let e=Number(t);return Number.isFinite(e)?e:null}function OM(t){if(!t||typeof t!="object")return null;let e=pn(t.input_tokens??t.promptTokenCount??t.prompt_tokens),n=pn(t.cached_input_tokens??t.cachedContentTokenCount??t.cached_prompt_tokens??t.cachedPromptTokens),r=pn(t.output_tokens??t.candidatesTokenCount??t.completionTokenCount??t.completion_tokens),o=pn(t.reasoning_output_tokens??t.reasoningTokenCount??t.thoughtsTokenCount??t.reasoning_tokens),i=pn(t.total_tokens??t.totalTokenCount??t.total_tokens);return e===null&&n===null&&r===null&&o===null&&i===null?null:{input:e,cachedInput:n,output:r,reasoningOutput:o,total:i}}function DM(t,e){if(!t||typeof t!="object")return!1;let n=OM(e);return n?(n.input!==null&&(t._tokenUsagePrompt=n.input),n.cachedInput!==null&&(t._tokenUsageCachedInput=n.cachedInput),n.output!==null&&(t._tokenUsageCompletion=n.output),n.reasoningOutput!==null&&(t._tokenUsageReasoningOutput=n.reasoningOutput),n.total!==null&&(t._tokenUsageTotal=n.total),!0):!1}function Df(t){if(!t||typeof t!="object")return null;let e=pn(t._tokenUsagePrompt),n=pn(t._tokenUsageCachedInput),r=pn(t._tokenUsageCompletion),o=pn(t._tokenUsageReasoningOutput),i=pn(t._tokenUsageTotal);return i===null&&(e!==null||r!==null)&&(i=(e||0)+(r||0)),e===null&&n===null&&r===null&&o===null&&i===null?null:{input_tokens:e||0,cached_input_tokens:n||0,output_tokens:r||0,reasoning_output_tokens:o||0,total_tokens:i||0}}function TS(t){if(!Array.isArray(t))return null;let e=0,n=0,r=0,o=0,i=0,s=!1;for(let a of t){let l=Df(a);l&&(s=!0,e+=l.input_tokens,n+=l.cached_input_tokens,r+=l.output_tokens,o+=l.reasoning_output_tokens,i+=l.total_tokens)}return s?(!i&&(e||r)&&(i=e+r),{input_tokens:e,cached_input_tokens:n,output_tokens:r,reasoning_output_tokens:o,total_tokens:i}):null}function FM(t,e=null){let n=Array.isArray(t)&&t.length>0?Df(t[t.length-1]):null;return{info:{total_token_usage:TS(t)||null,last_token_usage:n||null,model_context_window:e},rate_limits:null}}ES.exports={applyUsageToEntry:DM,getUsageFromEntry:Df,getTotalUsageFromHistory:TS,buildTokenUsageInfo:FM}});var Ff=k((Nj,wS)=>{var{getUsageFromEntry:LM,getTotalUsageFromHistory:UM}=qi();function qM(t){if(typeof t!="string")return null;let e=Array.from(t.matchAll(/<final_answer>([\s\S]*?)<\/final_answer>/gi));if(e.length===0)return null;let n=e[e.length-1];return typeof n[1]=="string"?n[1].trim():null}function BM(t){if(typeof t!="string")return t;let e=t.split(`
`),n=0;for(;n<e.length&&!e[n].trim();)n+=1;let r=e[n]||"";if(!/^\s*Thought\s*:/i.test(r))return t;let o=[],i=!0;for(let s=n;s<e.length;s+=1){let a=e[s],l=a.trim();if(i){if(!l||/^\s*(Thought|Plan|Action)\s*:/i.test(a)||/^\s*(\d+\.|[-*])\s+/.test(a))continue;i=!1}o.push(a)}return o.join(`
`)}function GM(t){if(typeof t!="string"||!t.trim())return t;let e=qM(t),n=typeof e=="string"&&e.trim()?e:t;n===t&&(n=BM(n));let r=[/without explicitly stating/i,/do not include/i,/forbidden/i,/i will now summarize/i,/the previous model has already completed/i,/the information has been retrieved/i];return n.split(`
`).filter(s=>{let a=s.trim();return a?!r.some(l=>l.test(a)):!0}).join(`
`).trim()}function HM({history:t,finalResponseText:e,turnCount:n,modelContextWindow:r=null}){let o=LM(t[t.length-1]),i=UM(t);return{response:e||"Agent failed to produce a response within turn limit.",turnCount:n,historyLength:t.length,tokenUsage:{info:{total_token_usage:i||null,last_token_usage:o||null,model_context_window:r}}}}wS.exports={buildCompletionData:HM,sanitizeFinalResponse:GM}});var Lf=k((Mj,vS)=>{var{DEFAULT_TOOL_TIMEOUT_MS:$M}=Nt();function VM(t){if(!Number.isFinite(t)||t===0)return"Z";let e=t>0?"-":"+",n=Math.abs(t),r=String(Math.floor(n/60)).padStart(2,"0"),o=String(n%60).padStart(2,"0");return`${e}${r}:${o}`}function WM(){let t=new Date,e=t.toISOString(),n=VM(t.getTimezoneOffset()),r=null;try{typeof process<"u"&&process&&typeof process.cwd=="function"&&(r=process.cwd())}catch{r=null}let o=["<environment_context>",`  <timestamp>${e}</timestamp>`,`  <timezone_offset>${n}</timezone_offset>`];return typeof r=="string"&&r.length>0&&o.push(`  <cwd>${r}</cwd>`),o.push("</environment_context>"),o.join(`
`)}function JM(t,e,n){let r=typeof n=="number"&&Number.isFinite(n)&&n>0?n:$M;return new Promise(o=>{let i=t._pendingUserInputs.get(e);i&&typeof i.reject=="function"&&i.reject(new Error("Superseded by new request"));let s={done:!1,resolve:a=>{s.done||(s.done=!0,s.timer&&clearTimeout(s.timer),t._pendingUserInputs.delete(e),t&&typeof t.emit=="function"&&t.emit("user_input_response",{callId:e,timedOut:!1,value:a,timestamp:new Date().toISOString()}),o({timedOut:!1,value:a}))},reject:()=>{s.done||(s.done=!0,s.timer&&clearTimeout(s.timer),t._pendingUserInputs.delete(e),t&&typeof t.emit=="function"&&t.emit("user_input_response",{callId:e,timedOut:!0,value:null,timestamp:new Date().toISOString()}),o({timedOut:!0}))},timer:null};s.timer=setTimeout(()=>{s.done||(s.done=!0,t._pendingUserInputs.delete(e),t&&typeof t.emit=="function"&&t.emit("user_input_response",{callId:e,timedOut:!0,value:null,timestamp:new Date().toISOString()}),o({timedOut:!0}))},r),s.timer&&typeof s.timer.unref=="function"&&s.timer.unref(),t._pendingUserInputs.set(e,s)})}function zM(t,e,n){let r=e;if(!r){if(t._pendingUserInputs.size!==1)return!1;r=Array.from(t._pendingUserInputs.keys())[0]}let o=t._pendingUserInputs.get(r);return!o||typeof o.resolve!="function"?!1:(o.resolve(n),!0)}function KM(t,e){let n=typeof e=="string"?e.trim():"";return n?(Array.isArray(t._pendingInputs)||(t._pendingInputs=[]),t._pendingInputs.push(n),t.emit("pending_input_queued",{content:n,timestamp:new Date().toISOString()}),!0):!1}function YM(t){if(!Array.isArray(t._pendingInputs)||t._pendingInputs.length===0)return[];let e=t._pendingInputs.slice();return t._pendingInputs=[],e}vS.exports={awaitUserInput:JM,respondToUserInput:zM,submitPendingInput:KM,drainPendingInputs:YM,buildEnvironmentContext:WM}});var CS=k((Oj,AS)=>{var{buildCompletionData:jM}=Ff(),{buildEnvironmentContext:XM}=Lf();function QM(t){return(...e)=>{t.debug&&console.log("[Debug]",...e)}}function ZM(t){t.currentPlan=null,t._decisionTraces=[],t._pendingInputs=[],t._toolFailureStreak=new Map,t._approvalGrants.clear(),t._approvalDenies.clear(),t._approvalDeniedThisTurn=!1,t._memoryFirstGuardCount=0,t._citationGuardCount=0,t._approvalDenyHints&&t._approvalDenyHints.clear(),Array.isArray(t._knowledgeSelectedThisTurn)?t._knowledgeSelectedThisTurn.length=0:t._knowledgeSelectedThisTurn=[],t._knowledgeSelectedIdSet instanceof Set?t._knowledgeSelectedIdSet.clear():t._knowledgeSelectedIdSet=new Set;let e=t.history.length;return t._turnStartIndex=e,e}function eO(t,e){console.log(`
--- [Agent] Starting Turn: "${e}" ---`);let n=QM(t),r=ZM(t);return t.emit("start",{message:e}),t.emit("turn_started",{message:e,timestamp:new Date().toISOString()}),t.history.push({role:"user",content:XM()}),t.history.push({role:"user",content:e}),t._setState("thinking",{input:e,step:0}),{dbg:n,turnStartIndex:r}}function tO({agent:t,finalResponseText:e,turnCount:n,maxTurns:r,dbg:o}){t._setState("idle",{finalResponse:e||null,turnCount:n}),t.emit("autosave",t.dumpSnapshot()),t._turnStartIndex=null;let i=jM({history:t.history,finalResponseText:e,turnCount:n});return t.emit("done",i),t.emit("agent_turn_complete",i),e||o("Turn limit reached",{turnCount:n,maxTurns:r,historyLength:t.history.length}),e||"Agent failed to produce a response within turn limit."}AS.exports={startAgentTurn:eO,finalizeAgentTurn:tO}});var RS=k((Dj,bS)=>{async function nO({agent:t,stream:e,turnCount:n,currentStepResponse:r,signal:o}){let i=!1;for await(let s of e){if(o&&o.aborted){let a=o.reason instanceof Error?o.reason:new Error("Aborted");throw a.name="AbortError",a}s.type==="text"?(i||(t.emit("assistant_message_started",{step:n}),i=!0),r.content+=s.delta,t.emit("agent_message_content_delta",{delta:s.delta,step:n})):s.type==="tool_calls"&&r.tool_calls.push(...s.tool_calls)}return r}bS.exports={runLlmStreamStep:nO}});var Uf=k((Fj,PS)=>{function rO(t){if(typeof t!="string")return"";let e=t.trim();if(!e)return"";let n=e.match(/^(.+?[.!?])\s/);return n?n[1]:e}function IS(t,e=160){let n=rO(t).replace(/\s+/g," ").trim();return n.length<=e?n:`${n.slice(0,e)}...`}function oO(t){if(typeof t!="string")return"";let e=t.match(/(?:^|\n)\s*Thought:\s*(.+)/i);return e?IS(e[1]):""}function iO(t){if(typeof t!="string")return null;let e=t.split(`
`),n=e.findIndex(o=>/^\s*Plan\s*:/i.test(o));if(n<0)return null;let r=0;for(let o=n+1;o<e.length;o+=1){let i=e[o].trim();if(i){if(/^\s*Action\s*:/i.test(i))break;/^(\d+\.|[-*])\s+/.test(i)&&(r+=1)}}return r>0?r:null}function xS(t){let e=oO(t),n=iO(t);return!e&&n==null?null:{thought:e,planSteps:n}}function sO(t){return!!xS(t)}function aO(t,e,n){if(!t||typeof t.emit!="function"||!Array.isArray(e)||e.length===0)return;let r=Array.from(new Set(e.map(s=>s&&s.name?String(s.name):"").filter(Boolean))),o=r.length?r.join(", "):"unknown_tool",i=IS(`Calling tools: ${o}.`,160);t.emit("decision_trace",{step:n,thought:i,planSteps:e.length,timestamp:new Date().toISOString()})}function lO(t,e,n){if(!t||typeof t.emit!="function")return;let r=xS(e);if(!r)return;let o={step:n,thought:r.thought||null,planSteps:r.planSteps,timestamp:new Date().toISOString()};Array.isArray(t._decisionTraces)&&(t._decisionTraces.push(o),t._decisionTraces.length>200&&(t._decisionTraces=t._decisionTraces.slice(-200))),t.emit("decision_trace",{step:o.step,thought:o.thought,planSteps:o.planSteps,timestamp:o.timestamp})}PS.exports={emitDecisionTrace:lO,canExtractDecisionTrace:sO,emitToolCallDecisionTrace:aO}});var NS=k((Lj,kS)=>{var{runLlmStreamStep:uO}=RS(),{emitDecisionTrace:cO,canExtractDecisionTrace:fO,emitToolCallDecisionTrace:dO}=Uf(),{getToolIntent:pO,getToolRisk:hO}=kr();function mO(t){if(t==null)return null;if(typeof t=="object")return t;if(typeof t!="string")return{_raw:String(t)};try{return JSON.parse(t)}catch{return{_raw:t}}}function gO(t){return t.some(e=>e&&!(e.thought_signature||e.thoughtSignature))}async function yO({agent:t,llm:e,systemPrompt:n,llmHistory:r,turnCount:o,signal:i}){let s={content:"",tool_calls:[]},a=!1;if(i&&i.aborted){let m=i.reason instanceof Error?i.reason:new Error("Aborted");throw m.name="AbortError",m}if(typeof e.chatStream=="function"){let m=e.chatStream(n,r,{signal:i});s=await uO({agent:t,stream:m,turnCount:o,currentStepResponse:s,signal:i}),a=!0}else{let m=await e.chat(n,r,{signal:i});s=m,m&&m.usage&&(s._usage=m.usage)}await(async()=>{if(!a||typeof e.chat!="function")return;let m=Array.isArray(s.tool_calls)?s.tool_calls:[];if(!(m.length===0||!gO(m)))try{let h=await e.chat(n,r,{signal:i});h&&h.usage&&(s._usage=h.usage),h&&Array.isArray(h.tool_calls)&&h.tool_calls.length>0&&(s.tool_calls=h.tool_calls)}catch{}})();let c=s&&typeof s.content=="string"?s.content:"",f=s&&Array.isArray(s.tool_calls)?s.tool_calls:[];if(i&&i.aborted){let m=i.reason instanceof Error?i.reason:new Error("Aborted");throw m.name="AbortError",m}if(c&&cO(t,c,o),f.length>0&&c&&!fO(c)&&dO(t,f,o),f.length>0){let m=f.map(h=>{let y=h&&h.name?String(h.name):"",_=mO(h&&h.arguments),T=pO(t,y,_),E=hO(t,y,h);return{...h,intent:T||void 0,risk:E}});t.emit("tool_call",{tools:f.map(h=>h.name),details:m})}return s}kS.exports={runLlmStep:yO}});var qf=k((Uj,FS)=>{function _O(t){if(typeof t!="string")return!1;let e=t.toLowerCase(),r=["weather","forecast","stock","price","prices","exchange rate","fx","news"].some(a=>e.includes(a)),o=/\b(current time|time now)\b/i.test(e),i=/\brate\b/i.test(e),s=/\b[a-z]{3}\b/i.test(e);return o||r||i&&s}var SO=new Set(["memory_search","kb_search","memory__search_nodes","memory_read_graph","memory__read_graph"]),TO=new Set(["searxng_query","read_url"]);function MS(t){return String(t||"").trim().toLowerCase()}function OS(t){return SO.has(MS(t))}function DS(t){return TO.has(MS(t))}function EO(t,e){if(!Array.isArray(t))return!1;for(let n=Math.max(0,e);n<t.length;n++){let r=t[n];if(!(!r||typeof r!="object")&&((r.role==="system"||r.role==="tool")&&r.tool_call_id||r.role==="assistant"&&Array.isArray(r.tool_calls)&&r.tool_calls.length>0))return!0}return!1}function wO(t,e){if(!Array.isArray(t))return!1;for(let n=Math.max(0,e);n<t.length;n++){let r=t[n];if(!(!r||typeof r!="object")&&!(r.role!=="system"&&r.role!=="tool"||!r.tool_call_id)&&OS(r.name))return!0}return!1}function vO(t){if(!Array.isArray(t))return!1;for(let e of t)if(!(!e||typeof e!="object")&&DS(e.name))return!0;return!1}function AO(t,e){if(!Array.isArray(t))return!1;let n=new Set(["update_plan","list_available_skills","read_skill_documentation","request_user_input"]);for(let r=Math.max(0,e);r<t.length;r++){let o=t[r];if(!(!o||typeof o!="object")&&o.role==="assistant"&&Array.isArray(o.tool_calls)&&o.tool_calls.length>0)for(let i of o.tool_calls){let s=i&&i.name?String(i.name):"";if(s&&!n.has(s))return!0}}return!1}function CO(t){return Array.isArray(t)?t.filter(e=>e&&typeof e=="object").filter(e=>e.status==="pending"||e.status==="in_progress").map(e=>typeof e.step=="string"?e.step:"").filter(Boolean):[]}function bO(t){if(typeof t!="string")return!1;let e=t.toLowerCase();return/(?:\bmy\b|\bmine\b|\bme\b|\bi\s+am\b|\bi'm\b|\bremember\b|\bdo you remember\b|\bwhat(?:'s| is)\s+my\b|\bwho am i\b|\bmy\s+favorite\b|\bmy\s+car\b|\bmy\s+name\b)/i.test(e)}function RO(t){if(typeof t!="string")return[];let e=t.toLowerCase(),n=e.replace(/[^a-z0-9\s_-]/g," ").split(/\s+/).filter(Boolean),r=new Set(["the","a","an","and","or","but","to","of","for","with","in","on","at","by","about","what","whats","what's","is","are","was","were","do","does","did","my","mine","me","i","am","i'm","remember","please","tell","color"]),o=n.filter(l=>l.length>1&&!r.has(l)),i=o.includes("car")||e.includes("car"),s=e.includes("color")||e.includes("colour"),a=[];i&&s&&a.push("car color"),i&&a.push("car"),s&&a.push("color");for(let l of o)a.includes(l)||a.push(l);return a.slice(0,3)}function qa(t){if(!t||typeof t.content!="string")return null;try{return JSON.parse(t.content)}catch{return null}}function IO(t){if(!Array.isArray(t)||t.length===0)return null;let e=[];for(let n of t){let r=qa(n);if(!r||typeof r!="object")continue;let o=r.structuredContent&&typeof r.structuredContent=="object"?r.structuredContent:null,i=o&&typeof o.error=="string"?o.error:null;(i==="ApprovalDenied"||i==="ApprovalTimeout")&&e.push({tool:n&&n.name?String(n.name):null,callId:n&&n.tool_call_id?String(n.tool_call_id):null,error:i})}return e.length>0?e:null}function xO(t){let e=t.map(o=>o&&o.tool?o.tool:"").filter(Boolean),n=Array.from(new Set(e));return`User denied approval for: ${n.length?n.join(", "):"the requested tool(s)"}.
Update your plan: mark the related step(s) as blocked/cannot-complete, then continue with a partial answer using the approved tool results.
Do not keep re-requesting the same tool unless the user explicitly asks to try again or changes their decision.`}function PO({toolResults:t}){if(!Array.isArray(t)||t.length===0)return 0;let e=new Set(["update_plan","list_available_skills","read_skill_documentation","request_user_input"]),n=0;for(let r of t){let o=r&&r.name?String(r.name):"";if(o&&e.has(o))continue;let i=qa(r);if(!i||typeof i!="object")continue;if(i.isError===!1){n+=1;continue}let s=i.structuredContent&&typeof i.structuredContent=="object"?i.structuredContent:null;!(s&&typeof s.error=="string"&&s.error.length>0)&&i.isError!==!0&&(n+=1)}return n}function kO({history:t,startIndex:e}){if(!Array.isArray(t))return!1;let n=typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):0,r=new Set(["update_plan","list_available_skills","read_skill_documentation","request_user_input"]);for(let o=n;o<t.length;o+=1){let i=t[o];if(!i||typeof i!="object")continue;let s=i&&i.name?String(i.name):"";if(s&&r.has(s)||!((i.role==="system"||i.role==="tool")&&i.tool_call_id&&s))continue;let a=qa(i);if(!a||typeof a!="object")continue;if(a.isError===!1)return!0;let l=a.structuredContent&&typeof a.structuredContent=="object"?a.structuredContent:null;if(!(l&&typeof l.error=="string"&&l.error.length>0)&&a.isError!==!0)return!0}return!1}function NO(t){if(!t||typeof t!="object")return"";if(Array.isArray(t.content)){let e=t.content.filter(n=>n&&n.type==="text"&&typeof n.text=="string").map(n=>n.text).join(`
`);if(e.trim())return e.trim()}if(t.structuredContent!==void 0)try{return JSON.stringify(t.structuredContent,null,2)}catch{return String(t.structuredContent)}return""}function MO(t){if(!t||typeof t!="object")return!0;if(Array.isArray(t.structuredContent))return t.structuredContent.length===0;if(t.structuredContent&&typeof t.structuredContent=="object"){let e=t.structuredContent.hits;if(Array.isArray(e))return e.length===0;let n=t.structuredContent.nodes;if(Array.isArray(n))return n.length===0}if(Array.isArray(t.content)){let e=t.content.map(n=>n&&n.text?String(n.text):"").join(" ");if(!e.trim()||/\bno\s+results\b|\bnone\b|\bempty\b|\[\s*\]/i.test(e))return!0}return!1}FS.exports={buildMemoryQueries:RO,countSuccessfulEvidenceTools:PO,detectApprovalBlock:IO,formatApprovalBlockedHint:xO,formatMemoryResult:NO,getPendingPlanSteps:CO,hasAnyTurnEvidence:kO,hasMemoryToolActivitySince:wO,hasEvidenceToolActivitySince:AO,hasToolActivitySince:EO,hasWebSearchToolRequested:vO,isEmptyMemorySearchResult:MO,isMemoryToolName:OS,isPersonalMemoryQuery:bO,isRealtimeQuery:_O,isWebSearchToolName:DS,parseToolResultContent:qa}});var US=k((qj,LS)=>{function OO(t,e=240){let n=String(t||"").trim().replace(/\s+/g," ");return n.length<=e?n:`${n.slice(0,Math.max(0,e-3))}...`}function DO({userInput:t}){let e=String(t||"").trim();if(!e)return null;let n=[{type:"fact",title:"User name",regex:/\bmy\s+name\s+is\s+([^\n.,!?]{2,80})/i,map:r=>`User says their name is ${r[1].trim()}.`},{type:"preference",title:"User preference",regex:/\bmy\s+favorite\s+([^\n.,!?]{2,60})\s+is\s+([^\n.,!?]{2,120})/i,map:r=>`Favorite ${r[1].trim()}: ${r[2].trim()}.`},{type:"preference",title:"User preference",regex:/\bi\s+(?:like|love|prefer)\s+([^\n.,!?]{3,120})/i,map:r=>`User preference: ${r[1].trim()}.`},{type:"note",title:"Remembered note",regex:/\bremember\s+that\s+([^\n]{4,200})/i,map:r=>r[1].trim()}];for(let r of n){let o=e.match(r.regex);if(!o)continue;let i=OO(r.map(o),220);return i?{type:r.type,title:r.title,content:i,metadata:{tags:["auto_saved"],source:"agentic_rag_policy"}}:null}return null}function FO(t){return!!(t&&t.ragConfig&&t.ragConfig.enabled&&t.ragConfig.autoSave)}LS.exports={buildAutoSavePayload:DO,shouldAutoSave:FO}});var Bf=k((Bj,$S)=>{function Mt(t){return String(t??"").trim()}var LO=new Set(["kb_search","memory_search","memory__search_nodes"]);function BS(t){return LO.has(Mt(t).toLowerCase())}function UO(t){let e=Number(t);return Number.isFinite(e)?e:null}function qS(t){if(!t||typeof t!="object")return null;let e=Mt(t.id);if(!e)return null;let n=Mt(t.title)||e,r=UO(t.score),o=Mt(t.source||t.source_path||t.file||""),i=Array.isArray(t.source_pages)?t.source_pages.map(s=>Number(s)).filter(s=>Number.isFinite(s)).map(s=>Math.trunc(s)):[];return{id:e,title:n,score:r,source:o,sourcePages:i,type:Mt(t.type||""),updatedAt:Mt(t.updated_at||"")}}function qO(t,e){return!e||typeof e!="object"?[]:Array.isArray(e.hits)?e.hits.map(qS).filter(Boolean):t==="memory__search_nodes"&&Array.isArray(e.nodes)?e.nodes.map(qS).filter(Boolean):[]}function BO(t){if(!t||typeof t!="object")return null;let e=t.structuredContent;return e&&typeof e=="object"?e:null}function GO({toolName:t,args:e,parsedToolResult:n,maxSelected:r=6,minScore:o=null}={}){if(!BS(t))return null;let i=BO(n);if(!i)return null;let s=qO(t,i);if(s.length===0||(typeof o=="number"&&Number.isFinite(o)&&(s=s.filter(c=>!(typeof c.score=="number"&&c.score<o))),s.length===0))return null;let a=Number.isFinite(Number(r))?Math.max(1,Math.floor(Number(r))):6,l=s.slice(0,a);return{tool:Mt(t),query:Mt(e&&e.query),scope:Mt(e&&e.scope),count:l.length,totalHits:s.length,selected:l}}function GS(t){let e=String(t||"");if(!e)return[];let n=/\[source:\s*#?([a-z0-9._:-]+)(?:\s+p\.?\s*(\d+))?\s*\]/ig,r=[],o=n.exec(e);for(;o;){let i=Mt(o[1]),s=o[2],a=Number.isFinite(Number(s))?Math.trunc(Number(s)):null;i&&r.push({id:i,page:a}),o=n.exec(e)}return r}function HS(t){let e=GS(t);return Array.from(new Set(e.map(n=>n.id).filter(Boolean)))}function HO({text:t,knowledgeIds:e}={}){let n=Array.isArray(e)?e.map(o=>Mt(o)).filter(Boolean):[];if(n.length===0)return!0;let r=new Set(HS(t));for(let o of n)if(r.has(o))return!0;return!1}function $O({knowledgeIds:t=[]}={}){let e=Array.isArray(t)?t.map(r=>Mt(r)).filter(Boolean).slice(0,6):[];return`Citation required: Your final answer used knowledge evidence. Add inline citations in this exact format: [source:#<id> p.<page>]. Example ids from this turn: ${e.length>0?e.join(", "):"knowledge_id"}.`}$S.exports={extractCitationEntriesFromText:GS,extractCitationIdsFromText:HS,extractKnowledgeSelectionFromParsed:GO,hasCitationForKnowledge:HO,isKnowledgeToolName:BS,buildCitationReminder:$O}});var WS=k((Gj,VS)=>{var{parseToolResultContent:VO}=qf(),{extractKnowledgeSelectionFromParsed:WO,isKnowledgeToolName:JO}=Bf();function zO(t){if(!t)return null;if(typeof t=="object")return t;if(typeof t!="string")return null;try{let e=JSON.parse(t);return e&&typeof e=="object"?e:null}catch{return null}}function KO(t){let e=new Map;if(!Array.isArray(t))return e;for(let n of t){if(!n||typeof n!="object")continue;let r=n.id?String(n.id):"";r&&e.set(r,n)}return e}function YO(t){return(Array.isArray(t&&t.selected)?t.selected:[]).map(n=>n&&n.id?String(n.id).trim():"").filter(Boolean)}function jO({agent:t,toolCalls:e,toolResults:n,turnCount:r}){if(!t||typeof t!="object"||!Array.isArray(n)||n.length===0)return 0;Array.isArray(t._knowledgeSelectedThisTurn)||(t._knowledgeSelectedThisTurn=[]),t._knowledgeSelectedIdSet instanceof Set||(t._knowledgeSelectedIdSet=new Set);let o=t._knowledgeSelectedIdSet,i=KO(e),s=0;for(let a=0;a<n.length;a+=1){let l=n[a],c=l&&l.tool_call_id?String(l.tool_call_id):"",f=c&&i.get(c)||(Array.isArray(e)?e[a]:null),m=String(l&&l.name||f&&f.name||"").trim();if(!JO(m))continue;let h=VO(l),y=zO(f&&f.arguments),_=WO({toolName:m,args:y,parsedToolResult:h,maxSelected:6,minScore:Number.isFinite(Number(t.ragConfig&&t.ragConfig.minScore))?Number(t.ragConfig.minScore):null});if(!_)continue;let T=YO(_);if(T.length===0)continue;let E=[];for(let b of T)o.has(b)||(o.add(b),E.push(b));let w={..._,callId:c||(f&&f.id?String(f.id):""),step:Number.isFinite(Number(r))?Number(r):null,selectedIds:T,newSelectedIds:E,timestamp:new Date().toISOString()};t._knowledgeSelectedThisTurn.push(w),typeof t.emit=="function"&&t.emit("knowledge_selected",w),s+=1}return s}VS.exports={recordKnowledgeSelections:jO}});var Gf=k((Hj,KS)=>{var{buildSyntheticToolPlan:XO}=bf(),{applyUsageToEntry:QO,buildTokenUsageInfo:ZO}=qi(),{emitDecisionTrace:eD}=Uf(),{buildMemoryQueries:tD,countSuccessfulEvidenceTools:nD,detectApprovalBlock:rD,formatApprovalBlockedHint:oD,formatMemoryResult:iD,getPendingPlanSteps:sD,hasAnyTurnEvidence:aD,hasMemoryToolActivitySince:lD,hasEvidenceToolActivitySince:uD,hasToolActivitySince:cD,hasWebSearchToolRequested:fD,isEmptyMemorySearchResult:dD,isPersonalMemoryQuery:pD,isRealtimeQuery:hD,parseToolResultContent:Bi}=qf(),{buildAutoSavePayload:mD,shouldAutoSave:gD}=US(),{recordKnowledgeSelections:JS}=WS();function zS(t){if(!t||!t.tools)return!1;let e=t.tools;return!!(e.memory_search||e.kb_search||e.memory__search_nodes||e.memory_read_graph||e.memory__read_graph)}async function yD({agent:t,userInput:e}){if(!t||!zS(t))return!1;let n=!!(t.ragConfig&&t.ragConfig.enabled&&t.tools.memory_search);if(!n&&!pD(e))return!1;let r=t.tools.memory_search,o=t.tools.kb_search,i=t.tools.memory__search_nodes,s=t.tools.memory_read_graph||t.tools.memory__read_graph;if(!o&&!r&&!i&&!s)return!1;let a=tD(e);if(!n&&a.length===0)return!1;let l=!1,c=null,f=y=>`auto_mem_${Date.now()}_${y}`,m=(y,_)=>{!y||!Array.isArray(_)||_.length===0||JS({agent:t,toolCalls:[y],toolResults:_,turnCount:null})};if(n){let y=t.ragConfig&&Number.isFinite(Number(t.ragConfig.topK))?Number(t.ragConfig.topK):5,_=t.ragConfig&&Number.isFinite(Number(t.ragConfig.minScore))?Number(t.ragConfig.minScore):.2,T=Math.max(_,.35);if(o){let E={id:f("kb"),name:"kb_search",arguments:JSON.stringify({query:e,topK:y,minScore:T})},w=await t._executeTools([E]);m(E,w);let b=Bi(w[0]);c=b,b&&b.structuredContent&&Array.isArray(b.structuredContent.hits)&&b.structuredContent.hits.length>0&&(l=!0)}if(!l&&r){let E={id:f("rag"),name:"memory_search",arguments:JSON.stringify({query:e,topK:y,minScore:T,scope:"all"})},w=await t._executeTools([E]);m(E,w);let b=Bi(w[0]);c=b,b&&b.structuredContent&&Array.isArray(b.structuredContent.hits)&&b.structuredContent.hits.length>0&&(l=!0)}}for(let y=0;y<a.length&&!(l||!i);y+=1){let _={id:f(y),name:"memory__search_nodes",arguments:JSON.stringify({query:a[y]})},T=await t._executeTools([_]);m(_,T);let E=Bi(T[0]);if(c=E,E&&!dD(E)){l=!0;break}}if(!l&&s){let y={id:f("read"),name:"memory__read_graph",arguments:JSON.stringify({})},_=await t._executeTools([y]);c=Bi(_[0])}let h=iD(c);return h?t.history.push({role:"user",content:`Memory lookup (auto):
${h}`}):t.history.push({role:"user",content:"Memory lookup (auto): no results found."}),!0}async function _D({agent:t,userInput:e}){if(!t||!t.tools||!t.tools.memory_save||!gD(t))return!1;let n=mD({userInput:e});if(!n)return!1;let r={id:`auto_mem_save_${Date.now()}`,name:"memory_save",arguments:JSON.stringify(n)},o=await t._executeTools([r]),i=Bi(o[0]);return!i||!i.structuredContent||i.structuredContent.ok!==!0?!1:(t.history.push({role:"user",content:`Memory autosave (auto): saved id=${i.structuredContent.id}`}),!0)}async function SD({agent:t,currentStepResponse:e,turnCount:n}){if(!e.tool_calls||e.tool_calls.length===0)return{handled:!1};let r=zS(t),o=fD(e.tool_calls),i=lD(t.history,t&&t._turnStartIndex);if(!!(t&&t.ragConfig&&t.ragConfig.memoryFirst===!0)&&r&&o&&!i){let h=Number(t._memoryFirstGuardCount||0);if(h<2)return t._memoryFirstGuardCount=h+1,t.history.push({role:"user",content:"Policy reminder: Call kb_search or memory_search first. Use web search only if local JSONL/memory evidence is insufficient."}),typeof t.emit=="function"&&t.emit("memory_first_guard",{attempt:t._memoryFirstGuardCount,tools:e.tool_calls.map(y=>y&&y.name?String(y.name):"").filter(Boolean)}),{handled:!0}}if(!e.content){let h=XO(e.tool_calls);eD(t,h,n),t.emit("assistant_message_started",{step:n}),t.emit("agent_message_content_delta",{delta:h,step:n}),t.history.push({role:"assistant",content:h})}let l={role:"assistant",content:e.content||null,tool_calls:e.tool_calls},c=QO(l,e._usage);t.history.push(l),c&&t.emit("token_count",ZO(t.history));let f=await t._executeTools(e.tool_calls);t.history.push(...f),JS({agent:t,toolCalls:e.tool_calls,toolResults:f,turnCount:n});let m=rD(f);if(m){t&&(t._approvalDeniedThisTurn=!0);let h=0;if(t&&t.tools)for(let y of m){let _=y&&y.tool?t.tools[y.tool]:null,T=_&&typeof _.risk=="number"?_.risk:2;T>h&&(h=T)}if(h>=2){let y=m.map(w=>w.tool).filter(Boolean).join(", "),_=m[0]&&m[0].error?m[0].error:"ApprovalDenied",T=nD({toolResults:f}),E=aD({history:t&&t.history,startIndex:t&&t._turnStartIndex});if(t&&typeof t.emit=="function"&&t.emit("approval_blocked",{tools:m,reason:_,successCount:T,turnEvidence:E,timestamp:new Date().toISOString()}),T===0&&!E){let w=`I can't continue because approval was not granted for tool(s): ${y}.

If you want me to use those tools, please approve. Otherwise, tell me what assumptions/region you want and I can give a best-effort, non-verified answer.`;return{handled:!0,stopTurn:!0,stopReason:_,message:w}}if(t&&Array.isArray(t.history)){t._approvalDenyHints||(t._approvalDenyHints=new Set);let w=`${_}:${y}`;t._approvalDenyHints.has(w)||(t._approvalDenyHints.add(w),t.history.push({role:"user",content:oD(m)}))}}}return{handled:!0}}KS.exports={handleToolCalls:SD,isRealtimeQuery:hD,hasToolActivitySince:cD,hasEvidenceToolActivitySince:uD,getPendingPlanSteps:sD,maybeAutoMemoryLookup:yD,maybeAutoMemorySave:_D}});var jS=k(($j,YS)=>{var{isRealtimeQuery:TD,hasEvidenceToolActivitySince:ED,getPendingPlanSteps:wD}=Gf(),{hasCitationForKnowledge:vD,buildCitationReminder:AD}=Bf();function CD({agent:t,userInput:e,turnStartIndex:n,currentStepResponse:r,realtimeGuardCount:o,planGuardCount:i}){let s=TD(e),a=ED(t.history,n),l=!r.content||!String(r.content).trim();if(s&&!a&&o<2){let m=o+1,h=m===1?"Reminder: This request asks for real-time data. You MUST call the relevant tools before providing a final answer.":"Final reminder: Call the relevant tools for real-time data before responding.";return t.history.push({role:"user",content:h}),t.emit("realtime_tool_guard",{message:e,attempt:m,emptyAnswer:l}),{shouldContinue:!0,realtimeGuardCount:m,planGuardCount:i}}let c=t&&t._knowledgeSelectedIdSet instanceof Set?Array.from(t._knowledgeSelectedIdSet):[];if(c.length>0){let m=Number(t&&t._citationGuardCount||0);if(!vD({text:r&&r.content,knowledgeIds:c})&&m<2){let y=m+1;return t&&(t._citationGuardCount=y),t.history.push({role:"user",content:AD({knowledgeIds:c})}),t.emit("citation_guard",{attempt:y,knowledgeIds:c}),{shouldContinue:!0,realtimeGuardCount:o,planGuardCount:i}}}let f=wD(t.currentPlan);if(f.length>0&&i<1&&!(t&&t._approvalDeniedThisTurn)){let m=i+1;return t.history.push({role:"user",content:`Reminder: You have pending plan steps. Complete them (use tools) before final answer. Pending: ${f.join(" | ")}`}),t.emit("plan_completion_guard",{attempt:m,pendingCount:f.length}),{shouldContinue:!0,realtimeGuardCount:o,planGuardCount:m}}return{shouldContinue:!1,realtimeGuardCount:o,planGuardCount:i}}YS.exports={applyTurnGuards:CD}});var nT=k((Vj,tT)=>{var XS="Another language model started to solve this problem and produced a summary of its thinking process. You also have access to the state of the tools that were used by that language model. Use this to build on the work that has already been done and avoid duplicating work. Here is the summary produced by the other language model, use the information in this summary to assist with your own analysis:";function QS(t){if(!t||t.role!=="user"||typeof t.content!="string")return!1;let e=t.content.trimStart();return e.startsWith("# AGENTS.md instructions for ")||e.startsWith("<user_instructions>")||e.startsWith("<skill")}function ZS(t){return!t||t.role!=="user"||typeof t.content!="string"?!1:t.content.trimStart().toLowerCase().startsWith("<environment_context>")}function bD(t){return!t||t.role!=="user"||typeof t.content!="string"?!1:t.content.trimStart().toLowerCase().startsWith("<turn_aborted>")}function eT(t){return!t||t.role!=="user"||typeof t.content!="string"?!1:t.content.startsWith(XS)}function RD(t){return QS(t)||ZS(t)||eT(t)}function ID(t){if(!t||t.role!=="user"||typeof t.content!="string")return!1;let e=t.content.trimStart(),n=e.toLowerCase();return e.startsWith("# AGENTS.md instructions for ")||e.startsWith("<user_instructions>")||e.startsWith("<skill")||n.startsWith("<environment_context>")||n.startsWith("<turn_aborted>")}tT.exports={SUMMARY_PREFIX:XS,isStrongInstruction:QS,isEnvironmentContext:ZS,isTurnAborted:bD,isSummaryMessage:eT,isSessionPrefixMessage:RD,isInstructionLikeUserMessage:ID}});var oT=k((Wj,rT)=>{function xD(t,e){let n=typeof t=="string"?t:"";return!Number.isFinite(e)||e<=0||n.length<=e?n:n.slice(0,e)+"..."}function PD(t){return typeof t!="string"?"":t.split(`
`).filter(r=>{let o=r.trim();if(!o)return!1;let i=o.toLowerCase();return!(i.startsWith("rules:")||i.startsWith("rule:")||i.includes("forbidden")||i.includes("do not")||i.includes("must")||i.includes("should")||i.includes("not listing")||i.includes("summary prompt"))}).join(`
`).trim()}rT.exports={truncateText:xD,sanitizeSummaryText:PD}});var uT=k((Jj,lT)=>{var{estimateTextTokens:kD}=La(),{SUMMARY_PREFIX:iT,isStrongInstruction:ND,isEnvironmentContext:MD,isTurnAborted:OD}=nT(),{truncateText:DD,sanitizeSummaryText:FD}=oT(),sT=["You are performing a CONTEXT CHECKPOINT COMPACTION. Create a handoff summary for another LLM that will resume the task.","","Include:","- Current progress and key decisions made","- Important context, constraints, or user preferences","- What remains to be done (clear next steps)","- Any critical data, examples, or references needed to continue","","Rules:","- Do NOT include real-time or volatile values (prices, exchange rates, news details). Instead, say they were retrieved.","- Do NOT introduce unrelated topics from older tasks unless they are still active requirements.","- Keep the summary focused on the current user intent and active work.","- You are FORBIDDEN from listing specific numeric values, timestamps, or prices.","- Summarize only task state, constraints, and decisions; omit detailed observations.","","Be concise, structured, and focused on helping the next LLM seamlessly continue the work."].join(`
`);function LD(t){if(!t||typeof t!="object")return 0;let e="";if(typeof t.content=="string")e=t.content;else if(t.content!=null)try{e=JSON.stringify(t.content)}catch{e="[unserializable content]"}let n="";if(t.tool_calls!=null)try{n=JSON.stringify(t.tool_calls)}catch{n="[unserializable tool_calls]"}let r=typeof t.role=="string"?t.role:"";return kD(`${r}:${e}${n?`
${n}`:""}`)}function UD(t){if(!Array.isArray(t)||t.length===0)return 0;let e=0;for(let n of t)e+=LD(n);return e}function qD(t,e){if(!t||typeof t!="object")return"";let n=typeof t.role=="string"?t.role:"unknown",r="";if(typeof t.content=="string")r=t.content;else try{r=JSON.stringify(t.content)}catch{r="[unserializable content]"}return`${n.toUpperCase()}: ${DD(r,e)}`}function BD(t,{maxChars:e=2e4,perMessageLimit:n=2e3}={}){let r=[],o=0;for(let i of t){let s=qD(i,n);if(!s)continue;let a=o+s.length+1;if(a>e)break;r.push(s),o=a}return r.join(`
`)}function GD(t,e){let n=new Set,r=-1,o=-1;for(let i=0;i<t.length;i++){let s=t[i];MD(s)&&(r=i),OD(s)&&(o=i),ND(s)&&n.add(i)}r>=0&&n.add(r),o>=0&&n.add(o);for(let i of Array.from(n))i>=e&&n.delete(i);return n}async function aT({history:t,llm:e,config:n,signal:r}){if(!Array.isArray(t)||t.length===0)return{history:Array.isArray(t)?t:[],compacted:!1,originalLength:0};let o=n||{};if(o.enabled===!1)return{history:t,compacted:!1,originalLength:t.length};let i=Number.isFinite(o.triggerMessages)?o.triggerMessages:120,s=Number.isFinite(o.triggerTokens)?o.triggerTokens:null,a=s&&s>0?UD(t):null,l=a!=null?a>s:!1;if(!(t.length>i)&&!l)return{history:t,compacted:!1,originalLength:t.length};let f=Number.isFinite(o.keepRecentMessages)?o.keepRecentMessages:10,m=Math.max(0,t.length-f),h=GD(t,m),y=Array.from(h).sort((I,P)=>I-P).map(I=>t[I]),_=t.filter((I,P)=>!h.has(P)&&P<m);if(_.length===0)return{history:t,compacted:!1,originalLength:t.length};let T=BD(_,{maxChars:Number.isFinite(o.maxSummaryChars)?o.maxSummaryChars:2e4,perMessageLimit:Number.isFinite(o.maxMessageChars)?o.maxMessageChars:2e3});if(!T||!e||typeof e.chat!="function")return{history:t,compacted:!1,originalLength:t.length};let E=await e.chat(sT,[{role:"user",content:T}],{signal:r}),w=E&&typeof E.content=="string"?E.content.trim():"",b=FD(w);if(!b)return{history:t,compacted:!1,originalLength:t.length};let L={role:"user",content:`${iT}
${b}`},D=t.slice(m);return{history:[...y,L,...D],compacted:!0,summary:b,originalLength:t.length}}async function HD(t,e={}){if(!t||!t.compaction||t.compaction.enabled===!1)return null;let n=e&&e.signal?e.signal:null,r=await aT({history:t.history,llm:t.llm,config:t.compaction,signal:n});if(r&&r.compacted){t.history=r.history;let o=r.summary?r.summary.length:0;console.log(`[Agent] History compacted: ${r.originalLength} -> ${t.history.length} (summary ${o} chars)`),typeof t.emit=="function"&&t.emit("context_compacted",{originalLength:r.originalLength,newLength:t.history.length,summary:r.summary||null,summaryLength:o})}return r||null}lT.exports={compactHistory:aT,maybeCompactAgentHistory:HD,SUMMARY_PROMPT:sT,SUMMARY_PREFIX:iT}});var fT=k((zj,cT)=>{var{getTotalUsageFromHistory:$D}=qi(),{riskLabel:VD}=Ia(),{getToolRegistrySnapshot:WD}=kr(),JD=1e3,zD=["api_key","apikey","secret","password","credential","authorization","bearer"];function KD(t){if(!t)return!1;let e=String(t).toLowerCase();return zD.includes(e)?!0:e.endsWith("token")}function Hf(t,e){if(t==null||typeof t=="string"||typeof t!="object")return t;if(e.has(t))return"[Circular]";if(e.add(t),Array.isArray(t))return t.map(r=>Hf(r,e));let n={};for(let[r,o]of Object.entries(t)){if(KD(r)){n[r]="[REDACTED]";continue}n[r]=Hf(o,e)}return n}function YD(t){return t===void 0||t===null?null:typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:Hf(t,new Set)}function jD(){return typeof window<"u"&&typeof window.document<"u"?"browser":"node"}function XD(t,e={}){let n=e&&Number.isFinite(e.maxEvents)&&e.maxEvents>0?Math.floor(e.maxEvents):JD,r=`session_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,o=[],i=new Map,s=(f,m)=>{o.push({timestamp:new Date().toISOString(),type:f,payload:m}),o.length>n&&o.splice(0,o.length-n)},a=(f,m,h)=>{let y=_=>{let T=h?h(_):_;s(m,T)};i.set(f,y),t&&typeof t.on=="function"&&t.on(f,y)};return a("turn_started","turn.started",f=>({message:f&&f.message?String(f.message):"",timestamp:f&&f.timestamp?f.timestamp:void 0})),a("decision_trace","decision.trace"),a("approval_required","approval.required"),a("approval_skipped","approval.skipped"),a("user_input_requested","user_input.requested"),a("user_input_response","user_input.response"),a("tool_call","tool.call.requested"),a("tool_call_begin","tool.call.begin"),a("tool_call_end","tool.call.end"),a("tool_result","tool.result"),a("knowledge_selected","knowledge.selected"),a("tool_error","tool.error"),a("plan_updated","plan.updated"),a("context_compacted","context.compacted"),a("state_changed","state.changed"),a("turn_aborted","turn.aborted"),a("agent_turn_complete","turn.completed"),{sessionId:r,events:o,exportSessionTrace:(f={})=>{let m=jD(),h=t&&t.identity?t.identity:null,y=t&&t.riskProfile?t.riskProfile:null,_=t&&t.llm&&t.llm.modelName?t.llm.modelName:null,T=$D(t&&t.history?t.history:[]),E=o.filter(P=>P.type==="turn.started").length,w=Array.from(new Set(o.filter(P=>P.type==="tool.call.begin"||P.type==="tool.result").map(P=>P&&P.payload&&P.payload.name?P.payload.name:P.payload&&P.payload.tool?P.payload.tool:null).filter(Boolean))),b=null;for(let P of o){if(P.type!=="approval.required"&&P.type!=="approval.skipped")continue;let q=P&&P.payload&&typeof P.payload.risk=="number"?P.payload.risk:null;q!==null&&(b===null||q>b)&&(b=q)}let L={totalTurns:E,totalTokens:T&&typeof T.total_tokens=="number"?T.total_tokens:null,maxRiskLevel:b===null?null:VD(b),toolsUsed:w},D=WD(t,w),I=o.map((P,q)=>({idx:q,timestamp:P.timestamp,type:P.type,payload:YD(P.payload)}));return{version:"1.0-opencode",metadata:{sessionId:r,exportedAt:new Date().toISOString(),platform:m,agent:{model:_,tier:y&&typeof y.tier=="number"?y.tier:null,identity:h}},summary:L,snapshot:t&&typeof t.dumpSnapshot=="function"?t.dumpSnapshot():null,toolRegistrySnapshot:D,events:I}},dispose:()=>{for(let[f,m]of i.entries())t&&typeof t.off=="function"?t.off(f,m):t&&typeof t.removeListener=="function"&&t.removeListener(f,m);i.clear()}}}cT.exports={createTraceCollector:XD}});var hT=k((Kj,pT)=>{var{EventEmitter:QD}=require("events"),{runAsyncIterator:ZD}=Ky(),{executeTools:eF}=bf(),{dumpSnapshot:tF,loadSnapshot:nF,setState:rF,getState:oF}=cS(),{initializeAgentState:iF}=SS(),{startAgentTurn:sF,finalizeAgentTurn:aF}=CS(),{awaitUserInput:lF,respondToUserInput:uF,submitPendingInput:cF,drainPendingInputs:fF}=Lf(),{applyUsageToEntry:dF,buildTokenUsageInfo:pF}=qi(),{sanitizeFinalResponse:dT}=Ff(),{runLlmStep:hF}=NS(),{handleToolCalls:mF,maybeAutoMemoryLookup:gF,maybeAutoMemorySave:yF}=Gf(),{applyTurnGuards:_F}=jS(),{maybeCompactAgentHistory:SF}=uT(),{createTraceCollector:TF}=fT(),$f=class extends QD{constructor({llm:e,tools:n=[],systemPrompt:r="You are a helpful AI assistant.",toolTimeoutMs:o,approvalTimeoutMs:i,approvalPolicy:s,trustedTools:a,toolOutputLimits:l,snapshot:c,maxTurns:f,compaction:m,maxProtectedRecentMessages:h,identity:y,riskProfile:_,ragConfig:T,ragService:E,skillsDir:w}={}){super(),iF(this,{llm:e,tools:n,systemPrompt:r,toolTimeoutMs:o,approvalTimeoutMs:i,approvalPolicy:s,trustedTools:a,toolOutputLimits:l,maxTurns:f,compaction:m,maxProtectedRecentMessages:h,identity:y,riskProfile:_,ragConfig:T,ragService:E,skillsDir:w}),c&&this.loadSnapshot(c,{emitPlanEvent:!1}),this._traceCollector=TF(this)}dumpSnapshot(){return tF(this)}loadSnapshot(e,{emitPlanEvent:n=!0}={}){return nF(this,e,{emitPlanEvent:n})}_setState(e,n={}){return rF(this,e,n)}getState(){return oF(this)}getIdentity(){return this.identity}getRiskProfile(){return this.riskProfile}_awaitUserInput(e,n){return lF(this,e,n)}respondToUserInput(e,n){return uF(this,e,n)}submitInput(e){return cF(this,e)}async run(e){let n=typeof AbortController<"u"?new AbortController:null;this._abortController&&this._abortController!==n&&!this._abortController.signal?.aborted&&this._abortController.abort(),this._abortController=n,this._abortReason=null;let r=n?n.signal:null,{dbg:o,turnStartIndex:i}=sF(this,e),s=await this._maybeCompactHistory({signal:r});s&&this.debug&&o("Compaction result",{compacted:!!s.compacted,originalLength:s.originalLength,newLength:Array.isArray(this.history)?this.history.length:0});let a="",l=0,c=this.maxTurns,f=0,m=0,h=!1,y=!1;try{for(;l<c;){if(r&&r.aborted){let I=r.reason instanceof Error?r.reason:new Error("Aborted");throw I.name="AbortError",I}l++,console.log(`[Agent] Step ${l}: Thinking...`),this._setState("thinking",{step:l,maxTurns:c}),this.emit("thinking",{step:l});let _=fF(this);if(_.length>0){for(let I of _)this.history.push({role:"user",content:I});this.emit("pending_input_applied",{count:_.length})}if(this.ragConfig&&this.ragConfig.autoMemoryPrecheck===!0&&!h&&(h=await gF({agent:this,userInput:e})||h),r&&r.aborted){let I=r.reason instanceof Error?r.reason:new Error("Aborted");throw I.name="AbortError",I}let E={content:"",tool_calls:[]},w=Math.min(this.maxProtectedRecentMessages,Math.max(0,this.history.length-i)),b=this.contextManager.process(this.history,{protectRecentMessages:w}),L=b.history;b.meta&&b.meta.dropped>0&&this.emit("context_truncated",{dropped:b.meta.dropped,estimatedTokens:b.meta.estimatedTokens,fullHistoryLength:this.history.length,sentHistoryLength:L.length}),E=await hF({agent:this,llm:this.llm,systemPrompt:this.systemPrompt,llmHistory:L,turnCount:l,signal:r}),o(`Step ${l} LLM response`,{contentLength:E&&E.content?String(E.content).length:0,toolCalls:Array.isArray(E.tool_calls)?E.tool_calls.length:0});let D=await mF({agent:this,currentStepResponse:E,turnCount:l});if(o(`Step ${l} tool flow`,{handled:D.handled,stopTurn:!!(D&&D.stopTurn)}),!D.handled){let I=_F({agent:this,userInput:e,turnStartIndex:i,currentStepResponse:E,realtimeGuardCount:f,planGuardCount:m});if(I.shouldContinue&&o(`Step ${l} guard triggered`,{realtimeGuardCount:I.realtimeGuardCount,planGuardCount:I.planGuardCount}),f=I.realtimeGuardCount,m=I.planGuardCount,I.shouldContinue)continue;console.log("[Agent] Final Answer Generated.");let P=dT(E.content||""),q={role:"assistant",content:P},K=dF(q,E._usage);if(this.history.push(q),K&&this.emit("token_count",pF(this.history)),a=P,!y)try{y=await yF({agent:this,userInput:e})}catch{}this.emit("response",{content:a});break}if(D&&D.stopTurn){console.log(`[Agent] Turn stopped: ${D.stopReason||"approval_blocked"}`);let I=dT(D.message||"Approval was not granted."),P={role:"assistant",content:I};this.history.push(P),a=I,this.emit("response",{content:a});break}}}catch(_){if(_&&_.name==="AbortError"){let T=this._abortReason||(_&&_.message?String(_.message):"aborted");this.history.push({role:"user",content:`<turn_aborted> ${T}`.trim()}),a="Aborted."}else{let T=_&&_.message?String(_.message):String(_);throw this._setState("error",{message:T}),this.emit("autosave",this.dumpSnapshot()),_}}try{return aF({agent:this,finalResponseText:a,turnCount:l,maxTurns:c,dbg:o})}finally{this._abortController=null,this._abortReason=null}}async _executeTools(e){let n=this._abortController?this._abortController.signal:null;return eF(this,e,{signal:n})}async _maybeCompactHistory(e={}){return await SF(this,e)}exportSessionTrace(e={}){return!this._traceCollector||typeof this._traceCollector.exportSessionTrace!="function"?null:this._traceCollector.exportSessionTrace(e)}async*runAsyncIterator(e,n={}){let r=n&&n.signal?n.signal:this._abortController?this._abortController.signal:void 0;r&&typeof r.addEventListener=="function"&&(r.aborted?this.stop("external_abort"):r.addEventListener("abort",()=>this.stop("external_abort"),{once:!0})),yield*ZD(this,e,{...n,signal:r})}stop(e="user_stop"){if(this._abortReason=e,this._abortController&&this._abortController.signal&&!this._abortController.signal.aborted){let n=new Error("Aborted");n.name="AbortError",n.reason=e,this._abortController.abort(n),this.emit("turn_aborted",{reason:e,timestamp:new Date().toISOString()})}}};pT.exports={Agent:$f}});var Vf=k((Yj,wT)=>{"use strict";var Ba=Object.prototype.hasOwnProperty,ET=Object.prototype.toString,mT=Object.defineProperty,gT=Object.getOwnPropertyDescriptor,yT=function(e){return typeof Array.isArray=="function"?Array.isArray(e):ET.call(e)==="[object Array]"},_T=function(e){if(!e||ET.call(e)!=="[object Object]")return!1;var n=Ba.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Ba.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var o;for(o in e);return typeof o>"u"||Ba.call(e,o)},ST=function(e,n){mT&&n.name==="__proto__"?mT(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},TT=function(e,n){if(n==="__proto__")if(Ba.call(e,n)){if(gT)return gT(e,n).value}else return;return e[n]};wT.exports=function t(){var e,n,r,o,i,s,a=arguments[0],l=1,c=arguments.length,f=!1;for(typeof a=="boolean"&&(f=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<c;++l)if(e=arguments[l],e!=null)for(n in e)r=TT(a,n),o=TT(e,n),a!==o&&(f&&o&&(_T(o)||(i=yT(o)))?(i?(i=!1,s=r&&yT(r)?r:[]):s=r&&_T(r)?r:{},ST(a,{name:n,newValue:t(f,s,o)})):typeof o<"u"&&ST(a,{name:n,newValue:o}));return a}});var vT=k((jj,EF)=>{EF.exports={name:"gaxios",version:"7.1.3",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:{type:"git",directory:"packages/gaxios",url:"https://github.com/googleapis/google-cloud-node-core.git"},keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","stream-browserify":"^3.0.0",tmp:"0.2.5","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2",rimraf:"^5.0.1"},homepage:"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}});var CT=k((Xj,AT)=>{"use strict";var wF=vT();AT.exports={pkg:wF}});var zf=k(Ot=>{"use strict";var RT=Ot&&Ot.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.GaxiosError=Ot.GAXIOS_ERROR_SYMBOL=void 0;Ot.defaultErrorRedactor=IT;var bT=RT(Vf()),vF=RT(CT()),Wf=vF.default.pkg;Ot.GAXIOS_ERROR_SYMBOL=Symbol.for(`${Wf.name}-gaxios-error`);var Jf=class t extends Error{config;response;code;status;error;[Ot.GAXIOS_ERROR_SYMBOL]=Wf.version;static[Symbol.hasInstance](e){return e&&typeof e=="object"&&Ot.GAXIOS_ERROR_SYMBOL in e&&e[Ot.GAXIOS_ERROR_SYMBOL]===Wf.version?!0:Function.prototype[Symbol.hasInstance].call(t,e)}constructor(e,n,r,o){if(super(e,{cause:o}),this.config=n,this.response=r,this.error=o instanceof Error?o:void 0,this.config=(0,bT.default)(!0,{},n),this.response&&(this.response.config=(0,bT.default)(!0,{},this.response.config)),this.response){try{this.response.data=AF(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}o instanceof DOMException?this.code=o.name:o&&typeof o=="object"&&"code"in o&&(typeof o.code=="string"||typeof o.code=="number")&&(this.code=o.code)}static extractAPIErrorFromResponse(e,n="The request failed"){let r=n;if(typeof e.data=="string"&&(r=e.data),e.data&&typeof e.data=="object"&&"error"in e.data&&e.data.error&&!e.ok){if(typeof e.data.error=="string")return{message:e.data.error,code:e.status,status:e.statusText};if(typeof e.data.error=="object"){r="message"in e.data.error&&typeof e.data.error.message=="string"?e.data.error.message:r;let o="status"in e.data.error&&typeof e.data.error.status=="string"?e.data.error.status:e.statusText,i="code"in e.data.error&&typeof e.data.error.code=="number"?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let s=[];for(let a of e.data.error.errors)typeof a=="object"&&"message"in a&&typeof a.message=="string"&&s.push(a.message);return Object.assign({message:s.join(`
`)||r,code:i,status:o},e.data.error)}return Object.assign({message:r,code:i,status:o},e.data.error)}}return{message:r,code:e.status,status:e.statusText}}};Ot.GaxiosError=Jf;function AF(t,e){switch(t){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function IT(t){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function n(i){i&&i.forEach((s,a)=>{(/^authentication$/i.test(a)||/^authorization$/i.test(a)||/secret/i.test(a))&&i.set(a,e)})}function r(i,s){if(typeof i=="object"&&i!==null&&typeof i[s]=="string"){let a=i[s];(/grant_type=/i.test(a)||/assertion=/i.test(a)||/secret/i.test(a))&&(i[s]=e)}}function o(i){!i||typeof i!="object"||(i instanceof FormData||i instanceof URLSearchParams||"forEach"in i&&"set"in i?i.forEach((s,a)=>{(["grant_type","assertion"].includes(a)||/secret/.test(a))&&i.set(a,e)}):("grant_type"in i&&(i.grant_type=e),"assertion"in i&&(i.assertion=e),"client_secret"in i&&(i.client_secret=e)))}return t.config&&(n(t.config.headers),r(t.config,"data"),o(t.config.data),r(t.config,"body"),o(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",e),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",e)),t.response&&(IT({config:t.response.config}),n(t.response.headers),t.response.bodyUsed&&(r(t.response,"data"),o(t.response.data))),t}});var PT=k(Kf=>{"use strict";Object.defineProperty(Kf,"__esModule",{value:!0});Kf.getRetryConfig=CF;async function CF(t){let e=xT(t);if(!t||!t.config||!e&&!t.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let n=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||n,t.config.retryConfig=e,!await(e.shouldRetry||bF)(t))return{shouldRetry:!1,config:t.config};let o=RF(e);t.config.retryConfig.currentRetryAttempt+=1;let i=e.retryBackoff?e.retryBackoff(t,o):new Promise(s=>{setTimeout(s,o)});return e.onRetryAttempt&&await e.onRetryAttempt(t),await i,{shouldRetry:!0,config:t.config}}function bF(t){let e=xT(t);if(t.config.signal?.aborted&&t.code!=="TimeoutError"||t.code==="AbortError"||!e||e.retry===0||!t.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(t.config.method?.toUpperCase()||"GET"))return!1;if(t.response&&t.response.status){let n=!1;for(let[r,o]of e.statusCodesToRetry){let i=t.response.status;if(i>=r&&i<=o){n=!0;break}}if(!n)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function xT(t){if(t&&t.config&&t.config.retryConfig)return t.config.retryConfig}function RF(t){let n=(t.currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,r=t.totalTimeout-(Date.now()-t.timeOfFirstRequest);return Math.min(n,r,t.maxRetryDelay)}});var jf=k(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.GaxiosInterceptorManager=void 0;var Yf=class extends Set{};Ga.GaxiosInterceptorManager=Yf});var NT=k((t8,kT)=>{var Eo=1e3,wo=Eo*60,vo=wo*60,Nr=vo*24,IF=Nr*7,xF=Nr*365.25;kT.exports=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return PF(t);if(n==="number"&&isFinite(t))return e.long?NF(t):kF(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function PF(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*xF;case"weeks":case"week":case"w":return n*IF;case"days":case"day":case"d":return n*Nr;case"hours":case"hour":case"hrs":case"hr":case"h":return n*vo;case"minutes":case"minute":case"mins":case"min":case"m":return n*wo;case"seconds":case"second":case"secs":case"sec":case"s":return n*Eo;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function kF(t){var e=Math.abs(t);return e>=Nr?Math.round(t/Nr)+"d":e>=vo?Math.round(t/vo)+"h":e>=wo?Math.round(t/wo)+"m":e>=Eo?Math.round(t/Eo)+"s":t+"ms"}function NF(t){var e=Math.abs(t);return e>=Nr?Ha(t,e,Nr,"day"):e>=vo?Ha(t,e,vo,"hour"):e>=wo?Ha(t,e,wo,"minute"):e>=Eo?Ha(t,e,Eo,"second"):t+" ms"}function Ha(t,e,n,r){var o=e>=n*1.5;return Math.round(t/n)+" "+r+(o?"s":"")}});var Xf=k((n8,MT)=>{function MF(t){n.debug=n,n.default=n,n.coerce=l,n.disable=s,n.enable=o,n.enabled=a,n.humanize=NT(),n.destroy=c,Object.keys(t).forEach(f=>{n[f]=t[f]}),n.names=[],n.skips=[],n.formatters={};function e(f){let m=0;for(let h=0;h<f.length;h++)m=(m<<5)-m+f.charCodeAt(h),m|=0;return n.colors[Math.abs(m)%n.colors.length]}n.selectColor=e;function n(f){let m,h=null,y,_;function T(...E){if(!T.enabled)return;let w=T,b=Number(new Date),L=b-(m||b);w.diff=L,w.prev=m,w.curr=b,m=b,E[0]=n.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let D=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(P,q)=>{if(P==="%%")return"%";D++;let K=n.formatters[q];if(typeof K=="function"){let B=E[D];P=K.call(w,B),E.splice(D,1),D--}return P}),n.formatArgs.call(w,E),(w.log||n.log).apply(w,E)}return T.namespace=f,T.useColors=n.useColors(),T.color=n.selectColor(f),T.extend=r,T.destroy=n.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(y!==n.namespaces&&(y=n.namespaces,_=n.enabled(f)),_),set:E=>{h=E}}),typeof n.init=="function"&&n.init(T),T}function r(f,m){let h=n(this.namespace+(typeof m>"u"?":":m)+f);return h.log=this.log,h}function o(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];let m=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let h of m)h[0]==="-"?n.skips.push(h.slice(1)):n.names.push(h)}function i(f,m){let h=0,y=0,_=-1,T=0;for(;h<f.length;)if(y<m.length&&(m[y]===f[h]||m[y]==="*"))m[y]==="*"?(_=y,T=h,y++):(h++,y++);else if(_!==-1)y=_+1,T++,h=T;else return!1;for(;y<m.length&&m[y]==="*";)y++;return y===m.length}function s(){let f=[...n.names,...n.skips.map(m=>"-"+m)].join(",");return n.enable(""),f}function a(f){for(let m of n.skips)if(i(f,m))return!1;for(let m of n.names)if(i(f,m))return!0;return!1}function l(f){return f instanceof Error?f.stack||f.message:f}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}MT.exports=MF});var OT=k((lt,$a)=>{lt.formatArgs=DF;lt.save=FF;lt.load=LF;lt.useColors=OF;lt.storage=UF();lt.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();lt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function OF(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function DF(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+$a.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(r=n))}),t.splice(r,0,e)}lt.log=console.debug||console.log||(()=>{});function FF(t){try{t?lt.storage.setItem("debug",t):lt.storage.removeItem("debug")}catch{}}function LF(){let t;try{t=lt.storage.getItem("debug")||lt.storage.getItem("DEBUG")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function UF(){try{return localStorage}catch{}}$a.exports=Xf()(lt);var{formatters:qF}=$a.exports;qF.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var FT=k((r8,DT)=>{"use strict";DT.exports=(t,e=process.argv)=>{let n=t.startsWith("-")?"":t.length===1?"-":"--",r=e.indexOf(n+t),o=e.indexOf("--");return r!==-1&&(o===-1||r<o)}});var qT=k((o8,UT)=>{"use strict";var BF=require("os"),LT=require("tty"),Dt=FT(),{env:Be}=process,sr;Dt("no-color")||Dt("no-colors")||Dt("color=false")||Dt("color=never")?sr=0:(Dt("color")||Dt("colors")||Dt("color=true")||Dt("color=always"))&&(sr=1);"FORCE_COLOR"in Be&&(Be.FORCE_COLOR==="true"?sr=1:Be.FORCE_COLOR==="false"?sr=0:sr=Be.FORCE_COLOR.length===0?1:Math.min(parseInt(Be.FORCE_COLOR,10),3));function Qf(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}function Zf(t,e){if(sr===0)return 0;if(Dt("color=16m")||Dt("color=full")||Dt("color=truecolor"))return 3;if(Dt("color=256"))return 2;if(t&&!e&&sr===void 0)return 0;let n=sr||0;if(Be.TERM==="dumb")return n;if(process.platform==="win32"){let r=BF.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in Be)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(r=>r in Be)||Be.CI_NAME==="codeship"?1:n;if("TEAMCITY_VERSION"in Be)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Be.TEAMCITY_VERSION)?1:0;if(Be.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Be){let r=parseInt((Be.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Be.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Be.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Be.TERM)||"COLORTERM"in Be?1:n}function GF(t){let e=Zf(t,t&&t.isTTY);return Qf(e)}UT.exports={supportsColor:GF,stdout:Qf(Zf(!0,LT.isatty(1))),stderr:Qf(Zf(!0,LT.isatty(2)))}});var GT=k((Ge,Wa)=>{var HF=require("tty"),Va=require("util");Ge.init=YF;Ge.log=JF;Ge.formatArgs=VF;Ge.save=zF;Ge.load=KF;Ge.useColors=$F;Ge.destroy=Va.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ge.colors=[6,2,3,4,5,1];try{let t=qT();t&&(t.stderr||t).level>=2&&(Ge.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Ge.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let n=e.substring(6).toLowerCase().replace(/_([a-z])/g,(o,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),t[n]=r,t},{});function $F(){return"colors"in Ge.inspectOpts?!!Ge.inspectOpts.colors:HF.isatty(process.stderr.fd)}function VF(t){let{namespace:e,useColors:n}=this;if(n){let r=this.color,o="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${o};1m${e} \x1B[0m`;t[0]=i+t[0].split(`
`).join(`
`+i),t.push(o+"m+"+Wa.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=WF()+e+" "+t[0]}function WF(){return Ge.inspectOpts.hideDate?"":new Date().toISOString()+" "}function JF(...t){return process.stderr.write(Va.formatWithOptions(Ge.inspectOpts,...t)+`
`)}function zF(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function KF(){return process.env.DEBUG}function YF(t){t.inspectOpts={};let e=Object.keys(Ge.inspectOpts);for(let n=0;n<e.length;n++)t.inspectOpts[e[n]]=Ge.inspectOpts[e[n]]}Wa.exports=Xf()(Ge);var{formatters:BT}=Wa.exports;BT.o=function(t){return this.inspectOpts.colors=this.useColors,Va.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};BT.O=function(t){return this.inspectOpts.colors=this.useColors,Va.inspect(t,this.inspectOpts)}});var td=k((i8,ed)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?ed.exports=OT():ed.exports=GT()});var VT=k(ut=>{"use strict";var jF=ut&&ut.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),XF=ut&&ut.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),HT=ut&&ut.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&jF(e,t,n);return XF(e,t),e};Object.defineProperty(ut,"__esModule",{value:!0});ut.req=ut.json=ut.toBuffer=void 0;var QF=HT(require("http")),ZF=HT(require("https"));async function $T(t){let e=0,n=[];for await(let r of t)e+=r.length,n.push(r);return Buffer.concat(n,e)}ut.toBuffer=$T;async function eL(t){let n=(await $T(t)).toString("utf8");try{return JSON.parse(n)}catch(r){let o=r;throw o.message+=` (input: ${n})`,o}}ut.json=eL;function tL(t,e={}){let r=((typeof t=="string"?t:t.href).startsWith("https:")?ZF:QF).request(t,e),o=new Promise((i,s)=>{r.once("response",i).once("error",s).end()});return r.then=o.then.bind(o),r}ut.req=tL});var KT=k(_t=>{"use strict";var JT=_t&&_t.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),nL=_t&&_t.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),zT=_t&&_t.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&JT(e,t,n);return nL(e,t),e},rL=_t&&_t.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&JT(e,t,n)};Object.defineProperty(_t,"__esModule",{value:!0});_t.Agent=void 0;var oL=zT(require("net")),WT=zT(require("http")),iL=require("https");rL(VT(),_t);var hn=Symbol("AgentBaseInternalState"),nd=class extends WT.Agent{constructor(e){super(e),this[hn]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let n=new oL.Socket({writable:!1});return this.sockets[e].push(n),this.totalSocketCount++,n}decrementSockets(e,n){if(!this.sockets[e]||n===null)return;let r=this.sockets[e],o=r.indexOf(n);o!==-1&&(r.splice(o,1),this.totalSocketCount--,r.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?iL.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,n,r){let o={...n,secureEndpoint:this.isSecureEndpoint(n)},i=this.getName(o),s=this.incrementSockets(i);Promise.resolve().then(()=>this.connect(e,o)).then(a=>{if(this.decrementSockets(i,s),a instanceof WT.Agent)try{return a.addRequest(e,o)}catch(l){return r(l)}this[hn].currentSocket=a,super.createSocket(e,n,r)},a=>{this.decrementSockets(i,s),r(a)})}createConnection(){let e=this[hn].currentSocket;if(this[hn].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[hn].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(e){this[hn]&&(this[hn].defaultPort=e)}get protocol(){return this[hn].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[hn]&&(this[hn].protocol=e)}};_t.Agent=nd});var YT=k(Ao=>{"use strict";var sL=Ao&&Ao.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.parseProxyResponse=void 0;var aL=sL(td()),Ja=(0,aL.default)("https-proxy-agent:parse-proxy-response");function lL(t){return new Promise((e,n)=>{let r=0,o=[];function i(){let f=t.read();f?c(f):t.once("readable",i)}function s(){t.removeListener("end",a),t.removeListener("error",l),t.removeListener("readable",i)}function a(){s(),Ja("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function l(f){s(),Ja("onerror %o",f),n(f)}function c(f){o.push(f),r+=f.length;let m=Buffer.concat(o,r),h=m.indexOf(`\r
\r
`);if(h===-1){Ja("have not received end of HTTP headers yet..."),i();return}let y=m.slice(0,h).toString("ascii").split(`\r
`),_=y.shift();if(!_)return t.destroy(),n(new Error("No header received from proxy CONNECT response"));let T=_.split(" "),E=+T[1],w=T.slice(2).join(" "),b={};for(let L of y){if(!L)continue;let D=L.indexOf(":");if(D===-1)return t.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${L}"`));let I=L.slice(0,D).toLowerCase(),P=L.slice(D+1).trimStart(),q=b[I];typeof q=="string"?b[I]=[q,P]:Array.isArray(q)?q.push(P):b[I]=P}Ja("got proxy server response: %o %o",_,b),s(),e({connect:{statusCode:E,statusText:w,headers:b},buffered:m})}t.on("error",l),t.on("end",a),i()})}Ao.parseProxyResponse=lL});var tE=k(Ft=>{"use strict";var uL=Ft&&Ft.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),cL=Ft&&Ft.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),ZT=Ft&&Ft.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)n!=="default"&&Object.prototype.hasOwnProperty.call(t,n)&&uL(e,t,n);return cL(e,t),e},eE=Ft&&Ft.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.HttpsProxyAgent=void 0;var za=ZT(require("net")),jT=ZT(require("tls")),fL=eE(require("assert")),dL=eE(td()),pL=KT(),hL=require("url"),mL=YT(),Gi=(0,dL.default)("https-proxy-agent"),XT=t=>t.servername===void 0&&t.host&&!za.isIP(t.host)?{...t,servername:t.host}:t,Ka=class extends pL.Agent{constructor(e,n){super(n),this.options={path:void 0},this.proxy=typeof e=="string"?new hL.URL(e):e,this.proxyHeaders=n?.headers??{},Gi("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),o=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?QT(n,"headers"):null,host:r,port:o}}async connect(e,n){let{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let o;r.protocol==="https:"?(Gi("Creating `tls.Socket`: %o",this.connectOpts),o=jT.connect(XT(this.connectOpts))):(Gi("Creating `net.Socket`: %o",this.connectOpts),o=za.connect(this.connectOpts));let i=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=za.isIPv6(n.host)?`[${n.host}]`:n.host,a=`CONNECT ${s}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){let h=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;i["Proxy-Authorization"]=`Basic ${Buffer.from(h).toString("base64")}`}i.Host=`${s}:${n.port}`,i["Proxy-Connection"]||(i["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let h of Object.keys(i))a+=`${h}: ${i[h]}\r
`;let l=(0,mL.parseProxyResponse)(o);o.write(`${a}\r
`);let{connect:c,buffered:f}=await l;if(e.emit("proxyConnect",c),this.emit("proxyConnect",c,e),c.statusCode===200)return e.once("socket",gL),n.secureEndpoint?(Gi("Upgrading socket connection to TLS"),jT.connect({...QT(XT(n),"host","path","port"),socket:o})):o;o.destroy();let m=new za.Socket({writable:!1});return m.readable=!0,e.once("socket",h=>{Gi("Replaying proxy buffer for failed request"),(0,fL.default)(h.listenerCount("data")>0),h.push(f),h.push(null)}),m}};Ka.protocols=["http","https"];Ft.HttpsProxyAgent=Ka;function gL(t){t.resume()}function QT(t,...e){let n={},r;for(r in t)e.includes(r)||(n[r]=t[r]);return n}});function yL(t){if(!/^data:/i.test(t))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');t=t.replace(/\r?\n/g,"");let e=t.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let n=t.substring(5,e).split(";"),r="",o=!1,i=n[0]||"text/plain",s=i;for(let f=1;f<n.length;f++)n[f]==="base64"?o=!0:n[f]&&(s+=`;${n[f]}`,n[f].indexOf("charset=")===0&&(r=n[f].substring(8)));!n[0]&&!r.length&&(s+=";charset=US-ASCII",r="US-ASCII");let a=o?"base64":"ascii",l=unescape(t.substring(e+1)),c=Buffer.from(l,a);return c.type=i,c.typeFull=s,c.charset=r,c}var nE,rE=qe(()=>{nE=yL});var iE=k((Ya,oE)=>{(function(t,e){typeof Ya=="object"&&typeof oE<"u"?e(Ya):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.WebStreamsPolyfill={}))})(Ya,(function(t){"use strict";function e(){}function n(p){return typeof p=="object"&&p!==null||typeof p=="function"}let r=e;function o(p,g){try{Object.defineProperty(p,"name",{value:g,configurable:!0})}catch{}}let i=Promise,s=Promise.prototype.then,a=Promise.reject.bind(i);function l(p){return new i(p)}function c(p){return l(g=>g(p))}function f(p){return a(p)}function m(p,g,S){return s.call(p,g,S)}function h(p,g,S){m(m(p,g,S),void 0,r)}function y(p,g){h(p,g)}function _(p,g){h(p,void 0,g)}function T(p,g,S){return m(p,g,S)}function E(p){m(p,void 0,r)}let w=p=>{if(typeof queueMicrotask=="function")w=queueMicrotask;else{let g=c(void 0);w=S=>m(g,S)}return w(p)};function b(p,g,S){if(typeof p!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(p,g,S)}function L(p,g,S){try{return c(b(p,g,S))}catch(A){return f(A)}}let D=16384;class I{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(g){let S=this._back,A=S;S._elements.length===D-1&&(A={_elements:[],_next:void 0}),S._elements.push(g),A!==S&&(this._back=A,S._next=A),++this._size}shift(){let g=this._front,S=g,A=this._cursor,N=A+1,V=g._elements,J=V[A];return N===D&&(S=g._next,N=0),--this._size,this._cursor=N,g!==S&&(this._front=S),V[A]=void 0,J}forEach(g){let S=this._cursor,A=this._front,N=A._elements;for(;(S!==N.length||A._next!==void 0)&&!(S===N.length&&(A=A._next,N=A._elements,S=0,N.length===0));)g(N[S]),++S}peek(){let g=this._front,S=this._cursor;return g._elements[S]}}let P=Symbol("[[AbortSteps]]"),q=Symbol("[[ErrorSteps]]"),K=Symbol("[[CancelSteps]]"),B=Symbol("[[PullSteps]]"),j=Symbol("[[ReleaseSteps]]");function Q(p,g){p._ownerReadableStream=g,g._reader=p,g._state==="readable"?ye(p):g._state==="closed"?Ae(p):Te(p,g._storedError)}function oe(p,g){let S=p._ownerReadableStream;return zt(S,g)}function le(p){let g=p._ownerReadableStream;g._state==="readable"?Pe(p,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Oe(p,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),g._readableStreamController[j](),g._reader=void 0,p._ownerReadableStream=void 0}function ue(p){return new TypeError("Cannot "+p+" a stream using a released reader")}function ye(p){p._closedPromise=l((g,S)=>{p._closedPromise_resolve=g,p._closedPromise_reject=S})}function Te(p,g){ye(p),Pe(p,g)}function Ae(p){ye(p),to(p)}function Pe(p,g){p._closedPromise_reject!==void 0&&(E(p._closedPromise),p._closedPromise_reject(g),p._closedPromise_resolve=void 0,p._closedPromise_reject=void 0)}function Oe(p,g){Te(p,g)}function to(p){p._closedPromise_resolve!==void 0&&(p._closedPromise_resolve(void 0),p._closedPromise_resolve=void 0,p._closedPromise_reject=void 0)}let cn=Number.isFinite||function(p){return typeof p=="number"&&isFinite(p)},Ti=Math.trunc||function(p){return p<0?Math.ceil(p):Math.floor(p)};function Y(p){return typeof p=="object"||typeof p=="function"}function it(p,g){if(p!==void 0&&!Y(p))throw new TypeError(`${g} is not an object.`)}function Qe(p,g){if(typeof p!="function")throw new TypeError(`${g} is not a function.`)}function Ei(p){return typeof p=="object"&&p!==null||typeof p=="function"}function Ze(p,g){if(!Ei(p))throw new TypeError(`${g} is not an object.`)}function De(p,g,S){if(p===void 0)throw new TypeError(`Parameter ${g} is required in '${S}'.`)}function v(p,g,S){if(p===void 0)throw new TypeError(`${g} is required in '${S}'.`)}function R(p){return Number(p)}function x(p){return p===0?0:p}function H(p){return x(Ti(p))}function O(p,g){let A=Number.MAX_SAFE_INTEGER,N=Number(p);if(N=x(N),!cn(N))throw new TypeError(`${g} is not a finite number`);if(N=H(N),N<0||N>A)throw new TypeError(`${g} is outside the accepted range of 0 to ${A}, inclusive`);return!cn(N)||N===0?0:N}function U(p,g){if(!er(p))throw new TypeError(`${g} is not a ReadableStream.`)}function W(p){return new z(p)}function M(p,g){p._reader._readRequests.push(g)}function F(p,g,S){let N=p._reader._readRequests.shift();S?N._closeSteps():N._chunkSteps(g)}function $(p){return p._reader._readRequests.length}function G(p){let g=p._reader;return!(g===void 0||!ee(g))}class z{constructor(g){if(De(g,1,"ReadableStreamDefaultReader"),U(g,"First parameter"),tr(g))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Q(this,g),this._readRequests=new I}get closed(){return ee(this)?this._closedPromise:f(Ie("closed"))}cancel(g=void 0){return ee(this)?this._ownerReadableStream===void 0?f(ue("cancel")):oe(this,g):f(Ie("cancel"))}read(){if(!ee(this))return f(Ie("read"));if(this._ownerReadableStream===void 0)return f(ue("read from"));let g,S,A=l((V,J)=>{g=V,S=J});return ne(this,{_chunkSteps:V=>g({value:V,done:!1}),_closeSteps:()=>g({value:void 0,done:!0}),_errorSteps:V=>S(V)}),A}releaseLock(){if(!ee(this))throw Ie("releaseLock");this._ownerReadableStream!==void 0&&ge(this)}}Object.defineProperties(z.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(z.prototype.cancel,"cancel"),o(z.prototype.read,"read"),o(z.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(z.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function ee(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_readRequests")?!1:p instanceof z}function ne(p,g){let S=p._ownerReadableStream;S._disturbed=!0,S._state==="closed"?g._closeSteps():S._state==="errored"?g._errorSteps(S._storedError):S._readableStreamController[B](g)}function ge(p){le(p);let g=new TypeError("Reader was released");Re(p,g)}function Re(p,g){let S=p._readRequests;p._readRequests=new I,S.forEach(A=>{A._errorSteps(g)})}function Ie(p){return new TypeError(`ReadableStreamDefaultReader.prototype.${p} can only be used on a ReadableStreamDefaultReader`)}let me=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Se{constructor(g,S){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=g,this._preventCancel=S}next(){let g=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?T(this._ongoingPromise,g,g):g(),this._ongoingPromise}return(g){let S=()=>this._returnSteps(g);return this._ongoingPromise?T(this._ongoingPromise,S,S):S()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let g=this._reader,S,A,N=l((J,Z)=>{S=J,A=Z});return ne(g,{_chunkSteps:J=>{this._ongoingPromise=void 0,w(()=>S({value:J,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,le(g),S({value:void 0,done:!0})},_errorSteps:J=>{this._ongoingPromise=void 0,this._isFinished=!0,le(g),A(J)}}),N}_returnSteps(g){if(this._isFinished)return Promise.resolve({value:g,done:!0});this._isFinished=!0;let S=this._reader;if(!this._preventCancel){let A=oe(S,g);return le(S),T(A,()=>({value:g,done:!0}))}return le(S),c({value:g,done:!0})}}let Fe={next(){return ro(this)?this._asyncIteratorImpl.next():f(oo("next"))},return(p){return ro(this)?this._asyncIteratorImpl.return(p):f(oo("return"))}};Object.setPrototypeOf(Fe,me);function no(p,g){let S=W(p),A=new Se(S,g),N=Object.create(Fe);return N._asyncIteratorImpl=A,N}function ro(p){if(!n(p)||!Object.prototype.hasOwnProperty.call(p,"_asyncIteratorImpl"))return!1;try{return p._asyncIteratorImpl instanceof Se}catch{return!1}}function oo(p){return new TypeError(`ReadableStreamAsyncIterator.${p} can only be used on a ReadableSteamAsyncIterator`)}let mt=Number.isNaN||function(p){return p!==p};var In,We,Le;function Ee(p){return p.slice()}function Hg(p,g,S,A,N){new Uint8Array(p).set(new Uint8Array(S,A,N),g)}let xn=p=>(typeof p.transfer=="function"?xn=g=>g.transfer():typeof structuredClone=="function"?xn=g=>structuredClone(g,{transfer:[g]}):xn=g=>g,xn(p)),jn=p=>(typeof p.detached=="boolean"?jn=g=>g.detached:jn=g=>g.byteLength===0,jn(p));function $g(p,g,S){if(p.slice)return p.slice(g,S);let A=S-g,N=new ArrayBuffer(A);return Hg(N,0,p,g,A),N}function Zs(p,g){let S=p[g];if(S!=null){if(typeof S!="function")throw new TypeError(`${String(g)} is not a function`);return S}}function qI(p){let g={[Symbol.iterator]:()=>p.iterator},S=(async function*(){return yield*g})(),A=S.next;return{iterator:S,nextMethod:A,done:!1}}let Nc=(Le=(In=Symbol.asyncIterator)!==null&&In!==void 0?In:(We=Symbol.for)===null||We===void 0?void 0:We.call(Symbol,"Symbol.asyncIterator"))!==null&&Le!==void 0?Le:"@@asyncIterator";function Vg(p,g="sync",S){if(S===void 0)if(g==="async"){if(S=Zs(p,Nc),S===void 0){let V=Zs(p,Symbol.iterator),J=Vg(p,"sync",V);return qI(J)}}else S=Zs(p,Symbol.iterator);if(S===void 0)throw new TypeError("The object is not iterable");let A=b(S,p,[]);if(!n(A))throw new TypeError("The iterator method must return an object");let N=A.next;return{iterator:A,nextMethod:N,done:!1}}function BI(p){let g=b(p.nextMethod,p.iterator,[]);if(!n(g))throw new TypeError("The iterator.next() method must return an object");return g}function GI(p){return!!p.done}function HI(p){return p.value}function $I(p){return!(typeof p!="number"||mt(p)||p<0)}function Wg(p){let g=$g(p.buffer,p.byteOffset,p.byteOffset+p.byteLength);return new Uint8Array(g)}function Mc(p){let g=p._queue.shift();return p._queueTotalSize-=g.size,p._queueTotalSize<0&&(p._queueTotalSize=0),g.value}function Oc(p,g,S){if(!$I(S)||S===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");p._queue.push({value:g,size:S}),p._queueTotalSize+=S}function VI(p){return p._queue.peek().value}function Xn(p){p._queue=new I,p._queueTotalSize=0}function Jg(p){return p===DataView}function WI(p){return Jg(p.constructor)}function JI(p){return Jg(p)?1:p.BYTES_PER_ELEMENT}class vr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Dc(this))throw Bc("view");return this._view}respond(g){if(!Dc(this))throw Bc("respond");if(De(g,1,"respond"),g=O(g,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(jn(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");ra(this._associatedReadableByteStreamController,g)}respondWithNewView(g){if(!Dc(this))throw Bc("respondWithNewView");if(De(g,1,"respondWithNewView"),!ArrayBuffer.isView(g))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(jn(g.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");oa(this._associatedReadableByteStreamController,g)}}Object.defineProperties(vr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),o(vr.prototype.respond,"respond"),o(vr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(vr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Pn{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Ar(this))throw vi("byobRequest");return qc(this)}get desiredSize(){if(!Ar(this))throw vi("desiredSize");return ny(this)}close(){if(!Ar(this))throw vi("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let g=this._controlledReadableByteStream._state;if(g!=="readable")throw new TypeError(`The stream (in ${g} state) is not in the readable state and cannot be closed`);wi(this)}enqueue(g){if(!Ar(this))throw vi("enqueue");if(De(g,1,"enqueue"),!ArrayBuffer.isView(g))throw new TypeError("chunk must be an array buffer view");if(g.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(g.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let S=this._controlledReadableByteStream._state;if(S!=="readable")throw new TypeError(`The stream (in ${S} state) is not in the readable state and cannot be enqueued to`);na(this,g)}error(g=void 0){if(!Ar(this))throw vi("error");Pt(this,g)}[K](g){zg(this),Xn(this);let S=this._cancelAlgorithm(g);return ta(this),S}[B](g){let S=this._controlledReadableByteStream;if(this._queueTotalSize>0){ty(this,g);return}let A=this._autoAllocateChunkSize;if(A!==void 0){let N;try{N=new ArrayBuffer(A)}catch(J){g._errorSteps(J);return}let V={buffer:N,bufferByteLength:A,byteOffset:0,byteLength:A,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(V)}M(S,g),Cr(this)}[j](){if(this._pendingPullIntos.length>0){let g=this._pendingPullIntos.peek();g.readerType="none",this._pendingPullIntos=new I,this._pendingPullIntos.push(g)}}}Object.defineProperties(Pn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Pn.prototype.close,"close"),o(Pn.prototype.enqueue,"enqueue"),o(Pn.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Pn.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Ar(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_controlledReadableByteStream")?!1:p instanceof Pn}function Dc(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_associatedReadableByteStreamController")?!1:p instanceof vr}function Cr(p){if(!XI(p))return;if(p._pulling){p._pullAgain=!0;return}p._pulling=!0;let S=p._pullAlgorithm();h(S,()=>(p._pulling=!1,p._pullAgain&&(p._pullAgain=!1,Cr(p)),null),A=>(Pt(p,A),null))}function zg(p){Lc(p),p._pendingPullIntos=new I}function Fc(p,g){let S=!1;p._state==="closed"&&(S=!0);let A=Kg(g);g.readerType==="default"?F(p,A,S):rx(p,A,S)}function Kg(p){let g=p.bytesFilled,S=p.elementSize;return new p.viewConstructor(p.buffer,p.byteOffset,g/S)}function ea(p,g,S,A){p._queue.push({buffer:g,byteOffset:S,byteLength:A}),p._queueTotalSize+=A}function Yg(p,g,S,A){let N;try{N=$g(g,S,S+A)}catch(V){throw Pt(p,V),V}ea(p,N,0,A)}function jg(p,g){g.bytesFilled>0&&Yg(p,g.buffer,g.byteOffset,g.bytesFilled),io(p)}function Xg(p,g){let S=Math.min(p._queueTotalSize,g.byteLength-g.bytesFilled),A=g.bytesFilled+S,N=S,V=!1,J=A%g.elementSize,Z=A-J;Z>=g.minimumFill&&(N=Z-g.bytesFilled,V=!0);let ce=p._queue;for(;N>0;){let ie=ce.peek(),de=Math.min(N,ie.byteLength),pe=g.byteOffset+g.bytesFilled;Hg(g.buffer,pe,ie.buffer,ie.byteOffset,de),ie.byteLength===de?ce.shift():(ie.byteOffset+=de,ie.byteLength-=de),p._queueTotalSize-=de,Qg(p,de,g),N-=de}return V}function Qg(p,g,S){S.bytesFilled+=g}function Zg(p){p._queueTotalSize===0&&p._closeRequested?(ta(p),xi(p._controlledReadableByteStream)):Cr(p)}function Lc(p){p._byobRequest!==null&&(p._byobRequest._associatedReadableByteStreamController=void 0,p._byobRequest._view=null,p._byobRequest=null)}function Uc(p){for(;p._pendingPullIntos.length>0;){if(p._queueTotalSize===0)return;let g=p._pendingPullIntos.peek();Xg(p,g)&&(io(p),Fc(p._controlledReadableByteStream,g))}}function zI(p){let g=p._controlledReadableByteStream._reader;for(;g._readRequests.length>0;){if(p._queueTotalSize===0)return;let S=g._readRequests.shift();ty(p,S)}}function KI(p,g,S,A){let N=p._controlledReadableByteStream,V=g.constructor,J=JI(V),{byteOffset:Z,byteLength:ce}=g,ie=S*J,de;try{de=xn(g.buffer)}catch(ve){A._errorSteps(ve);return}let pe={buffer:de,bufferByteLength:de.byteLength,byteOffset:Z,byteLength:ce,bytesFilled:0,minimumFill:ie,elementSize:J,viewConstructor:V,readerType:"byob"};if(p._pendingPullIntos.length>0){p._pendingPullIntos.push(pe),iy(N,A);return}if(N._state==="closed"){let ve=new V(pe.buffer,pe.byteOffset,0);A._closeSteps(ve);return}if(p._queueTotalSize>0){if(Xg(p,pe)){let ve=Kg(pe);Zg(p),A._chunkSteps(ve);return}if(p._closeRequested){let ve=new TypeError("Insufficient bytes to fill elements in the given buffer");Pt(p,ve),A._errorSteps(ve);return}}p._pendingPullIntos.push(pe),iy(N,A),Cr(p)}function YI(p,g){g.readerType==="none"&&io(p);let S=p._controlledReadableByteStream;if(Gc(S))for(;sy(S)>0;){let A=io(p);Fc(S,A)}}function jI(p,g,S){if(Qg(p,g,S),S.readerType==="none"){jg(p,S),Uc(p);return}if(S.bytesFilled<S.minimumFill)return;io(p);let A=S.bytesFilled%S.elementSize;if(A>0){let N=S.byteOffset+S.bytesFilled;Yg(p,S.buffer,N-A,A)}S.bytesFilled-=A,Fc(p._controlledReadableByteStream,S),Uc(p)}function ey(p,g){let S=p._pendingPullIntos.peek();Lc(p),p._controlledReadableByteStream._state==="closed"?YI(p,S):jI(p,g,S),Cr(p)}function io(p){return p._pendingPullIntos.shift()}function XI(p){let g=p._controlledReadableByteStream;return g._state!=="readable"||p._closeRequested||!p._started?!1:!!(G(g)&&$(g)>0||Gc(g)&&sy(g)>0||ny(p)>0)}function ta(p){p._pullAlgorithm=void 0,p._cancelAlgorithm=void 0}function wi(p){let g=p._controlledReadableByteStream;if(!(p._closeRequested||g._state!=="readable")){if(p._queueTotalSize>0){p._closeRequested=!0;return}if(p._pendingPullIntos.length>0){let S=p._pendingPullIntos.peek();if(S.bytesFilled%S.elementSize!==0){let A=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Pt(p,A),A}}ta(p),xi(g)}}function na(p,g){let S=p._controlledReadableByteStream;if(p._closeRequested||S._state!=="readable")return;let{buffer:A,byteOffset:N,byteLength:V}=g;if(jn(A))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let J=xn(A);if(p._pendingPullIntos.length>0){let Z=p._pendingPullIntos.peek();if(jn(Z.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Lc(p),Z.buffer=xn(Z.buffer),Z.readerType==="none"&&jg(p,Z)}if(G(S))if(zI(p),$(S)===0)ea(p,J,N,V);else{p._pendingPullIntos.length>0&&io(p);let Z=new Uint8Array(J,N,V);F(S,Z,!1)}else Gc(S)?(ea(p,J,N,V),Uc(p)):ea(p,J,N,V);Cr(p)}function Pt(p,g){let S=p._controlledReadableByteStream;S._state==="readable"&&(zg(p),Xn(p),ta(p),Py(S,g))}function ty(p,g){let S=p._queue.shift();p._queueTotalSize-=S.byteLength,Zg(p);let A=new Uint8Array(S.buffer,S.byteOffset,S.byteLength);g._chunkSteps(A)}function qc(p){if(p._byobRequest===null&&p._pendingPullIntos.length>0){let g=p._pendingPullIntos.peek(),S=new Uint8Array(g.buffer,g.byteOffset+g.bytesFilled,g.byteLength-g.bytesFilled),A=Object.create(vr.prototype);ZI(A,p,S),p._byobRequest=A}return p._byobRequest}function ny(p){let g=p._controlledReadableByteStream._state;return g==="errored"?null:g==="closed"?0:p._strategyHWM-p._queueTotalSize}function ra(p,g){let S=p._pendingPullIntos.peek();if(p._controlledReadableByteStream._state==="closed"){if(g!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(g===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(S.bytesFilled+g>S.byteLength)throw new RangeError("bytesWritten out of range")}S.buffer=xn(S.buffer),ey(p,g)}function oa(p,g){let S=p._pendingPullIntos.peek();if(p._controlledReadableByteStream._state==="closed"){if(g.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(g.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(S.byteOffset+S.bytesFilled!==g.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(S.bufferByteLength!==g.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(S.bytesFilled+g.byteLength>S.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let N=g.byteLength;S.buffer=xn(g.buffer),ey(p,N)}function ry(p,g,S,A,N,V,J){g._controlledReadableByteStream=p,g._pullAgain=!1,g._pulling=!1,g._byobRequest=null,g._queue=g._queueTotalSize=void 0,Xn(g),g._closeRequested=!1,g._started=!1,g._strategyHWM=V,g._pullAlgorithm=A,g._cancelAlgorithm=N,g._autoAllocateChunkSize=J,g._pendingPullIntos=new I,p._readableStreamController=g;let Z=S();h(c(Z),()=>(g._started=!0,Cr(g),null),ce=>(Pt(g,ce),null))}function QI(p,g,S){let A=Object.create(Pn.prototype),N,V,J;g.start!==void 0?N=()=>g.start(A):N=()=>{},g.pull!==void 0?V=()=>g.pull(A):V=()=>c(void 0),g.cancel!==void 0?J=ce=>g.cancel(ce):J=()=>c(void 0);let Z=g.autoAllocateChunkSize;if(Z===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");ry(p,A,N,V,J,S,Z)}function ZI(p,g,S){p._associatedReadableByteStreamController=g,p._view=S}function Bc(p){return new TypeError(`ReadableStreamBYOBRequest.prototype.${p} can only be used on a ReadableStreamBYOBRequest`)}function vi(p){return new TypeError(`ReadableByteStreamController.prototype.${p} can only be used on a ReadableByteStreamController`)}function ex(p,g){it(p,g);let S=p?.mode;return{mode:S===void 0?void 0:tx(S,`${g} has member 'mode' that`)}}function tx(p,g){if(p=`${p}`,p!=="byob")throw new TypeError(`${g} '${p}' is not a valid enumeration value for ReadableStreamReaderMode`);return p}function nx(p,g){var S;it(p,g);let A=(S=p?.min)!==null&&S!==void 0?S:1;return{min:O(A,`${g} has member 'min' that`)}}function oy(p){return new Qn(p)}function iy(p,g){p._reader._readIntoRequests.push(g)}function rx(p,g,S){let N=p._reader._readIntoRequests.shift();S?N._closeSteps(g):N._chunkSteps(g)}function sy(p){return p._reader._readIntoRequests.length}function Gc(p){let g=p._reader;return!(g===void 0||!br(g))}class Qn{constructor(g){if(De(g,1,"ReadableStreamBYOBReader"),U(g,"First parameter"),tr(g))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Ar(g._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Q(this,g),this._readIntoRequests=new I}get closed(){return br(this)?this._closedPromise:f(ia("closed"))}cancel(g=void 0){return br(this)?this._ownerReadableStream===void 0?f(ue("cancel")):oe(this,g):f(ia("cancel"))}read(g,S={}){if(!br(this))return f(ia("read"));if(!ArrayBuffer.isView(g))return f(new TypeError("view must be an array buffer view"));if(g.byteLength===0)return f(new TypeError("view must have non-zero byteLength"));if(g.buffer.byteLength===0)return f(new TypeError("view's buffer must have non-zero byteLength"));if(jn(g.buffer))return f(new TypeError("view's buffer has been detached"));let A;try{A=nx(S,"options")}catch(ie){return f(ie)}let N=A.min;if(N===0)return f(new TypeError("options.min must be greater than 0"));if(WI(g)){if(N>g.byteLength)return f(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(N>g.length)return f(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return f(ue("read from"));let V,J,Z=l((ie,de)=>{V=ie,J=de});return ay(this,g,N,{_chunkSteps:ie=>V({value:ie,done:!1}),_closeSteps:ie=>V({value:ie,done:!0}),_errorSteps:ie=>J(ie)}),Z}releaseLock(){if(!br(this))throw ia("releaseLock");this._ownerReadableStream!==void 0&&ox(this)}}Object.defineProperties(Qn.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(Qn.prototype.cancel,"cancel"),o(Qn.prototype.read,"read"),o(Qn.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Qn.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function br(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_readIntoRequests")?!1:p instanceof Qn}function ay(p,g,S,A){let N=p._ownerReadableStream;N._disturbed=!0,N._state==="errored"?A._errorSteps(N._storedError):KI(N._readableStreamController,g,S,A)}function ox(p){le(p);let g=new TypeError("Reader was released");ly(p,g)}function ly(p,g){let S=p._readIntoRequests;p._readIntoRequests=new I,S.forEach(A=>{A._errorSteps(g)})}function ia(p){return new TypeError(`ReadableStreamBYOBReader.prototype.${p} can only be used on a ReadableStreamBYOBReader`)}function Ai(p,g){let{highWaterMark:S}=p;if(S===void 0)return g;if(mt(S)||S<0)throw new RangeError("Invalid highWaterMark");return S}function sa(p){let{size:g}=p;return g||(()=>1)}function aa(p,g){it(p,g);let S=p?.highWaterMark,A=p?.size;return{highWaterMark:S===void 0?void 0:R(S),size:A===void 0?void 0:ix(A,`${g} has member 'size' that`)}}function ix(p,g){return Qe(p,g),S=>R(p(S))}function sx(p,g){it(p,g);let S=p?.abort,A=p?.close,N=p?.start,V=p?.type,J=p?.write;return{abort:S===void 0?void 0:ax(S,p,`${g} has member 'abort' that`),close:A===void 0?void 0:lx(A,p,`${g} has member 'close' that`),start:N===void 0?void 0:ux(N,p,`${g} has member 'start' that`),write:J===void 0?void 0:cx(J,p,`${g} has member 'write' that`),type:V}}function ax(p,g,S){return Qe(p,S),A=>L(p,g,[A])}function lx(p,g,S){return Qe(p,S),()=>L(p,g,[])}function ux(p,g,S){return Qe(p,S),A=>b(p,g,[A])}function cx(p,g,S){return Qe(p,S),(A,N)=>L(p,g,[A,N])}function uy(p,g){if(!so(p))throw new TypeError(`${g} is not a WritableStream.`)}function fx(p){if(typeof p!="object"||p===null)return!1;try{return typeof p.aborted=="boolean"}catch{return!1}}let dx=typeof AbortController=="function";function px(){if(dx)return new AbortController}class Zn{constructor(g={},S={}){g===void 0?g=null:Ze(g,"First parameter");let A=aa(S,"Second parameter"),N=sx(g,"First parameter");if(fy(this),N.type!==void 0)throw new RangeError("Invalid type is specified");let J=sa(A),Z=Ai(A,1);Rx(this,N,Z,J)}get locked(){if(!so(this))throw da("locked");return ao(this)}abort(g=void 0){return so(this)?ao(this)?f(new TypeError("Cannot abort a stream that already has a writer")):la(this,g):f(da("abort"))}close(){return so(this)?ao(this)?f(new TypeError("Cannot close a stream that already has a writer")):fn(this)?f(new TypeError("Cannot close an already-closing stream")):dy(this):f(da("close"))}getWriter(){if(!so(this))throw da("getWriter");return cy(this)}}Object.defineProperties(Zn.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),o(Zn.prototype.abort,"abort"),o(Zn.prototype.close,"close"),o(Zn.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Zn.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function cy(p){return new kn(p)}function hx(p,g,S,A,N=1,V=()=>1){let J=Object.create(Zn.prototype);fy(J);let Z=Object.create(lo.prototype);return _y(J,Z,p,g,S,A,N,V),J}function fy(p){p._state="writable",p._storedError=void 0,p._writer=void 0,p._writableStreamController=void 0,p._writeRequests=new I,p._inFlightWriteRequest=void 0,p._closeRequest=void 0,p._inFlightCloseRequest=void 0,p._pendingAbortRequest=void 0,p._backpressure=!1}function so(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_writableStreamController")?!1:p instanceof Zn}function ao(p){return p._writer!==void 0}function la(p,g){var S;if(p._state==="closed"||p._state==="errored")return c(void 0);p._writableStreamController._abortReason=g,(S=p._writableStreamController._abortController)===null||S===void 0||S.abort(g);let A=p._state;if(A==="closed"||A==="errored")return c(void 0);if(p._pendingAbortRequest!==void 0)return p._pendingAbortRequest._promise;let N=!1;A==="erroring"&&(N=!0,g=void 0);let V=l((J,Z)=>{p._pendingAbortRequest={_promise:void 0,_resolve:J,_reject:Z,_reason:g,_wasAlreadyErroring:N}});return p._pendingAbortRequest._promise=V,N||$c(p,g),V}function dy(p){let g=p._state;if(g==="closed"||g==="errored")return f(new TypeError(`The stream (in ${g} state) is not in the writable state and cannot be closed`));let S=l((N,V)=>{let J={_resolve:N,_reject:V};p._closeRequest=J}),A=p._writer;return A!==void 0&&p._backpressure&&g==="writable"&&Xc(A),Ix(p._writableStreamController),S}function mx(p){return l((S,A)=>{let N={_resolve:S,_reject:A};p._writeRequests.push(N)})}function Hc(p,g){if(p._state==="writable"){$c(p,g);return}Vc(p)}function $c(p,g){let S=p._writableStreamController;p._state="erroring",p._storedError=g;let A=p._writer;A!==void 0&&hy(A,g),!Tx(p)&&S._started&&Vc(p)}function Vc(p){p._state="errored",p._writableStreamController[q]();let g=p._storedError;if(p._writeRequests.forEach(N=>{N._reject(g)}),p._writeRequests=new I,p._pendingAbortRequest===void 0){ua(p);return}let S=p._pendingAbortRequest;if(p._pendingAbortRequest=void 0,S._wasAlreadyErroring){S._reject(g),ua(p);return}let A=p._writableStreamController[P](S._reason);h(A,()=>(S._resolve(),ua(p),null),N=>(S._reject(N),ua(p),null))}function gx(p){p._inFlightWriteRequest._resolve(void 0),p._inFlightWriteRequest=void 0}function yx(p,g){p._inFlightWriteRequest._reject(g),p._inFlightWriteRequest=void 0,Hc(p,g)}function _x(p){p._inFlightCloseRequest._resolve(void 0),p._inFlightCloseRequest=void 0,p._state==="erroring"&&(p._storedError=void 0,p._pendingAbortRequest!==void 0&&(p._pendingAbortRequest._resolve(),p._pendingAbortRequest=void 0)),p._state="closed";let S=p._writer;S!==void 0&&wy(S)}function Sx(p,g){p._inFlightCloseRequest._reject(g),p._inFlightCloseRequest=void 0,p._pendingAbortRequest!==void 0&&(p._pendingAbortRequest._reject(g),p._pendingAbortRequest=void 0),Hc(p,g)}function fn(p){return!(p._closeRequest===void 0&&p._inFlightCloseRequest===void 0)}function Tx(p){return!(p._inFlightWriteRequest===void 0&&p._inFlightCloseRequest===void 0)}function Ex(p){p._inFlightCloseRequest=p._closeRequest,p._closeRequest=void 0}function wx(p){p._inFlightWriteRequest=p._writeRequests.shift()}function ua(p){p._closeRequest!==void 0&&(p._closeRequest._reject(p._storedError),p._closeRequest=void 0);let g=p._writer;g!==void 0&&Yc(g,p._storedError)}function Wc(p,g){let S=p._writer;S!==void 0&&g!==p._backpressure&&(g?Dx(S):Xc(S)),p._backpressure=g}class kn{constructor(g){if(De(g,1,"WritableStreamDefaultWriter"),uy(g,"First parameter"),ao(g))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=g,g._writer=this;let S=g._state;if(S==="writable")!fn(g)&&g._backpressure?ha(this):vy(this),pa(this);else if(S==="erroring")jc(this,g._storedError),pa(this);else if(S==="closed")vy(this),Mx(this);else{let A=g._storedError;jc(this,A),Ey(this,A)}}get closed(){return Rr(this)?this._closedPromise:f(Ir("closed"))}get desiredSize(){if(!Rr(this))throw Ir("desiredSize");if(this._ownerWritableStream===void 0)throw bi("desiredSize");return bx(this)}get ready(){return Rr(this)?this._readyPromise:f(Ir("ready"))}abort(g=void 0){return Rr(this)?this._ownerWritableStream===void 0?f(bi("abort")):vx(this,g):f(Ir("abort"))}close(){if(!Rr(this))return f(Ir("close"));let g=this._ownerWritableStream;return g===void 0?f(bi("close")):fn(g)?f(new TypeError("Cannot close an already-closing stream")):py(this)}releaseLock(){if(!Rr(this))throw Ir("releaseLock");this._ownerWritableStream!==void 0&&my(this)}write(g=void 0){return Rr(this)?this._ownerWritableStream===void 0?f(bi("write to")):gy(this,g):f(Ir("write"))}}Object.defineProperties(kn.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),o(kn.prototype.abort,"abort"),o(kn.prototype.close,"close"),o(kn.prototype.releaseLock,"releaseLock"),o(kn.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(kn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Rr(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_ownerWritableStream")?!1:p instanceof kn}function vx(p,g){let S=p._ownerWritableStream;return la(S,g)}function py(p){let g=p._ownerWritableStream;return dy(g)}function Ax(p){let g=p._ownerWritableStream,S=g._state;return fn(g)||S==="closed"?c(void 0):S==="errored"?f(g._storedError):py(p)}function Cx(p,g){p._closedPromiseState==="pending"?Yc(p,g):Ox(p,g)}function hy(p,g){p._readyPromiseState==="pending"?Ay(p,g):Fx(p,g)}function bx(p){let g=p._ownerWritableStream,S=g._state;return S==="errored"||S==="erroring"?null:S==="closed"?0:Sy(g._writableStreamController)}function my(p){let g=p._ownerWritableStream,S=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");hy(p,S),Cx(p,S),g._writer=void 0,p._ownerWritableStream=void 0}function gy(p,g){let S=p._ownerWritableStream,A=S._writableStreamController,N=xx(A,g);if(S!==p._ownerWritableStream)return f(bi("write to"));let V=S._state;if(V==="errored")return f(S._storedError);if(fn(S)||V==="closed")return f(new TypeError("The stream is closing or closed and cannot be written to"));if(V==="erroring")return f(S._storedError);let J=mx(S);return Px(A,g,N),J}let yy={};class lo{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Jc(this))throw Kc("abortReason");return this._abortReason}get signal(){if(!Jc(this))throw Kc("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(g=void 0){if(!Jc(this))throw Kc("error");this._controlledWritableStream._state==="writable"&&Ty(this,g)}[P](g){let S=this._abortAlgorithm(g);return ca(this),S}[q](){Xn(this)}}Object.defineProperties(lo.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(lo.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Jc(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_controlledWritableStream")?!1:p instanceof lo}function _y(p,g,S,A,N,V,J,Z){g._controlledWritableStream=p,p._writableStreamController=g,g._queue=void 0,g._queueTotalSize=void 0,Xn(g),g._abortReason=void 0,g._abortController=px(),g._started=!1,g._strategySizeAlgorithm=Z,g._strategyHWM=J,g._writeAlgorithm=A,g._closeAlgorithm=N,g._abortAlgorithm=V;let ce=zc(g);Wc(p,ce);let ie=S(),de=c(ie);h(de,()=>(g._started=!0,fa(g),null),pe=>(g._started=!0,Hc(p,pe),null))}function Rx(p,g,S,A){let N=Object.create(lo.prototype),V,J,Z,ce;g.start!==void 0?V=()=>g.start(N):V=()=>{},g.write!==void 0?J=ie=>g.write(ie,N):J=()=>c(void 0),g.close!==void 0?Z=()=>g.close():Z=()=>c(void 0),g.abort!==void 0?ce=ie=>g.abort(ie):ce=()=>c(void 0),_y(p,N,V,J,Z,ce,S,A)}function ca(p){p._writeAlgorithm=void 0,p._closeAlgorithm=void 0,p._abortAlgorithm=void 0,p._strategySizeAlgorithm=void 0}function Ix(p){Oc(p,yy,0),fa(p)}function xx(p,g){try{return p._strategySizeAlgorithm(g)}catch(S){return Ci(p,S),1}}function Sy(p){return p._strategyHWM-p._queueTotalSize}function Px(p,g,S){try{Oc(p,g,S)}catch(N){Ci(p,N);return}let A=p._controlledWritableStream;if(!fn(A)&&A._state==="writable"){let N=zc(p);Wc(A,N)}fa(p)}function fa(p){let g=p._controlledWritableStream;if(!p._started||g._inFlightWriteRequest!==void 0)return;if(g._state==="erroring"){Vc(g);return}if(p._queue.length===0)return;let A=VI(p);A===yy?kx(p):Nx(p,A)}function Ci(p,g){p._controlledWritableStream._state==="writable"&&Ty(p,g)}function kx(p){let g=p._controlledWritableStream;Ex(g),Mc(p);let S=p._closeAlgorithm();ca(p),h(S,()=>(_x(g),null),A=>(Sx(g,A),null))}function Nx(p,g){let S=p._controlledWritableStream;wx(S);let A=p._writeAlgorithm(g);h(A,()=>{gx(S);let N=S._state;if(Mc(p),!fn(S)&&N==="writable"){let V=zc(p);Wc(S,V)}return fa(p),null},N=>(S._state==="writable"&&ca(p),yx(S,N),null))}function zc(p){return Sy(p)<=0}function Ty(p,g){let S=p._controlledWritableStream;ca(p),$c(S,g)}function da(p){return new TypeError(`WritableStream.prototype.${p} can only be used on a WritableStream`)}function Kc(p){return new TypeError(`WritableStreamDefaultController.prototype.${p} can only be used on a WritableStreamDefaultController`)}function Ir(p){return new TypeError(`WritableStreamDefaultWriter.prototype.${p} can only be used on a WritableStreamDefaultWriter`)}function bi(p){return new TypeError("Cannot "+p+" a stream using a released writer")}function pa(p){p._closedPromise=l((g,S)=>{p._closedPromise_resolve=g,p._closedPromise_reject=S,p._closedPromiseState="pending"})}function Ey(p,g){pa(p),Yc(p,g)}function Mx(p){pa(p),wy(p)}function Yc(p,g){p._closedPromise_reject!==void 0&&(E(p._closedPromise),p._closedPromise_reject(g),p._closedPromise_resolve=void 0,p._closedPromise_reject=void 0,p._closedPromiseState="rejected")}function Ox(p,g){Ey(p,g)}function wy(p){p._closedPromise_resolve!==void 0&&(p._closedPromise_resolve(void 0),p._closedPromise_resolve=void 0,p._closedPromise_reject=void 0,p._closedPromiseState="resolved")}function ha(p){p._readyPromise=l((g,S)=>{p._readyPromise_resolve=g,p._readyPromise_reject=S}),p._readyPromiseState="pending"}function jc(p,g){ha(p),Ay(p,g)}function vy(p){ha(p),Xc(p)}function Ay(p,g){p._readyPromise_reject!==void 0&&(E(p._readyPromise),p._readyPromise_reject(g),p._readyPromise_resolve=void 0,p._readyPromise_reject=void 0,p._readyPromiseState="rejected")}function Dx(p){ha(p)}function Fx(p,g){jc(p,g)}function Xc(p){p._readyPromise_resolve!==void 0&&(p._readyPromise_resolve(void 0),p._readyPromise_resolve=void 0,p._readyPromise_reject=void 0,p._readyPromiseState="fulfilled")}function Lx(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Qc=Lx();function Ux(p){if(!(typeof p=="function"||typeof p=="object")||p.name!=="DOMException")return!1;try{return new p,!0}catch{return!1}}function qx(){let p=Qc?.DOMException;return Ux(p)?p:void 0}function Bx(){let p=function(S,A){this.message=S||"",this.name=A||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return o(p,"DOMException"),p.prototype=Object.create(Error.prototype),Object.defineProperty(p.prototype,"constructor",{value:p,writable:!0,configurable:!0}),p}let Gx=qx()||Bx();function Cy(p,g,S,A,N,V){let J=W(p),Z=cy(g);p._disturbed=!0;let ce=!1,ie=c(void 0);return l((de,pe)=>{let ve;if(V!==void 0){if(ve=()=>{let se=V.reason!==void 0?V.reason:new Gx("Aborted","AbortError"),he=[];A||he.push(()=>g._state==="writable"?la(g,se):c(void 0)),N||he.push(()=>p._state==="readable"?zt(p,se):c(void 0)),st(()=>Promise.all(he.map(Ce=>Ce())),!0,se)},V.aborted){ve();return}V.addEventListener("abort",ve)}function Kt(){return l((se,he)=>{function Ce(gt){gt?se():m(po(),Ce,he)}Ce(!1)})}function po(){return ce?c(!0):m(Z._readyPromise,()=>l((se,he)=>{ne(J,{_chunkSteps:Ce=>{ie=m(gy(Z,Ce),void 0,e),se(!1)},_closeSteps:()=>se(!0),_errorSteps:he})}))}if(Mn(p,J._closedPromise,se=>(A?kt(!0,se):st(()=>la(g,se),!0,se),null)),Mn(g,Z._closedPromise,se=>(N?kt(!0,se):st(()=>zt(p,se),!0,se),null)),et(p,J._closedPromise,()=>(S?kt():st(()=>Ax(Z)),null)),fn(g)||g._state==="closed"){let se=new TypeError("the destination writable stream closed before all data could be piped to it");N?kt(!0,se):st(()=>zt(p,se),!0,se)}E(Kt());function rr(){let se=ie;return m(ie,()=>se!==ie?rr():void 0)}function Mn(se,he,Ce){se._state==="errored"?Ce(se._storedError):_(he,Ce)}function et(se,he,Ce){se._state==="closed"?Ce():y(he,Ce)}function st(se,he,Ce){if(ce)return;ce=!0,g._state==="writable"&&!fn(g)?y(rr(),gt):gt();function gt(){return h(se(),()=>On(he,Ce),ho=>On(!0,ho)),null}}function kt(se,he){ce||(ce=!0,g._state==="writable"&&!fn(g)?y(rr(),()=>On(se,he)):On(se,he))}function On(se,he){return my(Z),le(J),V!==void 0&&V.removeEventListener("abort",ve),se?pe(he):de(void 0),null}})}class Nn{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!ma(this))throw ya("desiredSize");return Zc(this)}close(){if(!ma(this))throw ya("close");if(!co(this))throw new TypeError("The stream is not in a state that permits close");xr(this)}enqueue(g=void 0){if(!ma(this))throw ya("enqueue");if(!co(this))throw new TypeError("The stream is not in a state that permits enqueue");return uo(this,g)}error(g=void 0){if(!ma(this))throw ya("error");Jt(this,g)}[K](g){Xn(this);let S=this._cancelAlgorithm(g);return ga(this),S}[B](g){let S=this._controlledReadableStream;if(this._queue.length>0){let A=Mc(this);this._closeRequested&&this._queue.length===0?(ga(this),xi(S)):Ri(this),g._chunkSteps(A)}else M(S,g),Ri(this)}[j](){}}Object.defineProperties(Nn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Nn.prototype.close,"close"),o(Nn.prototype.enqueue,"enqueue"),o(Nn.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Nn.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function ma(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_controlledReadableStream")?!1:p instanceof Nn}function Ri(p){if(!by(p))return;if(p._pulling){p._pullAgain=!0;return}p._pulling=!0;let S=p._pullAlgorithm();h(S,()=>(p._pulling=!1,p._pullAgain&&(p._pullAgain=!1,Ri(p)),null),A=>(Jt(p,A),null))}function by(p){let g=p._controlledReadableStream;return!co(p)||!p._started?!1:!!(tr(g)&&$(g)>0||Zc(p)>0)}function ga(p){p._pullAlgorithm=void 0,p._cancelAlgorithm=void 0,p._strategySizeAlgorithm=void 0}function xr(p){if(!co(p))return;let g=p._controlledReadableStream;p._closeRequested=!0,p._queue.length===0&&(ga(p),xi(g))}function uo(p,g){if(!co(p))return;let S=p._controlledReadableStream;if(tr(S)&&$(S)>0)F(S,g,!1);else{let A;try{A=p._strategySizeAlgorithm(g)}catch(N){throw Jt(p,N),N}try{Oc(p,g,A)}catch(N){throw Jt(p,N),N}}Ri(p)}function Jt(p,g){let S=p._controlledReadableStream;S._state==="readable"&&(Xn(p),ga(p),Py(S,g))}function Zc(p){let g=p._controlledReadableStream._state;return g==="errored"?null:g==="closed"?0:p._strategyHWM-p._queueTotalSize}function Hx(p){return!by(p)}function co(p){let g=p._controlledReadableStream._state;return!p._closeRequested&&g==="readable"}function Ry(p,g,S,A,N,V,J){g._controlledReadableStream=p,g._queue=void 0,g._queueTotalSize=void 0,Xn(g),g._started=!1,g._closeRequested=!1,g._pullAgain=!1,g._pulling=!1,g._strategySizeAlgorithm=J,g._strategyHWM=V,g._pullAlgorithm=A,g._cancelAlgorithm=N,p._readableStreamController=g;let Z=S();h(c(Z),()=>(g._started=!0,Ri(g),null),ce=>(Jt(g,ce),null))}function $x(p,g,S,A){let N=Object.create(Nn.prototype),V,J,Z;g.start!==void 0?V=()=>g.start(N):V=()=>{},g.pull!==void 0?J=()=>g.pull(N):J=()=>c(void 0),g.cancel!==void 0?Z=ce=>g.cancel(ce):Z=()=>c(void 0),Ry(p,N,V,J,Z,S,A)}function ya(p){return new TypeError(`ReadableStreamDefaultController.prototype.${p} can only be used on a ReadableStreamDefaultController`)}function Vx(p,g){return Ar(p._readableStreamController)?Jx(p):Wx(p)}function Wx(p,g){let S=W(p),A=!1,N=!1,V=!1,J=!1,Z,ce,ie,de,pe,ve=l(et=>{pe=et});function Kt(){return A?(N=!0,c(void 0)):(A=!0,ne(S,{_chunkSteps:st=>{w(()=>{N=!1;let kt=st,On=st;V||uo(ie._readableStreamController,kt),J||uo(de._readableStreamController,On),A=!1,N&&Kt()})},_closeSteps:()=>{A=!1,V||xr(ie._readableStreamController),J||xr(de._readableStreamController),(!V||!J)&&pe(void 0)},_errorSteps:()=>{A=!1}}),c(void 0))}function po(et){if(V=!0,Z=et,J){let st=Ee([Z,ce]),kt=zt(p,st);pe(kt)}return ve}function rr(et){if(J=!0,ce=et,V){let st=Ee([Z,ce]),kt=zt(p,st);pe(kt)}return ve}function Mn(){}return ie=Ii(Mn,Kt,po),de=Ii(Mn,Kt,rr),_(S._closedPromise,et=>(Jt(ie._readableStreamController,et),Jt(de._readableStreamController,et),(!V||!J)&&pe(void 0),null)),[ie,de]}function Jx(p){let g=W(p),S=!1,A=!1,N=!1,V=!1,J=!1,Z,ce,ie,de,pe,ve=l(se=>{pe=se});function Kt(se){_(se._closedPromise,he=>(se!==g||(Pt(ie._readableStreamController,he),Pt(de._readableStreamController,he),(!V||!J)&&pe(void 0)),null))}function po(){br(g)&&(le(g),g=W(p),Kt(g)),ne(g,{_chunkSteps:he=>{w(()=>{A=!1,N=!1;let Ce=he,gt=he;if(!V&&!J)try{gt=Wg(he)}catch(ho){Pt(ie._readableStreamController,ho),Pt(de._readableStreamController,ho),pe(zt(p,ho));return}V||na(ie._readableStreamController,Ce),J||na(de._readableStreamController,gt),S=!1,A?Mn():N&&et()})},_closeSteps:()=>{S=!1,V||wi(ie._readableStreamController),J||wi(de._readableStreamController),ie._readableStreamController._pendingPullIntos.length>0&&ra(ie._readableStreamController,0),de._readableStreamController._pendingPullIntos.length>0&&ra(de._readableStreamController,0),(!V||!J)&&pe(void 0)},_errorSteps:()=>{S=!1}})}function rr(se,he){ee(g)&&(le(g),g=oy(p),Kt(g));let Ce=he?de:ie,gt=he?ie:de;ay(g,se,1,{_chunkSteps:mo=>{w(()=>{A=!1,N=!1;let go=he?J:V;if(he?V:J)go||oa(Ce._readableStreamController,mo);else{let $y;try{$y=Wg(mo)}catch(of){Pt(Ce._readableStreamController,of),Pt(gt._readableStreamController,of),pe(zt(p,of));return}go||oa(Ce._readableStreamController,mo),na(gt._readableStreamController,$y)}S=!1,A?Mn():N&&et()})},_closeSteps:mo=>{S=!1;let go=he?J:V,Ca=he?V:J;go||wi(Ce._readableStreamController),Ca||wi(gt._readableStreamController),mo!==void 0&&(go||oa(Ce._readableStreamController,mo),!Ca&&gt._readableStreamController._pendingPullIntos.length>0&&ra(gt._readableStreamController,0)),(!go||!Ca)&&pe(void 0)},_errorSteps:()=>{S=!1}})}function Mn(){if(S)return A=!0,c(void 0);S=!0;let se=qc(ie._readableStreamController);return se===null?po():rr(se._view,!1),c(void 0)}function et(){if(S)return N=!0,c(void 0);S=!0;let se=qc(de._readableStreamController);return se===null?po():rr(se._view,!0),c(void 0)}function st(se){if(V=!0,Z=se,J){let he=Ee([Z,ce]),Ce=zt(p,he);pe(Ce)}return ve}function kt(se){if(J=!0,ce=se,V){let he=Ee([Z,ce]),Ce=zt(p,he);pe(Ce)}return ve}function On(){}return ie=xy(On,Mn,st),de=xy(On,et,kt),Kt(g),[ie,de]}function zx(p){return n(p)&&typeof p.getReader<"u"}function Kx(p){return zx(p)?jx(p.getReader()):Yx(p)}function Yx(p){let g,S=Vg(p,"async"),A=e;function N(){let J;try{J=BI(S)}catch(ce){return f(ce)}let Z=c(J);return T(Z,ce=>{if(!n(ce))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(GI(ce))xr(g._readableStreamController);else{let de=HI(ce);uo(g._readableStreamController,de)}})}function V(J){let Z=S.iterator,ce;try{ce=Zs(Z,"return")}catch(pe){return f(pe)}if(ce===void 0)return c(void 0);let ie;try{ie=b(ce,Z,[J])}catch(pe){return f(pe)}let de=c(ie);return T(de,pe=>{if(!n(pe))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return g=Ii(A,N,V,0),g}function jx(p){let g,S=e;function A(){let V;try{V=p.read()}catch(J){return f(J)}return T(V,J=>{if(!n(J))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(J.done)xr(g._readableStreamController);else{let Z=J.value;uo(g._readableStreamController,Z)}})}function N(V){try{return c(p.cancel(V))}catch(J){return f(J)}}return g=Ii(S,A,N,0),g}function Xx(p,g){it(p,g);let S=p,A=S?.autoAllocateChunkSize,N=S?.cancel,V=S?.pull,J=S?.start,Z=S?.type;return{autoAllocateChunkSize:A===void 0?void 0:O(A,`${g} has member 'autoAllocateChunkSize' that`),cancel:N===void 0?void 0:Qx(N,S,`${g} has member 'cancel' that`),pull:V===void 0?void 0:Zx(V,S,`${g} has member 'pull' that`),start:J===void 0?void 0:eP(J,S,`${g} has member 'start' that`),type:Z===void 0?void 0:tP(Z,`${g} has member 'type' that`)}}function Qx(p,g,S){return Qe(p,S),A=>L(p,g,[A])}function Zx(p,g,S){return Qe(p,S),A=>L(p,g,[A])}function eP(p,g,S){return Qe(p,S),A=>b(p,g,[A])}function tP(p,g){if(p=`${p}`,p!=="bytes")throw new TypeError(`${g} '${p}' is not a valid enumeration value for ReadableStreamType`);return p}function nP(p,g){return it(p,g),{preventCancel:!!p?.preventCancel}}function Iy(p,g){it(p,g);let S=p?.preventAbort,A=p?.preventCancel,N=p?.preventClose,V=p?.signal;return V!==void 0&&rP(V,`${g} has member 'signal' that`),{preventAbort:!!S,preventCancel:!!A,preventClose:!!N,signal:V}}function rP(p,g){if(!fx(p))throw new TypeError(`${g} is not an AbortSignal.`)}function oP(p,g){it(p,g);let S=p?.readable;v(S,"readable","ReadableWritablePair"),U(S,`${g} has member 'readable' that`);let A=p?.writable;return v(A,"writable","ReadableWritablePair"),uy(A,`${g} has member 'writable' that`),{readable:S,writable:A}}class Je{constructor(g={},S={}){g===void 0?g=null:Ze(g,"First parameter");let A=aa(S,"Second parameter"),N=Xx(g,"First parameter");if(ef(this),N.type==="bytes"){if(A.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let V=Ai(A,0);QI(this,N,V)}else{let V=sa(A),J=Ai(A,1);$x(this,N,J,V)}}get locked(){if(!er(this))throw Pr("locked");return tr(this)}cancel(g=void 0){return er(this)?tr(this)?f(new TypeError("Cannot cancel a stream that already has a reader")):zt(this,g):f(Pr("cancel"))}getReader(g=void 0){if(!er(this))throw Pr("getReader");return ex(g,"First parameter").mode===void 0?W(this):oy(this)}pipeThrough(g,S={}){if(!er(this))throw Pr("pipeThrough");De(g,1,"pipeThrough");let A=oP(g,"First parameter"),N=Iy(S,"Second parameter");if(tr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(ao(A.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let V=Cy(this,A.writable,N.preventClose,N.preventAbort,N.preventCancel,N.signal);return E(V),A.readable}pipeTo(g,S={}){if(!er(this))return f(Pr("pipeTo"));if(g===void 0)return f("Parameter 1 is required in 'pipeTo'.");if(!so(g))return f(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let A;try{A=Iy(S,"Second parameter")}catch(N){return f(N)}return tr(this)?f(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):ao(g)?f(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Cy(this,g,A.preventClose,A.preventAbort,A.preventCancel,A.signal)}tee(){if(!er(this))throw Pr("tee");let g=Vx(this);return Ee(g)}values(g=void 0){if(!er(this))throw Pr("values");let S=nP(g,"First parameter");return no(this,S.preventCancel)}[Nc](g){return this.values(g)}static from(g){return Kx(g)}}Object.defineProperties(Je,{from:{enumerable:!0}}),Object.defineProperties(Je.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),o(Je.from,"from"),o(Je.prototype.cancel,"cancel"),o(Je.prototype.getReader,"getReader"),o(Je.prototype.pipeThrough,"pipeThrough"),o(Je.prototype.pipeTo,"pipeTo"),o(Je.prototype.tee,"tee"),o(Je.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Je.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(Je.prototype,Nc,{value:Je.prototype.values,writable:!0,configurable:!0});function Ii(p,g,S,A=1,N=()=>1){let V=Object.create(Je.prototype);ef(V);let J=Object.create(Nn.prototype);return Ry(V,J,p,g,S,A,N),V}function xy(p,g,S){let A=Object.create(Je.prototype);ef(A);let N=Object.create(Pn.prototype);return ry(A,N,p,g,S,0,void 0),A}function ef(p){p._state="readable",p._reader=void 0,p._storedError=void 0,p._disturbed=!1}function er(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_readableStreamController")?!1:p instanceof Je}function tr(p){return p._reader!==void 0}function zt(p,g){if(p._disturbed=!0,p._state==="closed")return c(void 0);if(p._state==="errored")return f(p._storedError);xi(p);let S=p._reader;if(S!==void 0&&br(S)){let N=S._readIntoRequests;S._readIntoRequests=new I,N.forEach(V=>{V._closeSteps(void 0)})}let A=p._readableStreamController[K](g);return T(A,e)}function xi(p){p._state="closed";let g=p._reader;if(g!==void 0&&(to(g),ee(g))){let S=g._readRequests;g._readRequests=new I,S.forEach(A=>{A._closeSteps()})}}function Py(p,g){p._state="errored",p._storedError=g;let S=p._reader;S!==void 0&&(Pe(S,g),ee(S)?Re(S,g):ly(S,g))}function Pr(p){return new TypeError(`ReadableStream.prototype.${p} can only be used on a ReadableStream`)}function ky(p,g){it(p,g);let S=p?.highWaterMark;return v(S,"highWaterMark","QueuingStrategyInit"),{highWaterMark:R(S)}}let Ny=p=>p.byteLength;o(Ny,"size");class _a{constructor(g){De(g,1,"ByteLengthQueuingStrategy"),g=ky(g,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=g.highWaterMark}get highWaterMark(){if(!Oy(this))throw My("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Oy(this))throw My("size");return Ny}}Object.defineProperties(_a.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(_a.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function My(p){return new TypeError(`ByteLengthQueuingStrategy.prototype.${p} can only be used on a ByteLengthQueuingStrategy`)}function Oy(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_byteLengthQueuingStrategyHighWaterMark")?!1:p instanceof _a}let Dy=()=>1;o(Dy,"size");class Sa{constructor(g){De(g,1,"CountQueuingStrategy"),g=ky(g,"First parameter"),this._countQueuingStrategyHighWaterMark=g.highWaterMark}get highWaterMark(){if(!Ly(this))throw Fy("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Ly(this))throw Fy("size");return Dy}}Object.defineProperties(Sa.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Sa.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Fy(p){return new TypeError(`CountQueuingStrategy.prototype.${p} can only be used on a CountQueuingStrategy`)}function Ly(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_countQueuingStrategyHighWaterMark")?!1:p instanceof Sa}function iP(p,g){it(p,g);let S=p?.cancel,A=p?.flush,N=p?.readableType,V=p?.start,J=p?.transform,Z=p?.writableType;return{cancel:S===void 0?void 0:uP(S,p,`${g} has member 'cancel' that`),flush:A===void 0?void 0:sP(A,p,`${g} has member 'flush' that`),readableType:N,start:V===void 0?void 0:aP(V,p,`${g} has member 'start' that`),transform:J===void 0?void 0:lP(J,p,`${g} has member 'transform' that`),writableType:Z}}function sP(p,g,S){return Qe(p,S),A=>L(p,g,[A])}function aP(p,g,S){return Qe(p,S),A=>b(p,g,[A])}function lP(p,g,S){return Qe(p,S),(A,N)=>L(p,g,[A,N])}function uP(p,g,S){return Qe(p,S),A=>L(p,g,[A])}class Ta{constructor(g={},S={},A={}){g===void 0&&(g=null);let N=aa(S,"Second parameter"),V=aa(A,"Third parameter"),J=iP(g,"First parameter");if(J.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(J.writableType!==void 0)throw new RangeError("Invalid writableType specified");let Z=Ai(V,0),ce=sa(V),ie=Ai(N,1),de=sa(N),pe,ve=l(Kt=>{pe=Kt});cP(this,ve,ie,de,Z,ce),dP(this,J),J.start!==void 0?pe(J.start(this._transformStreamController)):pe(void 0)}get readable(){if(!Uy(this))throw Hy("readable");return this._readable}get writable(){if(!Uy(this))throw Hy("writable");return this._writable}}Object.defineProperties(Ta.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ta.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function cP(p,g,S,A,N,V){function J(){return g}function Z(ve){return mP(p,ve)}function ce(ve){return gP(p,ve)}function ie(){return yP(p)}p._writable=hx(J,Z,ie,ce,S,A);function de(){return _P(p)}function pe(ve){return SP(p,ve)}p._readable=Ii(J,de,pe,N,V),p._backpressure=void 0,p._backpressureChangePromise=void 0,p._backpressureChangePromise_resolve=void 0,Ea(p,!0),p._transformStreamController=void 0}function Uy(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_transformStreamController")?!1:p instanceof Ta}function qy(p,g){Jt(p._readable._readableStreamController,g),tf(p,g)}function tf(p,g){va(p._transformStreamController),Ci(p._writable._writableStreamController,g),nf(p)}function nf(p){p._backpressure&&Ea(p,!1)}function Ea(p,g){p._backpressureChangePromise!==void 0&&p._backpressureChangePromise_resolve(),p._backpressureChangePromise=l(S=>{p._backpressureChangePromise_resolve=S}),p._backpressure=g}class nr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!wa(this))throw Aa("desiredSize");let g=this._controlledTransformStream._readable._readableStreamController;return Zc(g)}enqueue(g=void 0){if(!wa(this))throw Aa("enqueue");By(this,g)}error(g=void 0){if(!wa(this))throw Aa("error");pP(this,g)}terminate(){if(!wa(this))throw Aa("terminate");hP(this)}}Object.defineProperties(nr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),o(nr.prototype.enqueue,"enqueue"),o(nr.prototype.error,"error"),o(nr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(nr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function wa(p){return!n(p)||!Object.prototype.hasOwnProperty.call(p,"_controlledTransformStream")?!1:p instanceof nr}function fP(p,g,S,A,N){g._controlledTransformStream=p,p._transformStreamController=g,g._transformAlgorithm=S,g._flushAlgorithm=A,g._cancelAlgorithm=N,g._finishPromise=void 0,g._finishPromise_resolve=void 0,g._finishPromise_reject=void 0}function dP(p,g){let S=Object.create(nr.prototype),A,N,V;g.transform!==void 0?A=J=>g.transform(J,S):A=J=>{try{return By(S,J),c(void 0)}catch(Z){return f(Z)}},g.flush!==void 0?N=()=>g.flush(S):N=()=>c(void 0),g.cancel!==void 0?V=J=>g.cancel(J):V=()=>c(void 0),fP(p,S,A,N,V)}function va(p){p._transformAlgorithm=void 0,p._flushAlgorithm=void 0,p._cancelAlgorithm=void 0}function By(p,g){let S=p._controlledTransformStream,A=S._readable._readableStreamController;if(!co(A))throw new TypeError("Readable side is not in a state that permits enqueue");try{uo(A,g)}catch(V){throw tf(S,V),S._readable._storedError}Hx(A)!==S._backpressure&&Ea(S,!0)}function pP(p,g){qy(p._controlledTransformStream,g)}function Gy(p,g){let S=p._transformAlgorithm(g);return T(S,void 0,A=>{throw qy(p._controlledTransformStream,A),A})}function hP(p){let g=p._controlledTransformStream,S=g._readable._readableStreamController;xr(S);let A=new TypeError("TransformStream terminated");tf(g,A)}function mP(p,g){let S=p._transformStreamController;if(p._backpressure){let A=p._backpressureChangePromise;return T(A,()=>{let N=p._writable;if(N._state==="erroring")throw N._storedError;return Gy(S,g)})}return Gy(S,g)}function gP(p,g){let S=p._transformStreamController;if(S._finishPromise!==void 0)return S._finishPromise;let A=p._readable;S._finishPromise=l((V,J)=>{S._finishPromise_resolve=V,S._finishPromise_reject=J});let N=S._cancelAlgorithm(g);return va(S),h(N,()=>(A._state==="errored"?fo(S,A._storedError):(Jt(A._readableStreamController,g),rf(S)),null),V=>(Jt(A._readableStreamController,V),fo(S,V),null)),S._finishPromise}function yP(p){let g=p._transformStreamController;if(g._finishPromise!==void 0)return g._finishPromise;let S=p._readable;g._finishPromise=l((N,V)=>{g._finishPromise_resolve=N,g._finishPromise_reject=V});let A=g._flushAlgorithm();return va(g),h(A,()=>(S._state==="errored"?fo(g,S._storedError):(xr(S._readableStreamController),rf(g)),null),N=>(Jt(S._readableStreamController,N),fo(g,N),null)),g._finishPromise}function _P(p){return Ea(p,!1),p._backpressureChangePromise}function SP(p,g){let S=p._transformStreamController;if(S._finishPromise!==void 0)return S._finishPromise;let A=p._writable;S._finishPromise=l((V,J)=>{S._finishPromise_resolve=V,S._finishPromise_reject=J});let N=S._cancelAlgorithm(g);return va(S),h(N,()=>(A._state==="errored"?fo(S,A._storedError):(Ci(A._writableStreamController,g),nf(p),rf(S)),null),V=>(Ci(A._writableStreamController,V),nf(p),fo(S,V),null)),S._finishPromise}function Aa(p){return new TypeError(`TransformStreamDefaultController.prototype.${p} can only be used on a TransformStreamDefaultController`)}function rf(p){p._finishPromise_resolve!==void 0&&(p._finishPromise_resolve(),p._finishPromise_resolve=void 0,p._finishPromise_reject=void 0)}function fo(p,g){p._finishPromise_reject!==void 0&&(E(p._finishPromise),p._finishPromise_reject(g),p._finishPromise_resolve=void 0,p._finishPromise_reject=void 0)}function Hy(p){return new TypeError(`TransformStream.prototype.${p} can only be used on a TransformStream`)}t.ByteLengthQueuingStrategy=_a,t.CountQueuingStrategy=Sa,t.ReadableByteStreamController=Pn,t.ReadableStream=Je,t.ReadableStreamBYOBReader=Qn,t.ReadableStreamBYOBRequest=vr,t.ReadableStreamDefaultController=Nn,t.ReadableStreamDefaultReader=z,t.TransformStream=Ta,t.TransformStreamDefaultController=nr,t.WritableStream=Zn,t.WritableStreamDefaultController=lo,t.WritableStreamDefaultWriter=kn}))});var sE=k(()=>{if(!globalThis.ReadableStream)try{let t=require("node:process"),{emitWarning:e}=t;try{t.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),t.emitWarning=e}catch(n){throw t.emitWarning=e,n}}catch{Object.assign(globalThis,iE())}try{let{Blob:t}=require("buffer");t&&!t.prototype.stream&&(t.prototype.stream=function(n){let r=0,o=this;return new ReadableStream({type:"bytes",async pull(i){let a=await o.slice(r,Math.min(o.size,r+65536)).arrayBuffer();r+=a.byteLength,i.enqueue(new Uint8Array(a)),r===o.size&&i.close()}})})}catch{}});async function*rd(t,e=!0){for(let n of t)if("stream"in n)yield*n.stream();else if(ArrayBuffer.isView(n))if(e){let r=n.byteOffset,o=n.byteOffset+n.byteLength;for(;r!==o;){let i=Math.min(o-r,aE),s=n.buffer.slice(r,r+i);r+=s.byteLength,yield new Uint8Array(s)}}else yield n;else{let r=0,o=n;for(;r!==o.size;){let s=await o.slice(r,Math.min(o.size,r+aE)).arrayBuffer();r+=s.byteLength,yield new Uint8Array(s)}}}var p8,aE,lE,_L,Yt,Hi=qe(()=>{p8=dn(sE(),1);aE=65536;lE=class od{#e=[];#t="";#n=0;#r="transparent";constructor(e=[],n={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof n!="object"&&typeof n!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");n===null&&(n={});let r=new TextEncoder;for(let i of e){let s;ArrayBuffer.isView(i)?s=new Uint8Array(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)):i instanceof ArrayBuffer?s=new Uint8Array(i.slice(0)):i instanceof od?s=i:s=r.encode(`${i}`),this.#n+=ArrayBuffer.isView(s)?s.byteLength:s.size,this.#e.push(s)}this.#r=`${n.endings===void 0?"transparent":n.endings}`;let o=n.type===void 0?"":String(n.type);this.#t=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#n}get type(){return this.#t}async text(){let e=new TextDecoder,n="";for await(let r of rd(this.#e,!1))n+=e.decode(r,{stream:!0});return n+=e.decode(),n}async arrayBuffer(){let e=new Uint8Array(this.size),n=0;for await(let r of rd(this.#e,!1))e.set(r,n),n+=r.length;return e.buffer}stream(){let e=rd(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(n){let r=await e.next();r.done?n.close():n.enqueue(r.value)},async cancel(){await e.return()}})}slice(e=0,n=this.size,r=""){let{size:o}=this,i=e<0?Math.max(o+e,0):Math.min(e,o),s=n<0?Math.max(o+n,0):Math.min(n,o),a=Math.max(s-i,0),l=this.#e,c=[],f=0;for(let h of l){if(f>=a)break;let y=ArrayBuffer.isView(h)?h.byteLength:h.size;if(i&&y<=i)i-=y,s-=y;else{let _;ArrayBuffer.isView(h)?(_=h.subarray(i,Math.min(y,s)),f+=_.byteLength):(_=h.slice(i,Math.min(y,s)),f+=_.size),s-=y,c.push(_),i=0}}let m=new od([],{type:String(r).toLowerCase()});return m.#n=a,m.#e=c,m}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(lE.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});_L=lE,Yt=_L});var SL,TL,ar,id=qe(()=>{Hi();SL=class extends Yt{#e=0;#t="";constructor(e,n,r={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,r),r===null&&(r={});let o=r.lastModified===void 0?Date.now():Number(r.lastModified);Number.isNaN(o)||(this.#e=o),this.#t=String(n)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Yt&&/^(File)$/.test(e[Symbol.toStringTag])}},TL=SL,ar=TL});function fE(t,e=Yt){var n=`${uE()}${uE()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),r=[],o=`--${n}\r
Content-Disposition: form-data; name="`;return t.forEach((i,s)=>typeof i=="string"?r.push(o+sd(s)+`"\r
\r
${i.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):r.push(o+sd(s)+`"; filename="${sd(i.name,1)}"\r
Content-Type: ${i.type||"application/octet-stream"}\r
\r
`,i,`\r
`)),r.push(`--${n}--`),new e(r,{type:"multipart/form-data; boundary="+n})}var $i,EL,wL,uE,vL,cE,sd,Mr,lr,ja=qe(()=>{Hi();id();({toStringTag:$i,iterator:EL,hasInstance:wL}=Symbol),uE=Math.random,vL="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),cE=(t,e,n)=>(t+="",/^(Blob|File)$/.test(e&&e[$i])?[(n=n!==void 0?n+"":e[$i]=="File"?e.name:"blob",t),e.name!==n||e[$i]=="blob"?new ar([e],n,e):e]:[t,e+""]),sd=(t,e)=>(e?t:t.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Mr=(t,e,n)=>{if(e.length<n)throw new TypeError(`Failed to execute '${t}' on 'FormData': ${n} arguments required, but only ${e.length} present.`)},lr=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[$i](){return"FormData"}[EL](){return this.entries()}static[wL](e){return e&&typeof e=="object"&&e[$i]==="FormData"&&!vL.some(n=>typeof e[n]!="function")}append(...e){Mr("append",arguments,2),this.#e.push(cE(...e))}delete(e){Mr("delete",arguments,1),e+="",this.#e=this.#e.filter(([n])=>n!==e)}get(e){Mr("get",arguments,1),e+="";for(var n=this.#e,r=n.length,o=0;o<r;o++)if(n[o][0]===e)return n[o][1];return null}getAll(e,n){return Mr("getAll",arguments,1),n=[],e+="",this.#e.forEach(r=>r[0]===e&&n.push(r[1])),n}has(e){return Mr("has",arguments,1),e+="",this.#e.some(n=>n[0]===e)}forEach(e,n){Mr("forEach",arguments,1);for(var[r,o]of this)e.call(n,o,r,this)}set(...e){Mr("set",arguments,2);var n=[],r=!0;e=cE(...e),this.#e.forEach(o=>{o[0]===e[0]?r&&(r=!n.push(e)):n.push(o)}),r&&n.push(e),this.#e=n}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var Dn,Xa=qe(()=>{Dn=class extends Error{constructor(e,n){super(e),Error.captureStackTrace(this,this.constructor),this.type=n}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var tt,ad=qe(()=>{Xa();tt=class extends Dn{constructor(e,n,r){super(e,n),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}});var Qa,ld,Vi,dE,pE,hE,Za=qe(()=>{Qa=Symbol.toStringTag,ld=t=>typeof t=="object"&&typeof t.append=="function"&&typeof t.delete=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.has=="function"&&typeof t.set=="function"&&typeof t.sort=="function"&&t[Qa]==="URLSearchParams",Vi=t=>t&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&/^(Blob|File)$/.test(t[Qa]),dE=t=>typeof t=="object"&&(t[Qa]==="AbortSignal"||t[Qa]==="EventTarget"),pE=(t,e)=>{let n=new URL(e).hostname,r=new URL(t).hostname;return n===r||n.endsWith(`.${r}`)},hE=(t,e)=>{let n=new URL(e).protocol,r=new URL(t).protocol;return n===r}});var gE=k((b8,mE)=>{if(!globalThis.DOMException)try{let{MessageChannel:t}=require("worker_threads"),e=new t().port1,n=new ArrayBuffer;e.postMessage(n,[n,n])}catch(t){t.constructor.name==="DOMException"&&(globalThis.DOMException=t.constructor)}mE.exports=globalThis.DOMException});var Or,yE,_E,ud,SE,TE,EE,wE,vE,AE,el,cd=qe(()=>{Or=require("node:fs"),yE=require("node:path"),_E=dn(gE(),1);id();Hi();({stat:ud}=Or.promises),SE=(t,e)=>vE((0,Or.statSync)(t),t,e),TE=(t,e)=>ud(t).then(n=>vE(n,t,e)),EE=(t,e)=>ud(t).then(n=>AE(n,t,e)),wE=(t,e)=>AE((0,Or.statSync)(t),t,e),vE=(t,e,n="")=>new Yt([new el({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],{type:n}),AE=(t,e,n="")=>new ar([new el({path:e,size:t.size,lastModified:t.mtimeMs,start:0})],(0,yE.basename)(e),{type:n,lastModified:t.mtimeMs}),el=class t{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,n){return new t({path:this.#e,lastModified:this.lastModified,size:n-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await ud(this.#e);if(e>this.lastModified)throw new _E.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Or.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var bE={};Vy(bE,{toFormData:()=>PL});function xL(t){let e=t.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let n=e[2]||e[3]||"",r=n.slice(n.lastIndexOf("\\")+1);return r=r.replace(/%22/g,'"'),r=r.replace(/&#(\d{4});/g,(o,i)=>String.fromCharCode(i)),r}async function PL(t,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let n=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");let r=new fd(n[1]||n[2]),o,i,s,a,l,c,f=[],m=new lr,h=w=>{s+=E.decode(w,{stream:!0})},y=w=>{f.push(w)},_=()=>{let w=new ar(f,c,{type:l});m.append(a,w)},T=()=>{m.append(a,s)},E=new TextDecoder("utf-8");E.decode(),r.onPartBegin=function(){r.onPartData=h,r.onPartEnd=T,o="",i="",s="",a="",l="",c=null,f.length=0},r.onHeaderField=function(w){o+=E.decode(w,{stream:!0})},r.onHeaderValue=function(w){i+=E.decode(w,{stream:!0})},r.onHeaderEnd=function(){if(i+=E.decode(),o=o.toLowerCase(),o==="content-disposition"){let w=i.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);w&&(a=w[2]||w[3]||""),c=xL(i),c&&(r.onPartData=y,r.onPartEnd=_)}else o==="content-type"&&(l=i);i="",o=""};for await(let w of t)r.write(w);return r.end(),m}var mn,be,CE,ur,tl,nl,AL,Wi,CL,bL,RL,IL,Dr,fd,RE=qe(()=>{cd();ja();mn=0,be={START_BOUNDARY:mn++,HEADER_FIELD_START:mn++,HEADER_FIELD:mn++,HEADER_VALUE_START:mn++,HEADER_VALUE:mn++,HEADER_VALUE_ALMOST_DONE:mn++,HEADERS_ALMOST_DONE:mn++,PART_DATA_START:mn++,PART_DATA:mn++,END:mn++},CE=1,ur={PART_BOUNDARY:CE,LAST_BOUNDARY:CE*=2},tl=10,nl=13,AL=32,Wi=45,CL=58,bL=97,RL=122,IL=t=>t|32,Dr=()=>{},fd=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Dr,this.onHeaderField=Dr,this.onHeadersEnd=Dr,this.onHeaderValue=Dr,this.onPartBegin=Dr,this.onPartData=Dr,this.onPartEnd=Dr,this.boundaryChars={},e=`\r
--`+e;let n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r),this.boundaryChars[n[r]]=!0;this.boundary=n,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=be.START_BOUNDARY}write(e){let n=0,r=e.length,o=this.index,{lookbehind:i,boundary:s,boundaryChars:a,index:l,state:c,flags:f}=this,m=this.boundary.length,h=m-1,y=e.length,_,T,E=D=>{this[D+"Mark"]=n},w=D=>{delete this[D+"Mark"]},b=(D,I,P,q)=>{(I===void 0||I!==P)&&this[D](q&&q.subarray(I,P))},L=(D,I)=>{let P=D+"Mark";P in this&&(I?(b(D,this[P],n,e),delete this[P]):(b(D,this[P],e.length,e),this[P]=0))};for(n=0;n<r;n++)switch(_=e[n],c){case be.START_BOUNDARY:if(l===s.length-2){if(_===Wi)f|=ur.LAST_BOUNDARY;else if(_!==nl)return;l++;break}else if(l-1===s.length-2){if(f&ur.LAST_BOUNDARY&&_===Wi)c=be.END,f=0;else if(!(f&ur.LAST_BOUNDARY)&&_===tl)l=0,b("onPartBegin"),c=be.HEADER_FIELD_START;else return;break}_!==s[l+2]&&(l=-2),_===s[l+2]&&l++;break;case be.HEADER_FIELD_START:c=be.HEADER_FIELD,E("onHeaderField"),l=0;case be.HEADER_FIELD:if(_===nl){w("onHeaderField"),c=be.HEADERS_ALMOST_DONE;break}if(l++,_===Wi)break;if(_===CL){if(l===1)return;L("onHeaderField",!0),c=be.HEADER_VALUE_START;break}if(T=IL(_),T<bL||T>RL)return;break;case be.HEADER_VALUE_START:if(_===AL)break;E("onHeaderValue"),c=be.HEADER_VALUE;case be.HEADER_VALUE:_===nl&&(L("onHeaderValue",!0),b("onHeaderEnd"),c=be.HEADER_VALUE_ALMOST_DONE);break;case be.HEADER_VALUE_ALMOST_DONE:if(_!==tl)return;c=be.HEADER_FIELD_START;break;case be.HEADERS_ALMOST_DONE:if(_!==tl)return;b("onHeadersEnd"),c=be.PART_DATA_START;break;case be.PART_DATA_START:c=be.PART_DATA,E("onPartData");case be.PART_DATA:if(o=l,l===0){for(n+=h;n<y&&!(e[n]in a);)n+=m;n-=h,_=e[n]}if(l<s.length)s[l]===_?(l===0&&L("onPartData",!0),l++):l=0;else if(l===s.length)l++,_===nl?f|=ur.PART_BOUNDARY:_===Wi?f|=ur.LAST_BOUNDARY:l=0;else if(l-1===s.length)if(f&ur.PART_BOUNDARY){if(l=0,_===tl){f&=~ur.PART_BOUNDARY,b("onPartEnd"),b("onPartBegin"),c=be.HEADER_FIELD_START;break}}else f&ur.LAST_BOUNDARY&&_===Wi?(b("onPartEnd"),c=be.END,f=0):l=0;if(l>0)i[l-1]=_;else if(o>0){let D=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);b("onPartData",0,o,D),o=0,E("onPartData"),n--}break;case be.END:break;default:throw new Error(`Unexpected state entered: ${c}`)}L("onHeaderField"),L("onHeaderValue"),L("onPartData"),this.index=l,this.state=c,this.flags=f}end(){if(this.state===be.HEADER_FIELD_START&&this.index===0||this.state===be.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==be.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function dd(t){if(t[ct].disturbed)throw new TypeError(`body used already for: ${t.url}`);if(t[ct].disturbed=!0,t[ct].error)throw t[ct].error;let{body:e}=t;if(e===null)return St.Buffer.alloc(0);if(!(e instanceof Lt.default))return St.Buffer.alloc(0);let n=[],r=0;try{for await(let o of e){if(t.size>0&&r+o.length>t.size){let i=new tt(`content size at ${t.url} over limit: ${t.size}`,"max-size");throw e.destroy(i),i}r+=o.length,n.push(o)}}catch(o){throw o instanceof Dn?o:new tt(`Invalid response body while trying to fetch ${t.url}: ${o.message}`,"system",o)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return n.every(o=>typeof o=="string")?St.Buffer.from(n.join("")):St.Buffer.concat(n,r)}catch(o){throw new tt(`Could not create Buffer from response body for ${t.url}: ${o.message}`,"system",o)}else throw new tt(`Premature close of server response while trying to fetch ${t.url}`)}var Lt,Fn,St,kL,ct,gn,Co,NL,rl,IE,xE,ol=qe(()=>{Lt=dn(require("node:stream"),1),Fn=require("node:util"),St=require("node:buffer");Hi();ja();ad();Xa();Za();kL=(0,Fn.promisify)(Lt.default.pipeline),ct=Symbol("Body internals"),gn=class{constructor(e,{size:n=0}={}){let r=null;e===null?e=null:ld(e)?e=St.Buffer.from(e.toString()):Vi(e)||St.Buffer.isBuffer(e)||(Fn.types.isAnyArrayBuffer(e)?e=St.Buffer.from(e):ArrayBuffer.isView(e)?e=St.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Lt.default||(e instanceof lr?(e=fE(e),r=e.type.split("=")[1]):e=St.Buffer.from(String(e))));let o=e;St.Buffer.isBuffer(e)?o=Lt.default.Readable.from(e):Vi(e)&&(o=Lt.default.Readable.from(e.stream())),this[ct]={body:e,stream:o,boundary:r,disturbed:!1,error:null},this.size=n,e instanceof Lt.default&&e.on("error",i=>{let s=i instanceof Dn?i:new tt(`Invalid response body while trying to fetch ${this.url}: ${i.message}`,"system",i);this[ct].error=s})}get body(){return this[ct].stream}get bodyUsed(){return this[ct].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:n,byteLength:r}=await dd(this);return e.slice(n,n+r)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let r=new lr,o=new URLSearchParams(await this.text());for(let[i,s]of o)r.append(i,s);return r}let{toFormData:n}=await Promise.resolve().then(()=>(RE(),bE));return n(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[ct].body&&this[ct].body.type||"",n=await this.arrayBuffer();return new Yt([n],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await dd(this);return new TextDecoder().decode(e)}buffer(){return dd(this)}};gn.prototype.buffer=(0,Fn.deprecate)(gn.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(gn.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Fn.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Co=(t,e)=>{let n,r,{body:o}=t[ct];if(t.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof Lt.default&&typeof o.getBoundary!="function"&&(n=new Lt.PassThrough({highWaterMark:e}),r=new Lt.PassThrough({highWaterMark:e}),o.pipe(n),o.pipe(r),t[ct].stream=n,o=r),o},NL=(0,Fn.deprecate)(t=>t.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),rl=(t,e)=>t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":ld(t)?"application/x-www-form-urlencoded;charset=UTF-8":Vi(t)?t.type||null:St.Buffer.isBuffer(t)||Fn.types.isAnyArrayBuffer(t)||ArrayBuffer.isView(t)?null:t instanceof lr?`multipart/form-data; boundary=${e[ct].boundary}`:t&&typeof t.getBoundary=="function"?`multipart/form-data;boundary=${NL(t)}`:t instanceof Lt.default?null:"text/plain;charset=UTF-8",IE=t=>{let{body:e}=t[ct];return e===null?0:Vi(e)?e.size:St.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},xE=async(t,{body:e})=>{e===null?t.end():await kL(e,t)}});function PE(t=[]){return new ft(t.reduce((e,n,r,o)=>(r%2===0&&e.push(o.slice(r,r+2)),e),[]).filter(([e,n])=>{try{return il(e),hd(e,String(n)),!0}catch{return!1}}))}var pd,Ji,il,hd,ft,sl=qe(()=>{pd=require("node:util"),Ji=dn(require("node:http"),1),il=typeof Ji.default.validateHeaderName=="function"?Ji.default.validateHeaderName:t=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(t)){let e=new TypeError(`Header name must be a valid HTTP token [${t}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},hd=typeof Ji.default.validateHeaderValue=="function"?Ji.default.validateHeaderValue:(t,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let n=new TypeError(`Invalid character in header content ["${t}"]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_CHAR"}),n}},ft=class t extends URLSearchParams{constructor(e){let n=[];if(e instanceof t){let r=e.raw();for(let[o,i]of Object.entries(r))n.push(...i.map(s=>[o,s]))}else if(e!=null)if(typeof e=="object"&&!pd.types.isBoxedPrimitive(e)){let r=e[Symbol.iterator];if(r==null)n.push(...Object.entries(e));else{if(typeof r!="function")throw new TypeError("Header pairs must be iterable");n=[...e].map(o=>{if(typeof o!="object"||pd.types.isBoxedPrimitive(o))throw new TypeError("Each header pair must be an iterable object");return[...o]}).map(o=>{if(o.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...o]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return n=n.length>0?n.map(([r,o])=>(il(r),hd(r,String(o)),[String(r).toLowerCase(),String(o)])):void 0,super(n),new Proxy(this,{get(r,o,i){switch(o){case"append":case"set":return(s,a)=>(il(s),hd(s,String(a)),URLSearchParams.prototype[o].call(r,String(s).toLowerCase(),String(a)));case"delete":case"has":case"getAll":return s=>(il(s),URLSearchParams.prototype[o].call(r,String(s).toLowerCase()));case"keys":return()=>(r.sort(),new Set(URLSearchParams.prototype.keys.call(r)).keys());default:return Reflect.get(r,o,i)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let n=this.getAll(e);if(n.length===0)return null;let r=n.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,n=void 0){for(let r of this.keys())Reflect.apply(e,n,[this.get(r),r,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,n)=>(e[n]=this.getAll(n),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,n)=>{let r=this.getAll(n);return n==="host"?e[n]=r[0]:e[n]=r.length>1?r:r[0],e},{})}};Object.defineProperties(ft.prototype,["get","entries","forEach","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}))});var ML,zi,md=qe(()=>{ML=new Set([301,302,303,307,308]),zi=t=>ML.has(t)});var jt,Tt,kE=qe(()=>{sl();ol();md();jt=Symbol("Response internals"),Tt=class t extends gn{constructor(e=null,n={}){super(e,n);let r=n.status!=null?n.status:200,o=new ft(n.headers);if(e!==null&&!o.has("Content-Type")){let i=rl(e,this);i&&o.append("Content-Type",i)}this[jt]={type:"default",url:n.url,status:r,statusText:n.statusText||"",headers:o,counter:n.counter,highWaterMark:n.highWaterMark}}get type(){return this[jt].type}get url(){return this[jt].url||""}get status(){return this[jt].status}get ok(){return this[jt].status>=200&&this[jt].status<300}get redirected(){return this[jt].counter>0}get statusText(){return this[jt].statusText}get headers(){return this[jt].headers}get highWaterMark(){return this[jt].highWaterMark}clone(){return new t(Co(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,n=302){if(!zi(n))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new t(null,{headers:{location:new URL(e).toString()},status:n})}static error(){let e=new t(null,{status:0,statusText:""});return e[jt].type="error",e}static json(e=void 0,n={}){let r=JSON.stringify(e);if(r===void 0)throw new TypeError("data is not JSON serializable");let o=new ft(n&&n.headers);return o.has("content-type")||o.set("content-type","application/json"),new t(r,{...n,headers:o})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(Tt.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var NE,ME=qe(()=>{NE=t=>{if(t.search)return t.search;let e=t.href.length-1,n=t.hash||(t.href[e]==="#"?"#":"");return t.href[e-n.length]==="?"?"?":""}});function OE(t,e=!1){return t==null||(t=new URL(t),/^(about|blob|data):$/.test(t.protocol))?"no-referrer":(t.username="",t.password="",t.hash="",e&&(t.pathname="",t.search=""),t)}function UE(t){if(!FE.has(t))throw new TypeError(`Invalid referrerPolicy: ${t}`);return t}function OL(t){if(/^(http|ws)s:$/.test(t.protocol))return!0;let e=t.host.replace(/(^\[)|(]$)/g,""),n=(0,DE.isIP)(e);return n===4&&/^127\./.test(e)||n===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:t.host==="localhost"||t.host.endsWith(".localhost")?!1:t.protocol==="file:"}function bo(t){return/^about:(blank|srcdoc)$/.test(t)||t.protocol==="data:"||/^(blob|filesystem):$/.test(t.protocol)?!0:OL(t)}function qE(t,{referrerURLCallback:e,referrerOriginCallback:n}={}){if(t.referrer==="no-referrer"||t.referrerPolicy==="")return null;let r=t.referrerPolicy;if(t.referrer==="about:client")return"no-referrer";let o=t.referrer,i=OE(o),s=OE(o,!0);i.toString().length>4096&&(i=s),e&&(i=e(i)),n&&(s=n(s));let a=new URL(t.url);switch(r){case"no-referrer":return"no-referrer";case"origin":return s;case"unsafe-url":return i;case"strict-origin":return bo(i)&&!bo(a)?"no-referrer":s.toString();case"strict-origin-when-cross-origin":return i.origin===a.origin?i:bo(i)&&!bo(a)?"no-referrer":s;case"same-origin":return i.origin===a.origin?i:"no-referrer";case"origin-when-cross-origin":return i.origin===a.origin?i:s;case"no-referrer-when-downgrade":return bo(i)&&!bo(a)?"no-referrer":i;default:throw new TypeError(`Invalid referrerPolicy: ${r}`)}}function BE(t){let e=(t.get("referrer-policy")||"").split(/[,\s]+/),n="";for(let r of e)r&&FE.has(r)&&(n=r);return n}var DE,FE,LE,gd=qe(()=>{DE=require("node:net");FE=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),LE="strict-origin-when-cross-origin"});var GE,HE,He,Ki,DL,cr,$E,VE=qe(()=>{GE=require("node:url"),HE=require("node:util");sl();ol();Za();ME();gd();He=Symbol("Request internals"),Ki=t=>typeof t=="object"&&typeof t[He]=="object",DL=(0,HE.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),cr=class t extends gn{constructor(e,n={}){let r;if(Ki(e)?r=new URL(e.url):(r=new URL(e),e={}),r.username!==""||r.password!=="")throw new TypeError(`${r} is an url with embedded credentials.`);let o=n.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(o)&&(o=o.toUpperCase()),!Ki(n)&&"data"in n&&DL(),(n.body!=null||Ki(e)&&e.body!==null)&&(o==="GET"||o==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let i=n.body?n.body:Ki(e)&&e.body!==null?Co(e):null;super(i,{size:n.size||e.size||0});let s=new ft(n.headers||e.headers||{});if(i!==null&&!s.has("Content-Type")){let c=rl(i,this);c&&s.set("Content-Type",c)}let a=Ki(e)?e.signal:null;if("signal"in n&&(a=n.signal),a!=null&&!dE(a))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let l=n.referrer==null?e.referrer:n.referrer;if(l==="")l="no-referrer";else if(l){let c=new URL(l);l=/^about:(\/\/)?client$/.test(c)?"client":c}else l=void 0;this[He]={method:o,redirect:n.redirect||e.redirect||"follow",headers:s,parsedURL:r,signal:a,referrer:l},this.follow=n.follow===void 0?e.follow===void 0?20:e.follow:n.follow,this.compress=n.compress===void 0?e.compress===void 0?!0:e.compress:n.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent,this.highWaterMark=n.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=n.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=n.referrerPolicy||e.referrerPolicy||""}get method(){return this[He].method}get url(){return(0,GE.format)(this[He].parsedURL)}get headers(){return this[He].headers}get redirect(){return this[He].redirect}get signal(){return this[He].signal}get referrer(){if(this[He].referrer==="no-referrer")return"";if(this[He].referrer==="client")return"about:client";if(this[He].referrer)return this[He].referrer.toString()}get referrerPolicy(){return this[He].referrerPolicy}set referrerPolicy(e){this[He].referrerPolicy=UE(e)}clone(){return new t(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(cr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});$E=t=>{let{parsedURL:e}=t[He],n=new ft(t[He].headers);n.has("Accept")||n.set("Accept","*/*");let r=null;if(t.body===null&&/^(post|put)$/i.test(t.method)&&(r="0"),t.body!==null){let a=IE(t);typeof a=="number"&&!Number.isNaN(a)&&(r=String(a))}r&&n.set("Content-Length",r),t.referrerPolicy===""&&(t.referrerPolicy=LE),t.referrer&&t.referrer!=="no-referrer"?t[He].referrer=qE(t):t[He].referrer="no-referrer",t[He].referrer instanceof URL&&n.set("Referer",t.referrer),n.has("User-Agent")||n.set("User-Agent","node-fetch"),t.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=t;typeof o=="function"&&(o=o(e));let i=NE(e),s={path:e.pathname+i,method:t.method,headers:n[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:t.insecureHTTPParser,agent:o};return{parsedURL:e,options:s}}});var Yi,WE=qe(()=>{Xa();Yi=class extends Dn{constructor(e,n="aborted"){super(e,n)}}});var KE={};Vy(KE,{AbortError:()=>Yi,Blob:()=>Yt,FetchError:()=>tt,File:()=>ar,FormData:()=>lr,Headers:()=>ft,Request:()=>cr,Response:()=>Tt,blobFrom:()=>TE,blobFromSync:()=>SE,default:()=>yd,fileFrom:()=>EE,fileFromSync:()=>wE,isRedirect:()=>zi});async function yd(t,e){return new Promise((n,r)=>{let o=new cr(t,e),{parsedURL:i,options:s}=$E(o);if(!FL.has(i.protocol))throw new TypeError(`node-fetch cannot load ${t}. URL scheme "${i.protocol.replace(/:$/,"")}" is not supported.`);if(i.protocol==="data:"){let _=nE(o.url),T=new Tt(_,{headers:{"Content-Type":_.typeFull}});n(T);return}let a=(i.protocol==="https:"?zE.default:JE.default).request,{signal:l}=o,c=null,f=()=>{let _=new Yi("The operation was aborted.");r(_),o.body&&o.body instanceof Et.default.Readable&&o.body.destroy(_),!(!c||!c.body)&&c.body.emit("error",_)};if(l&&l.aborted){f();return}let m=()=>{f(),y()},h=a(i.toString(),s);l&&l.addEventListener("abort",m);let y=()=>{h.abort(),l&&l.removeEventListener("abort",m)};h.on("error",_=>{r(new tt(`request to ${o.url} failed, reason: ${_.message}`,"system",_)),y()}),LL(h,_=>{c&&c.body&&c.body.destroy(_)}),process.version<"v14"&&h.on("socket",_=>{let T;_.prependListener("end",()=>{T=_._eventsCount}),_.prependListener("close",E=>{if(c&&T<_._eventsCount&&!E){let w=new Error("Premature close");w.code="ERR_STREAM_PREMATURE_CLOSE",c.body.emit("error",w)}})}),h.on("response",_=>{h.setTimeout(0);let T=PE(_.rawHeaders);if(zi(_.statusCode)){let D=T.get("Location"),I=null;try{I=D===null?null:new URL(D,o.url)}catch{if(o.redirect!=="manual"){r(new tt(`uri requested responds with an invalid redirect URL: ${D}`,"invalid-redirect")),y();return}}switch(o.redirect){case"error":r(new tt(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),y();return;case"manual":break;case"follow":{if(I===null)break;if(o.counter>=o.follow){r(new tt(`maximum redirect reached at: ${o.url}`,"max-redirect")),y();return}let P={headers:new ft(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:Co(o),signal:o.signal,size:o.size,referrer:o.referrer,referrerPolicy:o.referrerPolicy};if(!pE(o.url,I)||!hE(o.url,I))for(let K of["authorization","www-authenticate","cookie","cookie2"])P.headers.delete(K);if(_.statusCode!==303&&o.body&&e.body instanceof Et.default.Readable){r(new tt("Cannot follow redirect with body being a readable stream","unsupported-redirect")),y();return}(_.statusCode===303||(_.statusCode===301||_.statusCode===302)&&o.method==="POST")&&(P.method="GET",P.body=void 0,P.headers.delete("content-length"));let q=BE(T);q&&(P.referrerPolicy=q),n(yd(new cr(I,P))),y();return}default:return r(new TypeError(`Redirect option '${o.redirect}' is not a valid value of RequestRedirect`))}}l&&_.once("end",()=>{l.removeEventListener("abort",m)});let E=(0,Et.pipeline)(_,new Et.PassThrough,D=>{D&&r(D)});process.version<"v12.10"&&_.on("aborted",m);let w={url:o.url,status:_.statusCode,statusText:_.statusMessage,headers:T,size:o.size,counter:o.counter,highWaterMark:o.highWaterMark},b=T.get("Content-Encoding");if(!o.compress||o.method==="HEAD"||b===null||_.statusCode===204||_.statusCode===304){c=new Tt(E,w),n(c);return}let L={flush:Fr.default.Z_SYNC_FLUSH,finishFlush:Fr.default.Z_SYNC_FLUSH};if(b==="gzip"||b==="x-gzip"){E=(0,Et.pipeline)(E,Fr.default.createGunzip(L),D=>{D&&r(D)}),c=new Tt(E,w),n(c);return}if(b==="deflate"||b==="x-deflate"){let D=(0,Et.pipeline)(_,new Et.PassThrough,I=>{I&&r(I)});D.once("data",I=>{(I[0]&15)===8?E=(0,Et.pipeline)(E,Fr.default.createInflate(),P=>{P&&r(P)}):E=(0,Et.pipeline)(E,Fr.default.createInflateRaw(),P=>{P&&r(P)}),c=new Tt(E,w),n(c)}),D.once("end",()=>{c||(c=new Tt(E,w),n(c))});return}if(b==="br"){E=(0,Et.pipeline)(E,Fr.default.createBrotliDecompress(),D=>{D&&r(D)}),c=new Tt(E,w),n(c);return}c=new Tt(E,w),n(c)}),xE(h,o).catch(r)})}function LL(t,e){let n=ji.Buffer.from(`0\r
\r
`),r=!1,o=!1,i;t.on("response",s=>{let{headers:a}=s;r=a["transfer-encoding"]==="chunked"&&!a["content-length"]}),t.on("socket",s=>{let a=()=>{if(r&&!o){let c=new Error("Premature close");c.code="ERR_STREAM_PREMATURE_CLOSE",e(c)}},l=c=>{o=ji.Buffer.compare(c.slice(-5),n)===0,!o&&i&&(o=ji.Buffer.compare(i.slice(-3),n.slice(0,3))===0&&ji.Buffer.compare(c.slice(-2),n.slice(3))===0),i=c};s.prependListener("close",a),s.on("data",l),t.on("close",()=>{s.removeListener("close",a),s.removeListener("data",l)})})}var JE,zE,Fr,Et,ji,FL,YE=qe(()=>{JE=dn(require("node:http"),1),zE=dn(require("node:https"),1),Fr=dn(require("node:zlib"),1),Et=dn(require("node:stream"),1),ji=require("node:buffer");rE();ol();kE();sl();VE();ad();WE();md();ja();Za();gd();cd();FL=new Set(["data:","http:","https:"])});var QE=k(Io=>{"use strict";var UL=Io&&Io.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},Ro;Object.defineProperty(Io,"__esModule",{value:!0});Io.Gaxios=void 0;var qL=UL(Vf()),BL=require("https"),Lr=zf(),GL=PT(),jE=require("stream"),XE=jf(),HL=async()=>globalThis.crypto?.randomUUID()||(await import("crypto")).randomUUID(),$L=204,al=class{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new XE.GaxiosInterceptorManager,response:new XE.GaxiosInterceptorManager}}fetch(...e){let n=e[0],r=e[1],o,i=new Headers;return typeof n=="string"?o=new URL(n):n instanceof URL?o=n:n&&n.url&&(o=new URL(n.url)),n&&typeof n=="object"&&"headers"in n&&Ro.mergeHeaders(i,n.headers),r&&Ro.mergeHeaders(i,new Headers(r.headers)),typeof n=="object"&&!(n instanceof URL)?this.request({...r,...n,headers:i,url:o}):this.request({...r,headers:i,url:o})}async request(e={}){let n=await this.#r(e);return n=await this.#t(n),this.#n(this._request(n))}async _defaultAdapter(e){let n=e.fetchImplementation||this.defaults.fetchImplementation||await Ro.#l(),r={...e};delete r.data;let o=await n(e.url,r),i=await this.getResponseData(e,o);return Object.getOwnPropertyDescriptor(o,"data")?.configurable||Object.defineProperties(o,{data:{configurable:!0,writable:!0,enumerable:!0,value:i}}),Object.assign(o,{config:e,data:i})}async _request(e){try{let n;if(e.adapter?n=await e.adapter(e,this._defaultAdapter.bind(this)):n=await this._defaultAdapter(e),!e.validateStatus(n.status)){if(e.responseType==="stream"){let o=[];for await(let i of n.data)o.push(i);n.data=o.toString()}let r=Lr.GaxiosError.extractAPIErrorFromResponse(n,`Request failed with status code ${n.status}`);throw new Lr.GaxiosError(r?.message,e,n,r)}return n}catch(n){let r;n instanceof Lr.GaxiosError?r=n:n instanceof Error?r=new Lr.GaxiosError(n.message,e,void 0,n):r=new Lr.GaxiosError("Unexpected Gaxios Error",e,void 0,n);let{shouldRetry:o,config:i}=await(0,GL.getRetryConfig)(r);if(o&&i)return r.config.retryConfig.currentRetryAttempt=i.retryConfig.currentRetryAttempt,e.retryConfig=r.config?.retryConfig,this.#o(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(r),r}}async getResponseData(e,n){if(n.status===$L)return"";if(e.maxContentLength&&n.headers.has("content-length")&&e.maxContentLength<Number.parseInt(n.headers?.get("content-length")||""))throw new Lr.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(n,{config:e}));switch(e.responseType){case"stream":return n.body;case"json":{let r=await n.text();try{return JSON.parse(r)}catch{return r}}case"arraybuffer":return n.arrayBuffer();case"blob":return n.blob();case"text":return n.text();default:return this.getResponseDataFromContentType(n)}}#e(e,n=[]){let r=new URL(e),o=[...n],i=(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[];for(let s of i)o.push(s.trim());for(let s of o)if(s instanceof RegExp){if(s.test(r.toString()))return!1}else if(s instanceof URL){if(s.origin===r.origin)return!1}else if(s.startsWith("*.")||s.startsWith(".")){let a=s.replace(/^\*\./,".");if(r.hostname.endsWith(a))return!1}else if(s===r.origin||s===r.hostname||s===r.href)return!1;return!0}async#t(e){let n=Promise.resolve(e);for(let r of this.interceptors.request.values())r&&(n=n.then(r.resolved,r.rejected));return n}async#n(e){let n=Promise.resolve(e);for(let r of this.interceptors.response.values())r&&(n=n.then(r.resolved,r.rejected));return n}async#r(e){let n=new Headers(this.defaults.headers);Ro.mergeHeaders(n,e.headers);let r=(0,qL.default)(!0,{},this.defaults,e);if(!r.url)throw new Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params)if(r.paramsSerializer){let s=r.paramsSerializer(r.params);s.startsWith("?")&&(s=s.slice(1));let a=r.url.toString().includes("?")?"&":"?";r.url=r.url+a+s}else{let s=r.url instanceof URL?r.url:new URL(r.url);for(let[a,l]of new URLSearchParams(r.params))s.searchParams.append(a,l);r.url=s}typeof e.maxContentLength=="number"&&(r.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(r.follow=e.maxRedirects);let o=typeof r.data=="string"||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof jE.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(r.data?.constructor?.name||"");if(r.multipart?.length){let s=await HL();n.set("content-type",`multipart/related; boundary=${s}`),r.body=jE.Readable.from(this.getMultipartRequest(r.multipart,s))}else o?r.body=r.data:typeof r.data=="object"?n.get("Content-Type")==="application/x-www-form-urlencoded"?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(n.has("content-type")||n.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",!n.has("accept")&&r.responseType==="json"&&n.set("accept","application/json");let i=r.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(!r.agent)if(i&&this.#e(r.url,r.noProxy)){let s=await Ro.#a();this.agentCache.has(i)?r.agent=this.agentCache.get(i):(r.agent=new s(i,{cert:r.cert,key:r.key}),this.agentCache.set(i,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new BL.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return typeof r.errorRedactor!="function"&&r.errorRedactor!==!1&&(r.errorRedactor=Lr.defaultErrorRedactor),r.body&&!("duplex"in r)&&(r.duplex="half"),this.#o(r),Object.assign(r,{headers:n,url:r.url instanceof URL?r.url:new URL(r.url)})}#o(e){if(e.timeout){let n=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,n]):e.signal=n}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let n=e.headers.get("Content-Type");if(n===null)return e.text();if(n=n.toLowerCase(),n.includes("application/json")){let r=await e.text();try{r=JSON.parse(r)}catch{}return r}else return n.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,n){let r=`--${n}--`;for(let o of e){let i=o.headers.get("Content-Type")||"application/octet-stream";yield`--${n}\r
Content-Type: ${i}\r
\r
`,typeof o.content=="string"?yield o.content:yield*o.content,yield`\r
`}yield r}static#i;static#s;static async#a(){return this.#i||=(await Promise.resolve().then(()=>dn(tE()))).HttpsProxyAgent,this.#i}static async#l(){let e=typeof window<"u"&&!!window;return this.#s||=e?window.fetch:(await Promise.resolve().then(()=>(YE(),KE))).default,this.#s}static mergeHeaders(e,...n){e=e instanceof Headers?e:new Headers(e);for(let r of n)(r instanceof Headers?r:new Headers(r)).forEach((i,s)=>{s==="set-cookie"?e.append(s,i):e.set(s,i)});return e}};Io.Gaxios=al;Ro=al});var Ve=k(nt=>{"use strict";var VL=nt&&nt.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),WL=nt&&nt.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&VL(e,t,n)};Object.defineProperty(nt,"__esModule",{value:!0});nt.instance=nt.Gaxios=nt.GaxiosError=void 0;nt.request=zL;var ZE=QE();Object.defineProperty(nt,"Gaxios",{enumerable:!0,get:function(){return ZE.Gaxios}});var JL=zf();Object.defineProperty(nt,"GaxiosError",{enumerable:!0,get:function(){return JL.GaxiosError}});WL(jf(),nt);nt.instance=new ZE.Gaxios;async function zL(t){return nt.instance.request(t)}});var _d=k((ew,ll)=>{(function(t){"use strict";var e,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,o=Math.floor,i="[BigNumber Error] ",s=i+"Number primitive has more than 15 significant digits: ",a=1e14,l=14,c=9007199254740991,f=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],m=1e7,h=1e9;function y(I){var P,q,K,B=Y.prototype={constructor:Y,toString:null,valueOf:null},j=new Y(1),Q=20,oe=4,le=-7,ue=21,ye=-1e7,Te=1e7,Ae=!1,Pe=1,Oe=0,to={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},cn="0123456789abcdefghijklmnopqrstuvwxyz",Ti=!0;function Y(v,R){var x,H,O,U,W,M,F,$,G=this;if(!(G instanceof Y))return new Y(v,R);if(R==null){if(v&&v._isBigNumber===!0){G.s=v.s,!v.c||v.e>Te?G.c=G.e=null:v.e<ye?G.c=[G.e=0]:(G.e=v.e,G.c=v.c.slice());return}if((M=typeof v=="number")&&v*0==0){if(G.s=1/v<0?(v=-v,-1):1,v===~~v){for(U=0,W=v;W>=10;W/=10,U++);U>Te?G.c=G.e=null:(G.e=U,G.c=[v]);return}$=String(v)}else{if(!n.test($=String(v)))return K(G,$,M);G.s=$.charCodeAt(0)==45?($=$.slice(1),-1):1}(U=$.indexOf("."))>-1&&($=$.replace(".","")),(W=$.search(/e/i))>0?(U<0&&(U=W),U+=+$.slice(W+1),$=$.substring(0,W)):U<0&&(U=$.length)}else{if(w(R,2,cn.length,"Base"),R==10&&Ti)return G=new Y(v),Ze(G,Q+G.e+1,oe);if($=String(v),M=typeof v=="number"){if(v*0!=0)return K(G,$,M,R);if(G.s=1/v<0?($=$.slice(1),-1):1,Y.DEBUG&&$.replace(/^0\.0*|\./,"").length>15)throw Error(s+v)}else G.s=$.charCodeAt(0)===45?($=$.slice(1),-1):1;for(x=cn.slice(0,R),U=W=0,F=$.length;W<F;W++)if(x.indexOf(H=$.charAt(W))<0){if(H=="."){if(W>U){U=F;continue}}else if(!O&&($==$.toUpperCase()&&($=$.toLowerCase())||$==$.toLowerCase()&&($=$.toUpperCase()))){O=!0,W=-1,U=0;continue}return K(G,String(v),M,R)}M=!1,$=q($,R,10,G.s),(U=$.indexOf("."))>-1?$=$.replace(".",""):U=$.length}for(W=0;$.charCodeAt(W)===48;W++);for(F=$.length;$.charCodeAt(--F)===48;);if($=$.slice(W,++F)){if(F-=W,M&&Y.DEBUG&&F>15&&(v>c||v!==o(v)))throw Error(s+G.s*v);if((U=U-W-1)>Te)G.c=G.e=null;else if(U<ye)G.c=[G.e=0];else{if(G.e=U,G.c=[],W=(U+1)%l,U<0&&(W+=l),W<F){for(W&&G.c.push(+$.slice(0,W)),F-=l;W<F;)G.c.push(+$.slice(W,W+=l));W=l-($=$.slice(W)).length}else W-=F;for(;W--;$+="0");G.c.push(+$)}}else G.c=[G.e=0]}Y.clone=y,Y.ROUND_UP=0,Y.ROUND_DOWN=1,Y.ROUND_CEIL=2,Y.ROUND_FLOOR=3,Y.ROUND_HALF_UP=4,Y.ROUND_HALF_DOWN=5,Y.ROUND_HALF_EVEN=6,Y.ROUND_HALF_CEIL=7,Y.ROUND_HALF_FLOOR=8,Y.EUCLID=9,Y.config=Y.set=function(v){var R,x;if(v!=null)if(typeof v=="object"){if(v.hasOwnProperty(R="DECIMAL_PLACES")&&(x=v[R],w(x,0,h,R),Q=x),v.hasOwnProperty(R="ROUNDING_MODE")&&(x=v[R],w(x,0,8,R),oe=x),v.hasOwnProperty(R="EXPONENTIAL_AT")&&(x=v[R],x&&x.pop?(w(x[0],-h,0,R),w(x[1],0,h,R),le=x[0],ue=x[1]):(w(x,-h,h,R),le=-(ue=x<0?-x:x))),v.hasOwnProperty(R="RANGE"))if(x=v[R],x&&x.pop)w(x[0],-h,-1,R),w(x[1],1,h,R),ye=x[0],Te=x[1];else if(w(x,-h,h,R),x)ye=-(Te=x<0?-x:x);else throw Error(i+R+" cannot be zero: "+x);if(v.hasOwnProperty(R="CRYPTO"))if(x=v[R],x===!!x)if(x)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Ae=x;else throw Ae=!x,Error(i+"crypto unavailable");else Ae=x;else throw Error(i+R+" not true or false: "+x);if(v.hasOwnProperty(R="MODULO_MODE")&&(x=v[R],w(x,0,9,R),Pe=x),v.hasOwnProperty(R="POW_PRECISION")&&(x=v[R],w(x,0,h,R),Oe=x),v.hasOwnProperty(R="FORMAT"))if(x=v[R],typeof x=="object")to=x;else throw Error(i+R+" not an object: "+x);if(v.hasOwnProperty(R="ALPHABET"))if(x=v[R],typeof x=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(x))Ti=x.slice(0,10)=="0123456789",cn=x;else throw Error(i+R+" invalid: "+x)}else throw Error(i+"Object expected: "+v);return{DECIMAL_PLACES:Q,ROUNDING_MODE:oe,EXPONENTIAL_AT:[le,ue],RANGE:[ye,Te],CRYPTO:Ae,MODULO_MODE:Pe,POW_PRECISION:Oe,FORMAT:to,ALPHABET:cn}},Y.isBigNumber=function(v){if(!v||v._isBigNumber!==!0)return!1;if(!Y.DEBUG)return!0;var R,x,H=v.c,O=v.e,U=v.s;e:if({}.toString.call(H)=="[object Array]"){if((U===1||U===-1)&&O>=-h&&O<=h&&O===o(O)){if(H[0]===0){if(O===0&&H.length===1)return!0;break e}if(R=(O+1)%l,R<1&&(R+=l),String(H[0]).length==R){for(R=0;R<H.length;R++)if(x=H[R],x<0||x>=a||x!==o(x))break e;if(x!==0)return!0}}}else if(H===null&&O===null&&(U===null||U===1||U===-1))return!0;throw Error(i+"Invalid BigNumber: "+v)},Y.maximum=Y.max=function(){return Qe(arguments,-1)},Y.minimum=Y.min=function(){return Qe(arguments,1)},Y.random=(function(){var v=9007199254740992,R=Math.random()*v&2097151?function(){return o(Math.random()*v)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(x){var H,O,U,W,M,F=0,$=[],G=new Y(j);if(x==null?x=Q:w(x,0,h),W=r(x/l),Ae)if(crypto.getRandomValues){for(H=crypto.getRandomValues(new Uint32Array(W*=2));F<W;)M=H[F]*131072+(H[F+1]>>>11),M>=9e15?(O=crypto.getRandomValues(new Uint32Array(2)),H[F]=O[0],H[F+1]=O[1]):($.push(M%1e14),F+=2);F=W/2}else if(crypto.randomBytes){for(H=crypto.randomBytes(W*=7);F<W;)M=(H[F]&31)*281474976710656+H[F+1]*1099511627776+H[F+2]*4294967296+H[F+3]*16777216+(H[F+4]<<16)+(H[F+5]<<8)+H[F+6],M>=9e15?crypto.randomBytes(7).copy(H,F):($.push(M%1e14),F+=7);F=W/7}else throw Ae=!1,Error(i+"crypto unavailable");if(!Ae)for(;F<W;)M=R(),M<9e15&&($[F++]=M%1e14);for(W=$[--F],x%=l,W&&x&&(M=f[l-x],$[F]=o(W/M)*M);$[F]===0;$.pop(),F--);if(F<0)$=[U=0];else{for(U=-1;$[0]===0;$.splice(0,1),U-=l);for(F=1,M=$[0];M>=10;M/=10,F++);F<l&&(U-=l-F)}return G.e=U,G.c=$,G}})(),Y.sum=function(){for(var v=1,R=arguments,x=new Y(R[0]);v<R.length;)x=x.plus(R[v++]);return x},q=(function(){var v="0123456789";function R(x,H,O,U){for(var W,M=[0],F,$=0,G=x.length;$<G;){for(F=M.length;F--;M[F]*=H);for(M[0]+=U.indexOf(x.charAt($++)),W=0;W<M.length;W++)M[W]>O-1&&(M[W+1]==null&&(M[W+1]=0),M[W+1]+=M[W]/O|0,M[W]%=O)}return M.reverse()}return function(x,H,O,U,W){var M,F,$,G,z,ee,ne,ge,Re=x.indexOf("."),Ie=Q,me=oe;for(Re>=0&&(G=Oe,Oe=0,x=x.replace(".",""),ge=new Y(H),ee=ge.pow(x.length-Re),Oe=G,ge.c=R(D(T(ee.c),ee.e,"0"),10,O,v),ge.e=ge.c.length),ne=R(x,H,O,W?(M=cn,v):(M=v,cn)),$=G=ne.length;ne[--G]==0;ne.pop());if(!ne[0])return M.charAt(0);if(Re<0?--$:(ee.c=ne,ee.e=$,ee.s=U,ee=P(ee,ge,Ie,me,O),ne=ee.c,z=ee.r,$=ee.e),F=$+Ie+1,Re=ne[F],G=O/2,z=z||F<0||ne[F+1]!=null,z=me<4?(Re!=null||z)&&(me==0||me==(ee.s<0?3:2)):Re>G||Re==G&&(me==4||z||me==6&&ne[F-1]&1||me==(ee.s<0?8:7)),F<1||!ne[0])x=z?D(M.charAt(1),-Ie,M.charAt(0)):M.charAt(0);else{if(ne.length=F,z)for(--O;++ne[--F]>O;)ne[F]=0,F||(++$,ne=[1].concat(ne));for(G=ne.length;!ne[--G];);for(Re=0,x="";Re<=G;x+=M.charAt(ne[Re++]));x=D(x,$,M.charAt(0))}return x}})(),P=(function(){function v(H,O,U){var W,M,F,$,G=0,z=H.length,ee=O%m,ne=O/m|0;for(H=H.slice();z--;)F=H[z]%m,$=H[z]/m|0,W=ne*F+$*ee,M=ee*F+W%m*m+G,G=(M/U|0)+(W/m|0)+ne*$,H[z]=M%U;return G&&(H=[G].concat(H)),H}function R(H,O,U,W){var M,F;if(U!=W)F=U>W?1:-1;else for(M=F=0;M<U;M++)if(H[M]!=O[M]){F=H[M]>O[M]?1:-1;break}return F}function x(H,O,U,W){for(var M=0;U--;)H[U]-=M,M=H[U]<O[U]?1:0,H[U]=M*W+H[U]-O[U];for(;!H[0]&&H.length>1;H.splice(0,1));}return function(H,O,U,W,M){var F,$,G,z,ee,ne,ge,Re,Ie,me,Se,Fe,no,ro,oo,mt,In,We=H.s==O.s?1:-1,Le=H.c,Ee=O.c;if(!Le||!Le[0]||!Ee||!Ee[0])return new Y(!H.s||!O.s||(Le?Ee&&Le[0]==Ee[0]:!Ee)?NaN:Le&&Le[0]==0||!Ee?We*0:We/0);for(Re=new Y(We),Ie=Re.c=[],$=H.e-O.e,We=U+$+1,M||(M=a,$=_(H.e/l)-_(O.e/l),We=We/l|0),G=0;Ee[G]==(Le[G]||0);G++);if(Ee[G]>(Le[G]||0)&&$--,We<0)Ie.push(1),z=!0;else{for(ro=Le.length,mt=Ee.length,G=0,We+=2,ee=o(M/(Ee[0]+1)),ee>1&&(Ee=v(Ee,ee,M),Le=v(Le,ee,M),mt=Ee.length,ro=Le.length),no=mt,me=Le.slice(0,mt),Se=me.length;Se<mt;me[Se++]=0);In=Ee.slice(),In=[0].concat(In),oo=Ee[0],Ee[1]>=M/2&&oo++;do{if(ee=0,F=R(Ee,me,mt,Se),F<0){if(Fe=me[0],mt!=Se&&(Fe=Fe*M+(me[1]||0)),ee=o(Fe/oo),ee>1)for(ee>=M&&(ee=M-1),ne=v(Ee,ee,M),ge=ne.length,Se=me.length;R(ne,me,ge,Se)==1;)ee--,x(ne,mt<ge?In:Ee,ge,M),ge=ne.length,F=1;else ee==0&&(F=ee=1),ne=Ee.slice(),ge=ne.length;if(ge<Se&&(ne=[0].concat(ne)),x(me,ne,Se,M),Se=me.length,F==-1)for(;R(Ee,me,mt,Se)<1;)ee++,x(me,mt<Se?In:Ee,Se,M),Se=me.length}else F===0&&(ee++,me=[0]);Ie[G++]=ee,me[0]?me[Se++]=Le[no]||0:(me=[Le[no]],Se=1)}while((no++<ro||me[0]!=null)&&We--);z=me[0]!=null,Ie[0]||Ie.splice(0,1)}if(M==a){for(G=1,We=Ie[0];We>=10;We/=10,G++);Ze(Re,U+(Re.e=G+$*l-1)+1,W,z)}else Re.e=$,Re.r=+z;return Re}})();function it(v,R,x,H){var O,U,W,M,F;if(x==null?x=oe:w(x,0,8),!v.c)return v.toString();if(O=v.c[0],W=v.e,R==null)F=T(v.c),F=H==1||H==2&&(W<=le||W>=ue)?L(F,W):D(F,W,"0");else if(v=Ze(new Y(v),R,x),U=v.e,F=T(v.c),M=F.length,H==1||H==2&&(R<=U||U<=le)){for(;M<R;F+="0",M++);F=L(F,U)}else if(R-=W+(H===2&&U>W),F=D(F,U,"0"),U+1>M){if(--R>0)for(F+=".";R--;F+="0");}else if(R+=U-M,R>0)for(U+1==M&&(F+=".");R--;F+="0");return v.s<0&&O?"-"+F:F}function Qe(v,R){for(var x,H,O=1,U=new Y(v[0]);O<v.length;O++)H=new Y(v[O]),(!H.s||(x=E(U,H))===R||x===0&&U.s===R)&&(U=H);return U}function Ei(v,R,x){for(var H=1,O=R.length;!R[--O];R.pop());for(O=R[0];O>=10;O/=10,H++);return(x=H+x*l-1)>Te?v.c=v.e=null:x<ye?v.c=[v.e=0]:(v.e=x,v.c=R),v}K=(function(){var v=/^(-?)0([xbo])(?=\w[\w.]*$)/i,R=/^([^.]+)\.$/,x=/^\.([^.]+)$/,H=/^-?(Infinity|NaN)$/,O=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(U,W,M,F){var $,G=M?W:W.replace(O,"");if(H.test(G))U.s=isNaN(G)?null:G<0?-1:1;else{if(!M&&(G=G.replace(v,function(z,ee,ne){return $=(ne=ne.toLowerCase())=="x"?16:ne=="b"?2:8,!F||F==$?ee:z}),F&&($=F,G=G.replace(R,"$1").replace(x,"0.$1")),W!=G))return new Y(G,$);if(Y.DEBUG)throw Error(i+"Not a"+(F?" base "+F:"")+" number: "+W);U.s=null}U.c=U.e=null}})();function Ze(v,R,x,H){var O,U,W,M,F,$,G,z=v.c,ee=f;if(z){e:{for(O=1,M=z[0];M>=10;M/=10,O++);if(U=R-O,U<0)U+=l,W=R,F=z[$=0],G=o(F/ee[O-W-1]%10);else if($=r((U+1)/l),$>=z.length)if(H){for(;z.length<=$;z.push(0));F=G=0,O=1,U%=l,W=U-l+1}else break e;else{for(F=M=z[$],O=1;M>=10;M/=10,O++);U%=l,W=U-l+O,G=W<0?0:o(F/ee[O-W-1]%10)}if(H=H||R<0||z[$+1]!=null||(W<0?F:F%ee[O-W-1]),H=x<4?(G||H)&&(x==0||x==(v.s<0?3:2)):G>5||G==5&&(x==4||H||x==6&&(U>0?W>0?F/ee[O-W]:0:z[$-1])%10&1||x==(v.s<0?8:7)),R<1||!z[0])return z.length=0,H?(R-=v.e+1,z[0]=ee[(l-R%l)%l],v.e=-R||0):z[0]=v.e=0,v;if(U==0?(z.length=$,M=1,$--):(z.length=$+1,M=ee[l-U],z[$]=W>0?o(F/ee[O-W]%ee[W])*M:0),H)for(;;)if($==0){for(U=1,W=z[0];W>=10;W/=10,U++);for(W=z[0]+=M,M=1;W>=10;W/=10,M++);U!=M&&(v.e++,z[0]==a&&(z[0]=1));break}else{if(z[$]+=M,z[$]!=a)break;z[$--]=0,M=1}for(U=z.length;z[--U]===0;z.pop());}v.e>Te?v.c=v.e=null:v.e<ye&&(v.c=[v.e=0])}return v}function De(v){var R,x=v.e;return x===null?v.toString():(R=T(v.c),R=x<=le||x>=ue?L(R,x):D(R,x,"0"),v.s<0?"-"+R:R)}return B.absoluteValue=B.abs=function(){var v=new Y(this);return v.s<0&&(v.s=1),v},B.comparedTo=function(v,R){return E(this,new Y(v,R))},B.decimalPlaces=B.dp=function(v,R){var x,H,O,U=this;if(v!=null)return w(v,0,h),R==null?R=oe:w(R,0,8),Ze(new Y(U),v+U.e+1,R);if(!(x=U.c))return null;if(H=((O=x.length-1)-_(this.e/l))*l,O=x[O])for(;O%10==0;O/=10,H--);return H<0&&(H=0),H},B.dividedBy=B.div=function(v,R){return P(this,new Y(v,R),Q,oe)},B.dividedToIntegerBy=B.idiv=function(v,R){return P(this,new Y(v,R),0,1)},B.exponentiatedBy=B.pow=function(v,R){var x,H,O,U,W,M,F,$,G,z=this;if(v=new Y(v),v.c&&!v.isInteger())throw Error(i+"Exponent not an integer: "+De(v));if(R!=null&&(R=new Y(R)),M=v.e>14,!z.c||!z.c[0]||z.c[0]==1&&!z.e&&z.c.length==1||!v.c||!v.c[0])return G=new Y(Math.pow(+De(z),M?v.s*(2-b(v)):+De(v))),R?G.mod(R):G;if(F=v.s<0,R){if(R.c?!R.c[0]:!R.s)return new Y(NaN);H=!F&&z.isInteger()&&R.isInteger(),H&&(z=z.mod(R))}else{if(v.e>9&&(z.e>0||z.e<-1||(z.e==0?z.c[0]>1||M&&z.c[1]>=24e7:z.c[0]<8e13||M&&z.c[0]<=9999975e7)))return U=z.s<0&&b(v)?-0:0,z.e>-1&&(U=1/U),new Y(F?1/U:U);Oe&&(U=r(Oe/l+2))}for(M?(x=new Y(.5),F&&(v.s=1),$=b(v)):(O=Math.abs(+De(v)),$=O%2),G=new Y(j);;){if($){if(G=G.times(z),!G.c)break;U?G.c.length>U&&(G.c.length=U):H&&(G=G.mod(R))}if(O){if(O=o(O/2),O===0)break;$=O%2}else if(v=v.times(x),Ze(v,v.e+1,1),v.e>14)$=b(v);else{if(O=+De(v),O===0)break;$=O%2}z=z.times(z),U?z.c&&z.c.length>U&&(z.c.length=U):H&&(z=z.mod(R))}return H?G:(F&&(G=j.div(G)),R?G.mod(R):U?Ze(G,Oe,oe,W):G)},B.integerValue=function(v){var R=new Y(this);return v==null?v=oe:w(v,0,8),Ze(R,R.e+1,v)},B.isEqualTo=B.eq=function(v,R){return E(this,new Y(v,R))===0},B.isFinite=function(){return!!this.c},B.isGreaterThan=B.gt=function(v,R){return E(this,new Y(v,R))>0},B.isGreaterThanOrEqualTo=B.gte=function(v,R){return(R=E(this,new Y(v,R)))===1||R===0},B.isInteger=function(){return!!this.c&&_(this.e/l)>this.c.length-2},B.isLessThan=B.lt=function(v,R){return E(this,new Y(v,R))<0},B.isLessThanOrEqualTo=B.lte=function(v,R){return(R=E(this,new Y(v,R)))===-1||R===0},B.isNaN=function(){return!this.s},B.isNegative=function(){return this.s<0},B.isPositive=function(){return this.s>0},B.isZero=function(){return!!this.c&&this.c[0]==0},B.minus=function(v,R){var x,H,O,U,W=this,M=W.s;if(v=new Y(v,R),R=v.s,!M||!R)return new Y(NaN);if(M!=R)return v.s=-R,W.plus(v);var F=W.e/l,$=v.e/l,G=W.c,z=v.c;if(!F||!$){if(!G||!z)return G?(v.s=-R,v):new Y(z?W:NaN);if(!G[0]||!z[0])return z[0]?(v.s=-R,v):new Y(G[0]?W:oe==3?-0:0)}if(F=_(F),$=_($),G=G.slice(),M=F-$){for((U=M<0)?(M=-M,O=G):($=F,O=z),O.reverse(),R=M;R--;O.push(0));O.reverse()}else for(H=(U=(M=G.length)<(R=z.length))?M:R,M=R=0;R<H;R++)if(G[R]!=z[R]){U=G[R]<z[R];break}if(U&&(O=G,G=z,z=O,v.s=-v.s),R=(H=z.length)-(x=G.length),R>0)for(;R--;G[x++]=0);for(R=a-1;H>M;){if(G[--H]<z[H]){for(x=H;x&&!G[--x];G[x]=R);--G[x],G[H]+=a}G[H]-=z[H]}for(;G[0]==0;G.splice(0,1),--$);return G[0]?Ei(v,G,$):(v.s=oe==3?-1:1,v.c=[v.e=0],v)},B.modulo=B.mod=function(v,R){var x,H,O=this;return v=new Y(v,R),!O.c||!v.s||v.c&&!v.c[0]?new Y(NaN):!v.c||O.c&&!O.c[0]?new Y(O):(Pe==9?(H=v.s,v.s=1,x=P(O,v,0,3),v.s=H,x.s*=H):x=P(O,v,0,Pe),v=O.minus(x.times(v)),!v.c[0]&&Pe==1&&(v.s=O.s),v)},B.multipliedBy=B.times=function(v,R){var x,H,O,U,W,M,F,$,G,z,ee,ne,ge,Re,Ie,me=this,Se=me.c,Fe=(v=new Y(v,R)).c;if(!Se||!Fe||!Se[0]||!Fe[0])return!me.s||!v.s||Se&&!Se[0]&&!Fe||Fe&&!Fe[0]&&!Se?v.c=v.e=v.s=null:(v.s*=me.s,!Se||!Fe?v.c=v.e=null:(v.c=[0],v.e=0)),v;for(H=_(me.e/l)+_(v.e/l),v.s*=me.s,F=Se.length,z=Fe.length,F<z&&(ge=Se,Se=Fe,Fe=ge,O=F,F=z,z=O),O=F+z,ge=[];O--;ge.push(0));for(Re=a,Ie=m,O=z;--O>=0;){for(x=0,ee=Fe[O]%Ie,ne=Fe[O]/Ie|0,W=F,U=O+W;U>O;)$=Se[--W]%Ie,G=Se[W]/Ie|0,M=ne*$+G*ee,$=ee*$+M%Ie*Ie+ge[U]+x,x=($/Re|0)+(M/Ie|0)+ne*G,ge[U--]=$%Re;ge[U]=x}return x?++H:ge.splice(0,1),Ei(v,ge,H)},B.negated=function(){var v=new Y(this);return v.s=-v.s||null,v},B.plus=function(v,R){var x,H=this,O=H.s;if(v=new Y(v,R),R=v.s,!O||!R)return new Y(NaN);if(O!=R)return v.s=-R,H.minus(v);var U=H.e/l,W=v.e/l,M=H.c,F=v.c;if(!U||!W){if(!M||!F)return new Y(O/0);if(!M[0]||!F[0])return F[0]?v:new Y(M[0]?H:O*0)}if(U=_(U),W=_(W),M=M.slice(),O=U-W){for(O>0?(W=U,x=F):(O=-O,x=M),x.reverse();O--;x.push(0));x.reverse()}for(O=M.length,R=F.length,O-R<0&&(x=F,F=M,M=x,R=O),O=0;R;)O=(M[--R]=M[R]+F[R]+O)/a|0,M[R]=a===M[R]?0:M[R]%a;return O&&(M=[O].concat(M),++W),Ei(v,M,W)},B.precision=B.sd=function(v,R){var x,H,O,U=this;if(v!=null&&v!==!!v)return w(v,1,h),R==null?R=oe:w(R,0,8),Ze(new Y(U),v,R);if(!(x=U.c))return null;if(O=x.length-1,H=O*l+1,O=x[O]){for(;O%10==0;O/=10,H--);for(O=x[0];O>=10;O/=10,H++);}return v&&U.e+1>H&&(H=U.e+1),H},B.shiftedBy=function(v){return w(v,-c,c),this.times("1e"+v)},B.squareRoot=B.sqrt=function(){var v,R,x,H,O,U=this,W=U.c,M=U.s,F=U.e,$=Q+4,G=new Y("0.5");if(M!==1||!W||!W[0])return new Y(!M||M<0&&(!W||W[0])?NaN:W?U:1/0);if(M=Math.sqrt(+De(U)),M==0||M==1/0?(R=T(W),(R.length+F)%2==0&&(R+="0"),M=Math.sqrt(+R),F=_((F+1)/2)-(F<0||F%2),M==1/0?R="5e"+F:(R=M.toExponential(),R=R.slice(0,R.indexOf("e")+1)+F),x=new Y(R)):x=new Y(M+""),x.c[0]){for(F=x.e,M=F+$,M<3&&(M=0);;)if(O=x,x=G.times(O.plus(P(U,O,$,1))),T(O.c).slice(0,M)===(R=T(x.c)).slice(0,M))if(x.e<F&&--M,R=R.slice(M-3,M+1),R=="9999"||!H&&R=="4999"){if(!H&&(Ze(O,O.e+Q+2,0),O.times(O).eq(U))){x=O;break}$+=4,M+=4,H=1}else{(!+R||!+R.slice(1)&&R.charAt(0)=="5")&&(Ze(x,x.e+Q+2,1),v=!x.times(x).eq(U));break}}return Ze(x,x.e+Q+1,oe,v)},B.toExponential=function(v,R){return v!=null&&(w(v,0,h),v++),it(this,v,R,1)},B.toFixed=function(v,R){return v!=null&&(w(v,0,h),v=v+this.e+1),it(this,v,R)},B.toFormat=function(v,R,x){var H,O=this;if(x==null)v!=null&&R&&typeof R=="object"?(x=R,R=null):v&&typeof v=="object"?(x=v,v=R=null):x=to;else if(typeof x!="object")throw Error(i+"Argument not an object: "+x);if(H=O.toFixed(v,R),O.c){var U,W=H.split("."),M=+x.groupSize,F=+x.secondaryGroupSize,$=x.groupSeparator||"",G=W[0],z=W[1],ee=O.s<0,ne=ee?G.slice(1):G,ge=ne.length;if(F&&(U=M,M=F,F=U,ge-=U),M>0&&ge>0){for(U=ge%M||M,G=ne.substr(0,U);U<ge;U+=M)G+=$+ne.substr(U,M);F>0&&(G+=$+ne.slice(U)),ee&&(G="-"+G)}H=z?G+(x.decimalSeparator||"")+((F=+x.fractionGroupSize)?z.replace(new RegExp("\\d{"+F+"}\\B","g"),"$&"+(x.fractionGroupSeparator||"")):z):G}return(x.prefix||"")+H+(x.suffix||"")},B.toFraction=function(v){var R,x,H,O,U,W,M,F,$,G,z,ee,ne=this,ge=ne.c;if(v!=null&&(M=new Y(v),!M.isInteger()&&(M.c||M.s!==1)||M.lt(j)))throw Error(i+"Argument "+(M.isInteger()?"out of range: ":"not an integer: ")+De(M));if(!ge)return new Y(ne);for(R=new Y(j),$=x=new Y(j),H=F=new Y(j),ee=T(ge),U=R.e=ee.length-ne.e-1,R.c[0]=f[(W=U%l)<0?l+W:W],v=!v||M.comparedTo(R)>0?U>0?R:$:M,W=Te,Te=1/0,M=new Y(ee),F.c[0]=0;G=P(M,R,0,1),O=x.plus(G.times(H)),O.comparedTo(v)!=1;)x=H,H=O,$=F.plus(G.times(O=$)),F=O,R=M.minus(G.times(O=R)),M=O;return O=P(v.minus(x),H,0,1),F=F.plus(O.times($)),x=x.plus(O.times(H)),F.s=$.s=ne.s,U=U*2,z=P($,H,U,oe).minus(ne).abs().comparedTo(P(F,x,U,oe).minus(ne).abs())<1?[$,H]:[F,x],Te=W,z},B.toNumber=function(){return+De(this)},B.toPrecision=function(v,R){return v!=null&&w(v,1,h),it(this,v,R,2)},B.toString=function(v){var R,x=this,H=x.s,O=x.e;return O===null?H?(R="Infinity",H<0&&(R="-"+R)):R="NaN":(v==null?R=O<=le||O>=ue?L(T(x.c),O):D(T(x.c),O,"0"):v===10&&Ti?(x=Ze(new Y(x),Q+O+1,oe),R=D(T(x.c),x.e,"0")):(w(v,2,cn.length,"Base"),R=q(D(T(x.c),O,"0"),10,v,H,!0)),H<0&&x.c[0]&&(R="-"+R)),R},B.valueOf=B.toJSON=function(){return De(this)},B._isBigNumber=!0,I!=null&&Y.set(I),Y}function _(I){var P=I|0;return I>0||I===P?P:P-1}function T(I){for(var P,q,K=1,B=I.length,j=I[0]+"";K<B;){for(P=I[K++]+"",q=l-P.length;q--;P="0"+P);j+=P}for(B=j.length;j.charCodeAt(--B)===48;);return j.slice(0,B+1||1)}function E(I,P){var q,K,B=I.c,j=P.c,Q=I.s,oe=P.s,le=I.e,ue=P.e;if(!Q||!oe)return null;if(q=B&&!B[0],K=j&&!j[0],q||K)return q?K?0:-oe:Q;if(Q!=oe)return Q;if(q=Q<0,K=le==ue,!B||!j)return K?0:!B^q?1:-1;if(!K)return le>ue^q?1:-1;for(oe=(le=B.length)<(ue=j.length)?le:ue,Q=0;Q<oe;Q++)if(B[Q]!=j[Q])return B[Q]>j[Q]^q?1:-1;return le==ue?0:le>ue^q?1:-1}function w(I,P,q,K){if(I<P||I>q||I!==o(I))throw Error(i+(K||"Argument")+(typeof I=="number"?I<P||I>q?" out of range: ":" not an integer: ":" not a primitive number: ")+String(I))}function b(I){var P=I.c.length-1;return _(I.e/l)==P&&I.c[P]%2!=0}function L(I,P){return(I.length>1?I.charAt(0)+"."+I.slice(1):I)+(P<0?"e":"e+")+P}function D(I,P,q){var K,B;if(P<0){for(B=q+".";++P;B+=q);I=B+I}else if(K=I.length,++P>K){for(B=q,P-=K;--P;B+=q);I+=B}else P<K&&(I=I.slice(0,P)+"."+I.slice(P));return I}e=y(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof ll<"u"&&ll.exports?ll.exports=e:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=e)})(ew)});var ow=k((h5,rw)=>{var tw=_d(),nw=rw.exports;(function(){"use strict";function t(c){return c<10?"0"+c:c}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,o,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s;function a(c){return n.lastIndex=0,n.test(c)?'"'+c.replace(n,function(f){var m=i[f];return typeof m=="string"?m:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function l(c,f){var m,h,y,_,T=r,E,w=f[c],b=w!=null&&(w instanceof tw||tw.isBigNumber(w));switch(w&&typeof w=="object"&&typeof w.toJSON=="function"&&(w=w.toJSON(c)),typeof s=="function"&&(w=s.call(f,c,w)),typeof w){case"string":return b?w:a(w);case"number":return isFinite(w)?String(w):"null";case"boolean":case"null":case"bigint":return String(w);case"object":if(!w)return"null";if(r+=o,E=[],Object.prototype.toString.apply(w)==="[object Array]"){for(_=w.length,m=0;m<_;m+=1)E[m]=l(m,w)||"null";return y=E.length===0?"[]":r?`[
`+r+E.join(`,
`+r)+`
`+T+"]":"["+E.join(",")+"]",r=T,y}if(s&&typeof s=="object")for(_=s.length,m=0;m<_;m+=1)typeof s[m]=="string"&&(h=s[m],y=l(h,w),y&&E.push(a(h)+(r?": ":":")+y));else Object.keys(w).forEach(function(L){var D=l(L,w);D&&E.push(a(L)+(r?": ":":")+D)});return y=E.length===0?"{}":r?`{
`+r+E.join(`,
`+r)+`
`+T+"}":"{"+E.join(",")+"}",r=T,y}}typeof nw.stringify!="function"&&(nw.stringify=function(c,f,m){var h;if(r="",o="",typeof m=="number")for(h=0;h<m;h+=1)o+=" ";else typeof m=="string"&&(o=m);if(s=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return l("",{"":c})})})()});var sw=k((m5,iw)=>{var ul=null,KL=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,YL=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,jL=function(t){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(t!=null){if(t.strict===!0&&(e.strict=!0),t.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=t.alwaysParseAsBig===!0?t.alwaysParseAsBig:!1,e.useNativeBigInt=t.useNativeBigInt===!0?t.useNativeBigInt:!1,typeof t.constructorAction<"u")if(t.constructorAction==="error"||t.constructorAction==="ignore"||t.constructorAction==="preserve")e.constructorAction=t.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${t.constructorAction}`);if(typeof t.protoAction<"u")if(t.protoAction==="error"||t.protoAction==="ignore"||t.protoAction==="preserve")e.protoAction=t.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${t.protoAction}`)}var n,r,o={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},i,s=function(T){throw{name:"SyntaxError",message:T,at:n,text:i}},a=function(T){return T&&T!==r&&s("Expected '"+T+"' instead of '"+r+"'"),r=i.charAt(n),n+=1,r},l=function(){var T,E="";for(r==="-"&&(E="-",a("-"));r>="0"&&r<="9";)E+=r,a();if(r===".")for(E+=".";a()&&r>="0"&&r<="9";)E+=r;if(r==="e"||r==="E")for(E+=r,a(),(r==="-"||r==="+")&&(E+=r,a());r>="0"&&r<="9";)E+=r,a();if(T=+E,!isFinite(T))s("Bad number");else return ul==null&&(ul=_d()),E.length>15?e.storeAsString?E:e.useNativeBigInt?BigInt(E):new ul(E):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(T):new ul(T):T},c=function(){var T,E,w="",b;if(r==='"')for(var L=n;a();){if(r==='"')return n-1>L&&(w+=i.substring(L,n-1)),a(),w;if(r==="\\"){if(n-1>L&&(w+=i.substring(L,n-1)),a(),r==="u"){for(b=0,E=0;E<4&&(T=parseInt(a(),16),!!isFinite(T));E+=1)b=b*16+T;w+=String.fromCharCode(b)}else if(typeof o[r]=="string")w+=o[r];else break;L=n}}s("Bad string")},f=function(){for(;r&&r<=" ";)a()},m=function(){switch(r){case"t":return a("t"),a("r"),a("u"),a("e"),!0;case"f":return a("f"),a("a"),a("l"),a("s"),a("e"),!1;case"n":return a("n"),a("u"),a("l"),a("l"),null}s("Unexpected '"+r+"'")},h,y=function(){var T=[];if(r==="["){if(a("["),f(),r==="]")return a("]"),T;for(;r;){if(T.push(h()),f(),r==="]")return a("]"),T;a(","),f()}}s("Bad array")},_=function(){var T,E=Object.create(null);if(r==="{"){if(a("{"),f(),r==="}")return a("}"),E;for(;r;){if(T=c(),f(),a(":"),e.strict===!0&&Object.hasOwnProperty.call(E,T)&&s('Duplicate key "'+T+'"'),KL.test(T)===!0?e.protoAction==="error"?s("Object contains forbidden prototype property"):e.protoAction==="ignore"?h():E[T]=h():YL.test(T)===!0?e.constructorAction==="error"?s("Object contains forbidden constructor property"):e.constructorAction==="ignore"?h():E[T]=h():E[T]=h(),f(),r==="}")return a("}"),E;a(","),f()}}s("Bad object")};return h=function(){switch(f(),r){case"{":return _();case"[":return y();case'"':return c();case"-":return l();default:return r>="0"&&r<="9"?l():m()}},function(T,E){var w;return i=T+"",n=0,r=" ",w=h(),f(),r&&s("Syntax error"),typeof E=="function"?(function b(L,D){var I,P,q=L[D];return q&&typeof q=="object"&&Object.keys(q).forEach(function(K){P=b(q,K),P!==void 0?q[K]=P:delete q[K]}),E.call(L,D,q)})({"":w},""):w}};iw.exports=jL});var uw=k((g5,cl)=>{var aw=ow().stringify,lw=sw();cl.exports=function(t){return{parse:lw(t),stringify:aw}};cl.exports.parse=lw();cl.exports.stringify=aw});var Sd=k(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.GCE_LINUX_BIOS_PATHS=void 0;Xt.isGoogleCloudServerless=dw;Xt.isGoogleComputeEngineLinux=pw;Xt.isGoogleComputeEngineMACAddress=hw;Xt.isGoogleComputeEngine=mw;Xt.detectGCPResidency=QL;var cw=require("fs"),fw=require("os");Xt.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var XL=/^42:01/;function dw(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function pw(){if((0,fw.platform)()!=="linux")return!1;try{(0,cw.statSync)(Xt.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let t=(0,cw.readFileSync)(Xt.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(t)}catch{return!1}}function hw(){let t=(0,fw.networkInterfaces)();for(let e of Object.values(t))if(e){for(let{mac:n}of e)if(XL.test(n))return!0}return!1}function mw(){return pw()||hw()}function QL(){return dw()||mw()}});var gw=k(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.Colours=void 0;var ze=class t{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){t.enabled=t.isEnabled(process==null?void 0:process.stderr),this.enabled?(t.reset="\x1B[0m",t.bright="\x1B[1m",t.dim="\x1B[2m",t.red="\x1B[31m",t.green="\x1B[32m",t.yellow="\x1B[33m",t.blue="\x1B[34m",t.magenta="\x1B[35m",t.cyan="\x1B[36m",t.white="\x1B[37m",t.grey="\x1B[90m"):(t.reset="",t.bright="",t.dim="",t.red="",t.green="",t.yellow="",t.blue="",t.magenta="",t.cyan="",t.white="",t.grey="")}};fl.Colours=ze;ze.enabled=!1;ze.reset="";ze.bright="";ze.dim="";ze.red="";ze.green="";ze.yellow="";ze.blue="";ze.magenta="";ze.cyan="";ze.white="";ze.grey="";ze.refresh()});var Tw=k(we=>{"use strict";var ZL=we&&we.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),eU=we&&we.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),yw=we&&we.__importStar||(function(){var t=function(e){return t=Object.getOwnPropertyNames||function(n){var r=[];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[r.length]=o);return r},t(e)};return function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var r=t(e),o=0;o<r.length;o++)r[o]!=="default"&&ZL(n,e,r[o]);return eU(n,e),n}})();Object.defineProperty(we,"__esModule",{value:!0});we.env=we.DebugLogBackendBase=we.placeholder=we.AdhocDebugLogger=we.LogSeverity=void 0;we.getNodeBackend=Ed;we.getDebugBackend=nU;we.getStructuredBackend=rU;we.setBackend=oU;we.log=Sw;var tU=require("events"),Xi=yw(require("process")),_w=yw(require("util")),wt=gw(),Qt;(function(t){t.DEFAULT="DEFAULT",t.DEBUG="DEBUG",t.INFO="INFO",t.WARNING="WARNING",t.ERROR="ERROR"})(Qt||(we.LogSeverity=Qt={}));var Qi=class extends tU.EventEmitter{constructor(e,n){super(),this.namespace=e,this.upstream=n,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(r,o)=>this.on(r,o)}),this.func.debug=(...r)=>this.invokeSeverity(Qt.DEBUG,...r),this.func.info=(...r)=>this.invokeSeverity(Qt.INFO,...r),this.func.warn=(...r)=>this.invokeSeverity(Qt.WARNING,...r),this.func.error=(...r)=>this.invokeSeverity(Qt.ERROR,...r),this.func.sublog=r=>Sw(r,this.func)}invoke(e,...n){if(this.upstream)try{this.upstream(e,...n)}catch{}try{this.emit("log",e,n)}catch{}}invokeSeverity(e,...n){this.invoke({severity:e},...n)}};we.AdhocDebugLogger=Qi;we.placeholder=new Qi("",()=>{}).func;var xo=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let n=(e=Xi.env[we.env.nodeEnables])!==null&&e!==void 0?e:"*";n==="all"&&(n="*"),this.filters=n.split(",")}log(e,n,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let o=this.cached.get(e);o||(o=this.makeLogger(e),this.cached.set(e,o)),o(n,...r)}catch(o){console.error(o)}}};we.DebugLogBackendBase=xo;var Td=class extends xo{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(n,...r)=>{var o;let i=`${wt.Colours.green}${e}${wt.Colours.reset}`,s=`${wt.Colours.yellow}${Xi.pid}${wt.Colours.reset}`,a;switch(n.severity){case Qt.ERROR:a=`${wt.Colours.red}${n.severity}${wt.Colours.reset}`;break;case Qt.INFO:a=`${wt.Colours.magenta}${n.severity}${wt.Colours.reset}`;break;case Qt.WARNING:a=`${wt.Colours.yellow}${n.severity}${wt.Colours.reset}`;break;default:a=(o=n.severity)!==null&&o!==void 0?o:Qt.DEFAULT;break}let l=_w.formatWithOptions({colors:wt.Colours.enabled},...r),c=Object.assign({},n);delete c.severity;let f=Object.getOwnPropertyNames(c).length?JSON.stringify(c):"",m=f?`${wt.Colours.grey}${f}${wt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",s,i,a,l,f?` ${m}`:"")}:()=>{}}setFilters(){let n=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${n}$`,"i")}};function Ed(){return new Td}var wd=class extends xo{constructor(e){super(),this.debugPkg=e}makeLogger(e){let n=this.debugPkg(e);return(r,...o)=>{n(o[0],...o.slice(1))}}setFilters(){var e;let n=(e=Xi.env.NODE_DEBUG)!==null&&e!==void 0?e:"";Xi.env.NODE_DEBUG=`${n}${n?",":""}${this.filters.join(",")}`}};function nU(t){return new wd(t)}var vd=class extends xo{constructor(e){var n;super(),this.upstream=(n=e)!==null&&n!==void 0?n:void 0}makeLogger(e){var n;let r=(n=this.upstream)===null||n===void 0?void 0:n.makeLogger(e);return(o,...i)=>{var s;let a=(s=o.severity)!==null&&s!==void 0?s:Qt.INFO,l=Object.assign({severity:a,message:_w.format(...i)},o),c=JSON.stringify(l);r?r(o,c):console.log("%s",c)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function rU(t){return new vd(t)}we.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var Ad=new Map,vt;function oU(t){vt=t,Ad.clear()}function Sw(t,e){if(!vt&&!Xi.env[we.env.nodeEnables]||!t)return we.placeholder;e&&(t=`${e.instance.namespace}:${t}`);let n=Ad.get(t);if(n)return n.func;if(vt===null)return we.placeholder;vt===void 0&&(vt=Ed());let r=(()=>{let o;return new Qi(t,(s,...a)=>{if(o!==vt){if(vt===null)return;vt===void 0&&(vt=Ed()),o=vt}vt?.log(t,s,...a)})})();return Ad.set(t,r),r.func}});var Cd=k(Ur=>{"use strict";var iU=Ur&&Ur.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),sU=Ur&&Ur.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&iU(e,t,n)};Object.defineProperty(Ur,"__esModule",{value:!0});sU(Tw(),Ur)});var es=k(ae=>{"use strict";var ww=ae&&ae.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),aU=ae&&ae.__setModuleDefault||(Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e}),lU=ae&&ae.__importStar||(function(){var t=function(e){return t=Object.getOwnPropertyNames||function(n){var r=[];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[r.length]=o);return r},t(e)};return function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var r=t(e),o=0;o<r.length;o++)r[o]!=="default"&&ww(n,e,r[o]);return aU(n,e),n}})(),uU=ae&&ae.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&ww(e,t,n)};Object.defineProperty(ae,"__esModule",{value:!0});ae.gcpResidencyCache=ae.METADATA_SERVER_DETECTION=ae.HEADERS=ae.HEADER_VALUE=ae.HEADER_NAME=ae.SECONDARY_HOST_ADDRESS=ae.HOST_ADDRESS=ae.BASE_PATH=void 0;ae.instance=mU;ae.project=gU;ae.universe=yU;ae.bulk=_U;ae.isAvailable=TU;ae.resetIsAvailableCache=EU;ae.getGCPResidency=Id;ae.setGCPResidency=vw;ae.requestTimeout=Aw;var bd=Ve(),cU=uw(),fU=Sd(),dU=lU(Cd());ae.BASE_PATH="/computeMetadata/v1";ae.HOST_ADDRESS="http://169.254.169.254";ae.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";ae.HEADER_NAME="Metadata-Flavor";ae.HEADER_VALUE="Google";ae.HEADERS=Object.freeze({[ae.HEADER_NAME]:ae.HEADER_VALUE});var Ew=dU.log("gcp-metadata");ae.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function Rd(t){return t||(t=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||ae.HOST_ADDRESS),/^https?:\/\//.test(t)||(t=`http://${t}`),new URL(ae.BASE_PATH,t).href}function pU(t){Object.keys(t).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function Zi(t,e={},n=3,r=!1){let o=new Headers(ae.HEADERS),i="",s={};if(typeof t=="object"){let m=t;new Headers(m.headers).forEach((h,y)=>o.set(y,h)),i=m.metadataKey,s=m.params||s,n=m.noResponseRetries||n,r=m.fastFail||r}else i=t;typeof e=="string"?i+=`/${e}`:(pU(e),e.property&&(i+=`/${e.property}`),new Headers(e.headers).forEach((m,h)=>o.set(h,m)),s=e.params||s);let a=r?hU:bd.request,l={url:`${Rd()}/${i}`,headers:o,retryConfig:{noResponseRetries:n},params:s,responseType:"text",timeout:Aw()};Ew.info("instance request %j",l);let c=await a(l);Ew.info("instance metadata is %s",c.data);let f=c.headers.get(ae.HEADER_NAME);if(f!==ae.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${ae.HEADER_NAME} header. Expected '${ae.HEADER_VALUE}', got ${f?`'${f}'`:"no header"}`);if(typeof c.data=="string")try{return cU.parse(c.data)}catch{}return c.data}async function hU(t){let e={...t,url:t.url?.toString().replace(Rd(),Rd(ae.SECONDARY_HOST_ADDRESS))},n=(0,bd.request)(t),r=(0,bd.request)(e);return Promise.any([n,r])}function mU(t){return Zi("instance",t)}function gU(t){return Zi("project",t)}function yU(t){return Zi("universe",t)}async function _U(t){let e={};return await Promise.all(t.map(n=>(async()=>{let r=await Zi(n),o=n.metadataKey;e[o]=r})())),e}function SU(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var dl;async function TU(){if(process.env.METADATA_SERVER_DETECTION){let t=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(t in ae.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${t}\`, but it should be \`${Object.keys(ae.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(t){case"assume-present":return!0;case"none":return!1;case"bios-only":return Id();case"ping-only":}}try{return dl===void 0&&(dl=Zi("instance",void 0,SU(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await dl,!0}catch(t){let e=t;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let n="UNKNOWN";e.code&&(n=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${n}`,"MetadataLookupWarning")}return!1}}function EU(){dl=void 0}ae.gcpResidencyCache=null;function Id(){return ae.gcpResidencyCache===null&&vw(),ae.gcpResidencyCache}function vw(t=null){ae.gcpResidencyCache=t!==null?t:(0,fU.detectGCPResidency)()}function Aw(){return Id()?0:3e3}uU(Sd(),ae)});var Rw=k(pl=>{"use strict";pl.byteLength=vU;pl.toByteArray=CU;pl.fromByteArray=IU;var yn=[],Ut=[],wU=typeof Uint8Array<"u"?Uint8Array:Array,xd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(qr=0,Cw=xd.length;qr<Cw;++qr)yn[qr]=xd[qr],Ut[xd.charCodeAt(qr)]=qr;var qr,Cw;Ut[45]=62;Ut[95]=63;function bw(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function vU(t){var e=bw(t),n=e[0],r=e[1];return(n+r)*3/4-r}function AU(t,e,n){return(e+n)*3/4-n}function CU(t){var e,n=bw(t),r=n[0],o=n[1],i=new wU(AU(t,r,o)),s=0,a=o>0?r-4:r,l;for(l=0;l<a;l+=4)e=Ut[t.charCodeAt(l)]<<18|Ut[t.charCodeAt(l+1)]<<12|Ut[t.charCodeAt(l+2)]<<6|Ut[t.charCodeAt(l+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=e&255;return o===2&&(e=Ut[t.charCodeAt(l)]<<2|Ut[t.charCodeAt(l+1)]>>4,i[s++]=e&255),o===1&&(e=Ut[t.charCodeAt(l)]<<10|Ut[t.charCodeAt(l+1)]<<4|Ut[t.charCodeAt(l+2)]>>2,i[s++]=e>>8&255,i[s++]=e&255),i}function bU(t){return yn[t>>18&63]+yn[t>>12&63]+yn[t>>6&63]+yn[t&63]}function RU(t,e,n){for(var r,o=[],i=e;i<n;i+=3)r=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(t[i+2]&255),o.push(bU(r));return o.join("")}function IU(t){for(var e,n=t.length,r=n%3,o=[],i=16383,s=0,a=n-r;s<a;s+=i)o.push(RU(t,s,s+i>a?a:s+i));return r===1?(e=t[n-1],o.push(yn[e>>2]+yn[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],o.push(yn[e>>10]+yn[e>>4&63]+yn[e<<2&63]+"=")),o.join("")}});var kd=k(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.fromArrayBufferToHex=xU;function xU(t){return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}});var Iw=k(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.BrowserCrypto=void 0;var Po=Rw(),PU=kd(),Nd=class t{constructor(){if(typeof window>"u"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let n=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",n);return Po.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let n=new Uint8Array(e);return window.crypto.getRandomValues(n),Po.fromByteArray(n)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,n,r){let o={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(n),s=Po.toByteArray(t.padBase64(r)),a=await window.crypto.subtle.importKey("jwk",e,o,!0,["verify"]);return await window.crypto.subtle.verify(o,a,s,i)}async sign(e,n){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},o=new TextEncoder().encode(n),i=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),s=await window.crypto.subtle.sign(r,i,o);return Po.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let n=Po.toByteArray(t.padBase64(e));return new TextDecoder().decode(n)}encodeBase64StringUtf8(e){let n=new TextEncoder().encode(e);return Po.fromByteArray(n)}async sha256DigestHex(e){let n=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",n);return(0,PU.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,n){let r=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),o=new TextEncoder,i=await window.crypto.subtle.importKey("raw",o.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",i,o.encode(n))}};hl.BrowserCrypto=Nd});var xw=k(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});ml.NodeCrypto=void 0;var ko=require("crypto"),Md=class{async sha256DigestBase64(e){return ko.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return ko.randomBytes(e).toString("base64")}async verify(e,n,r){let o=ko.createVerify("RSA-SHA256");return o.update(n),o.end(),o.verify(e,r,"base64")}async sign(e,n){let r=ko.createSign("RSA-SHA256");return r.update(n),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return ko.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,n){let r=typeof e=="string"?e:NU(e);return kU(ko.createHmac("sha256",r).update(n).digest())}};ml.NodeCrypto=Md;function kU(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function NU(t){return Buffer.from(t)}});var ts=k(Ln=>{"use strict";var MU=Ln&&Ln.__createBinding||(Object.create?(function(t,e,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(e,n);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,o)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]})),OU=Ln&&Ln.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&MU(e,t,n)};Object.defineProperty(Ln,"__esModule",{value:!0});Ln.createCrypto=LU;Ln.hasBrowserCrypto=Pw;var DU=Iw(),FU=xw();OU(kd(),Ln);function LU(){return Pw()?new DU.BrowserCrypto:new FU.NodeCrypto}function Pw(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}});var No=k((Od,Nw)=>{var gl=require("buffer"),_n=gl.Buffer;function kw(t,e){for(var n in t)e[n]=t[n]}_n.from&&_n.alloc&&_n.allocUnsafe&&_n.allocUnsafeSlow?Nw.exports=gl:(kw(gl,Od),Od.Buffer=Br);function Br(t,e,n){return _n(t,e,n)}Br.prototype=Object.create(_n.prototype);kw(_n,Br);Br.from=function(t,e,n){if(typeof t=="number")throw new TypeError("Argument must not be a number");return _n(t,e,n)};Br.alloc=function(t,e,n){if(typeof t!="number")throw new TypeError("Argument must be a number");var r=_n(t);return e!==void 0?typeof n=="string"?r.fill(e,n):r.fill(e):r.fill(0),r};Br.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return _n(t)};Br.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return gl.SlowBuffer(t)}});var Ow=k((R5,Mw)=>{"use strict";function Dd(t){var e=(t/8|0)+(t%8===0?0:1);return e}var UU={ES256:Dd(256),ES384:Dd(384),ES512:Dd(521)};function qU(t){var e=UU[t];if(e)return e;throw new Error('Unknown algorithm "'+t+'"')}Mw.exports=qU});var Fd=k((I5,Bw)=>{"use strict";var yl=No().Buffer,Fw=Ow(),_l=128,Lw=0,BU=32,GU=16,HU=2,Uw=GU|BU|Lw<<6,Sl=HU|Lw<<6;function $U(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function qw(t){if(yl.isBuffer(t))return t;if(typeof t=="string")return yl.from(t,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function VU(t,e){t=qw(t);var n=Fw(e),r=n+1,o=t.length,i=0;if(t[i++]!==Uw)throw new Error('Could not find expected "seq"');var s=t[i++];if(s===(_l|1)&&(s=t[i++]),o-i<s)throw new Error('"seq" specified length of "'+s+'", only "'+(o-i)+'" remaining');if(t[i++]!==Sl)throw new Error('Could not find expected "int" for "r"');var a=t[i++];if(o-i-2<a)throw new Error('"r" specified length of "'+a+'", only "'+(o-i-2)+'" available');if(r<a)throw new Error('"r" specified length of "'+a+'", max of "'+r+'" is acceptable');var l=i;if(i+=a,t[i++]!==Sl)throw new Error('Could not find expected "int" for "s"');var c=t[i++];if(o-i!==c)throw new Error('"s" specified length of "'+c+'", expected "'+(o-i)+'"');if(r<c)throw new Error('"s" specified length of "'+c+'", max of "'+r+'" is acceptable');var f=i;if(i+=c,i!==o)throw new Error('Expected to consume entire buffer, but "'+(o-i)+'" bytes remain');var m=n-a,h=n-c,y=yl.allocUnsafe(m+a+h+c);for(i=0;i<m;++i)y[i]=0;t.copy(y,i,l+Math.max(-m,0),l+a),i=n;for(var _=i;i<_+h;++i)y[i]=0;return t.copy(y,i,f+Math.max(-h,0),f+c),y=y.toString("base64"),y=$U(y),y}function Dw(t,e,n){for(var r=0;e+r<n&&t[e+r]===0;)++r;var o=t[e+r]>=_l;return o&&--r,r}function WU(t,e){t=qw(t);var n=Fw(e),r=t.length;if(r!==n*2)throw new TypeError('"'+e+'" signatures must be "'+n*2+'" bytes, saw "'+r+'"');var o=Dw(t,0,n),i=Dw(t,n,t.length),s=n-o,a=n-i,l=2+s+1+1+a,c=l<_l,f=yl.allocUnsafe((c?2:3)+l),m=0;return f[m++]=Uw,c?f[m++]=l:(f[m++]=_l|1,f[m++]=l&255),f[m++]=Sl,f[m++]=s,o<0?(f[m++]=0,m+=t.copy(f,m,0,n)):m+=t.copy(f,m,o,n),f[m++]=Sl,f[m++]=a,i<0?(f[m++]=0,t.copy(f,m,n)):t.copy(f,m,n+i),f}Bw.exports={derToJose:VU,joseToDer:WU}});var Zt=k(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.LRUCache=void 0;Un.snakeToCamel=Hw;Un.originalOrCamelOptions=YU;Un.removeUndefinedValuesInObject=jU;Un.isValidFile=XU;Un.getWellKnownCertificateConfigFileLocation=QU;var JU=require("fs"),zU=require("os"),Ld=require("path"),KU="certificate_config.json",Gw="gcloud";function Hw(t){return t.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function YU(t){function e(n){let r=t||{};return r[n]??r[Hw(n)]}return{get:e}}var Ud=class{capacity;#e=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#t(e,n){this.#e.delete(e),this.#e.set(e,{value:n,lastAccessed:Date.now()})}set(e,n){this.#t(e,n),this.#n()}get(e){let n=this.#e.get(e);if(n)return this.#t(e,n.value),this.#n(),n.value}#n(){let e=this.maxAge?Date.now()-this.maxAge:0,n=this.#e.entries().next();for(;!n.done&&(this.#e.size>this.capacity||n.value[1].lastAccessed<e);)this.#e.delete(n.value[0]),n=this.#e.entries().next()}};Un.LRUCache=Ud;function jU(t){return Object.entries(t).forEach(([e,n])=>{(n===void 0||n==="undefined")&&delete t[e]}),t}async function XU(t){try{return(await JU.promises.lstat(t)).isFile()}catch{return!1}}function QU(){let t=process.env.CLOUDSDK_CONFIG||(ZU()?Ld.join(process.env.APPDATA||"",Gw):Ld.join(process.env.HOME||"",".config",Gw));return Ld.join(t,KU)}function ZU(){return zU.platform().startsWith("win")}});var $w=k((P5,eq)=>{eq.exports={name:"google-auth-library",version:"10.5.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"echo 'disabled until linkinator is fixed'","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var qd=k(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.USER_AGENT=fr.PRODUCT_NAME=fr.pkg=void 0;var Vw=$w();fr.pkg=Vw;var Ww="google-api-nodejs-client";fr.PRODUCT_NAME=Ww;var tq=`${Ww}/${Vw.version}`;fr.USER_AGENT=tq});var At=k(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.AuthClient=en.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=en.DEFAULT_UNIVERSE=void 0;var nq=require("events"),Bd=Ve(),rq=Zt(),oq=Cd(),Gd=qd();en.DEFAULT_UNIVERSE="googleapis.com";en.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=300*1e3;var Hd=class t extends nq.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=en.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=en.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let n=(0,rq.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=n.get("project_id")??null,this.quotaProjectId=n.get("quota_project_id"),this.credentials=n.get("credentials")??{},this.universeDomain=n.get("universe_domain")??en.DEFAULT_UNIVERSE,this.transporter=e.transporter??new Bd.Gaxios(e.transporterOptions),n.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(t.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(t.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let n=e[0],r=e[1],o,i=new Headers;return typeof n=="string"?o=new URL(n):n instanceof URL?o=n:n&&n.url&&(o=new URL(n.url)),n&&typeof n=="object"&&"headers"in n&&Bd.Gaxios.mergeHeaders(i,n.headers),r&&Bd.Gaxios.mergeHeaders(i,new Headers(r.headers)),typeof n=="object"&&!(n instanceof URL)?this.request({...r,...n,headers:i,url:o}):this.request({...r,headers:i,url:o})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,n){let r=n.get("x-goog-user-project"),o=n.get("authorization");return r&&e.set("x-goog-user-project",r),o&&e.set("authorization",o),e}static log=(0,oq.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let r=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${r}`)}let n=e.headers.get("User-Agent");n?n.includes(`${Gd.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${n} ${Gd.USER_AGENT}`):e.headers.set("User-Agent",Gd.USER_AGENT);try{let r=e,o=r[t.RequestMethodNameSymbol],i=`${Math.floor(Math.random()*1e3)}`;r[t.RequestLogIdSymbol]=i;let s={url:e.url,headers:e.headers};o?t.log.info("%s [%s] request %j",o,i,s):t.log.info("[%s] request %j",i,s)}catch{}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let n=e.config,r=n[t.RequestMethodNameSymbol],o=n[t.RequestLogIdSymbol];r?t.log.info("%s [%s] response %j",r,o,e.data):t.log.info("[%s] response %j",o,e.data)}catch{}return e},rejected:async e=>{try{let n=e.config,r=n[t.RequestMethodNameSymbol],o=n[t.RequestLogIdSymbol];r?t.log.info("%s [%s] error %j",r,o,e.response?.data):t.log.error("[%s] error %j",o,e.response?.data)}catch{}throw e}};static setMethodName(e,n){try{let r=e;r[t.RequestMethodNameSymbol]=n}catch{}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};en.AuthClient=Hd});var Vd=k(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.LoginTicket=void 0;var $d=class{envelope;payload;constructor(e,n){this.envelope=e,this.payload=n}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};Tl.LoginTicket=$d});var Gr=k(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.OAuth2Client=Sn.ClientAuthentication=Sn.CertificateFormat=Sn.CodeChallengeMethod=void 0;var Jw=Ve(),iq=require("querystring"),sq=require("stream"),aq=Fd(),zw=Zt(),Wd=ts(),Mo=At(),lq=Vd(),Kw;(function(t){t.Plain="plain",t.S256="S256"})(Kw||(Sn.CodeChallengeMethod=Kw={}));var qn;(function(t){t.PEM="PEM",t.JWK="JWK"})(qn||(Sn.CertificateFormat=qn={}));var ns;(function(t){t.ClientSecretPost="ClientSecretPost",t.ClientSecretBasic="ClientSecretBasic",t.None="None"})(ns||(Sn.ClientAuthentication=ns={}));var Jd=class t extends Mo.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=qn.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},n,r){super(typeof e=="object"?e:{}),typeof e!="object"&&(e={clientId:e,clientSecret:n,redirectUri:r}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||ns.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+iq.stringify(e)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,Wd.createCrypto)(),r=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),i=(await e.sha256DigestBase64(r)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:r,codeChallenge:i}}getToken(e,n){let r=typeof e=="string"?{code:e}:e;if(n)this.getTokenAsync(r).then(o=>n(null,o.tokens,o.res),o=>n(o,null,o.response));else return this.getTokenAsync(r)}async getTokenAsync(e){let n=this.endpoints.oauth2TokenUrl.toString(),r=new Headers,o={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===ns.ClientSecretBasic){let l=Buffer.from(`${this._clientId}:${this._clientSecret}`);r.set("authorization",`Basic ${l.toString("base64")}`)}this.clientAuthentication===ns.ClientSecretPost&&(o.client_secret=this._clientSecret);let i={...t.RETRY_CONFIG,method:"POST",url:n,data:new URLSearchParams((0,zw.removeUndefinedValuesInObject)(o)),headers:r};Mo.AuthClient.setMethodName(i,"getTokenAsync");let s=await this.transporter.request(i),a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+s.data.expires_in*1e3,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let n=this.refreshTokenNoCache(e).then(r=>(this.refreshTokenPromises.delete(e),r),r=>{throw this.refreshTokenPromises.delete(e),r});return this.refreshTokenPromises.set(e,n),n}async refreshTokenNoCache(e){if(!e)throw new Error("No refresh token is set.");let n=this.endpoints.oauth2TokenUrl.toString(),r={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},o;try{let s={...t.RETRY_CONFIG,method:"POST",url:n,data:new URLSearchParams((0,zw.removeUndefinedValuesInObject)(r))};Mo.AuthClient.setMethodName(s,"refreshTokenNoCache"),o=await this.transporter.request(s)}catch(s){throw s instanceof Jw.GaxiosError&&s.message==="invalid_grant"&&s.response?.data&&/ReAuth/i.test(s.response.data.error_description)&&(s.message=JSON.stringify(s.response.data)),s}let i=o.data;return o.data&&o.data.expires_in&&(i.expiry_date=new Date().getTime()+o.data.expires_in*1e3,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:o}}refreshAccessToken(e){if(e)this.refreshAccessTokenAsync().then(n=>e(null,n.credentials,n.res),e);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),n=e.tokens;return n.refresh_token=this.credentials.refresh_token,this.credentials=n,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(e)this.getAccessTokenAsync().then(n=>e(null,n.token,n.res),e);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let r=await this.processAndValidateRefreshHandler();if(r?.access_token)return this.setCredentials(r),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let n=await this.refreshAccessTokenAsync();if(!n.credentials||n.credentials&&!n.credentials.access_token)throw new Error("Could not refresh access token.");return{token:n.credentials.access_token,res:n.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let n=this.credentials;if(!n.access_token&&!n.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(n.access_token&&!this.isTokenExpiring()){n.token_type=n.token_type||"Bearer";let a=new Headers({authorization:n.token_type+" "+n.access_token});return{headers:this.addSharedMetadataHeaders(a)}}if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token){this.setCredentials(a);let l=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(l)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let r=null,o=null;try{r=await this.refreshToken(n.refresh_token),o=r.tokens}catch(a){let l=a;throw l.response&&(l.response.status===403||l.response.status===404)&&(l.message=`Could not refresh access token: ${l.message}`),l}let i=this.credentials;i.token_type=i.token_type||"Bearer",o.refresh_token=i.refresh_token,this.credentials=o;let s=new Headers({authorization:i.token_type+" "+o.access_token});return{headers:this.addSharedMetadataHeaders(s),res:r.res}}static getRevokeTokenUrl(e){return new t().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let n=new URL(this.endpoints.oauth2RevokeUrl);return n.searchParams.append("token",e),n}revokeToken(e,n){let r={...t.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(Mo.AuthClient.setMethodName(r,"revokeToken"),n)this.transporter.request(r).then(o=>n(null,o),n);else return this.transporter.request(r)}revokeCredentials(e){if(e)this.revokeCredentialsAsync().then(n=>e(null,n),e);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw new Error("No access token to revoke.")}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async requestAsync(e,n=!1){try{let r=await this.getRequestMetadataAsync();return e.headers=Jw.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,r.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(r){let o=r.response;if(o){let i=o.status,s=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),a=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,l=o.config.data instanceof sq.Readable,c=i===401||i===403;if(!n&&c&&!l&&s)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!n&&c&&!l&&a){let f=await this.processAndValidateRefreshHandler();return f?.access_token&&this.setCredentials(f),this.requestAsync(e,!0)}}throw r}}verifyIdToken(e,n){if(n&&typeof n!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(n)this.verifyIdTokenAsync(e).then(r=>n(null,r),n);else return this.verifyIdTokenAsync(e)}async verifyIdTokenAsync(e){if(!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let n=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,n.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:n}=await this.transporter.request({...t.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),r=Object.assign({expiry_date:new Date().getTime()+n.expires_in*1e3,scopes:n.scope.split(" ")},n);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(n=>e(null,n.certs,n.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),n=(0,Wd.hasBrowserCrypto)()?qn.JWK:qn.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===n)return{certs:this.certificateCache,format:n};let r,o;switch(n){case qn.PEM:o=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case qn.JWK:o=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${n}`)}try{let c={...t.RETRY_CONFIG,url:o};Mo.AuthClient.setMethodName(c,"getFederatedSignonCertsAsync"),r=await this.transporter.request(c)}catch(c){throw c instanceof Error&&(c.message=`Failed to retrieve verification certificates: ${c.message}`),c}let i=r?.headers.get("cache-control"),s=-1;if(i){let c=/max-age=(?<maxAge>[0-9]+)/.exec(i)?.groups?.maxAge;c&&(s=Number(c)*1e3)}let a={};switch(n){case qn.PEM:a=r.data;break;case qn.JWK:for(let c of r.data.keys)a[c.kid]=c;break;default:throw new Error(`Unsupported certificate format ${n}`)}let l=new Date;return this.certificateExpiry=s===-1?null:new Date(l.getTime()+s),this.certificateCache=a,this.certificateCacheFormat=n,{certs:a,format:n,res:r}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(n=>e(null,n.pubkeys,n.res),e);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let e,n=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let r={...t.RETRY_CONFIG,url:n};Mo.AuthClient.setMethodName(r,"getIapPublicKeysAsync"),e=await this.transporter.request(r)}catch(r){throw r instanceof Error&&(r.message=`Failed to retrieve verification certificates: ${r.message}`),r}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,n,r,o,i){let s=(0,Wd.createCrypto)();i||(i=t.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let a=e.split(".");if(a.length!==3)throw new Error("Wrong number of segments in token: "+e);let l=a[0]+"."+a[1],c=a[2],f,m;try{f=JSON.parse(s.decodeBase64StringUtf8(a[0]))}catch(L){throw L instanceof Error&&(L.message=`Can't parse token envelope: ${a[0]}': ${L.message}`),L}if(!f)throw new Error("Can't parse token envelope: "+a[0]);try{m=JSON.parse(s.decodeBase64StringUtf8(a[1]))}catch(L){throw L instanceof Error&&(L.message=`Can't parse token payload '${a[0]}`),L}if(!m)throw new Error("Can't parse token payload: "+a[1]);if(!Object.prototype.hasOwnProperty.call(n,f.kid))throw new Error("No pem found for envelope: "+JSON.stringify(f));let h=n[f.kid];if(f.alg==="ES256"&&(c=aq.joseToDer(c,"ES256").toString("base64")),!await s.verify(h,l,c))throw new Error("Invalid token signature: "+e);if(!m.iat)throw new Error("No issue time in token: "+JSON.stringify(m));if(!m.exp)throw new Error("No expiration time in token: "+JSON.stringify(m));let _=Number(m.iat);if(isNaN(_))throw new Error("iat field using invalid format");let T=Number(m.exp);if(isNaN(T))throw new Error("exp field using invalid format");let E=new Date().getTime()/1e3;if(T>=E+i)throw new Error("Expiration time too far in future: "+JSON.stringify(m));let w=_-t.CLOCK_SKEW_SECS_,b=T+t.CLOCK_SKEW_SECS_;if(E<w)throw new Error("Token used too early, "+E+" < "+w+": "+JSON.stringify(m));if(E>b)throw new Error("Token used too late, "+E+" > "+b+": "+JSON.stringify(m));if(o&&o.indexOf(m.iss)<0)throw new Error("Invalid issuer, expected one of ["+o+"], but got "+m.iss);if(typeof r<"u"&&r!==null){let L=m.aud,D=!1;if(r.constructor===Array?D=r.indexOf(L)>-1:D=L===r,!D)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new lq.LoginTicket(f,m)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return e?e<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};Sn.OAuth2Client=Jd});var Kd=k(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});El.Compute=void 0;var uq=Ve(),Yw=es(),cq=Gr(),zd=class extends cq.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e=`service-accounts/${this.serviceAccountEmail}/token`,n;try{let o={property:e};this.scopes.length>0&&(o.params={scopes:this.scopes.join(",")}),n=await Yw.instance(o)}catch(o){throw o instanceof uq.GaxiosError&&(o.message=`Could not refresh access token: ${o.message}`,this.wrapError(o)),o}let r=n;return n&&n.expires_in&&(r.expiry_date=new Date().getTime()+n.expires_in*1e3,delete r.expires_in),this.emit("tokens",r),{tokens:r,res:null}}async fetchIdToken(e){let n=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`,r;try{let o={property:n};r=await Yw.instance(o)}catch(o){throw o instanceof Error&&(o.message=`Could not fetch ID token: ${o.message}`),o}return r}wrapError(e){let n=e.response;n&&n.status&&(e.status=n.status,n.status===403?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:n.status===404&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}};El.Compute=zd});var jd=k(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.IdTokenClient=void 0;var fq=Gr(),Yd=class extends fq.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let n=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:n,expiry_date:this.getIdTokenExpiryDate(n)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let n=e.split(".")[1];if(n)return JSON.parse(Buffer.from(n,"base64").toString("ascii")).exp*1e3}};wl.IdTokenClient=Yd});var Xd=k(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.GCPEnv=void 0;Oo.clear=dq;Oo.getEnv=pq;var jw=es(),Tn;(function(t){t.APP_ENGINE="APP_ENGINE",t.KUBERNETES_ENGINE="KUBERNETES_ENGINE",t.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",t.COMPUTE_ENGINE="COMPUTE_ENGINE",t.CLOUD_RUN="CLOUD_RUN",t.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",t.NONE="NONE"})(Tn||(Oo.GCPEnv=Tn={}));var rs;function dq(){rs=void 0}async function pq(){return rs||(rs=hq(),rs)}async function hq(){let t=Tn.NONE;return mq()?t=Tn.APP_ENGINE:gq()?t=Tn.CLOUD_FUNCTIONS:await Tq()?await Sq()?t=Tn.KUBERNETES_ENGINE:yq()?t=Tn.CLOUD_RUN:_q()?t=Tn.CLOUD_RUN_JOBS:t=Tn.COMPUTE_ENGINE:t=Tn.NONE,t}function mq(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function gq(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function yq(){return!!process.env.K_CONFIGURATION}function _q(){return!!process.env.CLOUD_RUN_JOB}async function Sq(){try{return await jw.instance("attributes/cluster-name"),!0}catch{return!1}}async function Tq(){return jw.isAvailable()}});var Qd=k((U5,Xw)=>{var vl=No().Buffer,Eq=require("stream"),wq=require("util");function Al(t){if(this.buffer=null,this.writable=!0,this.readable=!0,!t)return this.buffer=vl.alloc(0),this;if(typeof t.pipe=="function")return this.buffer=vl.alloc(0),t.pipe(this),this;if(t.length||typeof t=="object")return this.buffer=t,this.writable=!1,process.nextTick(function(){this.emit("end",t),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof t+")")}wq.inherits(Al,Eq);Al.prototype.write=function(e){this.buffer=vl.concat([this.buffer,vl.from(e)]),this.emit("data",e)};Al.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};Xw.exports=Al});var Zw=k((q5,Qw)=>{"use strict";var os=require("buffer").Buffer,Zd=require("buffer").SlowBuffer;Qw.exports=Cl;function Cl(t,e){if(!os.isBuffer(t)||!os.isBuffer(e)||t.length!==e.length)return!1;for(var n=0,r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}Cl.install=function(){os.prototype.equal=Zd.prototype.equal=function(e){return Cl(this,e)}};var vq=os.prototype.equal,Aq=Zd.prototype.equal;Cl.restore=function(){os.prototype.equal=vq,Zd.prototype.equal=Aq}});var rp=k((B5,lv)=>{var Fo=No().Buffer,qt=require("crypto"),tv=Fd(),ev=require("util"),Cq=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,is="secret must be a string or buffer",Do="key must be a string or a buffer",bq="key must be a string, a buffer or an object",tp=typeof qt.createPublicKey=="function";tp&&(Do+=" or a KeyObject",is+="or a KeyObject");function nv(t){if(!Fo.isBuffer(t)&&typeof t!="string"&&(!tp||typeof t!="object"||typeof t.type!="string"||typeof t.asymmetricKeyType!="string"||typeof t.export!="function"))throw tn(Do)}function rv(t){if(!Fo.isBuffer(t)&&typeof t!="string"&&typeof t!="object")throw tn(bq)}function Rq(t){if(!Fo.isBuffer(t)){if(typeof t=="string")return t;if(!tp||typeof t!="object"||t.type!=="secret"||typeof t.export!="function")throw tn(is)}}function np(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ov(t){t=t.toString();var e=4-t.length%4;if(e!==4)for(var n=0;n<e;++n)t+="=";return t.replace(/\-/g,"+").replace(/_/g,"/")}function tn(t){var e=[].slice.call(arguments,1),n=ev.format.bind(ev,t).apply(null,e);return new TypeError(n)}function Iq(t){return Fo.isBuffer(t)||typeof t=="string"}function ss(t){return Iq(t)||(t=JSON.stringify(t)),t}function iv(t){return function(n,r){Rq(r),n=ss(n);var o=qt.createHmac("sha"+t,r),i=(o.update(n),o.digest("base64"));return np(i)}}var ep,xq="timingSafeEqual"in qt?function(e,n){return e.byteLength!==n.byteLength?!1:qt.timingSafeEqual(e,n)}:function(e,n){return ep||(ep=Zw()),ep(e,n)};function Pq(t){return function(n,r,o){var i=iv(t)(n,o);return xq(Fo.from(r),Fo.from(i))}}function sv(t){return function(n,r){rv(r),n=ss(n);var o=qt.createSign("RSA-SHA"+t),i=(o.update(n),o.sign(r,"base64"));return np(i)}}function av(t){return function(n,r,o){nv(o),n=ss(n),r=ov(r);var i=qt.createVerify("RSA-SHA"+t);return i.update(n),i.verify(o,r,"base64")}}function kq(t){return function(n,r){rv(r),n=ss(n);var o=qt.createSign("RSA-SHA"+t),i=(o.update(n),o.sign({key:r,padding:qt.constants.RSA_PKCS1_PSS_PADDING,saltLength:qt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return np(i)}}function Nq(t){return function(n,r,o){nv(o),n=ss(n),r=ov(r);var i=qt.createVerify("RSA-SHA"+t);return i.update(n),i.verify({key:o,padding:qt.constants.RSA_PKCS1_PSS_PADDING,saltLength:qt.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function Mq(t){var e=sv(t);return function(){var r=e.apply(null,arguments);return r=tv.derToJose(r,"ES"+t),r}}function Oq(t){var e=av(t);return function(r,o,i){o=tv.joseToDer(o,"ES"+t).toString("base64");var s=e(r,o,i);return s}}function Dq(){return function(){return""}}function Fq(){return function(e,n){return n===""}}lv.exports=function(e){var n={hs:iv,rs:sv,ps:kq,es:Mq,none:Dq},r={hs:Pq,rs:av,ps:Nq,es:Oq,none:Fq},o=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!o)throw tn(Cq,e);var i=(o[1]||o[3]).toLowerCase(),s=o[2];return{sign:n[i](s),verify:r[i](s)}}});var op=k((G5,uv)=>{var Lq=require("buffer").Buffer;uv.exports=function(e){return typeof e=="string"?e:typeof e=="number"||Lq.isBuffer(e)?e.toString():JSON.stringify(e)}});var mv=k((H5,hv)=>{var Uq=No().Buffer,cv=Qd(),qq=rp(),Bq=require("stream"),fv=op(),ip=require("util");function dv(t,e){return Uq.from(t,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Gq(t,e,n){n=n||"utf8";var r=dv(fv(t),"binary"),o=dv(fv(e),n);return ip.format("%s.%s",r,o)}function pv(t){var e=t.header,n=t.payload,r=t.secret||t.privateKey,o=t.encoding,i=qq(e.alg),s=Gq(e,n,o),a=i.sign(s,r);return ip.format("%s.%s",s,a)}function bl(t){var e=t.secret;if(e=e??t.privateKey,e=e??t.key,/^hs/i.test(t.header.alg)===!0&&e==null)throw new TypeError("secret must be a string or buffer or a KeyObject");var n=new cv(e);this.readable=!0,this.header=t.header,this.encoding=t.encoding,this.secret=this.privateKey=this.key=n,this.payload=new cv(t.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}ip.inherits(bl,Bq);bl.prototype.sign=function(){try{var e=pv({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};bl.sign=pv;hv.exports=bl});var Cv=k(($5,Av)=>{var yv=No().Buffer,gv=Qd(),Hq=rp(),$q=require("stream"),_v=op(),Vq=require("util"),Wq=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function Jq(t){return Object.prototype.toString.call(t)==="[object Object]"}function zq(t){if(Jq(t))return t;try{return JSON.parse(t)}catch{return}}function Sv(t){var e=t.split(".",1)[0];return zq(yv.from(e,"base64").toString("binary"))}function Kq(t){return t.split(".",2).join(".")}function Tv(t){return t.split(".")[2]}function Yq(t,e){e=e||"utf8";var n=t.split(".")[1];return yv.from(n,"base64").toString(e)}function Ev(t){return Wq.test(t)&&!!Sv(t)}function wv(t,e,n){if(!e){var r=new Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}t=_v(t);var o=Tv(t),i=Kq(t),s=Hq(e);return s.verify(i,o,n)}function vv(t,e){if(e=e||{},t=_v(t),!Ev(t))return null;var n=Sv(t);if(!n)return null;var r=Yq(t);return(n.typ==="JWT"||e.json)&&(r=JSON.parse(r,e.encoding)),{header:n,payload:r,signature:Tv(t)}}function Lo(t){t=t||{};var e=t.secret;if(e=e??t.publicKey,e=e??t.key,/^hs/i.test(t.algorithm)===!0&&e==null)throw new TypeError("secret must be a string or buffer or a KeyObject");var n=new gv(e);this.readable=!0,this.algorithm=t.algorithm,this.encoding=t.encoding,this.secret=this.publicKey=this.key=n,this.signature=new gv(t.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}Vq.inherits(Lo,$q);Lo.prototype.verify=function(){try{var e=wv(this.signature.buffer,this.algorithm,this.key.buffer),n=vv(this.signature.buffer,this.encoding);return this.emit("done",e,n),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(r){this.readable=!1,this.emit("error",r),this.emit("close")}};Lo.decode=vv;Lo.isValid=Ev;Lo.verify=wv;Av.exports=Lo});var sp=k(dr=>{var bv=mv(),Rl=Cv(),jq=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];dr.ALGORITHMS=jq;dr.sign=bv.sign;dr.verify=Rl.verify;dr.decode=Rl.decode;dr.isValid=Rl.isValid;dr.createSign=function(e){return new bv(e)};dr.createVerify=function(e){return new Rl(e)}});var Gv=k(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.GoogleToken=void 0;var Rv=Il(require("fs")),Xq=Ve(),Qq=Il(sp()),Zq=Il(require("path")),e1=require("util");function Il(t,e){if(typeof WeakMap=="function")var n=new WeakMap,r=new WeakMap;return(Il=function(i,s){if(!s&&i&&i.__esModule)return i;var a,l,c={__proto__:null,default:i};if(i===null||Bn(i)!="object"&&typeof i!="function")return c;if(a=s?r:n){if(a.has(i))return a.get(i);a.set(i,c)}for(var f in i)f!=="default"&&{}.hasOwnProperty.call(i,f)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(i,f))&&(l.get||l.set)?a(c,f,l):c[f]=i[f]);return c})(t,e)}function Bn(t){"@babel/helpers - typeof";return Bn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(t)}function t1(t,e){Fv(t,e),e.add(t)}function n1(t,e,n){Fv(t,e),e.set(t,n)}function Fv(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Iv(t,e,n){return t.set(nn(t,e),n),n}function xv(t,e){return t.get(nn(t,e))}function nn(t,e,n){if(typeof t=="function"?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function Pv(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qv(r.key),r)}}function Lv(t,e,n){return e&&Pv(t.prototype,e),n&&Pv(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Uv(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r1(t,e,n){return e=cs(e),o1(t,dp()?Reflect.construct(e,n||[],cs(t).constructor):e.apply(t,n))}function o1(t,e){if(e&&(Bn(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return i1(t)}function i1(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s1(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&us(t,e)}function ap(t){var e=typeof Map=="function"?new Map:void 0;return ap=function(r){if(r===null||!l1(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return a1(r,arguments,cs(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),us(o,r)},ap(t)}function a1(t,e,n){if(dp())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&us(o,n.prototype),o}function dp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dp=function(){return!!t})()}function l1(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function us(t,e){return us=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},us(t,e)}function cs(t){return cs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cs(t)}function Ct(t,e,n){return(e=qv(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qv(t){var e=u1(t,"string");return Bn(e)=="symbol"?e:e+""}function u1(t,e){if(Bn(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Bn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Rt(){var t,e,n=typeof Symbol=="function"?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(y,_,T,E){var w=_&&_.prototype instanceof a?_:a,b=Object.create(w.prototype);return bt(b,"_invoke",(function(L,D,I){var P,q,K,B=0,j=I||[],Q=!1,oe={p:0,n:0,v:t,a:le,f:le.bind(t,4),d:function(ye,Te){return P=ye,q=0,K=t,oe.n=Te,s}};function le(ue,ye){for(q=ue,K=ye,e=0;!Q&&B&&!Te&&e<j.length;e++){var Te,Ae=j[e],Pe=oe.p,Oe=Ae[2];ue>3?(Te=Oe===ye)&&(K=Ae[(q=Ae[4])?5:(q=3,3)],Ae[4]=Ae[5]=t):Ae[0]<=Pe&&((Te=ue<2&&Pe<Ae[1])?(q=0,oe.v=ye,oe.n=Ae[1]):Pe<Oe&&(Te=ue<3||Ae[0]>ye||ye>Oe)&&(Ae[4]=ue,Ae[5]=ye,oe.n=Oe,q=0))}if(Te||ue>1)return s;throw Q=!0,ye}return function(ue,ye,Te){if(B>1)throw TypeError("Generator is already running");for(Q&&ye===1&&le(ye,Te),q=ye,K=Te;(e=q<2?t:K)||!Q;){P||(q?q<3?(q>1&&(oe.n=-1),le(q,K)):oe.n=K:oe.v=K);try{if(B=2,P){if(q||(ue="next"),e=P[ue]){if(!(e=e.call(P,K)))throw TypeError("iterator result is not an object");if(!e.done)return e;K=e.value,q<2&&(q=0)}else q===1&&(e=P.return)&&e.call(P),q<2&&(K=TypeError("The iterator does not provide a '"+ue+"' method"),q=1);P=t}else if((e=(Q=oe.n<0)?K:L.call(D,oe))!==s)break}catch(Ae){P=t,q=1,K=Ae}finally{B=1}}return{value:e,done:Q}}})(y,T,E),!0),b}var s={};function a(){}function l(){}function c(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(bt(e={},r,function(){return this}),e),m=c.prototype=a.prototype=Object.create(f);function h(y){return Object.setPrototypeOf?Object.setPrototypeOf(y,c):(y.__proto__=c,bt(y,o,"GeneratorFunction")),y.prototype=Object.create(m),y}return l.prototype=c,bt(m,"constructor",c),bt(c,"constructor",l),l.displayName="GeneratorFunction",bt(c,o,"GeneratorFunction"),bt(m),bt(m,o,"Generator"),bt(m,r,function(){return this}),bt(m,"toString",function(){return"[object Generator]"}),(Rt=function(){return{w:i,m:h}})()}function bt(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch{o=0}bt=function(s,a,l,c){if(a)o?o(s,a,{value:l,enumerable:!c,configurable:!c,writable:!c}):s[a]=l;else{var f=function(h,y){bt(s,h,function(_){return this._invoke(h,y,_)})};f("next",0),f("throw",1),f("return",2)}},bt(t,e,n,r)}function kv(t,e,n,r,o,i,s){try{var a=t[i](s),l=a.value}catch(c){return void n(c)}a.done?e(l):Promise.resolve(l).then(r,o)}function Uo(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function s(l){kv(i,r,o,s,a,"next",l)}function a(l){kv(i,r,o,s,a,"throw",l)}s(void 0)})}}var Nv=Rv.readFile?(0,e1.promisify)(Rv.readFile):Uo(Rt().m(function t(){return Rt().w(function(e){for(;;)switch(e.n){case 0:throw new ls("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},t)})),Mv="https://oauth2.googleapis.com/token",c1="https://oauth2.googleapis.com/revoke?token=",ls=(function(t){function e(n,r){var o;return Uv(this,e),o=r1(this,e,[n]),Ct(o,"code",void 0),o.code=r,o}return s1(e,t),Lv(e)})(ap(Error)),as=new WeakMap,En=new WeakSet,W5=xl.GoogleToken=(function(){function t(e){Uv(this,t),t1(this,En),Ct(this,"expiresAt",void 0),Ct(this,"key",void 0),Ct(this,"keyFile",void 0),Ct(this,"iss",void 0),Ct(this,"sub",void 0),Ct(this,"scope",void 0),Ct(this,"rawToken",void 0),Ct(this,"tokenExpires",void 0),Ct(this,"email",void 0),Ct(this,"additionalClaims",void 0),Ct(this,"eagerRefreshThresholdMillis",void 0),Ct(this,"transporter",{request:function(r){return(0,Xq.request)(r)}}),n1(this,as,void 0),nn(En,this,Bv).call(this,e)}return Lv(t,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var n=new Date().getTime();return this.rawToken&&this.expiresAt?n>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var n,r=new Date().getTime(),o=(n=this.eagerRefreshThresholdMillis)!==null&&n!==void 0?n:0;return this.rawToken&&this.expiresAt?this.expiresAt<=r+o:!0}},{key:"getToken",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Bn(n)==="object"&&(r=n,n=void 0),r=Object.assign({forceRefresh:!1},r),n){var o=n;nn(En,this,Ov).call(this,r).then(function(i){return o(null,i)},n);return}return nn(En,this,Ov).call(this,r)}},{key:"getCredentials",value:(function(){var e=Uo(Rt().m(function r(o){var i,s,a,l,c,f,m;return Rt().w(function(h){for(;;)switch(h.n){case 0:i=Zq.extname(o),m=i,h.n=m===".json"?1:m===".der"||m===".crt"||m===".pem"?4:m===".p12"||m===".pfx"?6:7;break;case 1:return h.n=2,Nv(o,"utf8");case 2:if(s=h.v,a=JSON.parse(s),l=a.private_key,c=a.client_email,!(!l||!c)){h.n=3;break}throw new ls("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return h.a(2,{privateKey:l,clientEmail:c});case 4:return h.n=5,Nv(o,"utf8");case 5:return f=h.v,h.a(2,{privateKey:f});case 6:throw new ls("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new ls("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return h.a(2)}},r)}));function n(r){return e.apply(this,arguments)}return n})()},{key:"revokeToken",value:function(n){if(n){nn(En,this,Dv).call(this).then(function(){return n()},n);return}return nn(En,this,Dv).call(this)}}])})();function Ov(t){return lp.apply(this,arguments)}function lp(){return lp=Uo(Rt().m(function t(e){return Rt().w(function(n){for(;;)switch(n.n){case 0:if(!(xv(as,this)&&!e.forceRefresh)){n.n=1;break}return n.a(2,xv(as,this));case 1:return n.p=1,n.n=2,Iv(as,this,nn(En,this,f1).call(this,e));case 2:return n.a(2,n.v);case 3:return n.p=3,Iv(as,this,void 0),n.f(3);case 4:return n.a(2)}},t,this,[[1,,3,4]])})),lp.apply(this,arguments)}function f1(t){return up.apply(this,arguments)}function up(){return up=Uo(Rt().m(function t(e){var n;return Rt().w(function(r){for(;;)switch(r.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){r.n=1;break}return r.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){r.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){r.n=4;break}return r.n=3,this.getCredentials(this.keyFile);case 3:n=r.v,this.key=n.privateKey,this.iss=n.clientEmail||this.iss,n.clientEmail||nn(En,this,d1).call(this);case 4:return r.a(2,nn(En,this,p1).call(this))}},t,this)})),up.apply(this,arguments)}function d1(){if(!this.iss)throw new ls("email is required.","MISSING_CREDENTIALS")}function Dv(){return cp.apply(this,arguments)}function cp(){return cp=Uo(Rt().m(function t(){var e;return Rt().w(function(n){for(;;)switch(n.n){case 0:if(this.accessToken){n.n=1;break}throw new Error("No token to revoke.");case 1:return e=c1+this.accessToken,n.n=2,this.transporter.request({url:e,retry:!0});case 2:nn(En,this,Bv).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return n.a(2)}},t,this)})),cp.apply(this,arguments)}function Bv(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=t.keyFile,this.key=t.key,this.rawToken=void 0,this.iss=t.email||t.iss,this.sub=t.sub,this.additionalClaims=t.additionalClaims,Bn(t.scope)==="object"?this.scope=t.scope.join(" "):this.scope=t.scope,this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis,t.transporter&&(this.transporter=t.transporter)}function p1(){return fp.apply(this,arguments)}function fp(){return fp=Uo(Rt().m(function t(){var e,n,r,o,i,s,a,l,c,f;return Rt().w(function(m){for(;;)switch(m.n){case 0:return e=Math.floor(new Date().getTime()/1e3),n=this.additionalClaims||{},r=Object.assign({iss:this.iss,scope:this.scope,aud:Mv,exp:e+3600,iat:e,sub:this.sub},n),o=Qq.sign({header:{alg:"RS256"},payload:r,secret:this.key}),m.p=1,m.n=2,this.transporter.request({method:"POST",url:Mv,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:o}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return i=m.v,this.rawToken=i.data,this.expiresAt=i.data.expires_in===null||i.data.expires_in===void 0?void 0:(e+i.data.expires_in)*1e3,m.a(2,this.rawToken);case 3:throw m.p=3,f=m.v,this.rawToken=void 0,this.tokenExpires=void 0,l=f.response&&(s=f.response)!==null&&s!==void 0&&s.data?(a=f.response)===null||a===void 0?void 0:a.data:{},l.error&&(c=l.error_description?": ".concat(l.error_description):"",f.message="".concat(l.error).concat(c)),f;case 4:return m.a(2)}},t,this,[[1,3]])})),fp.apply(this,arguments)}});var hp=k(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.JWTAccess=void 0;var h1=sp(),m1=Zt(),Hv={alg:"RS256",typ:"JWT"},pp=class t{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new m1.LRUCache({capacity:500,maxAge:3600*1e3});constructor(e,n,r,o){this.email=e,this.key=n,this.keyId=r,this.eagerRefreshThresholdMillis=o??300*1e3}getCachedKey(e,n){let r=e;if(n&&Array.isArray(n)&&n.length?r=e?`${e}_${n.join("_")}`:`${n.join("_")}`:typeof n=="string"&&(r=e?`${e}_${n}`:n),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,n,r){let o=this.getCachedKey(e,r),i=this.cache.get(o),s=Date.now();if(i&&i.expiration-s>this.eagerRefreshThresholdMillis)return new Headers(i.headers);let a=Math.floor(Date.now()/1e3),l=t.getExpirationTime(a),c;if(Array.isArray(r)&&(r=r.join(" ")),r?c={iss:this.email,sub:this.email,scope:r,exp:l,iat:a}:c={iss:this.email,sub:this.email,aud:e,exp:l,iat:a},n){for(let _ in c)if(n[_])throw new Error(`The '${_}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let f=this.keyId?{...Hv,kid:this.keyId}:Hv,m=Object.assign(c,n),h=h1.sign({header:f,payload:m,secret:this.key}),y=new Headers({authorization:`Bearer ${h}`});return this.cache.set(o,{expiration:l*1e3,headers:y}),y}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,n){if(n)this.fromStreamAsync(e).then(()=>n(),n);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((n,r)=>{e||r(new Error("Must pass in a stream containing the service account auth settings."));let o="";e.setEncoding("utf8").on("data",i=>o+=i).on("error",r).on("end",()=>{try{let i=JSON.parse(o);this.fromJSON(i),n()}catch(i){r(i)}})})}};Pl.JWTAccess=pp});var gp=k(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.JWT=void 0;var $v=Gv(),g1=hp(),y1=Gr(),kl=At(),mp=class t extends y1.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let n=new t(this);return n.scopes=e,n}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let n=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==kl.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==kl.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${kl.DEFAULT_UNIVERSE}`);if(!this.apiKey&&n)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:r}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${r.id_token}`}))}}else{this.access||(this.access=new g1.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let r;this.hasUserScopes()?r=this.scopes:e||(r=this.defaultScopes);let o=this.useJWTAccessWithScope||this.universeDomain!==kl.DEFAULT_UNIVERSE,i=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,o?r:void 0);return{headers:this.addSharedMetadataHeaders(i)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let n=new $v.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await n.getToken({forceRefresh:!0}),!n.idToken)throw new Error("Unknown error: Failed to fetch ID token");return n.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(e){if(e)this.authorizeAsync().then(n=>e(null,n),e);else return this.authorizeAsync()}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw new Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),r={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",r),{res:null,tokens:r}}createGToken(){return this.gtoken||(this.gtoken=new $v.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,n){if(n)this.fromStreamAsync(e).then(()=>n(),n);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((n,r)=>{if(!e)throw new Error("Must pass in a stream containing the service account auth settings.");let o="";e.setEncoding("utf8").on("error",r).on("data",i=>o+=i).on("end",()=>{try{let i=JSON.parse(o);this.fromJSON(i),n()}catch(i){r(i)}})})}fromAPIKey(e){if(typeof e!="string")throw new Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let n=await this.createGToken().getCredentials(this.keyFile);return{private_key:n.privateKey,client_email:n.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};Nl.JWT=mp});var _p=k(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.UserRefreshClient=qo.USER_REFRESH_ACCOUNT_TYPE=void 0;var _1=Gr(),S1=At();qo.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var yp=class t extends _1.OAuth2Client{_refreshToken;constructor(e,n,r,o,i){let s=e&&typeof e=="object"?e:{clientId:e,clientSecret:n,refreshToken:r,eagerRefreshThresholdMillis:o,forceRefreshOnFailure:i};super(s),this._refreshToken=s.refreshToken,this.credentials.refresh_token=s.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let n={...t.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return S1.AuthClient.setMethodName(n,"fetchIdToken"),(await this.transporter.request(n)).data.id_token}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the user refresh token");if(e.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,n){if(n)this.fromStreamAsync(e).then(()=>n(),n);else return this.fromStreamAsync(e)}async fromStreamAsync(e){return new Promise((n,r)=>{if(!e)return r(new Error("Must pass in a stream containing the user refresh token."));let o="";e.setEncoding("utf8").on("error",r).on("data",i=>o+=i).on("end",()=>{try{let i=JSON.parse(o);return this.fromJSON(i),n()}catch(i){return r(i)}})})}static fromJSON(e){let n=new t;return n.fromJSON(e),n}};qo.UserRefreshClient=yp});var Tp=k(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.Impersonated=Bo.IMPERSONATED_ACCOUNT_TYPE=void 0;var Vv=Gr(),T1=Ve(),E1=Zt();Bo.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var Sp=class t extends Vv.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new Vv.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,!!!(0,E1.originalOrCamelOptions)(e).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${n}:signBlob`,o={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...t.RETRY_CONFIG,url:r,data:o,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,n=`${this.endpoint}/v1/${e}:generateAccessToken`,r={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},o=await this.sourceClient.request({...t.RETRY_CONFIG,url:n,data:r,method:"POST"}),i=o.data;return this.credentials.access_token=i.accessToken,this.credentials.expiry_date=Date.parse(i.expireTime),{tokens:this.credentials,res:o}}catch(e){if(!(e instanceof Error))throw e;let n=0,r="";throw e instanceof T1.GaxiosError&&(n=e?.response?.data?.error?.status,r=e?.response?.data?.error?.message),n&&r?(e.message=`${n}: unable to impersonate: ${r}`,e):(e.message=`unable to impersonate: ${e}`,e)}}async fetchIdToken(e,n){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,o=`${this.endpoint}/v1/${r}:generateIdToken`,i={delegates:this.delegates,audience:e,includeEmail:n?.includeEmail??!0,useEmailAzp:n?.includeEmail??!0};return(await this.sourceClient.request({...t.RETRY_CONFIG,url:o,data:i,method:"POST"})).data.token}};Bo.Impersonated=Sp});var wp=k(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.OAuthClientAuthHandler=void 0;fs.getErrorFromOAuthErrorResponse=A1;var Go=Ve(),w1=ts(),v1=["PUT","POST","PATCH"],Ep=class{#e=(0,w1.createCrypto)();#t;transporter;constructor(e){e&&"clientId"in e?(this.#t=e,this.transporter=new Go.Gaxios):(this.#t=e?.clientAuthentication,this.transporter=e?.transporter||new Go.Gaxios)}applyClientAuthenticationOptions(e,n){e.headers=Go.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,n),n||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,n){if(n)e.headers=Go.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${n}`});else if(this.#t?.confidentialClientType==="basic"){e.headers=Go.Gaxios.mergeHeaders(e.headers);let r=this.#t.clientId,o=this.#t.clientSecret||"",i=this.#e.encodeBase64StringUtf8(`${r}:${o}`);Go.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${i}`})}}injectAuthenticatedRequestBody(e){if(this.#t?.confidentialClientType==="request-body"){let n=(e.method||"GET").toUpperCase();if(!v1.includes(n))throw new Error(`${n} HTTP method does not support ${this.#t.confidentialClientType} client authentication`);let o=new Headers(e.headers).get("content-type");if(o?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let i=new URLSearchParams(e.data??"");i.append("client_id",this.#t.clientId),i.append("client_secret",this.#t.clientSecret||""),e.data=i}else if(o?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#t.clientId,client_secret:this.#t.clientSecret||""});else throw new Error(`${o} content-types are not supported with ${this.#t.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};fs.OAuthClientAuthHandler=Ep;function A1(t,e){let n=t.error,r=t.error_description,o=t.error_uri,i=`Error code ${n}`;typeof r<"u"&&(i+=`: ${r}`),typeof o<"u"&&(i+=` - ${o}`);let s=new Error(i);if(e){let a=Object.keys(e);e.stack&&a.push("stack"),a.forEach(l=>{l!=="message"&&Object.defineProperty(s,l,{value:e[l],writable:!1,enumerable:!0})})}return s}});var Ol=k(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});Ml.StsCredentials=void 0;var C1=Ve(),b1=At(),Wv=wp(),R1=Zt(),vp=class t extends Wv.OAuthClientAuthHandler{#e;constructor(e={tokenExchangeEndpoint:""},n){(typeof e!="object"||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:n}),super(e),this.#e=e.tokenExchangeEndpoint}async exchangeToken(e,n,r){let o={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:r&&JSON.stringify(r)},i={...t.RETRY_CONFIG,url:this.#e.toString(),method:"POST",headers:n,data:new URLSearchParams((0,R1.removeUndefinedValuesInObject)(o))};b1.AuthClient.setMethodName(i,"exchangeToken"),this.applyClientAuthenticationOptions(i);try{let s=await this.transporter.request(i),a=s.data;return a.res=s,a}catch(s){throw s instanceof C1.GaxiosError&&s.response?(0,Wv.getErrorFromOAuthErrorResponse)(s.response.data,s):s}}};Ml.StsCredentials=vp});var pr=k(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.BaseExternalAccountClient=Bt.CLOUD_RESOURCE_MANAGER=Bt.EXTERNAL_ACCOUNT_TYPE=Bt.EXPIRATION_TIME_OFFSET=void 0;var I1=Ve(),x1=require("stream"),Ap=At(),P1=Ol(),Jv=Zt(),k1=qd(),N1="urn:ietf:params:oauth:grant-type:token-exchange",M1="urn:ietf:params:oauth:token-type:access_token",Cp="https://www.googleapis.com/auth/cloud-platform",O1=3600;Bt.EXPIRATION_TIME_OFFSET=300*1e3;Bt.EXTERNAL_ACCOUNT_TYPE="external_account";Bt.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var D1="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",F1="https://sts.{universeDomain}/v1/token",bp=class t extends Ap.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#e=null;constructor(e){super(e);let n=(0,Jv.originalOrCamelOptions)(e),r=n.get("type");if(r&&r!==Bt.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${Bt.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let o=n.get("client_id"),i=n.get("client_secret");this.tokenUrl=n.get("token_url")??F1.replace("{universeDomain}",this.universeDomain);let s=n.get("subject_token_type"),a=n.get("workforce_pool_user_project"),l=n.get("service_account_impersonation_url"),c=n.get("service_account_impersonation"),f=(0,Jv.originalOrCamelOptions)(c).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(n.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),o&&(this.clientAuth={confidentialClientType:"basic",clientId:o,clientSecret:i}),this.stsCredential=new P1.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=n.get("scopes")||[Cp],this.cachedAccessToken=null,this.audience=n.get("audience"),this.subjectTokenType=s,this.workforcePoolUserProject=a;let m=new RegExp(D1);if(this.workforcePoolUserProject&&!this.audience.match(m))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=l,this.serviceAccountImpersonationLifetime=f,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=O1),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);return/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl)?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),n=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(n)}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let n=await this.getRequestHeaders(),r={...t.RETRY_CONFIG,headers:n,url:`${this.cloudResourceManagerURL.toString()}${e}`};Ap.AuthClient.setMethodName(r,"getProjectId");let o=await this.transporter.request(r);return this.projectId=o.data.projectId,this.projectId}return null}async requestAsync(e,n=!1){let r;try{let o=await this.getRequestHeaders();e.headers=I1.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,o),r=await this.transporter.request(e)}catch(o){let i=o.response;if(i){let s=i.status,a=i.config.data instanceof x1.Readable;if(!n&&(s===401||s===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw o}return r}async refreshAccessTokenAsync(){this.#e=this.#e||this.#t();try{return await this.#e}finally{this.#e=null}}async#t(){let e=await this.retrieveSubjectToken(),n={grantType:N1,audience:this.audience,requestedTokenType:M1,subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[Cp]:this.getScopesArray()},r=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,o=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),i=await this.stsCredential.exchangeToken(n,o,r);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(i.access_token):i.expires_in?this.cachedAccessToken={access_token:i.access_token,expiry_date:new Date().getTime()+i.expires_in*1e3,res:i.res}:this.cachedAccessToken={access_token:i.access_token,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let n=e.match(/\/projects\/([^/]+)/);return n?n[1]:null}async getImpersonatedAccessToken(e){let n={...t.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};Ap.AuthClient.setMethodName(n,"getImpersonatedAccessToken");let r=await this.transporter.request(n),o=r.data;return{access_token:o.accessToken,expiry_date:new Date(o.expireTime).getTime(),res:r}}isExpired(e){let n=new Date().getTime();return e.expiry_date?n>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[Cp]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),n=this.serviceAccountImpersonationUrl!==void 0,r=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${k1.pkg.version} google-byoid-sdk source/${r} sa-impersonation/${n} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};Bt.BaseExternalAccountClient=bp});var zv=k(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.FileSubjectTokenSupplier=void 0;var Ip=require("util"),xp=require("fs"),L1=(0,Ip.promisify)(xp.readFile??(()=>{})),U1=(0,Ip.promisify)(xp.realpath??(()=>{})),q1=(0,Ip.promisify)(xp.lstat??(()=>{})),Rp=class{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await U1(e),!(await q1(e)).isFile())throw new Error}catch(o){throw o instanceof Error&&(o.message=`The file at ${e} does not exist, or it is not a file. ${o.message}`),o}let n,r=await L1(e,{encoding:"utf8"});if(this.formatType==="text"?n=r:this.formatType==="json"&&this.subjectTokenFieldName&&(n=JSON.parse(r)[this.subjectTokenFieldName]),!n)throw new Error("Unable to parse the subject_token from the credential_source file");return n}};Dl.FileSubjectTokenSupplier=Rp});var Kv=k(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});Fl.UrlSubjectTokenSupplier=void 0;var B1=At(),Pp=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let n={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};B1.AuthClient.setMethodName(n,"getSubjectToken");let r;if(this.formatType==="text"?r=(await e.transporter.request(n)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(r=(await e.transporter.request(n)).data[this.subjectTokenFieldName]),!r)throw new Error("Unable to parse the subject_token from the credential_source URL");return r}};Fl.UrlSubjectTokenSupplier=Pp});var Yv=k(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.CertificateSubjectTokenSupplier=It.InvalidConfigurationError=It.CertificateSourceUnavailableError=It.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var Ll=Zt(),Ul=require("fs"),ql=require("crypto"),G1=require("https");It.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var wn=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};It.CertificateSourceUnavailableError=wn;var Gt=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};It.InvalidConfigurationError=Gt;var kp=class{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new Gt("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new Gt("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new Gt("Cannot create mTLS Agent with missing certificate or key");return new G1.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#e();let{certPath:e,keyPath:n}=await this.#t();return{cert:this.cert,key:this.key}=await this.#n(e,n),await this.#r(this.cert)}async#e(){let e=this.certificateConfigPath;if(e){if(await(0,Ll.isValidFile)(e))return e;throw new wn(`Provided certificate config path is invalid: ${e}`)}let n=process.env[It.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(n){if(await(0,Ll.isValidFile)(n))return n;throw new wn(`Path from environment variable "${It.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${n}`)}let r=(0,Ll.getWellKnownCertificateConfigFileLocation)();if(await(0,Ll.isValidFile)(r))return r;throw new wn(`Could not find certificate configuration file. Searched override path, the "${It.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${r}).`)}async#t(){let e=this.certificateConfigPath,n;try{n=await Ul.promises.readFile(e,"utf8")}catch{throw new wn(`Failed to read certificate config file at: ${e}`)}try{let r=JSON.parse(n),o=r?.cert_configs?.workload?.cert_path,i=r?.cert_configs?.workload?.key_path;if(!o||!i)throw new Gt(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:o,keyPath:i}}catch(r){throw r instanceof Gt?r:new Gt(`Failed to parse certificate config from ${e}: ${r.message}`)}}async#n(e,n){let r,o;try{r=await Ul.promises.readFile(e),new ql.X509Certificate(r)}catch(i){let s=i instanceof Error?i.message:String(i);throw new wn(`Failed to read certificate file at ${e}: ${s}`)}try{o=await Ul.promises.readFile(n),(0,ql.createPrivateKey)(o)}catch(i){let s=i instanceof Error?i.message:String(i);throw new wn(`Failed to read private key file at ${n}: ${s}`)}return{cert:r,key:o}}async#r(e){let n=new ql.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([n.raw.toString("base64")]);try{let i=((await Ul.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((l,c)=>{try{return new ql.X509Certificate(l)}catch(f){let m=f instanceof Error?f.message:String(f);throw new Gt(`Failed to parse certificate at index ${c} in trust chain file ${this.trustChainPath}: ${m}`)}}),s=i.findIndex(l=>n.raw.equals(l.raw)),a;if(s===-1)a=[n,...i];else if(s===0)a=i;else throw new Gt(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${s}).`);return JSON.stringify(a.map(l=>l.raw.toString("base64")))}catch(r){if(r instanceof Gt)throw r;let o=r instanceof Error?r.message:String(r);throw new wn(`Failed to process certificate chain from ${this.trustChainPath}: ${o}`)}}};It.CertificateSubjectTokenSupplier=kp});var Op=k(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});Bl.IdentityPoolClient=void 0;var H1=pr(),Np=Zt(),$1=zv(),V1=Kv(),jv=Yv(),W1=Ol(),Xv=Ve(),Mp=class t extends H1.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let n=(0,Np.originalOrCamelOptions)(e),r=n.get("credential_source"),o=n.get("subject_token_supplier");if(!r&&!o)throw new Error("A credential source or subject token supplier must be specified.");if(r&&o)throw new Error("Only one of credential source or subject token supplier can be specified.");if(o)this.subjectTokenSupplier=o,this.credentialSourceType="programmatic";else{let i=(0,Np.originalOrCamelOptions)(r),s=(0,Np.originalOrCamelOptions)(i.get("format")),a=s.get("type")||"text",l=s.get("subject_token_field_name");if(a!=="json"&&a!=="text")throw new Error(`Invalid credential_source format "${a}"`);if(a==="json"&&!l)throw new Error("Missing subject_token_field_name for JSON credential_source format");let c=i.get("file"),f=i.get("url"),m=i.get("certificate"),h=i.get("headers");if(c&&f||f&&m||c&&m)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(c)this.credentialSourceType="file",this.subjectTokenSupplier=new $1.FileSubjectTokenSupplier({filePath:c,formatType:a,subjectTokenFieldName:l});else if(f)this.credentialSourceType="url",this.subjectTokenSupplier=new V1.UrlSubjectTokenSupplier({url:f,formatType:a,subjectTokenFieldName:l,headers:h,additionalGaxiosOptions:t.RETRY_CONFIG});else if(m){this.credentialSourceType="certificate";let y=new jv.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:m.use_default_certificate_config,certificateConfigLocation:m.certificate_config_location,trustChainPath:m.trust_chain_path});this.subjectTokenSupplier=y}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof jv.CertificateSubjectTokenSupplier){let n=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new W1.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new Xv.Gaxios({agent:n})}),this.transporter=new Xv.Gaxios({...this.transporter.defaults||{},agent:n})}return e}};Bl.IdentityPoolClient=Mp});var Fp=k(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});Hl.AwsRequestSigner=void 0;var Gl=Ve(),Zv=ts(),Qv="AWS4-HMAC-SHA256",J1="aws4_request",Dp=class{getCredentials;region;crypto;constructor(e,n){this.getCredentials=e,this.region=n,this.crypto=(0,Zv.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let n=typeof e.data=="object"?JSON.stringify(e.data):e.data,r=e.url,o=e.method||"GET",i=e.body||n,s=e.headers,a=await this.getCredentials(),l=new URL(r);if(typeof i!="string"&&i!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${i}`);let c=await K1({crypto:this.crypto,host:l.host,canonicalUri:l.pathname,canonicalQuerystring:l.search.slice(1),method:o,region:this.region,securityCredentials:a,requestPayload:i,additionalAmzHeaders:s}),f=Gl.Gaxios.mergeHeaders(c.amzDate?{"x-amz-date":c.amzDate}:{},{authorization:c.authorizationHeader,host:l.host},s||{});a.token&&Gl.Gaxios.mergeHeaders(f,{"x-amz-security-token":a.token});let m={url:r,method:o,headers:f};return i!==void 0&&(m.body=i),m}};Hl.AwsRequestSigner=Dp;async function ds(t,e,n){return await t.signWithHmacSha256(e,n)}async function z1(t,e,n,r,o){let i=await ds(t,`AWS4${e}`,n),s=await ds(t,i,r),a=await ds(t,s,o);return await ds(t,a,"aws4_request")}async function K1(t){let e=Gl.Gaxios.mergeHeaders(t.additionalAmzHeaders),n=t.requestPayload||"",r=t.host.split(".")[0],o=new Date,i=o.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),s=o.toISOString().replace(/[-]/g,"").replace(/T.*/,"");t.securityCredentials.token&&e.set("x-amz-security-token",t.securityCredentials.token);let a=Gl.Gaxios.mergeHeaders({host:t.host},e.has("date")?{}:{"x-amz-date":i},e),l="",c=[...a.keys()].sort();c.forEach(b=>{l+=`${b}:${a.get(b)}
`});let f=c.join(";"),m=await t.crypto.sha256DigestHex(n),h=`${t.method.toUpperCase()}
${t.canonicalUri}
${t.canonicalQuerystring}
${l}
${f}
${m}`,y=`${s}/${t.region}/${r}/${J1}`,_=`${Qv}
${i}
${y}
`+await t.crypto.sha256DigestHex(h),T=await z1(t.crypto,t.securityCredentials.secretAccessKey,s,t.region,r),E=await ds(t.crypto,T,_),w=`${Qv} Credential=${t.securityCredentials.accessKeyId}/${y}, SignedHeaders=${f}, Signature=${(0,Zv.fromArrayBufferToHex)(E)}`;return{amzDate:e.has("date")?void 0:i,authorizationHeader:w,canonicalQuerystring:t.canonicalQuerystring}}});var e0=k(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});Vl.DefaultAwsSecurityCredentialsSupplier=void 0;var $l=At(),Lp=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#r)return this.#r;let n=new Headers;if(!this.#r&&this.imdsV2SessionTokenUrl&&n.set("x-aws-ec2-metadata-token",await this.#e(e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:n};$l.AuthClient.setMethodName(r,"getAwsRegion");let o=await e.transporter.request(r);return o.data.substr(0,o.data.length-1)}async getAwsSecurityCredentials(e){if(this.#o)return this.#o;let n=new Headers;this.imdsV2SessionTokenUrl&&n.set("x-aws-ec2-metadata-token",await this.#e(e.transporter));let r=await this.#t(n,e.transporter),o=await this.#n(r,n,e.transporter);return{accessKeyId:o.AccessKeyId,secretAccessKey:o.SecretAccessKey,token:o.Token}}async#e(e){let n={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return $l.AuthClient.setMethodName(n,"#getImdsV2SessionToken"),(await e.request(n)).data}async#t(e,n){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return $l.AuthClient.setMethodName(r,"#getAwsRoleName"),(await n.request(r)).data}async#n(e,n,r){let o={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:n};return $l.AuthClient.setMethodName(o,"#retrieveAwsSecurityCredentials"),(await r.request(o)).data}get#r(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get#o(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}};Vl.DefaultAwsSecurityCredentialsSupplier=Lp});var qp=k(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});Wl.AwsClient=void 0;var Y1=Fp(),j1=pr(),X1=e0(),t0=Zt(),Q1=Ve(),Up=class t extends j1.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static#e="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let n=(0,t0.originalOrCamelOptions)(e),r=n.get("credential_source"),o=n.get("aws_security_credentials_supplier");if(!r&&!o)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(r&&o)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(o)this.awsSecurityCredentialsSupplier=o,this.regionalCredVerificationUrl=t.#e,this.credentialSourceType="programmatic";else{let i=(0,t0.originalOrCamelOptions)(r);this.environmentId=i.get("environment_id");let s=i.get("region_url"),a=i.get("url"),l=i.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new X1.DefaultAwsSecurityCredentialsSupplier({regionUrl:s,securityCredentialsUrl:a,imdsV2SessionTokenUrl:l}),this.regionalCredVerificationUrl=i.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(!e||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(e[2],10)!==1)throw new Error(`aws version "${e[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new Y1.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...t.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),n=[];return Q1.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((o,i)=>n.push({key:i,value:o})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:n}))}};Wl.AwsClient=Up});var Vp=k(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.InvalidSubjectTokenError=ke.InvalidMessageFieldError=ke.InvalidCodeFieldError=ke.InvalidTokenTypeFieldError=ke.InvalidExpirationTimeFieldError=ke.InvalidSuccessFieldError=ke.InvalidVersionFieldError=ke.ExecutableResponseError=ke.ExecutableResponse=void 0;var Jl="urn:ietf:params:oauth:token-type:saml2",Bp="urn:ietf:params:oauth:token-type:id_token",Gp="urn:ietf:params:oauth:token-type:jwt",Hp=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new zl("Executable response must contain a 'version' field.");if(e.success===void 0)throw new Kl("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Jl&&this.tokenType!==Bp&&this.tokenType!==Gp)throw new Yl(`Executable response must contain a 'token_type' field when successful and it must be one of ${Bp}, ${Gp}, or ${Jl}.`);if(this.tokenType===Jl){if(!e.saml_response)throw new ps(`Executable response must contain a 'saml_response' field when token_type=${Jl}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new ps(`Executable response must contain a 'id_token' field when token_type=${Bp} or ${Gp}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new jl("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new Xl("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};ke.ExecutableResponse=Hp;var vn=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};ke.ExecutableResponseError=vn;var zl=class extends vn{};ke.InvalidVersionFieldError=zl;var Kl=class extends vn{};ke.InvalidSuccessFieldError=Kl;var $p=class extends vn{};ke.InvalidExpirationTimeFieldError=$p;var Yl=class extends vn{};ke.InvalidTokenTypeFieldError=Yl;var jl=class extends vn{};ke.InvalidCodeFieldError=jl;var Xl=class extends vn{};ke.InvalidMessageFieldError=Xl;var ps=class extends vn{};ke.InvalidSubjectTokenError=ps});var zp=k(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.PluggableAuthHandler=Ho.ExecutableError=void 0;var Hr=Vp(),Z1=require("child_process"),Wp=require("fs"),Ql=class extends Error{code;constructor(e,n){super(`The executable failed with exit code: ${n} and error message: ${e}.`),this.code=n,Object.setPrototypeOf(this,new.target.prototype)}};Ho.ExecutableError=Ql;var Jp=class t{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw new Error("No command provided.");if(this.commandComponents=t.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((n,r)=>{let o=Z1.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),i="";o.stdout.on("data",a=>{i+=a}),o.stderr.on("data",a=>{i+=a});let s=setTimeout(()=>(o.removeAllListeners(),o.kill(),r(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);o.on("close",a=>{if(clearTimeout(s),a===0)try{let l=JSON.parse(i),c=new Hr.ExecutableResponse(l);return n(c)}catch(l){return l instanceof Hr.ExecutableResponseError?r(l):r(new Hr.ExecutableResponseError(`The executable returned an invalid response: ${i}`))}else return r(new Ql(i,a.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await Wp.promises.realpath(this.outputFile)}catch{return}if(!(await Wp.promises.lstat(e)).isFile())return;let n=await Wp.promises.readFile(e,{encoding:"utf8"});if(n!=="")try{let r=JSON.parse(n);return new Hr.ExecutableResponse(r).isValid()?new Hr.ExecutableResponse(r):void 0}catch(r){throw r instanceof Hr.ExecutableResponseError?r:new Hr.ExecutableResponseError(`The output file contained an invalid response: ${n}`)}}static parseCommand(e){let n=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!n)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let r=0;r<n.length;r++)n[r][0]==='"'&&n[r].slice(-1)==='"'&&(n[r]=n[r].slice(1,-1));return n}};Ho.PluggableAuthHandler=Jp});var Yp=k($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.PluggableAuthClient=$o.ExecutableError=void 0;var eB=pr(),tB=Vp(),n0=zp(),nB=zp();Object.defineProperty($o,"ExecutableError",{enumerable:!0,get:function(){return nB.ExecutableError}});var rB=30*1e3,r0=5*1e3,o0=120*1e3,oB="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",i0=1,Kp=class extends eB.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=e.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(e.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=rB;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<r0||this.timeoutMillis>o0)throw new Error(`Timeout must be between ${r0} and ${o0} milliseconds.`);this.outputFile=e.credential_source.executable.output_file,this.handler=new n0.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[oB]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let e;if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let n=new Map;n.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),n.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),n.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&n.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let r=this.getServiceAccountEmail();r&&n.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",r),e=await this.handler.retrieveResponseFromExecutable(n)}if(e.version>i0)throw new Error(`Version of executable is not currently supported, maximum supported version is ${i0}.`);if(!e.success)throw new n0.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new tB.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw new Error("Executable response is expired.");return e.subjectToken}};$o.PluggableAuthClient=Kp});var Xp=k(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.ExternalAccountClient=void 0;var iB=pr(),sB=Op(),aB=qp(),lB=Yp(),jp=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===iB.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new aB.AwsClient(e):e.credential_source?.executable?new lB.PluggableAuthClient(e):new sB.IdentityPoolClient(e):null}};Zl.ExternalAccountClient=jp});var eh=k(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.ExternalAccountAuthorizedUserClient=Vo.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var a0=At(),s0=wp(),l0=Ve(),uB=require("stream"),cB=pr();Vo.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var fB="https://sts.{universeDomain}/v1/oauthtoken",Qp=class t extends s0.OAuthClientAuthHandler{#e;constructor(e){super(e),this.#e=e.tokenRefreshEndpoint}async refreshToken(e,n){let r={...t.RETRY_CONFIG,url:this.#e,method:"POST",headers:n,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};a0.AuthClient.setMethodName(r,"refreshToken"),this.applyClientAuthenticationOptions(r);try{let o=await this.transporter.request(r),i=o.data;return i.res=o,i}catch(o){throw o instanceof l0.GaxiosError&&o.response?(0,s0.getErrorFromOAuthErrorResponse)(o.response.data,o):o}}},Zp=class extends a0.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let n={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new Qp({tokenRefreshEndpoint:e.token_url??fB.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:n}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,typeof e?.eagerRefreshThresholdMillis!="number"?this.eagerRefreshThresholdMillis=cB.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),n=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(n)}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async requestAsync(e,n=!1){let r;try{let o=await this.getRequestHeaders();e.headers=l0.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,o),r=await this.transporter.request(e)}catch(o){let i=o.response;if(i){let s=i.status,a=i.config.data instanceof uB.Readable;if(!n&&(s===401||s===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw o}return r}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+e.expires_in*1e3,res:e.res},e.refresh_token!==void 0&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let n=new Date().getTime();return e.expiry_date?n>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Vo.ExternalAccountAuthorizedUserClient=Zp});var d0=k(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.GoogleAuth=rn.GoogleAuthExceptionMessages=void 0;var dB=require("child_process"),hs=require("fs"),pB=Ve(),ms=es(),hB=require("os"),th=require("path"),mB=ts(),gB=Kd(),yB=jd(),_B=Xd(),Wo=gp(),u0=_p(),Jo=Tp(),SB=Xp(),gs=pr(),nh=At(),c0=eh(),f0=Zt();rn.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var rh=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#e=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError(rn.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(n=>e(null,n),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===rn.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId(),e)return this._cachedProjectId=e,e;throw new Error(rn.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await ms.universe("universe-domain"),e||=nh.DEFAULT_UNIVERSE}catch(n){if(n&&n?.response?.status===404)e=nh.DEFAULT_UNIVERSE;else throw n}return e}async getUniverseDomain(){let e=(0,f0.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=nh.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},n){let r;if(typeof e=="function"?n=e:r=e,n)this.getApplicationDefaultAsync(r).then(o=>n(null,o.credential,o.projectId),n);else return this.getApplicationDefaultAsync(r)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await this.#t(this.cachedCredential,null);let n;if(n=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),n)return n instanceof Wo.JWT?n.scopes=this.scopes:n instanceof gs.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await this.#t(n);if(n=await this._tryGetApplicationCredentialsFromWellKnownFile(e),n)return n instanceof Wo.JWT?n.scopes=this.scopes:n instanceof gs.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await this.#t(n);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#t(new gB.Compute(e));throw new Error(rn.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async#t(e,n=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return n&&(e.quotaProjectId=n),this.cachedCredential=e,{credential:e,projectId:r}}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=ms.getGCPResidency()||await ms.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let n=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!n||n.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(n,e)}catch(r){throw r instanceof Error&&(r.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${r.message}`),r}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let n=null;if(this._isWindows())n=process.env.APPDATA;else{let o=process.env.HOME;o&&(n=th.join(o,".config"))}return n&&(n=th.join(n,"gcloud","application_default_credentials.json"),hs.existsSync(n)||(n=null)),n?await this._getApplicationCredentialsFromFilePath(n,e):null}async _getApplicationCredentialsFromFilePath(e,n={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=hs.realpathSync(e),!hs.lstatSync(e).isFile())throw new Error}catch(o){throw o instanceof Error&&(o.message=`The file at ${e} does not exist, or it is not a file. ${o.message}`),o}let r=hs.createReadStream(e);return this.fromStream(r,n)}fromImpersonatedJSON(e){if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==Jo.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${Jo.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let n=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!r)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let o=(this.scopes||e.scopes||this.defaultScopes)??[];return new Jo.Impersonated({...e,sourceClient:n,targetPrincipal:r,targetScopes:Array.isArray(o)?o:[o]})}fromJSON(e,n={}){let r,o=(0,f0.originalOrCamelOptions)(n).get("universe_domain");return e.type===u0.USER_REFRESH_ACCOUNT_TYPE?(r=new u0.UserRefreshClient(n),r.fromJSON(e)):e.type===Jo.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===gs.EXTERNAL_ACCOUNT_TYPE?(r=SB.ExternalAccountClient.fromJSON({...e,...n}),r.scopes=this.getAnyScopes()):e.type===c0.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new c0.ExternalAccountAuthorizedUserClient({...e,...n}):(n.scopes=this.scopes,r=new Wo.JWT(n),this.setGapicJWTValues(r),r.fromJSON(e)),o&&(r.universeDomain=o),r}_cacheClientFromJSON(e,n){let r=this.fromJSON(e,n);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,n={},r){let o={};if(typeof n=="function"?r=n:o=n,r)this.fromStreamAsync(e,o).then(i=>r(null,i),r);else return this.fromStreamAsync(e,o)}fromStreamAsync(e,n){return new Promise((r,o)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let i=[];e.setEncoding("utf8").on("error",o).on("data",s=>i.push(s)).on("end",()=>{try{try{let s=JSON.parse(i.join("")),a=this._cacheClientFromJSON(s,n);return r(a)}catch(s){if(!this.keyFilename)throw s;let a=new Wo.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=a,this.setGapicJWTValues(a),r(a)}}catch(s){return o(s)}})})}fromAPIKey(e,n={}){return new Wo.JWT({...n,apiKey:e})}_isWindows(){let e=hB.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,dB.exec)("gcloud config config-helper --format json",(n,r)=>{if(!n&&r)try{let o=JSON.parse(r).configuration.properties.core.project;e(o);return}catch{}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let n=await this.getClient();if(n&&n.projectId)return n.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==gs.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await ms.project("project-id")}catch{return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(n=>e(null,n),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof Jo.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof gs.BaseExternalAccountClient){let n=e.getServiceAccountEmail();if(n)return{client_email:n,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[n,r]=await Promise.all([ms.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:n,universe_domain:r}}throw new Error(rn.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#e=this.#e||this.#n();try{return await this.#e}finally{this.#e=null}}async#n(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=th.resolve(this.keyFilename),n=hs.createReadStream(e);return await this.fromStreamAsync(n,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:n}=await this.#t(e);return n}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let n=await this.getClient();if(!("fetchIdToken"in n))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new yB.IdTokenClient({targetAudience:e,idTokenProvider:n})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let n=e.url,o=await(await this.getClient()).getRequestHeaders(n);return e.headers=pB.Gaxios.mergeHeaders(e.headers,o),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,_B.getEnv)()}async sign(e,n){let r=await this.getClient(),o=await this.getUniverseDomain();if(n=n||`https://iamcredentials.${o}/v1/projects/-/serviceAccounts/`,r instanceof Jo.Impersonated)return(await r.sign(e)).signedBlob;let i=(0,mB.createCrypto)();if(r instanceof Wo.JWT&&r.key)return await i.sign(r.key,e);let s=await this.getCredentials();if(!s.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(i,s.client_email,e,n)}async signBlob(e,n,r,o){let i=new URL(o+`${n}:signBlob`);return(await this.request({method:"POST",url:i.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};rn.GoogleAuth=rh});var p0=k(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.IAMAuth=void 0;var oh=class{selector;token;constructor(e,n){this.selector=e,this.token=n,this.selector=e,this.token=n}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};eu.IAMAuth=oh});var h0=k(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.DownscopedClient=An.EXPIRATION_TIME_OFFSET=An.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var TB=Ve(),EB=require("stream"),ih=At(),wB=Ol(),vB="urn:ietf:params:oauth:grant-type:token-exchange",AB="urn:ietf:params:oauth:token-type:access_token",CB="urn:ietf:params:oauth:token-type:access_token";An.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;An.EXPIRATION_TIME_OFFSET=300*1e3;var sh=class extends ih.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,n={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof ih.AuthClient?{}:e),e instanceof ih.AuthClient?(this.authClient=e,this.credentialAccessBoundary=n):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>An.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${An.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let r of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(r.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new wB.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),n=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(n)}request(e,n){if(n)this.requestAsync(e).then(r=>n(null,r),r=>n(r,r.response));else return this.requestAsync(e)}async requestAsync(e,n=!1){let r;try{let o=await this.getRequestHeaders();e.headers=TB.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,o),r=await this.transporter.request(e)}catch(o){let i=o.response;if(i){let s=i.status,a=i.config.data instanceof EB.Readable;if(!n&&(s===401||s===403)&&!a&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw o}return r}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,n={grantType:vB,requestedTokenType:AB,subjectToken:e,subjectTokenType:CB},r=await this.stsCredential.exchangeToken(n,void 0,this.credentialAccessBoundary),o=this.authClient.credentials?.expiry_date||null,i=r.expires_in?new Date().getTime()+r.expires_in*1e3:o;return this.cachedDownscopedAccessToken={access_token:r.access_token,expiry_date:i,res:r.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let n=new Date().getTime();return e.expiry_date?n>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};An.DownscopedClient=sh});var m0=k(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.PassThroughClient=void 0;var bB=At(),ah=class extends bB.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};tu.PassThroughClient=ah});var T0=k(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.GoogleAuth=te.auth=te.PassThroughClient=te.ExternalAccountAuthorizedUserClient=te.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=te.ExecutableError=te.PluggableAuthClient=te.DownscopedClient=te.BaseExternalAccountClient=te.ExternalAccountClient=te.IdentityPoolClient=te.AwsRequestSigner=te.AwsClient=te.UserRefreshClient=te.LoginTicket=te.ClientAuthentication=te.OAuth2Client=te.CodeChallengeMethod=te.Impersonated=te.JWT=te.JWTAccess=te.IdTokenClient=te.IAMAuth=te.GCPEnv=te.Compute=te.DEFAULT_UNIVERSE=te.AuthClient=te.gaxios=te.gcpMetadata=void 0;var g0=d0();Object.defineProperty(te,"GoogleAuth",{enumerable:!0,get:function(){return g0.GoogleAuth}});te.gcpMetadata=es();te.gaxios=Ve();var y0=At();Object.defineProperty(te,"AuthClient",{enumerable:!0,get:function(){return y0.AuthClient}});Object.defineProperty(te,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return y0.DEFAULT_UNIVERSE}});var RB=Kd();Object.defineProperty(te,"Compute",{enumerable:!0,get:function(){return RB.Compute}});var IB=Xd();Object.defineProperty(te,"GCPEnv",{enumerable:!0,get:function(){return IB.GCPEnv}});var xB=p0();Object.defineProperty(te,"IAMAuth",{enumerable:!0,get:function(){return xB.IAMAuth}});var PB=jd();Object.defineProperty(te,"IdTokenClient",{enumerable:!0,get:function(){return PB.IdTokenClient}});var kB=hp();Object.defineProperty(te,"JWTAccess",{enumerable:!0,get:function(){return kB.JWTAccess}});var NB=gp();Object.defineProperty(te,"JWT",{enumerable:!0,get:function(){return NB.JWT}});var MB=Tp();Object.defineProperty(te,"Impersonated",{enumerable:!0,get:function(){return MB.Impersonated}});var lh=Gr();Object.defineProperty(te,"CodeChallengeMethod",{enumerable:!0,get:function(){return lh.CodeChallengeMethod}});Object.defineProperty(te,"OAuth2Client",{enumerable:!0,get:function(){return lh.OAuth2Client}});Object.defineProperty(te,"ClientAuthentication",{enumerable:!0,get:function(){return lh.ClientAuthentication}});var OB=Vd();Object.defineProperty(te,"LoginTicket",{enumerable:!0,get:function(){return OB.LoginTicket}});var DB=_p();Object.defineProperty(te,"UserRefreshClient",{enumerable:!0,get:function(){return DB.UserRefreshClient}});var FB=qp();Object.defineProperty(te,"AwsClient",{enumerable:!0,get:function(){return FB.AwsClient}});var LB=Fp();Object.defineProperty(te,"AwsRequestSigner",{enumerable:!0,get:function(){return LB.AwsRequestSigner}});var UB=Op();Object.defineProperty(te,"IdentityPoolClient",{enumerable:!0,get:function(){return UB.IdentityPoolClient}});var qB=Xp();Object.defineProperty(te,"ExternalAccountClient",{enumerable:!0,get:function(){return qB.ExternalAccountClient}});var BB=pr();Object.defineProperty(te,"BaseExternalAccountClient",{enumerable:!0,get:function(){return BB.BaseExternalAccountClient}});var GB=h0();Object.defineProperty(te,"DownscopedClient",{enumerable:!0,get:function(){return GB.DownscopedClient}});var _0=Yp();Object.defineProperty(te,"PluggableAuthClient",{enumerable:!0,get:function(){return _0.PluggableAuthClient}});Object.defineProperty(te,"ExecutableError",{enumerable:!0,get:function(){return _0.ExecutableError}});var S0=eh();Object.defineProperty(te,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return S0.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}});Object.defineProperty(te,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return S0.ExternalAccountAuthorizedUserClient}});var HB=m0();Object.defineProperty(te,"PassThroughClient",{enumerable:!0,get:function(){return HB.PassThroughClient}});var $B=new g0.GoogleAuth;te.auth=$B});var Gn=k((y9,v0)=>{"use strict";var E0=["nodebuffer","arraybuffer","fragments"],w0=typeof Blob<"u";w0&&E0.push("blob");v0.exports={BINARY_TYPES:E0,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:w0,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var ys=k((_9,nu)=>{"use strict";var{EMPTY_BUFFER:VB}=Gn(),uh=Buffer[Symbol.species];function WB(t,e){if(t.length===0)return VB;if(t.length===1)return t[0];let n=Buffer.allocUnsafe(e),r=0;for(let o=0;o<t.length;o++){let i=t[o];n.set(i,r),r+=i.length}return r<e?new uh(n.buffer,n.byteOffset,r):n}function A0(t,e,n,r,o){for(let i=0;i<o;i++)n[r+i]=t[i]^e[i&3]}function C0(t,e){for(let n=0;n<t.length;n++)t[n]^=e[n&3]}function JB(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function ch(t){if(ch.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new uh(t):ArrayBuffer.isView(t)?e=new uh(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),ch.readOnly=!1),e}nu.exports={concat:WB,mask:A0,toArrayBuffer:JB,toBuffer:ch,unmask:C0};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");nu.exports.mask=function(e,n,r,o,i){i<48?A0(e,n,r,o,i):t.mask(e,n,r,o,i)},nu.exports.unmask=function(e,n){e.length<32?C0(e,n):t.unmask(e,n)}}catch{}});var I0=k((S9,R0)=>{"use strict";var b0=Symbol("kDone"),fh=Symbol("kRun"),dh=class{constructor(e){this[b0]=()=>{this.pending--,this[fh]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[fh]()}[fh](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[b0])}}};R0.exports=dh});var Ss=k((T9,N0)=>{"use strict";var _s=require("zlib"),x0=ys(),zB=I0(),{kStatusCode:P0}=Gn(),KB=Buffer[Symbol.species],YB=Buffer.from([0,0,255,255]),ou=Symbol("permessage-deflate"),Hn=Symbol("total-length"),zo=Symbol("callback"),hr=Symbol("buffers"),Ko=Symbol("error"),ru,ph=class{constructor(e,n,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!n,this._deflate=null,this._inflate=null,this.params=null,!ru){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;ru=new zB(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[zo];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let n=this._options,r=e.find(o=>!(n.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(n.serverMaxWindowBits===!1||typeof n.serverMaxWindowBits=="number"&&n.serverMaxWindowBits>o.server_max_window_bits)||typeof n.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return n.serverNoContextTakeover&&(r.server_no_context_takeover=!0),n.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof n.serverMaxWindowBits=="number"&&(r.server_max_window_bits=n.serverMaxWindowBits),typeof n.clientMaxWindowBits=="number"?r.client_max_window_bits=n.clientMaxWindowBits:(r.client_max_window_bits===!0||n.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let n=e[0];if(this._options.clientNoContextTakeover===!1&&n.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!n.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(n.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&n.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return n}normalizeParams(e){return e.forEach(n=>{Object.keys(n).forEach(r=>{let o=n[r];if(o.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(o=o[0],r==="client_max_window_bits"){if(o!==!0){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${o}`);o=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${o}`)}else if(r==="server_max_window_bits"){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${o}`);o=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${o}`)}else throw new Error(`Unknown parameter "${r}"`);n[r]=o})}),e}decompress(e,n,r){ru.add(o=>{this._decompress(e,n,(i,s)=>{o(),r(i,s)})})}compress(e,n,r){ru.add(o=>{this._compress(e,n,(i,s)=>{o(),r(i,s)})})}_decompress(e,n,r){let o=this._isServer?"client":"server";if(!this._inflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?_s.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=_s.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[ou]=this,this._inflate[Hn]=0,this._inflate[hr]=[],this._inflate.on("error",XB),this._inflate.on("data",k0)}this._inflate[zo]=r,this._inflate.write(e),n&&this._inflate.write(YB),this._inflate.flush(()=>{let i=this._inflate[Ko];if(i){this._inflate.close(),this._inflate=null,r(i);return}let s=x0.concat(this._inflate[hr],this._inflate[Hn]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Hn]=0,this._inflate[hr]=[],n&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),r(null,s)})}_compress(e,n,r){let o=this._isServer?"server":"client";if(!this._deflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?_s.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=_s.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[Hn]=0,this._deflate[hr]=[],this._deflate.on("data",jB)}this._deflate[zo]=r,this._deflate.write(e),this._deflate.flush(_s.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=x0.concat(this._deflate[hr],this._deflate[Hn]);n&&(i=new KB(i.buffer,i.byteOffset,i.length-4)),this._deflate[zo]=null,this._deflate[Hn]=0,this._deflate[hr]=[],n&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}};N0.exports=ph;function jB(t){this[hr].push(t),this[Hn]+=t.length}function k0(t){if(this[Hn]+=t.length,this[ou]._maxPayload<1||this[Hn]<=this[ou]._maxPayload){this[hr].push(t);return}this[Ko]=new RangeError("Max payload size exceeded"),this[Ko].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ko][P0]=1009,this.removeListener("data",k0),this.reset()}function XB(t){if(this[ou]._inflate=null,this[Ko]){this[zo](this[Ko]);return}t[P0]=1007,this[zo](t)}});var Yo=k((E9,iu)=>{"use strict";var{isUtf8:M0}=require("buffer"),{hasBlob:QB}=Gn(),ZB=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function eG(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function hh(t){let e=t.length,n=0;for(;n<e;)if((t[n]&128)===0)n++;else if((t[n]&224)===192){if(n+1===e||(t[n+1]&192)!==128||(t[n]&254)===192)return!1;n+=2}else if((t[n]&240)===224){if(n+2>=e||(t[n+1]&192)!==128||(t[n+2]&192)!==128||t[n]===224&&(t[n+1]&224)===128||t[n]===237&&(t[n+1]&224)===160)return!1;n+=3}else if((t[n]&248)===240){if(n+3>=e||(t[n+1]&192)!==128||(t[n+2]&192)!==128||(t[n+3]&192)!==128||t[n]===240&&(t[n+1]&240)===128||t[n]===244&&t[n+1]>143||t[n]>244)return!1;n+=4}else return!1;return!0}function tG(t){return QB&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}iu.exports={isBlob:tG,isValidStatusCode:eG,isValidUTF8:hh,tokenChars:ZB};if(M0)iu.exports.isValidUTF8=function(t){return t.length<24?hh(t):M0(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");iu.exports.isValidUTF8=function(e){return e.length<32?hh(e):t(e)}}catch{}});var Sh=k((w9,B0)=>{"use strict";var{Writable:nG}=require("stream"),O0=Ss(),{BINARY_TYPES:rG,EMPTY_BUFFER:D0,kStatusCode:oG,kWebSocket:iG}=Gn(),{concat:mh,toArrayBuffer:sG,unmask:aG}=ys(),{isValidStatusCode:lG,isValidUTF8:F0}=Yo(),su=Buffer[Symbol.species],Ht=0,L0=1,U0=2,q0=3,gh=4,yh=5,au=6,_h=class extends nG{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||rG[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[iG]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=Ht}_write(e,n,r){if(this._opcode===8&&this._state==Ht)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=new su(r.buffer,r.byteOffset+e,r.length-e),new su(r.buffer,r.byteOffset,e)}let n=Buffer.allocUnsafe(e);do{let r=this._buffers[0],o=n.length-e;e>=r.length?n.set(this._buffers.shift(),o):(n.set(new Uint8Array(r.buffer,r.byteOffset,e),o),this._buffers[0]=new su(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return n}startLoop(e){this._loop=!0;do switch(this._state){case Ht:this.getInfo(e);break;case L0:this.getPayloadLength16(e);break;case U0:this.getPayloadLength64(e);break;case q0:this.getMask();break;case gh:this.getData(e);break;case yh:case au:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let n=this.consume(2);if((n[0]&48)!==0){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let r=(n[0]&64)===64;if(r&&!this._extensions[O0.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(n[0]&128)===128,this._opcode=n[0]&15,this._payloadLength=n[1]&127,this._opcode===0){if(r){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(r){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(n[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=L0:this._payloadLength===127?this._state=U0:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let n=this.consume(8),r=n.readUInt32BE(0);if(r>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=r*Math.pow(2,32)+n.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let n=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(n);return}this._masked?this._state=q0:this._state=gh}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=gh}getData(e){let n=D0;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}n=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&aG(n,this._mask)}if(this._opcode>7){this.controlMessage(n,e);return}if(this._compressed){this._state=yh,this.decompress(n,e);return}n.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(n)),this.dataMessage(e)}decompress(e,n){this._extensions[O0.extensionName].decompress(e,this._fin,(o,i)=>{if(o)return n(o);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");n(s);return}this._fragments.push(i)}this.dataMessage(n),this._state===Ht&&this.startLoop(n)})}dataMessage(e){if(!this._fin){this._state=Ht;return}let n=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=mh(r,n):this._binaryType==="arraybuffer"?o=sG(mh(r,n)):this._binaryType==="blob"?o=new Blob(r):o=r,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=Ht):(this._state=au,setImmediate(()=>{this.emit("message",o,!0),this._state=Ht,this.startLoop(e)}))}else{let o=mh(r,n);if(!this._skipUTF8Validation&&!F0(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===yh||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=Ht):(this._state=au,setImmediate(()=>{this.emit("message",o,!1),this._state=Ht,this.startLoop(e)}))}}controlMessage(e,n){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,D0),this.end();else{let r=e.readUInt16BE(0);if(!lG(r)){let i=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");n(i);return}let o=new su(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!F0(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");n(i);return}this._loop=!1,this.emit("conclude",r,o),this.end()}this._state=Ht;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=Ht):(this._state=au,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=Ht,this.startLoop(n)}))}createError(e,n,r,o,i){this._loop=!1,this._errored=!0;let s=new e(r?`Invalid WebSocket frame: ${n}`:n);return Error.captureStackTrace(s,this.createError),s.code=i,s[oG]=o,s}};B0.exports=_h});var wh=k((A9,$0)=>{"use strict";var{Duplex:v9}=require("stream"),{randomFillSync:uG}=require("crypto"),G0=Ss(),{EMPTY_BUFFER:cG,kWebSocket:fG,NOOP:dG}=Gn(),{isBlob:jo,isValidStatusCode:pG}=Yo(),{mask:H0,toBuffer:$r}=ys(),$t=Symbol("kByteLength"),hG=Buffer.alloc(4),lu=8*1024,Vr,Xo=lu,on=0,mG=1,gG=2,Th=class t{constructor(e,n,r){this._extensions=n||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=on,this.onerror=dG,this[fG]=void 0}static frame(e,n){let r,o=!1,i=2,s=!1;n.mask&&(r=n.maskBuffer||hG,n.generateMask?n.generateMask(r):(Xo===lu&&(Vr===void 0&&(Vr=Buffer.alloc(lu)),uG(Vr,0,lu),Xo=0),r[0]=Vr[Xo++],r[1]=Vr[Xo++],r[2]=Vr[Xo++],r[3]=Vr[Xo++]),s=(r[0]|r[1]|r[2]|r[3])===0,i=6);let a;typeof e=="string"?(!n.mask||s)&&n[$t]!==void 0?a=n[$t]:(e=Buffer.from(e),a=e.length):(a=e.length,o=n.mask&&n.readOnly&&!s);let l=a;a>=65536?(i+=8,l=127):a>125&&(i+=2,l=126);let c=Buffer.allocUnsafe(o?a+i:i);return c[0]=n.fin?n.opcode|128:n.opcode,n.rsv1&&(c[0]|=64),c[1]=l,l===126?c.writeUInt16BE(a,2):l===127&&(c[2]=c[3]=0,c.writeUIntBE(a,4,6)),n.mask?(c[1]|=128,c[i-4]=r[0],c[i-3]=r[1],c[i-2]=r[2],c[i-1]=r[3],s?[c,e]:o?(H0(e,r,c,i,a),[c]):(H0(e,r,e,0,a),[c,e])):[c,e]}close(e,n,r,o){let i;if(e===void 0)i=cG;else{if(typeof e!="number"||!pG(e))throw new TypeError("First argument must be a valid error code number");if(n===void 0||!n.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(n);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof n=="string"?i.write(n,2):i.set(n,2)}}let s={[$t]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==on?this.enqueue([this.dispatch,i,!1,s,o]):this.sendFrame(t.frame(i,s),o)}ping(e,n,r){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):jo(e)?(o=e.size,i=!1):(e=$r(e),o=e.length,i=$r.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[$t]:o,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};jo(e)?this._state!==on?this.enqueue([this.getBlobData,e,!1,s,r]):this.getBlobData(e,!1,s,r):this._state!==on?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(t.frame(e,s),r)}pong(e,n,r){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):jo(e)?(o=e.size,i=!1):(e=$r(e),o=e.length,i=$r.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[$t]:o,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};jo(e)?this._state!==on?this.enqueue([this.getBlobData,e,!1,s,r]):this.getBlobData(e,!1,s,r):this._state!==on?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(t.frame(e,s),r)}send(e,n,r){let o=this._extensions[G0.extensionName],i=n.binary?2:1,s=n.compress,a,l;typeof e=="string"?(a=Buffer.byteLength(e),l=!1):jo(e)?(a=e.size,l=!1):(e=$r(e),a=e.length,l=$r.readOnly),this._firstFragment?(this._firstFragment=!1,s&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=o._threshold),this._compress=s):(s=!1,i=0),n.fin&&(this._firstFragment=!0);let c={[$t]:a,fin:n.fin,generateMask:this._generateMask,mask:n.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:l,rsv1:s};jo(e)?this._state!==on?this.enqueue([this.getBlobData,e,this._compress,c,r]):this.getBlobData(e,this._compress,c,r):this._state!==on?this.enqueue([this.dispatch,e,this._compress,c,r]):this.dispatch(e,this._compress,c,r)}getBlobData(e,n,r,o){this._bufferedBytes+=r[$t],this._state=gG,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(Eh,this,a,o);return}this._bufferedBytes-=r[$t];let s=$r(i);n?this.dispatch(s,n,r,o):(this._state=on,this.sendFrame(t.frame(s,r),o),this.dequeue())}).catch(i=>{process.nextTick(yG,this,i,o)})}dispatch(e,n,r,o){if(!n){this.sendFrame(t.frame(e,r),o);return}let i=this._extensions[G0.extensionName];this._bufferedBytes+=r[$t],this._state=mG,i.compress(e,r.fin,(s,a)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");Eh(this,l,o);return}this._bufferedBytes-=r[$t],this._state=on,r.readOnly=!1,this.sendFrame(t.frame(a,r),o),this.dequeue()})}dequeue(){for(;this._state===on&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][$t],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][$t],this._queue.push(e)}sendFrame(e,n){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],n),this._socket.uncork()):this._socket.write(e[0],n)}};$0.exports=Th;function Eh(t,e,n){typeof n=="function"&&n(e);for(let r=0;r<t._queue.length;r++){let o=t._queue[r],i=o[o.length-1];typeof i=="function"&&i(e)}}function yG(t,e,n){Eh(t,e,n),t.onerror(e)}});var Q0=k((C9,X0)=>{"use strict";var{kForOnEventAttribute:Ts,kListener:vh}=Gn(),V0=Symbol("kCode"),W0=Symbol("kData"),J0=Symbol("kError"),z0=Symbol("kMessage"),K0=Symbol("kReason"),Qo=Symbol("kTarget"),Y0=Symbol("kType"),j0=Symbol("kWasClean"),$n=class{constructor(e){this[Qo]=null,this[Y0]=e}get target(){return this[Qo]}get type(){return this[Y0]}};Object.defineProperty($n.prototype,"target",{enumerable:!0});Object.defineProperty($n.prototype,"type",{enumerable:!0});var Wr=class extends $n{constructor(e,n={}){super(e),this[V0]=n.code===void 0?0:n.code,this[K0]=n.reason===void 0?"":n.reason,this[j0]=n.wasClean===void 0?!1:n.wasClean}get code(){return this[V0]}get reason(){return this[K0]}get wasClean(){return this[j0]}};Object.defineProperty(Wr.prototype,"code",{enumerable:!0});Object.defineProperty(Wr.prototype,"reason",{enumerable:!0});Object.defineProperty(Wr.prototype,"wasClean",{enumerable:!0});var Zo=class extends $n{constructor(e,n={}){super(e),this[J0]=n.error===void 0?null:n.error,this[z0]=n.message===void 0?"":n.message}get error(){return this[J0]}get message(){return this[z0]}};Object.defineProperty(Zo.prototype,"error",{enumerable:!0});Object.defineProperty(Zo.prototype,"message",{enumerable:!0});var Es=class extends $n{constructor(e,n={}){super(e),this[W0]=n.data===void 0?null:n.data}get data(){return this[W0]}};Object.defineProperty(Es.prototype,"data",{enumerable:!0});var _G={addEventListener(t,e,n={}){for(let o of this.listeners(t))if(!n[Ts]&&o[vh]===e&&!o[Ts])return;let r;if(t==="message")r=function(i,s){let a=new Es("message",{data:s?i:i.toString()});a[Qo]=this,uu(e,this,a)};else if(t==="close")r=function(i,s){let a=new Wr("close",{code:i,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Qo]=this,uu(e,this,a)};else if(t==="error")r=function(i){let s=new Zo("error",{error:i,message:i.message});s[Qo]=this,uu(e,this,s)};else if(t==="open")r=function(){let i=new $n("open");i[Qo]=this,uu(e,this,i)};else return;r[Ts]=!!n[Ts],r[vh]=e,n.once?this.once(t,r):this.on(t,r)},removeEventListener(t,e){for(let n of this.listeners(t))if(n[vh]===e&&!n[Ts]){this.removeListener(t,n);break}}};X0.exports={CloseEvent:Wr,ErrorEvent:Zo,Event:$n,EventTarget:_G,MessageEvent:Es};function uu(t,e,n){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,n):t.call(e,n)}});var Ah=k((b9,Z0)=>{"use strict";var{tokenChars:ws}=Yo();function Cn(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}function SG(t){let e=Object.create(null),n=Object.create(null),r=!1,o=!1,i=!1,s,a,l=-1,c=-1,f=-1,m=0;for(;m<t.length;m++)if(c=t.charCodeAt(m),s===void 0)if(f===-1&&ws[c]===1)l===-1&&(l=m);else if(m!==0&&(c===32||c===9))f===-1&&l!==-1&&(f=m);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${m}`);f===-1&&(f=m);let y=t.slice(l,f);c===44?(Cn(e,y,n),n=Object.create(null)):s=y,l=f=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);else if(a===void 0)if(f===-1&&ws[c]===1)l===-1&&(l=m);else if(c===32||c===9)f===-1&&l!==-1&&(f=m);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${m}`);f===-1&&(f=m),Cn(n,t.slice(l,f),!0),c===44&&(Cn(e,s,n),n=Object.create(null),s=void 0),l=f=-1}else if(c===61&&l!==-1&&f===-1)a=t.slice(l,m),l=f=-1;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(o){if(ws[c]!==1)throw new SyntaxError(`Unexpected character at index ${m}`);l===-1?l=m:r||(r=!0),o=!1}else if(i)if(ws[c]===1)l===-1&&(l=m);else if(c===34&&l!==-1)i=!1,f=m;else if(c===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(c===34&&t.charCodeAt(m-1)===61)i=!0;else if(f===-1&&ws[c]===1)l===-1&&(l=m);else if(l!==-1&&(c===32||c===9))f===-1&&(f=m);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${m}`);f===-1&&(f=m);let y=t.slice(l,f);r&&(y=y.replace(/\\/g,""),r=!1),Cn(n,a,y),c===44&&(Cn(e,s,n),n=Object.create(null),s=void 0),a=void 0,l=f=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);if(l===-1||i||c===32||c===9)throw new SyntaxError("Unexpected end of input");f===-1&&(f=m);let h=t.slice(l,f);return s===void 0?Cn(e,h,n):(a===void 0?Cn(n,h,!0):r?Cn(n,a,h.replace(/\\/g,"")):Cn(n,a,h),Cn(e,s,n)),e}function TG(t){return Object.keys(t).map(e=>{let n=t[e];return Array.isArray(n)||(n=[n]),n.map(r=>[e].concat(Object.keys(r).map(o=>{let i=r[o];return Array.isArray(i)||(i=[i]),i.map(s=>s===!0?o:`${o}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Z0.exports={format:TG,parse:SG}});var pu=k((x9,fA)=>{"use strict";var EG=require("events"),wG=require("https"),vG=require("http"),nA=require("net"),AG=require("tls"),{randomBytes:CG,createHash:bG}=require("crypto"),{Duplex:R9,Readable:I9}=require("stream"),{URL:Ch}=require("url"),mr=Ss(),RG=Sh(),IG=wh(),{isBlob:xG}=Yo(),{BINARY_TYPES:eA,CLOSE_TIMEOUT:PG,EMPTY_BUFFER:cu,GUID:kG,kForOnEventAttribute:bh,kListener:NG,kStatusCode:MG,kWebSocket:$e,NOOP:rA}=Gn(),{EventTarget:{addEventListener:OG,removeEventListener:DG}}=Q0(),{format:FG,parse:LG}=Ah(),{toBuffer:UG}=ys(),oA=Symbol("kAborted"),Rh=[8,13],Vn=["CONNECTING","OPEN","CLOSING","CLOSED"],qG=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,xe=class t extends EG{constructor(e,n,r){super(),this._binaryType=eA[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=cu,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,n===void 0?n=[]:Array.isArray(n)||(typeof n=="object"&&n!==null?(r=n,n=[]):n=[n]),iA(this,e,n,r)):(this._autoPong=r.autoPong,this._closeTimeout=r.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){eA.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,n,r){let o=new RG({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),i=new IG(e,this._extensions,r.generateMask);this._receiver=o,this._sender=i,this._socket=e,o[$e]=this,i[$e]=this,e[$e]=this,o.on("conclude",HG),o.on("drain",$G),o.on("error",VG),o.on("message",WG),o.on("ping",JG),o.on("pong",zG),i.onerror=KG,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),n.length>0&&e.unshift(n),e.on("close",lA),e.on("data",du),e.on("end",uA),e.on("error",cA),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[mr.extensionName]&&this._extensions[mr.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,n){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){xt(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,n,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),aA(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,n,r){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=n=void 0):typeof n=="function"&&(r=n,n=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Ih(this,e,r);return}n===void 0&&(n=!this._isServer),this._sender.ping(e||cu,n,r)}pong(e,n,r){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=n=void 0):typeof n=="function"&&(r=n,n=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Ih(this,e,r);return}n===void 0&&(n=!this._isServer),this._sender.pong(e||cu,n,r)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,n,r){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof n=="function"&&(r=n,n={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Ih(this,e,r);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...n};this._extensions[mr.extensionName]||(o.compress=!1),this._sender.send(e||cu,o,r)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){xt(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(xe,"CONNECTING",{enumerable:!0,value:Vn.indexOf("CONNECTING")});Object.defineProperty(xe.prototype,"CONNECTING",{enumerable:!0,value:Vn.indexOf("CONNECTING")});Object.defineProperty(xe,"OPEN",{enumerable:!0,value:Vn.indexOf("OPEN")});Object.defineProperty(xe.prototype,"OPEN",{enumerable:!0,value:Vn.indexOf("OPEN")});Object.defineProperty(xe,"CLOSING",{enumerable:!0,value:Vn.indexOf("CLOSING")});Object.defineProperty(xe.prototype,"CLOSING",{enumerable:!0,value:Vn.indexOf("CLOSING")});Object.defineProperty(xe,"CLOSED",{enumerable:!0,value:Vn.indexOf("CLOSED")});Object.defineProperty(xe.prototype,"CLOSED",{enumerable:!0,value:Vn.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(xe.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(xe.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[bh])return e[NG];return null},set(e){for(let n of this.listeners(t))if(n[bh]){this.removeListener(t,n);break}typeof e=="function"&&this.addEventListener(t,e,{[bh]:!0})}})});xe.prototype.addEventListener=OG;xe.prototype.removeEventListener=DG;fA.exports=xe;function iA(t,e,n,r){let o={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:PG,protocolVersion:Rh[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,t._closeTimeout=o.closeTimeout,!Rh.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${Rh.join(", ")})`);let i;if(e instanceof Ch)i=e;else try{i=new Ch(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),t._url=i.href;let s=i.protocol==="wss:",a=i.protocol==="ws+unix:",l;if(i.protocol!=="ws:"&&!s&&!a?l=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?l="The URL's pathname is empty":i.hash&&(l="The URL contains a fragment identifier"),l){let T=new SyntaxError(l);if(t._redirects===0)throw T;fu(t,T);return}let c=s?443:80,f=CG(16).toString("base64"),m=s?wG.request:vG.request,h=new Set,y;if(o.createConnection=o.createConnection||(s?GG:BG),o.defaultPort=o.defaultPort||c,o.port=i.port||c,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":f,Connection:"Upgrade",Upgrade:"websocket"},o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(y=new mr(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=FG({[mr.extensionName]:y.offer()})),n.length){for(let T of n){if(typeof T!="string"||!qG.test(T)||h.has(T))throw new SyntaxError("An invalid or duplicated subprotocol was specified");h.add(T)}o.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),a){let T=o.path.split(":");o.socketPath=T[0],o.path=T[1]}let _;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?o.socketPath:i.host;let T=r&&r.headers;if(r={...r,headers:{}},T)for(let[E,w]of Object.entries(T))r.headers[E.toLowerCase()]=w}else if(t.listenerCount("redirect")===0){let T=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!T||t._originalSecure&&!s)&&(delete o.headers.authorization,delete o.headers.cookie,T||delete o.headers.host,o.auth=void 0)}o.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),_=t._req=m(o),t._redirects&&t.emit("redirect",t.url,_)}else _=t._req=m(o);o.timeout&&_.on("timeout",()=>{xt(t,_,"Opening handshake has timed out")}),_.on("error",T=>{_===null||_[oA]||(_=t._req=null,fu(t,T))}),_.on("response",T=>{let E=T.headers.location,w=T.statusCode;if(E&&o.followRedirects&&w>=300&&w<400){if(++t._redirects>o.maxRedirects){xt(t,_,"Maximum redirects exceeded");return}_.abort();let b;try{b=new Ch(E,e)}catch{let D=new SyntaxError(`Invalid URL: ${E}`);fu(t,D);return}iA(t,b,n,r)}else t.emit("unexpected-response",_,T)||xt(t,_,`Unexpected server response: ${T.statusCode}`)}),_.on("upgrade",(T,E,w)=>{if(t.emit("upgrade",T),t.readyState!==xe.CONNECTING)return;_=t._req=null;let b=T.headers.upgrade;if(b===void 0||b.toLowerCase()!=="websocket"){xt(t,E,"Invalid Upgrade header");return}let L=bG("sha1").update(f+kG).digest("base64");if(T.headers["sec-websocket-accept"]!==L){xt(t,E,"Invalid Sec-WebSocket-Accept header");return}let D=T.headers["sec-websocket-protocol"],I;if(D!==void 0?h.size?h.has(D)||(I="Server sent an invalid subprotocol"):I="Server sent a subprotocol but none was requested":h.size&&(I="Server sent no subprotocol"),I){xt(t,E,I);return}D&&(t._protocol=D);let P=T.headers["sec-websocket-extensions"];if(P!==void 0){if(!y){xt(t,E,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let q;try{q=LG(P)}catch{xt(t,E,"Invalid Sec-WebSocket-Extensions header");return}let K=Object.keys(q);if(K.length!==1||K[0]!==mr.extensionName){xt(t,E,"Server indicated an extension that was not requested");return}try{y.accept(q[mr.extensionName])}catch{xt(t,E,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[mr.extensionName]=y}t.setSocket(E,w,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(_,t):_.end()}function fu(t,e){t._readyState=xe.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function BG(t){return t.path=t.socketPath,nA.connect(t)}function GG(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=nA.isIP(t.host)?"":t.host),AG.connect(t)}function xt(t,e,n){t._readyState=xe.CLOSING;let r=new Error(n);Error.captureStackTrace(r,xt),e.setHeader?(e[oA]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(fu,t,r)):(e.destroy(r),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function Ih(t,e,n){if(e){let r=xG(e)?e.size:UG(e).length;t._socket?t._sender._bufferedBytes+=r:t._bufferedAmount+=r}if(n){let r=new Error(`WebSocket is not open: readyState ${t.readyState} (${Vn[t.readyState]})`);process.nextTick(n,r)}}function HG(t,e){let n=this[$e];n._closeFrameReceived=!0,n._closeMessage=e,n._closeCode=t,n._socket[$e]!==void 0&&(n._socket.removeListener("data",du),process.nextTick(sA,n._socket),t===1005?n.close():n.close(t,e))}function $G(){let t=this[$e];t.isPaused||t._socket.resume()}function VG(t){let e=this[$e];e._socket[$e]!==void 0&&(e._socket.removeListener("data",du),process.nextTick(sA,e._socket),e.close(t[MG])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function tA(){this[$e].emitClose()}function WG(t,e){this[$e].emit("message",t,e)}function JG(t){let e=this[$e];e._autoPong&&e.pong(t,!this._isServer,rA),e.emit("ping",t)}function zG(t){this[$e].emit("pong",t)}function sA(t){t.resume()}function KG(t){let e=this[$e];e.readyState!==xe.CLOSED&&(e.readyState===xe.OPEN&&(e._readyState=xe.CLOSING,aA(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function aA(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),t._closeTimeout)}function lA(){let t=this[$e];if(this.removeListener("close",lA),this.removeListener("data",du),this.removeListener("end",uA),t._readyState=xe.CLOSING,!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&this._readableState.length!==0){let e=this.read(this._readableState.length);t._receiver.write(e)}t._receiver.end(),this[$e]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",tA),t._receiver.on("finish",tA))}function du(t){this[$e]._receiver.write(t)||this.pause()}function uA(){let t=this[$e];t._readyState=xe.CLOSING,t._receiver.end(),this.end()}function cA(){let t=this[$e];this.removeListener("error",cA),this.on("error",rA),t&&(t._readyState=xe.CLOSING,this.destroy())}});var mA=k((k9,hA)=>{"use strict";var P9=pu(),{Duplex:YG}=require("stream");function dA(t){t.emit("close")}function jG(){!this.destroyed&&this._writableState.finished&&this.destroy()}function pA(t){this.removeListener("error",pA),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function XG(t,e){let n=!0,r=new YG({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,s){let a=!s&&r._readableState.objectMode?i.toString():i;r.push(a)||t.pause()}),t.once("error",function(i){r.destroyed||(n=!1,r.destroy(i))}),t.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(o,i){if(t.readyState===t.CLOSED){i(o),process.nextTick(dA,r);return}let s=!1;t.once("error",function(l){s=!0,i(l)}),t.once("close",function(){s||i(o),process.nextTick(dA,r)}),n&&t.terminate()},r._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){r._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),r._readableState.endEmitted&&r.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},r._read=function(){t.isPaused&&t.resume()},r._write=function(o,i,s){if(t.readyState===t.CONNECTING){t.once("open",function(){r._write(o,i,s)});return}t.send(o,s)},r.on("end",jG),r.on("error",pA),r}hA.exports=XG});var yA=k((N9,gA)=>{"use strict";var{tokenChars:QG}=Yo();function ZG(t){let e=new Set,n=-1,r=-1,o=0;for(o;o<t.length;o++){let s=t.charCodeAt(o);if(r===-1&&QG[s]===1)n===-1&&(n=o);else if(o!==0&&(s===32||s===9))r===-1&&n!==-1&&(r=o);else if(s===44){if(n===-1)throw new SyntaxError(`Unexpected character at index ${o}`);r===-1&&(r=o);let a=t.slice(n,r);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),n=r=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(n===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(n,o);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}gA.exports={parse:ZG}});var AA=k((O9,vA)=>{"use strict";var eH=require("events"),hu=require("http"),{Duplex:M9}=require("stream"),{createHash:tH}=require("crypto"),_A=Ah(),Jr=Ss(),nH=yA(),rH=pu(),{CLOSE_TIMEOUT:oH,GUID:iH,kWebSocket:sH}=Gn(),aH=/^[+/0-9A-Za-z]{22}==$/,SA=0,TA=1,wA=2,xh=class extends eH{constructor(e,n){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:oH,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:rH,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=hu.createServer((r,o)=>{let i=hu.STATUS_CODES[426];o.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),o.end(i)}),this._server.listen(e.port,e.host,e.backlog,n)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=lH(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,i,s)=>{this.handleUpgrade(o,i,s,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=SA}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===wA){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(vs,this);return}if(e&&this.once("close",e),this._state!==TA)if(this._state=TA,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(vs,this):process.nextTick(vs,this);else{let n=this._server;this._removeListeners(),this._removeListeners=this._server=null,n.close(()=>{vs(this)})}}shouldHandle(e){if(this.options.path){let n=e.url.indexOf("?");if((n!==-1?e.url.slice(0,n):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,n,r,o){n.on("error",EA);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){zr(this,e,n,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){zr(this,e,n,400,"Invalid Upgrade header");return}if(i===void 0||!aH.test(i)){zr(this,e,n,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){zr(this,e,n,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){As(n,400);return}let l=e.headers["sec-websocket-protocol"],c=new Set;if(l!==void 0)try{c=nH.parse(l)}catch{zr(this,e,n,400,"Invalid Sec-WebSocket-Protocol header");return}let f=e.headers["sec-websocket-extensions"],m={};if(this.options.perMessageDeflate&&f!==void 0){let h=new Jr(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let y=_A.parse(f);y[Jr.extensionName]&&(h.accept(y[Jr.extensionName]),m[Jr.extensionName]=h)}catch{zr(this,e,n,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let h={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(h,(y,_,T,E)=>{if(!y)return As(n,_||401,T,E);this.completeUpgrade(m,i,c,e,n,r,o)});return}if(!this.options.verifyClient(h))return As(n,401)}this.completeUpgrade(m,i,c,e,n,r,o)}completeUpgrade(e,n,r,o,i,s,a){if(!i.readable||!i.writable)return i.destroy();if(i[sH])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>SA)return As(i,503);let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${tH("sha1").update(n+iH).digest("base64")}`],f=new this.options.WebSocket(null,void 0,this.options);if(r.size){let m=this.options.handleProtocols?this.options.handleProtocols(r,o):r.values().next().value;m&&(c.push(`Sec-WebSocket-Protocol: ${m}`),f._protocol=m)}if(e[Jr.extensionName]){let m=e[Jr.extensionName].params,h=_A.format({[Jr.extensionName]:[m]});c.push(`Sec-WebSocket-Extensions: ${h}`),f._extensions=e}this.emit("headers",c,o),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",EA),f.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(vs,this)})),a(f,o)}};vA.exports=xh;function lH(t,e){for(let n of Object.keys(e))t.on(n,e[n]);return function(){for(let r of Object.keys(e))t.removeListener(r,e[r])}}function vs(t){t._state=wA,t.emit("close")}function EA(){this.destroy()}function As(t,e,n,r){n=n||hu.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...r},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${hu.STATUS_CODES[e]}\r
`+Object.keys(r).map(o=>`${o}: ${r[o]}`).join(`\r
`)+`\r
\r
`+n)}function zr(t,e,n,r,o,i){if(t.listenerCount("wsClientError")){let s=new Error(o);Error.captureStackTrace(s,zr),t.emit("wsClientError",s,n,e)}else As(n,r,o,i)}});var bA=k((D9,CA)=>{"use strict";var Wn=pu();Wn.createWebSocketStream=mA();Wn.Server=AA();Wn.Receiver=Sh();Wn.Sender=wh();Wn.WebSocket=Wn;Wn.WebSocketServer=Wn.Server;CA.exports=Wn});var $C=k(C=>{"use strict";var uH=T0(),cH=require("fs"),ZA=require("fs/promises"),fH=require("node:stream"),dH=require("node:stream/promises"),pH=bA(),hH=require("path");function Im(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var RA=Im(ZA),mH=Im(pH),gH=Im(hH);var eC,tC;function yH(t){eC=t.geminiUrl,tC=t.vertexUrl}function _H(){return{geminiUrl:eC,vertexUrl:tC}}function SH(t,e,n,r){var o,i;if(!t?.baseUrl){let s=_H();return e?(o=s.vertexUrl)!==null&&o!==void 0?o:n:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return t.baseUrl}var ln=class{};function X(t,e){let n=/\{([^}]+)\}/g;return t.replace(n,(r,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){let i=e[o];return i!=null?String(i):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function d(t,e,n){for(let i=0;i<e.length-1;i++){let s=e[i];if(s.endsWith("[]")){let a=s.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(t[a])){let l=t[a];if(Array.isArray(n))for(let c=0;c<l.length;c++){let f=l[c];d(f,e.slice(i+1),n[c])}else for(let c of l)d(c,e.slice(i+1),n)}return}else if(s.endsWith("[0]")){let a=s.slice(0,-3);a in t||(t[a]=[{}]);let l=t[a];d(l[0],e.slice(i+1),n);return}(!t[s]||typeof t[s]!="object")&&(t[s]={}),t=t[s]}let r=e[e.length-1],o=t[r];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function u(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;let o=e[r];if(o.endsWith("[]")){let i=o.slice(0,-2);if(i in t){let s=t[i];return Array.isArray(s)?s.map(a=>u(a,e.slice(r+1),n)):n}else return n}else t=t[o]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function TH(t,e){for(let[n,r]of Object.entries(e)){let o=n.split("."),i=r.split("."),s=new Set,a=-1;for(let l=0;l<o.length;l++)if(o[l]==="*"){a=l;break}if(a!==-1&&i.length>a)for(let l=a;l<i.length;l++){let c=i[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&s.add(c)}Mh(t,o,i,0,s)}}function Mh(t,e,n,r,o){if(r>=e.length||typeof t!="object"||t===null)return;let i=e[r];if(i.endsWith("[]")){let s=i.slice(0,-2),a=t;if(s in a&&Array.isArray(a[s]))for(let l of a[s])Mh(l,e,n,r+1,o)}else if(i==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){let s=t,a=Object.keys(s).filter(c=>!c.startsWith("_")&&!o.has(c)),l={};for(let c of a)l[c]=s[c];for(let[c,f]of Object.entries(l)){let m=[];for(let h of n.slice(r))h==="*"?m.push(c):m.push(h);d(s,m,f)}for(let c of a)delete s[c]}}else{let s=t;i in s&&Mh(s[i],e,n,r+1,o)}}function xm(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function EH(t){let e={},n=u(t,["operationName"]);n!=null&&d(e,["operationName"],n);let r=u(t,["resourceName"]);return r!=null&&d(e,["_url","resourceName"],r),e}function wH(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["metadata"]);r!=null&&d(e,["metadata"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);i!=null&&d(e,["error"],i);let s=u(t,["response","generateVideoResponse"]);return s!=null&&d(e,["response"],AH(s)),e}function vH(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["metadata"]);r!=null&&d(e,["metadata"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);i!=null&&d(e,["error"],i);let s=u(t,["response"]);return s!=null&&d(e,["response"],CH(s)),e}function AH(t){let e={},n=u(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>bH(s))),d(e,["generatedVideos"],i)}let r=u(t,["raiMediaFilteredCount"]);r!=null&&d(e,["raiMediaFilteredCount"],r);let o=u(t,["raiMediaFilteredReasons"]);return o!=null&&d(e,["raiMediaFilteredReasons"],o),e}function CH(t){let e={},n=u(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>RH(s))),d(e,["generatedVideos"],i)}let r=u(t,["raiMediaFilteredCount"]);r!=null&&d(e,["raiMediaFilteredCount"],r);let o=u(t,["raiMediaFilteredReasons"]);return o!=null&&d(e,["raiMediaFilteredReasons"],o),e}function bH(t){let e={},n=u(t,["video"]);return n!=null&&d(e,["video"],MH(n)),e}function RH(t){let e={},n=u(t,["_self"]);return n!=null&&d(e,["video"],OH(n)),e}function IH(t){let e={},n=u(t,["operationName"]);return n!=null&&d(e,["_url","operationName"],n),e}function xH(t){let e={},n=u(t,["operationName"]);return n!=null&&d(e,["_url","operationName"],n),e}function PH(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["metadata"]);r!=null&&d(e,["metadata"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);i!=null&&d(e,["error"],i);let s=u(t,["response"]);return s!=null&&d(e,["response"],kH(s)),e}function kH(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["parent"]);r!=null&&d(e,["parent"],r);let o=u(t,["documentName"]);return o!=null&&d(e,["documentName"],o),e}function Pm(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["metadata"]);r!=null&&d(e,["metadata"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);i!=null&&d(e,["error"],i);let s=u(t,["response"]);return s!=null&&d(e,["response"],NH(s)),e}function NH(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["parent"]);r!=null&&d(e,["parent"],r);let o=u(t,["documentName"]);return o!=null&&d(e,["documentName"],o),e}function MH(t){let e={},n=u(t,["uri"]);n!=null&&d(e,["uri"],n);let r=u(t,["encodedVideo"]);r!=null&&d(e,["videoBytes"],xm(r));let o=u(t,["encoding"]);return o!=null&&d(e,["mimeType"],o),e}function OH(t){let e={},n=u(t,["gcsUri"]);n!=null&&d(e,["uri"],n);let r=u(t,["bytesBase64Encoded"]);r!=null&&d(e,["videoBytes"],xm(r));let o=u(t,["mimeType"]);return o!=null&&d(e,["mimeType"],o),e}C.Outcome=void 0;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(C.Outcome||(C.Outcome={}));C.Language=void 0;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(C.Language||(C.Language={}));C.FunctionResponseScheduling=void 0;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(C.FunctionResponseScheduling||(C.FunctionResponseScheduling={}));C.Type=void 0;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(C.Type||(C.Type={}));C.ApiSpec=void 0;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(C.ApiSpec||(C.ApiSpec={}));C.AuthType=void 0;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(C.AuthType||(C.AuthType={}));C.HttpElementLocation=void 0;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(C.HttpElementLocation||(C.HttpElementLocation={}));C.PhishBlockThreshold=void 0;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(C.PhishBlockThreshold||(C.PhishBlockThreshold={}));C.Behavior=void 0;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(C.Behavior||(C.Behavior={}));C.DynamicRetrievalConfigMode=void 0;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(C.DynamicRetrievalConfigMode||(C.DynamicRetrievalConfigMode={}));C.FunctionCallingConfigMode=void 0;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(C.FunctionCallingConfigMode||(C.FunctionCallingConfigMode={}));C.ThinkingLevel=void 0;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(C.ThinkingLevel||(C.ThinkingLevel={}));C.HarmCategory=void 0;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(C.HarmCategory||(C.HarmCategory={}));C.HarmBlockMethod=void 0;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(C.HarmBlockMethod||(C.HarmBlockMethod={}));C.HarmBlockThreshold=void 0;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(C.HarmBlockThreshold||(C.HarmBlockThreshold={}));C.FinishReason=void 0;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(C.FinishReason||(C.FinishReason={}));C.HarmProbability=void 0;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(C.HarmProbability||(C.HarmProbability={}));C.HarmSeverity=void 0;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(C.HarmSeverity||(C.HarmSeverity={}));C.UrlRetrievalStatus=void 0;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(C.UrlRetrievalStatus||(C.UrlRetrievalStatus={}));C.BlockedReason=void 0;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(C.BlockedReason||(C.BlockedReason={}));C.TrafficType=void 0;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(C.TrafficType||(C.TrafficType={}));C.Modality=void 0;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(C.Modality||(C.Modality={}));C.MediaResolution=void 0;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(C.MediaResolution||(C.MediaResolution={}));C.TuningMode=void 0;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(C.TuningMode||(C.TuningMode={}));C.AdapterSize=void 0;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(C.AdapterSize||(C.AdapterSize={}));C.JobState=void 0;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(C.JobState||(C.JobState={}));C.TuningTask=void 0;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(C.TuningTask||(C.TuningTask={}));C.PartMediaResolutionLevel=void 0;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(C.PartMediaResolutionLevel||(C.PartMediaResolutionLevel={}));C.ResourceScope=void 0;(function(t){t.COLLECTION="COLLECTION"})(C.ResourceScope||(C.ResourceScope={}));C.FeatureSelectionPreference=void 0;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(C.FeatureSelectionPreference||(C.FeatureSelectionPreference={}));C.Environment=void 0;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(C.Environment||(C.Environment={}));C.SafetyFilterLevel=void 0;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(C.SafetyFilterLevel||(C.SafetyFilterLevel={}));C.PersonGeneration=void 0;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(C.PersonGeneration||(C.PersonGeneration={}));C.ImagePromptLanguage=void 0;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(C.ImagePromptLanguage||(C.ImagePromptLanguage={}));C.MaskReferenceMode=void 0;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(C.MaskReferenceMode||(C.MaskReferenceMode={}));C.ControlReferenceType=void 0;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(C.ControlReferenceType||(C.ControlReferenceType={}));C.SubjectReferenceType=void 0;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(C.SubjectReferenceType||(C.SubjectReferenceType={}));C.EditMode=void 0;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(C.EditMode||(C.EditMode={}));C.SegmentMode=void 0;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(C.SegmentMode||(C.SegmentMode={}));C.VideoGenerationReferenceType=void 0;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(C.VideoGenerationReferenceType||(C.VideoGenerationReferenceType={}));C.VideoGenerationMaskMode=void 0;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(C.VideoGenerationMaskMode||(C.VideoGenerationMaskMode={}));C.VideoCompressionQuality=void 0;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(C.VideoCompressionQuality||(C.VideoCompressionQuality={}));C.TuningMethod=void 0;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING",t.DISTILLATION="DISTILLATION"})(C.TuningMethod||(C.TuningMethod={}));C.DocumentState=void 0;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(C.DocumentState||(C.DocumentState={}));C.FileState=void 0;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(C.FileState||(C.FileState={}));C.FileSource=void 0;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED",t.REGISTERED="REGISTERED"})(C.FileSource||(C.FileSource={}));C.TurnCompleteReason=void 0;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(C.TurnCompleteReason||(C.TurnCompleteReason={}));C.MediaModality=void 0;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(C.MediaModality||(C.MediaModality={}));C.VadSignalType=void 0;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(C.VadSignalType||(C.VadSignalType={}));C.VoiceActivityType=void 0;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.ACTIVITY_START="ACTIVITY_START",t.ACTIVITY_END="ACTIVITY_END"})(C.VoiceActivityType||(C.VoiceActivityType={}));C.StartSensitivity=void 0;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(C.StartSensitivity||(C.StartSensitivity={}));C.EndSensitivity=void 0;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(C.EndSensitivity||(C.EndSensitivity={}));C.ActivityHandling=void 0;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(C.ActivityHandling||(C.ActivityHandling={}));C.TurnCoverage=void 0;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(C.TurnCoverage||(C.TurnCoverage={}));C.Scale=void 0;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(C.Scale||(C.Scale={}));C.MusicGenerationMode=void 0;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(C.MusicGenerationMode||(C.MusicGenerationMode={}));C.LiveMusicPlaybackControl=void 0;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(C.LiveMusicPlaybackControl||(C.LiveMusicPlaybackControl={}));var Oh=class{},Dh=class{},Fh=class{};function DH(t,e){return{inlineData:{data:t,mimeType:e}}}function FH(t,e){return{fileData:{fileUri:t,mimeType:e}}}var Lh=class{};function LH(t,e,n){return Object.assign({fileData:{fileUri:t,mimeType:e}},n&&{mediaResolution:{level:n}})}function Uh(t){return{text:t}}function UH(t,e){return{functionCall:{name:t,args:e}}}function qH(t,e,n,r=[]){return{functionResponse:Object.assign({id:t,name:e,response:n},r.length>0&&{parts:r})}}function BH(t,e,n){return Object.assign({inlineData:{data:t,mimeType:e}},n&&{mediaResolution:{level:n}})}function GH(t,e){return{codeExecutionResult:{outcome:t,output:e}}}function HH(t,e){return{executableCode:{code:t,language:e}}}function IA(t){return typeof t=="object"&&t!==null?"fileData"in t||"text"in t||"functionCall"in t||"functionResponse"in t||"inlineData"in t||"videoMetadata"in t||"codeExecutionResult"in t||"executableCode"in t:!1}function nC(t){let e=[];if(typeof t=="string")e.push(Uh(t));else if(IA(t))e.push(t);else if(Array.isArray(t)){if(t.length===0)throw new Error("partOrString cannot be an empty array");for(let n of t)if(typeof n=="string")e.push(Uh(n));else if(IA(n))e.push(n);else throw new Error("element in PartUnion must be a Part object or string")}else throw new Error("partOrString must be a Part object, string, or array");return e}function $H(t){return{role:"user",parts:nC(t)}}function VH(t){return{role:"model",parts:nC(t)}}var _r=class{constructor(e){let n={};for(let r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}},qh=class{},Bh=class{},gr=class{get text(){var e,n,r,o,i,s,a,l;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1,m=[];for(let h of(l=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[y,_]of Object.entries(h))y!=="text"&&y!=="thought"&&y!=="thoughtSignature"&&(_!==null||_!==void 0)&&m.push(y);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,c+=h.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,n,r,o,i,s,a,l;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",f=[];for(let m of(l=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[h,y]of Object.entries(m))h!=="inlineData"&&(y!==null||y!==void 0)&&f.push(h);m.inlineData&&typeof m.inlineData.data=="string"&&(c+=atob(m.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,r,o,i,s,a,l;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if(c?.length!==0)return c}get executableCode(){var e,n,r,o,i,s,a,l,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let f=(l=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if(f?.length!==0)return(c=f?.[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,r,o,i,s,a,l,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let f=(l=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if(f?.length!==0)return(c=f?.[0])===null||c===void 0?void 0:c.output}},Is=class{},xs=class{},wu=class{},vu=class{},Au=class{},Cu=class{},Ps=class{},ks=class{},Ns=class{},bu=class{},Gh=class{},Ms=class t{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){let r=new t,o,i=e;return n?o=vH(i):o=wH(i),Object.assign(r,o),r}},Os=class{},Ds=class{},Fs=class{},Ls=class{},Ru=class{},Iu=class{},xu=class{},Hh=class{},Pu=class t{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){let r=new t,i=PH(e);return Object.assign(r,i),r}},ku=class{},Nu=class{},Mu=class{},Ou=class{},$h=class{},Vh=class{},Wh=class{},Us=class{},Jh=class{},zh=class{toReferenceImageAPI(){return{referenceType:"REFERENCE_TYPE_RAW",referenceImage:this.referenceImage,referenceId:this.referenceId}}},Kh=class{toReferenceImageAPI(){return{referenceType:"REFERENCE_TYPE_MASK",referenceImage:this.referenceImage,referenceId:this.referenceId,maskImageConfig:this.config}}},Yh=class{toReferenceImageAPI(){return{referenceType:"REFERENCE_TYPE_CONTROL",referenceImage:this.referenceImage,referenceId:this.referenceId,controlImageConfig:this.config}}},jh=class{toReferenceImageAPI(){return{referenceType:"REFERENCE_TYPE_STYLE",referenceImage:this.referenceImage,referenceId:this.referenceId,styleImageConfig:this.config}}},Xh=class{toReferenceImageAPI(){return{referenceType:"REFERENCE_TYPE_SUBJECT",referenceImage:this.referenceImage,referenceId:this.referenceId,subjectImageConfig:this.config}}},Qh=class{toReferenceImageAPI(){return{referenceType:"REFERENCE_TYPE_CONTENT",referenceImage:this.referenceImage,referenceId:this.referenceId}}},Du=class{get text(){var e,n,r;let o="",i=!1,s=[];for(let a of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&s.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;i=!0,o+=a.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?o:void 0}get data(){var e,n,r;let o="",i=[];for(let s of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(let[a,l]of Object.entries(s))a!=="inlineData"&&l!==null&&i.push(a);s.inlineData&&typeof s.inlineData.data=="string"&&(o+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}},Zh=class{},em=class{constructor(){this.functionResponses=[]}},Fu=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}},tm=class{},qs=class t{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){let r=new t,i=Pm(e);return Object.assign(r,i),r}};function _e(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function rC(t,e){let n=_e(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function oC(t){return Array.isArray(t)?t.map(e=>Lu(e)):[Lu(t)]}function Lu(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function iC(t){let e=Lu(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function sC(t){let e=Lu(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function xA(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function aC(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>xA(e)):[xA(t)]}function nm(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function PA(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function kA(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Ke(t){if(t==null)throw new Error("ContentUnion is required");return nm(t)?t:{role:"user",parts:aC(t)}}function km(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{let r=Ke(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){let n=Ke(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Ke(n)):[Ke(e)]}function Vt(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(PA(t)||kA(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ke(t)]}let e=[],n=[],r=nm(t[0]);for(let o of t){let i=nm(o);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)e.push(o);else{if(PA(o)||kA(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return r||e.push({role:"user",parts:aC(n)}),e}function WH(t,e){t.includes("null")&&(e.nullable=!0);let n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(C.Type).includes(n[0].toUpperCase())?n[0].toUpperCase():C.Type.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let r of n)e.anyOf.push({type:Object.values(C.Type).includes(r.toUpperCase())?r.toUpperCase():C.Type.TYPE_UNSPECIFIED})}}function ti(t){let e={},n=["items"],r=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");let i=t.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(e.nullable=!0,t=i[1]):i[1].type==="null"&&(e.nullable=!0,t=i[0])),t.type instanceof Array&&WH(t.type,e);for(let[s,a]of Object.entries(t))if(a!=null)if(s=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(C.Type).includes(a.toUpperCase())?a.toUpperCase():C.Type.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=ti(a);else if(r.includes(s)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(ti(c))}e[s]=l}else if(o.includes(s)){let l={};for(let[c,f]of Object.entries(a))l[c]=ti(f);e[s]=l}else{if(s==="additionalProperties")continue;e[s]=a}return e}function Nm(t){return ti(t)}function Mm(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Om(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function si(t){if(t.functionDeclarations)for(let e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=ti(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=ti(e.response));return t}function ai(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");let e=[];for(let n of t)e.push(n);return e}function JH(t,e,n,r=1){let o=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function Jn(t,e){if(typeof e!="string")throw new Error("name must be a string");return JH(t,e,"cachedContents")}function lC(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Sr(t){return xm(t)}function zH(t){return t!=null&&typeof t=="object"&&"name"in t}function uC(t){return t!=null&&typeof t=="object"&&"video"in t}function cC(t){return t!=null&&typeof t=="object"&&"uri"in t}function Dm(t){var e;let n;if(zH(t)&&(n=t.name),!(cC(t)&&(n=t.uri,n===void 0))&&!(uC(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function fC(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function dC(t){for(let e of["models","tunedModels","publisherModels"])if(KH(t,e))return t[e];return[]}function KH(t,e){return t!==null&&typeof t=="object"&&e in t}function YH(t,e={}){let n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function jH(t,e={}){let n=[],r=new Set;for(let o of t){let i=o.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);let s=YH(o,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function pC(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,o=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(o>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function XH(t){if(typeof t!="string")return t;let e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function hC(t){if(typeof t!="object"||t===null)return{};let e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;let o=n.inlinedResponses;if(!Array.isArray(o)||o.length===0)return t;let i=!1;for(let s of o){if(typeof s!="object"||s===null)continue;let l=s.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function li(t,e){let n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function mC(t){let e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function QH(t){let e={},n=u(t,["responsesFile"]);n!=null&&d(e,["fileName"],n);let r=u(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>N$(s))),d(e,["inlinedResponses"],i)}let o=u(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["inlinedEmbedContentResponses"],i)}return e}function ZH(t){let e={},n=u(t,["predictionsFormat"]);n!=null&&d(e,["format"],n);let r=u(t,["gcsDestination","outputUriPrefix"]);r!=null&&d(e,["gcsUri"],r);let o=u(t,["bigqueryDestination","outputUri"]);return o!=null&&d(e,["bigqueryUri"],o),e}function e$(t){let e={},n=u(t,["format"]);n!=null&&d(e,["predictionsFormat"],n);let r=u(t,["gcsUri"]);r!=null&&d(e,["gcsDestination","outputUriPrefix"],r);let o=u(t,["bigqueryUri"]);if(o!=null&&d(e,["bigqueryDestination","outputUri"],o),u(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(u(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Tu(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["metadata","displayName"]);r!=null&&d(e,["displayName"],r);let o=u(t,["metadata","state"]);o!=null&&d(e,["state"],mC(o));let i=u(t,["metadata","createTime"]);i!=null&&d(e,["createTime"],i);let s=u(t,["metadata","endTime"]);s!=null&&d(e,["endTime"],s);let a=u(t,["metadata","updateTime"]);a!=null&&d(e,["updateTime"],a);let l=u(t,["metadata","model"]);l!=null&&d(e,["model"],l);let c=u(t,["metadata","output"]);return c!=null&&d(e,["dest"],QH(hC(c))),e}function rm(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["displayName"]);r!=null&&d(e,["displayName"],r);let o=u(t,["state"]);o!=null&&d(e,["state"],mC(o));let i=u(t,["error"]);i!=null&&d(e,["error"],i);let s=u(t,["createTime"]);s!=null&&d(e,["createTime"],s);let a=u(t,["startTime"]);a!=null&&d(e,["startTime"],a);let l=u(t,["endTime"]);l!=null&&d(e,["endTime"],l);let c=u(t,["updateTime"]);c!=null&&d(e,["updateTime"],c);let f=u(t,["model"]);f!=null&&d(e,["model"],f);let m=u(t,["inputConfig"]);m!=null&&d(e,["src"],t$(m));let h=u(t,["outputConfig"]);h!=null&&d(e,["dest"],ZH(hC(h)));let y=u(t,["completionStats"]);return y!=null&&d(e,["completionStats"],y),e}function t$(t){let e={},n=u(t,["instancesFormat"]);n!=null&&d(e,["format"],n);let r=u(t,["gcsSource","uris"]);r!=null&&d(e,["gcsUri"],r);let o=u(t,["bigquerySource","inputUri"]);return o!=null&&d(e,["bigqueryUri"],o),e}function n$(t,e){let n={};if(u(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let r=u(e,["fileName"]);r!=null&&d(n,["fileName"],r);let o=u(e,["inlinedRequests"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>k$(t,s))),d(n,["requests","requests"],i)}return n}function r$(t){let e={},n=u(t,["format"]);n!=null&&d(e,["instancesFormat"],n);let r=u(t,["gcsUri"]);r!=null&&d(e,["gcsSource","uris"],r);let o=u(t,["bigqueryUri"]);if(o!=null&&d(e,["bigquerySource","inputUri"],o),u(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function o$(t){let e={},n=u(t,["data"]);if(n!=null&&d(e,["data"],n),u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function i$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],li(t,r)),n}function s$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],li(t,r)),n}function a$(t){let e={},n=u(t,["content"]);n!=null&&d(e,["content"],n);let r=u(t,["citationMetadata"]);r!=null&&d(e,["citationMetadata"],l$(r));let o=u(t,["tokenCount"]);o!=null&&d(e,["tokenCount"],o);let i=u(t,["finishReason"]);i!=null&&d(e,["finishReason"],i);let s=u(t,["avgLogprobs"]);s!=null&&d(e,["avgLogprobs"],s);let a=u(t,["groundingMetadata"]);a!=null&&d(e,["groundingMetadata"],a);let l=u(t,["index"]);l!=null&&d(e,["index"],l);let c=u(t,["logprobsResult"]);c!=null&&d(e,["logprobsResult"],c);let f=u(t,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(y=>y)),d(e,["safetyRatings"],h)}let m=u(t,["urlContextMetadata"]);return m!=null&&d(e,["urlContextMetadata"],m),e}function l$(t){let e={},n=u(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),d(e,["citations"],r)}return e}function gC(t){let e={},n=u(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>q$(i))),d(e,["parts"],o)}let r=u(t,["role"]);return r!=null&&d(e,["role"],r),e}function u$(t,e){let n={},r=u(t,["displayName"]);if(e!==void 0&&r!=null&&d(e,["batch","displayName"],r),u(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function c$(t,e){let n={},r=u(t,["displayName"]);e!==void 0&&r!=null&&d(e,["displayName"],r);let o=u(t,["dest"]);return e!==void 0&&o!=null&&d(e,["outputConfig"],e$(XH(o))),n}function NA(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["_url","model"],_e(t,r));let o=u(e,["src"]);o!=null&&d(n,["batch","inputConfig"],n$(t,pC(t,o)));let i=u(e,["config"]);return i!=null&&u$(i,n),n}function f$(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["model"],_e(t,r));let o=u(e,["src"]);o!=null&&d(n,["inputConfig"],r$(pC(t,o)));let i=u(e,["config"]);return i!=null&&c$(i,n),n}function d$(t,e){let n={},r=u(t,["displayName"]);return e!==void 0&&r!=null&&d(e,["batch","displayName"],r),n}function p$(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["_url","model"],_e(t,r));let o=u(e,["src"]);o!=null&&d(n,["batch","inputConfig"],T$(t,o));let i=u(e,["config"]);return i!=null&&d$(i,n),n}function h$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],li(t,r)),n}function m$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],li(t,r)),n}function g$(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["name"]);r!=null&&d(e,["name"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);return i!=null&&d(e,["error"],i),e}function y$(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["name"]);r!=null&&d(e,["name"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);return i!=null&&d(e,["error"],i),e}function _$(t,e){let n={},r=u(e,["contents"]);if(r!=null){let i=km(t,r);Array.isArray(i)&&(i=i.map(s=>s)),d(n,["requests[]","request","content"],i)}let o=u(e,["config"]);return o!=null&&(d(n,["_self"],S$(o,n)),TH(n,{"requests[].*":"requests[].request.*"})),n}function S$(t,e){let n={},r=u(t,["taskType"]);e!==void 0&&r!=null&&d(e,["requests[]","taskType"],r);let o=u(t,["title"]);e!==void 0&&o!=null&&d(e,["requests[]","title"],o);let i=u(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&d(e,["requests[]","outputDimensionality"],i),u(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function T$(t,e){let n={},r=u(e,["fileName"]);r!=null&&d(n,["file_name"],r);let o=u(e,["inlinedRequests"]);return o!=null&&d(n,["requests"],_$(t,o)),n}function E$(t){let e={};if(u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function w$(t){let e={},n=u(t,["id"]);n!=null&&d(e,["id"],n);let r=u(t,["args"]);r!=null&&d(e,["args"],r);let o=u(t,["name"]);if(o!=null&&d(e,["name"],o),u(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function v$(t){let e={},n=u(t,["allowedFunctionNames"]);n!=null&&d(e,["allowedFunctionNames"],n);let r=u(t,["mode"]);if(r!=null&&d(e,["mode"],r),u(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function A$(t,e,n){let r={},o=u(e,["systemInstruction"]);n!==void 0&&o!=null&&d(n,["systemInstruction"],gC(Ke(o)));let i=u(e,["temperature"]);i!=null&&d(r,["temperature"],i);let s=u(e,["topP"]);s!=null&&d(r,["topP"],s);let a=u(e,["topK"]);a!=null&&d(r,["topK"],a);let l=u(e,["candidateCount"]);l!=null&&d(r,["candidateCount"],l);let c=u(e,["maxOutputTokens"]);c!=null&&d(r,["maxOutputTokens"],c);let f=u(e,["stopSequences"]);f!=null&&d(r,["stopSequences"],f);let m=u(e,["responseLogprobs"]);m!=null&&d(r,["responseLogprobs"],m);let h=u(e,["logprobs"]);h!=null&&d(r,["logprobs"],h);let y=u(e,["presencePenalty"]);y!=null&&d(r,["presencePenalty"],y);let _=u(e,["frequencyPenalty"]);_!=null&&d(r,["frequencyPenalty"],_);let T=u(e,["seed"]);T!=null&&d(r,["seed"],T);let E=u(e,["responseMimeType"]);E!=null&&d(r,["responseMimeType"],E);let w=u(e,["responseSchema"]);w!=null&&d(r,["responseSchema"],Nm(w));let b=u(e,["responseJsonSchema"]);if(b!=null&&d(r,["responseJsonSchema"],b),u(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let L=u(e,["safetySettings"]);if(n!==void 0&&L!=null){let le=L;Array.isArray(le)&&(le=le.map(ue=>B$(ue))),d(n,["safetySettings"],le)}let D=u(e,["tools"]);if(n!==void 0&&D!=null){let le=ai(D);Array.isArray(le)&&(le=le.map(ue=>H$(si(ue)))),d(n,["tools"],le)}let I=u(e,["toolConfig"]);if(n!==void 0&&I!=null&&d(n,["toolConfig"],G$(I)),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=u(e,["cachedContent"]);n!==void 0&&P!=null&&d(n,["cachedContent"],Jn(t,P));let q=u(e,["responseModalities"]);q!=null&&d(r,["responseModalities"],q);let K=u(e,["mediaResolution"]);K!=null&&d(r,["mediaResolution"],K);let B=u(e,["speechConfig"]);if(B!=null&&d(r,["speechConfig"],Mm(B)),u(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let j=u(e,["thinkingConfig"]);j!=null&&d(r,["thinkingConfig"],j);let Q=u(e,["imageConfig"]);Q!=null&&d(r,["imageConfig"],P$(Q));let oe=u(e,["enableEnhancedCivicAnswers"]);if(oe!=null&&d(r,["enableEnhancedCivicAnswers"],oe),u(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function C$(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["candidates"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>a$(c))),d(e,["candidates"],l)}let o=u(t,["modelVersion"]);o!=null&&d(e,["modelVersion"],o);let i=u(t,["promptFeedback"]);i!=null&&d(e,["promptFeedback"],i);let s=u(t,["responseId"]);s!=null&&d(e,["responseId"],s);let a=u(t,["usageMetadata"]);return a!=null&&d(e,["usageMetadata"],a),e}function b$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],li(t,r)),n}function R$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],li(t,r)),n}function I$(t){let e={};if(u(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=u(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function x$(t){let e={};if(u(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=u(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function P$(t){let e={},n=u(t,["aspectRatio"]);n!=null&&d(e,["aspectRatio"],n);let r=u(t,["imageSize"]);if(r!=null&&d(e,["imageSize"],r),u(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(u(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function k$(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["request","model"],_e(t,r));let o=u(e,["contents"]);if(o!=null){let a=Vt(o);Array.isArray(a)&&(a=a.map(l=>gC(l))),d(n,["request","contents"],a)}let i=u(e,["metadata"]);i!=null&&d(n,["metadata"],i);let s=u(e,["config"]);return s!=null&&d(n,["request","generationConfig"],A$(t,s,u(n,["request"],{}))),n}function N$(t){let e={},n=u(t,["response"]);n!=null&&d(e,["response"],C$(n));let r=u(t,["metadata"]);r!=null&&d(e,["metadata"],r);let o=u(t,["error"]);return o!=null&&d(e,["error"],o),e}function M$(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);if(e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),u(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function O$(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);e!==void 0&&o!=null&&d(e,["_query","pageToken"],o);let i=u(t,["filter"]);return e!==void 0&&i!=null&&d(e,["_query","filter"],i),n}function D$(t){let e={},n=u(t,["config"]);return n!=null&&M$(n,e),e}function F$(t){let e={},n=u(t,["config"]);return n!=null&&O$(n,e),e}function L$(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["operations"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>Tu(s))),d(e,["batchJobs"],i)}return e}function U$(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["batchPredictionJobs"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>rm(s))),d(e,["batchJobs"],i)}return e}function q$(t){let e={},n=u(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);let r=u(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);let o=u(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);let i=u(t,["fileData"]);i!=null&&d(e,["fileData"],E$(i));let s=u(t,["functionCall"]);s!=null&&d(e,["functionCall"],w$(s));let a=u(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);let l=u(t,["inlineData"]);l!=null&&d(e,["inlineData"],o$(l));let c=u(t,["text"]);c!=null&&d(e,["text"],c);let f=u(t,["thought"]);f!=null&&d(e,["thought"],f);let m=u(t,["thoughtSignature"]);m!=null&&d(e,["thoughtSignature"],m);let h=u(t,["videoMetadata"]);return h!=null&&d(e,["videoMetadata"],h),e}function B$(t){let e={},n=u(t,["category"]);if(n!=null&&d(e,["category"],n),u(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=u(t,["threshold"]);return r!=null&&d(e,["threshold"],r),e}function G$(t){let e={},n=u(t,["retrievalConfig"]);n!=null&&d(e,["retrievalConfig"],n);let r=u(t,["functionCallingConfig"]);return r!=null&&d(e,["functionCallingConfig"],v$(r)),e}function H$(t){let e={};if(u(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(t,["computerUse"]);n!=null&&d(e,["computerUse"],n);let r=u(t,["fileSearch"]);r!=null&&d(e,["fileSearch"],r);let o=u(t,["codeExecution"]);if(o!=null&&d(e,["codeExecution"],o),u(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let i=u(t,["functionDeclarations"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(m=>m)),d(e,["functionDeclarations"],f)}let s=u(t,["googleMaps"]);s!=null&&d(e,["googleMaps"],I$(s));let a=u(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],x$(a));let l=u(t,["googleSearchRetrieval"]);l!=null&&d(e,["googleSearchRetrieval"],l);let c=u(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}C.PagedItem=void 0;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(C.PagedItem||(C.PagedItem={}));var bn=class{constructor(e,n,r,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,o)}init(e,n,r){var o,i;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n?.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(o=s.config)===null||o===void 0?void 0:o.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Uu=class extends ln{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new bn(C.PagedItem.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){let n=NA(this.apiClient,e),r=n._url,o=X("{model}:batchGenerateContent",r),a=n.batch.inputConfig.requests,l=a.requests,c=[];for(let f of l){let m=Object.assign({},f);if(m.systemInstruction){let h=m.systemInstruction;delete m.systemInstruction;let y=m.request;y.systemInstruction=h,m.request=y}c.push(m)}return a.requests=c,delete n.config,delete n._url,delete n._query,{path:o,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){let r=n?Object.assign({},n):{},o=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${o}`),r.dest===void 0){let i=this.getGcsUri(e),s=this.getBigqueryUri(e);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${o}`;else if(s)r.dest=`${s}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=f$(this.apiClient,e);return a=X("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>rm(f))}else{let c=NA(this.apiClient,e);return a=X("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>Tu(f))}}async createEmbeddingsInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=p$(this.apiClient,e);return i=X("{model}:asyncBatchEmbedContent",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>Tu(l))}}async get(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=R$(this.apiClient,e);return a=X("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>rm(f))}else{let c=b$(this.apiClient,e);return a=X("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>Tu(f))}}async cancel(e){var n,r,o,i;let s="",a={};if(this.apiClient.isVertexAI()){let l=s$(this.apiClient,e);s=X("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{let l=i$(this.apiClient,e);s=X("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=F$(e);return a=X("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=U$(f),h=new Us;return Object.assign(h,m),h})}else{let c=D$(e);return a=X("batches",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=L$(f),h=new Us;return Object.assign(h,m),h})}}async delete(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=m$(this.apiClient,e);return a=X("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>y$(f))}else{let c=h$(this.apiClient,e);return a=X("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>g$(f))}}};function $$(t){let e={},n=u(t,["data"]);if(n!=null&&d(e,["data"],n),u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function MA(t){let e={},n=u(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>dV(i))),d(e,["parts"],o)}let r=u(t,["role"]);return r!=null&&d(e,["role"],r),e}function V$(t,e){let n={},r=u(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);let o=u(t,["expireTime"]);e!==void 0&&o!=null&&d(e,["expireTime"],o);let i=u(t,["displayName"]);e!==void 0&&i!=null&&d(e,["displayName"],i);let s=u(t,["contents"]);if(e!==void 0&&s!=null){let f=Vt(s);Array.isArray(f)&&(f=f.map(m=>MA(m))),d(e,["contents"],f)}let a=u(t,["systemInstruction"]);e!==void 0&&a!=null&&d(e,["systemInstruction"],MA(Ke(a)));let l=u(t,["tools"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(m=>hV(m))),d(e,["tools"],f)}let c=u(t,["toolConfig"]);if(e!==void 0&&c!=null&&d(e,["toolConfig"],pV(c)),u(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function W$(t,e){let n={},r=u(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);let o=u(t,["expireTime"]);e!==void 0&&o!=null&&d(e,["expireTime"],o);let i=u(t,["displayName"]);e!==void 0&&i!=null&&d(e,["displayName"],i);let s=u(t,["contents"]);if(e!==void 0&&s!=null){let m=Vt(s);Array.isArray(m)&&(m=m.map(h=>h)),d(e,["contents"],m)}let a=u(t,["systemInstruction"]);e!==void 0&&a!=null&&d(e,["systemInstruction"],Ke(a));let l=u(t,["tools"]);if(e!==void 0&&l!=null){let m=l;Array.isArray(m)&&(m=m.map(h=>mV(h))),d(e,["tools"],m)}let c=u(t,["toolConfig"]);e!==void 0&&c!=null&&d(e,["toolConfig"],c);let f=u(t,["kmsKeyName"]);return e!==void 0&&f!=null&&d(e,["encryption_spec","kmsKeyName"],f),n}function J$(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["model"],rC(t,r));let o=u(e,["config"]);return o!=null&&V$(o,n),n}function z$(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["model"],rC(t,r));let o=u(e,["config"]);return o!=null&&W$(o,n),n}function K$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],Jn(t,r)),n}function Y$(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],Jn(t,r)),n}function j$(t){let e={},n=u(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function X$(t){let e={},n=u(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function Q$(t){let e={};if(u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function Z$(t){let e={},n=u(t,["id"]);n!=null&&d(e,["id"],n);let r=u(t,["args"]);r!=null&&d(e,["args"],r);let o=u(t,["name"]);if(o!=null&&d(e,["name"],o),u(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eV(t){let e={},n=u(t,["allowedFunctionNames"]);n!=null&&d(e,["allowedFunctionNames"],n);let r=u(t,["mode"]);if(r!=null&&d(e,["mode"],r),u(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function tV(t){let e={},n=u(t,["description"]);n!=null&&d(e,["description"],n);let r=u(t,["name"]);r!=null&&d(e,["name"],r);let o=u(t,["parameters"]);o!=null&&d(e,["parameters"],o);let i=u(t,["parametersJsonSchema"]);i!=null&&d(e,["parametersJsonSchema"],i);let s=u(t,["response"]);s!=null&&d(e,["response"],s);let a=u(t,["responseJsonSchema"]);if(a!=null&&d(e,["responseJsonSchema"],a),u(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function nV(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],Jn(t,r)),n}function rV(t,e){let n={},r=u(e,["name"]);return r!=null&&d(n,["_url","name"],Jn(t,r)),n}function oV(t){let e={};if(u(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=u(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function iV(t){let e={};if(u(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=u(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function sV(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function aV(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function lV(t){let e={},n=u(t,["config"]);return n!=null&&sV(n,e),e}function uV(t){let e={},n=u(t,["config"]);return n!=null&&aV(n,e),e}function cV(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["cachedContents"],i)}return e}function fV(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["cachedContents"],i)}return e}function dV(t){let e={},n=u(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);let r=u(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);let o=u(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);let i=u(t,["fileData"]);i!=null&&d(e,["fileData"],Q$(i));let s=u(t,["functionCall"]);s!=null&&d(e,["functionCall"],Z$(s));let a=u(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);let l=u(t,["inlineData"]);l!=null&&d(e,["inlineData"],$$(l));let c=u(t,["text"]);c!=null&&d(e,["text"],c);let f=u(t,["thought"]);f!=null&&d(e,["thought"],f);let m=u(t,["thoughtSignature"]);m!=null&&d(e,["thoughtSignature"],m);let h=u(t,["videoMetadata"]);return h!=null&&d(e,["videoMetadata"],h),e}function pV(t){let e={},n=u(t,["retrievalConfig"]);n!=null&&d(e,["retrievalConfig"],n);let r=u(t,["functionCallingConfig"]);return r!=null&&d(e,["functionCallingConfig"],eV(r)),e}function hV(t){let e={};if(u(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(t,["computerUse"]);n!=null&&d(e,["computerUse"],n);let r=u(t,["fileSearch"]);r!=null&&d(e,["fileSearch"],r);let o=u(t,["codeExecution"]);if(o!=null&&d(e,["codeExecution"],o),u(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let i=u(t,["functionDeclarations"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(m=>m)),d(e,["functionDeclarations"],f)}let s=u(t,["googleMaps"]);s!=null&&d(e,["googleMaps"],oV(s));let a=u(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],iV(a));let l=u(t,["googleSearchRetrieval"]);l!=null&&d(e,["googleSearchRetrieval"],l);let c=u(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}function mV(t){let e={},n=u(t,["retrieval"]);n!=null&&d(e,["retrieval"],n);let r=u(t,["computerUse"]);if(r!=null&&d(e,["computerUse"],r),u(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=u(t,["codeExecution"]);o!=null&&d(e,["codeExecution"],o);let i=u(t,["enterpriseWebSearch"]);i!=null&&d(e,["enterpriseWebSearch"],i);let s=u(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(h=>tV(h))),d(e,["functionDeclarations"],m)}let a=u(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],a);let l=u(t,["googleSearch"]);l!=null&&d(e,["googleSearch"],l);let c=u(t,["googleSearchRetrieval"]);c!=null&&d(e,["googleSearchRetrieval"],c);let f=u(t,["urlContext"]);return f!=null&&d(e,["urlContext"],f),e}function gV(t,e){let n={},r=u(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);let o=u(t,["expireTime"]);return e!==void 0&&o!=null&&d(e,["expireTime"],o),n}function yV(t,e){let n={},r=u(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);let o=u(t,["expireTime"]);return e!==void 0&&o!=null&&d(e,["expireTime"],o),n}function _V(t,e){let n={},r=u(e,["name"]);r!=null&&d(n,["_url","name"],Jn(t,r));let o=u(e,["config"]);return o!=null&&gV(o,n),n}function SV(t,e){let n={},r=u(e,["name"]);r!=null&&d(n,["_url","name"],Jn(t,r));let o=u(e,["config"]);return o!=null&&yV(o,n),n}var qu=class extends ln{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new bn(C.PagedItem.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=z$(this.apiClient,e);return a=X("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>f)}else{let c=J$(this.apiClient,e);return a=X("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async get(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=rV(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>f)}else{let c=nV(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Y$(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=X$(f),h=new Fs;return Object.assign(h,m),h})}else{let c=K$(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=j$(f),h=new Fs;return Object.assign(h,m),h})}}async update(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=SV(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>f)}else{let c=_V(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async listInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=uV(e);return a=X("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=fV(f),h=new Ls;return Object.assign(h,m),h})}else{let c=lV(e);return a=X("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=cV(f),h=new Ls;return Object.assign(h,m),h})}}};function Bu(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function OA(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fe(t){return this instanceof fe?(this.v=t,this):new fe(t)}function sn(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(y){return function(_){return Promise.resolve(_).then(y,m)}}function a(y,_){r[y]&&(o[y]=function(T){return new Promise(function(E,w){i.push([y,T,E,w])>1||l(y,T)})},_&&(o[y]=_(o[y])))}function l(y,_){try{c(r[y](_))}catch(T){h(i[0][3],T)}}function c(y){y.value instanceof fe?Promise.resolve(y.value.v).then(f,m):h(i[0][2],y)}function f(y){l("next",y)}function m(y){l("throw",y)}function h(y,_){y(_),i.shift(),i.length&&l(i[0][0],i[0][1])}}function an(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof OA=="function"?OA(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}function TV(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;let n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:yC(n)}function yC(t){if(t.parts===void 0||t.parts.length===0)return!1;for(let e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function EV(t){if(t.length!==0){for(let e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function DA(t){if(t===void 0||t.length===0)return[];let e=[],n=t.length,r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{let o=[],i=!0;for(;r<n&&t[r].role==="model";)o.push(t[r]),i&&!yC(t[r])&&(i=!1),r++;i?e.push(...o):e.pop()}return e}var Gu=class{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new Hu(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Hu=class{constructor(e,n,r,o={},i=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=o,this.history=i,this.sendPromise=Promise.resolve(),EV(i)}async sendMessage(e){var n;await this.sendPromise;let r=Ke(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var i,s,a;let l=await o,c=(s=(i=l.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,f=l.automaticFunctionCallingHistory,m=this.getHistory(!0).length,h=[];f!=null&&(h=(a=f.slice(m))!==null&&a!==void 0?a:[]);let y=c?[c]:[];this.recordHistory(r,y,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;let r=Ke(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});let i=await o;return this.processStreamResponse(i,r)}getHistory(e=!1){let n=e?DA(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return sn(this,arguments,function*(){var o,i,s,a,l,c;let f=[];try{for(var m=!0,h=an(e),y;y=yield fe(h.next()),o=y.done,!o;m=!0){a=y.value,m=!1;let _=a;if(TV(_)){let T=(c=(l=_.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content;T!==void 0&&f.push(T)}yield yield fe(_)}}catch(_){i={error:_}}finally{try{!m&&!o&&(s=h.return)&&(yield fe(s.call(h)))}finally{if(i)throw i.error}}this.recordHistory(n,f)})}recordHistory(e,n,r){let o=[];n.length>0&&n.every(i=>i.role!==void 0)?o=n:o.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...DA(r)):this.history.push(e),this.history.push(...o)}};var ri=class t extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,t.prototype)}};function wV(t){let e={},n=u(t,["file"]);return n!=null&&d(e,["file"],n),e}function vV(t){let e={},n=u(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function AV(t){let e={},n=u(t,["name"]);return n!=null&&d(e,["_url","file"],Dm(n)),e}function CV(t){let e={},n=u(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function bV(t){let e={},n=u(t,["name"]);return n!=null&&d(e,["_url","file"],Dm(n)),e}function RV(t){let e={},n=u(t,["uris"]);return n!=null&&d(e,["uris"],n),e}function IV(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function xV(t){let e={},n=u(t,["config"]);return n!=null&&IV(n,e),e}function PV(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["files"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["files"],i)}return e}function kV(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["files"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),d(e,["files"],o)}return e}var $u=class extends ln{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new bn(C.PagedItem.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=xV(e);return i=X("files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>{let c=PV(l),f=new ku;return Object.assign(f,c),f})}}async createInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=wV(e);return i=X("upload/v1beta/files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=vV(l),f=new Nu;return Object.assign(f,c),f})}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=bV(e);return i=X("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>l)}}async delete(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=AV(e);return i=X("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>{let c=CV(l),f=new Mu;return Object.assign(f,c),f})}}async registerFilesInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=RV(e);return i=X("files:register",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=kV(l),f=new Ou;return Object.assign(f,c),f})}}};function Eu(t){let e={},n=u(t,["data"]);if(n!=null&&d(e,["data"],n),u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function NV(t){let e={},n=u(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>KV(i))),d(e,["parts"],o)}let r=u(t,["role"]);return r!=null&&d(e,["role"],r),e}function MV(t){let e={};if(u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function OV(t){let e={},n=u(t,["id"]);n!=null&&d(e,["id"],n);let r=u(t,["args"]);r!=null&&d(e,["args"],r);let o=u(t,["name"]);if(o!=null&&d(e,["name"],o),u(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function DV(t){let e={},n=u(t,["description"]);n!=null&&d(e,["description"],n);let r=u(t,["name"]);r!=null&&d(e,["name"],r);let o=u(t,["parameters"]);o!=null&&d(e,["parameters"],o);let i=u(t,["parametersJsonSchema"]);i!=null&&d(e,["parametersJsonSchema"],i);let s=u(t,["response"]);s!=null&&d(e,["response"],s);let a=u(t,["responseJsonSchema"]);if(a!=null&&d(e,["responseJsonSchema"],a),u(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function FV(t){let e={},n=u(t,["modelSelectionConfig"]);n!=null&&d(e,["modelConfig"],n);let r=u(t,["responseJsonSchema"]);r!=null&&d(e,["responseJsonSchema"],r);let o=u(t,["audioTimestamp"]);o!=null&&d(e,["audioTimestamp"],o);let i=u(t,["candidateCount"]);i!=null&&d(e,["candidateCount"],i);let s=u(t,["enableAffectiveDialog"]);s!=null&&d(e,["enableAffectiveDialog"],s);let a=u(t,["frequencyPenalty"]);a!=null&&d(e,["frequencyPenalty"],a);let l=u(t,["logprobs"]);l!=null&&d(e,["logprobs"],l);let c=u(t,["maxOutputTokens"]);c!=null&&d(e,["maxOutputTokens"],c);let f=u(t,["mediaResolution"]);f!=null&&d(e,["mediaResolution"],f);let m=u(t,["presencePenalty"]);m!=null&&d(e,["presencePenalty"],m);let h=u(t,["responseLogprobs"]);h!=null&&d(e,["responseLogprobs"],h);let y=u(t,["responseMimeType"]);y!=null&&d(e,["responseMimeType"],y);let _=u(t,["responseModalities"]);_!=null&&d(e,["responseModalities"],_);let T=u(t,["responseSchema"]);T!=null&&d(e,["responseSchema"],T);let E=u(t,["routingConfig"]);E!=null&&d(e,["routingConfig"],E);let w=u(t,["seed"]);w!=null&&d(e,["seed"],w);let b=u(t,["speechConfig"]);b!=null&&d(e,["speechConfig"],b);let L=u(t,["stopSequences"]);L!=null&&d(e,["stopSequences"],L);let D=u(t,["temperature"]);D!=null&&d(e,["temperature"],D);let I=u(t,["thinkingConfig"]);I!=null&&d(e,["thinkingConfig"],I);let P=u(t,["topK"]);P!=null&&d(e,["topK"],P);let q=u(t,["topP"]);if(q!=null&&d(e,["topP"],q),u(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function LV(t){let e={};if(u(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=u(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function UV(t){let e={};if(u(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=u(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function qV(t,e){let n={},r=u(t,["generationConfig"]);e!==void 0&&r!=null&&d(e,["setup","generationConfig"],r);let o=u(t,["responseModalities"]);e!==void 0&&o!=null&&d(e,["setup","generationConfig","responseModalities"],o);let i=u(t,["temperature"]);e!==void 0&&i!=null&&d(e,["setup","generationConfig","temperature"],i);let s=u(t,["topP"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig","topP"],s);let a=u(t,["topK"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","topK"],a);let l=u(t,["maxOutputTokens"]);e!==void 0&&l!=null&&d(e,["setup","generationConfig","maxOutputTokens"],l);let c=u(t,["mediaResolution"]);e!==void 0&&c!=null&&d(e,["setup","generationConfig","mediaResolution"],c);let f=u(t,["seed"]);e!==void 0&&f!=null&&d(e,["setup","generationConfig","seed"],f);let m=u(t,["speechConfig"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","speechConfig"],Om(m));let h=u(t,["thinkingConfig"]);e!==void 0&&h!=null&&d(e,["setup","generationConfig","thinkingConfig"],h);let y=u(t,["enableAffectiveDialog"]);e!==void 0&&y!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],y);let _=u(t,["systemInstruction"]);e!==void 0&&_!=null&&d(e,["setup","systemInstruction"],NV(Ke(_)));let T=u(t,["tools"]);if(e!==void 0&&T!=null){let P=ai(T);Array.isArray(P)&&(P=P.map(q=>jV(si(q)))),d(e,["setup","tools"],P)}let E=u(t,["sessionResumption"]);e!==void 0&&E!=null&&d(e,["setup","sessionResumption"],YV(E));let w=u(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&d(e,["setup","inputAudioTranscription"],w);let b=u(t,["outputAudioTranscription"]);e!==void 0&&b!=null&&d(e,["setup","outputAudioTranscription"],b);let L=u(t,["realtimeInputConfig"]);e!==void 0&&L!=null&&d(e,["setup","realtimeInputConfig"],L);let D=u(t,["contextWindowCompression"]);e!==void 0&&D!=null&&d(e,["setup","contextWindowCompression"],D);let I=u(t,["proactivity"]);if(e!==void 0&&I!=null&&d(e,["setup","proactivity"],I),u(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function BV(t,e){let n={},r=u(t,["generationConfig"]);e!==void 0&&r!=null&&d(e,["setup","generationConfig"],FV(r));let o=u(t,["responseModalities"]);e!==void 0&&o!=null&&d(e,["setup","generationConfig","responseModalities"],o);let i=u(t,["temperature"]);e!==void 0&&i!=null&&d(e,["setup","generationConfig","temperature"],i);let s=u(t,["topP"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig","topP"],s);let a=u(t,["topK"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","topK"],a);let l=u(t,["maxOutputTokens"]);e!==void 0&&l!=null&&d(e,["setup","generationConfig","maxOutputTokens"],l);let c=u(t,["mediaResolution"]);e!==void 0&&c!=null&&d(e,["setup","generationConfig","mediaResolution"],c);let f=u(t,["seed"]);e!==void 0&&f!=null&&d(e,["setup","generationConfig","seed"],f);let m=u(t,["speechConfig"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","speechConfig"],Om(m));let h=u(t,["thinkingConfig"]);e!==void 0&&h!=null&&d(e,["setup","generationConfig","thinkingConfig"],h);let y=u(t,["enableAffectiveDialog"]);e!==void 0&&y!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],y);let _=u(t,["systemInstruction"]);e!==void 0&&_!=null&&d(e,["setup","systemInstruction"],Ke(_));let T=u(t,["tools"]);if(e!==void 0&&T!=null){let q=ai(T);Array.isArray(q)&&(q=q.map(K=>XV(si(K)))),d(e,["setup","tools"],q)}let E=u(t,["sessionResumption"]);e!==void 0&&E!=null&&d(e,["setup","sessionResumption"],E);let w=u(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&d(e,["setup","inputAudioTranscription"],w);let b=u(t,["outputAudioTranscription"]);e!==void 0&&b!=null&&d(e,["setup","outputAudioTranscription"],b);let L=u(t,["realtimeInputConfig"]);e!==void 0&&L!=null&&d(e,["setup","realtimeInputConfig"],L);let D=u(t,["contextWindowCompression"]);e!==void 0&&D!=null&&d(e,["setup","contextWindowCompression"],D);let I=u(t,["proactivity"]);e!==void 0&&I!=null&&d(e,["setup","proactivity"],I);let P=u(t,["explicitVadSignal"]);return e!==void 0&&P!=null&&d(e,["setup","explicitVadSignal"],P),n}function GV(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["setup","model"],_e(t,r));let o=u(e,["config"]);return o!=null&&d(n,["config"],qV(o,n)),n}function HV(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["setup","model"],_e(t,r));let o=u(e,["config"]);return o!=null&&d(n,["config"],BV(o,n)),n}function $V(t){let e={},n=u(t,["musicGenerationConfig"]);return n!=null&&d(e,["musicGenerationConfig"],n),e}function VV(t){let e={},n=u(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),d(e,["weightedPrompts"],r)}return e}function WV(t){let e={},n=u(t,["media"]);if(n!=null){let c=oC(n);Array.isArray(c)&&(c=c.map(f=>Eu(f))),d(e,["mediaChunks"],c)}let r=u(t,["audio"]);r!=null&&d(e,["audio"],Eu(sC(r)));let o=u(t,["audioStreamEnd"]);o!=null&&d(e,["audioStreamEnd"],o);let i=u(t,["video"]);i!=null&&d(e,["video"],Eu(iC(i)));let s=u(t,["text"]);s!=null&&d(e,["text"],s);let a=u(t,["activityStart"]);a!=null&&d(e,["activityStart"],a);let l=u(t,["activityEnd"]);return l!=null&&d(e,["activityEnd"],l),e}function JV(t){let e={},n=u(t,["media"]);if(n!=null){let c=oC(n);Array.isArray(c)&&(c=c.map(f=>f)),d(e,["mediaChunks"],c)}let r=u(t,["audio"]);r!=null&&d(e,["audio"],sC(r));let o=u(t,["audioStreamEnd"]);o!=null&&d(e,["audioStreamEnd"],o);let i=u(t,["video"]);i!=null&&d(e,["video"],iC(i));let s=u(t,["text"]);s!=null&&d(e,["text"],s);let a=u(t,["activityStart"]);a!=null&&d(e,["activityStart"],a);let l=u(t,["activityEnd"]);return l!=null&&d(e,["activityEnd"],l),e}function zV(t){let e={},n=u(t,["setupComplete"]);n!=null&&d(e,["setupComplete"],n);let r=u(t,["serverContent"]);r!=null&&d(e,["serverContent"],r);let o=u(t,["toolCall"]);o!=null&&d(e,["toolCall"],o);let i=u(t,["toolCallCancellation"]);i!=null&&d(e,["toolCallCancellation"],i);let s=u(t,["usageMetadata"]);s!=null&&d(e,["usageMetadata"],QV(s));let a=u(t,["goAway"]);a!=null&&d(e,["goAway"],a);let l=u(t,["sessionResumptionUpdate"]);l!=null&&d(e,["sessionResumptionUpdate"],l);let c=u(t,["voiceActivityDetectionSignal"]);c!=null&&d(e,["voiceActivityDetectionSignal"],c);let f=u(t,["voiceActivity"]);return f!=null&&d(e,["voiceActivity"],ZV(f)),e}function KV(t){let e={},n=u(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);let r=u(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);let o=u(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);let i=u(t,["fileData"]);i!=null&&d(e,["fileData"],MV(i));let s=u(t,["functionCall"]);s!=null&&d(e,["functionCall"],OV(s));let a=u(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);let l=u(t,["inlineData"]);l!=null&&d(e,["inlineData"],Eu(l));let c=u(t,["text"]);c!=null&&d(e,["text"],c);let f=u(t,["thought"]);f!=null&&d(e,["thought"],f);let m=u(t,["thoughtSignature"]);m!=null&&d(e,["thoughtSignature"],m);let h=u(t,["videoMetadata"]);return h!=null&&d(e,["videoMetadata"],h),e}function YV(t){let e={},n=u(t,["handle"]);if(n!=null&&d(e,["handle"],n),u(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function jV(t){let e={};if(u(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(t,["computerUse"]);n!=null&&d(e,["computerUse"],n);let r=u(t,["fileSearch"]);r!=null&&d(e,["fileSearch"],r);let o=u(t,["codeExecution"]);if(o!=null&&d(e,["codeExecution"],o),u(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let i=u(t,["functionDeclarations"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(m=>m)),d(e,["functionDeclarations"],f)}let s=u(t,["googleMaps"]);s!=null&&d(e,["googleMaps"],LV(s));let a=u(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],UV(a));let l=u(t,["googleSearchRetrieval"]);l!=null&&d(e,["googleSearchRetrieval"],l);let c=u(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}function XV(t){let e={},n=u(t,["retrieval"]);n!=null&&d(e,["retrieval"],n);let r=u(t,["computerUse"]);if(r!=null&&d(e,["computerUse"],r),u(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let o=u(t,["codeExecution"]);o!=null&&d(e,["codeExecution"],o);let i=u(t,["enterpriseWebSearch"]);i!=null&&d(e,["enterpriseWebSearch"],i);let s=u(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(h=>DV(h))),d(e,["functionDeclarations"],m)}let a=u(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],a);let l=u(t,["googleSearch"]);l!=null&&d(e,["googleSearch"],l);let c=u(t,["googleSearchRetrieval"]);c!=null&&d(e,["googleSearchRetrieval"],c);let f=u(t,["urlContext"]);return f!=null&&d(e,["urlContext"],f),e}function QV(t){let e={},n=u(t,["promptTokenCount"]);n!=null&&d(e,["promptTokenCount"],n);let r=u(t,["cachedContentTokenCount"]);r!=null&&d(e,["cachedContentTokenCount"],r);let o=u(t,["candidatesTokenCount"]);o!=null&&d(e,["responseTokenCount"],o);let i=u(t,["toolUsePromptTokenCount"]);i!=null&&d(e,["toolUsePromptTokenCount"],i);let s=u(t,["thoughtsTokenCount"]);s!=null&&d(e,["thoughtsTokenCount"],s);let a=u(t,["totalTokenCount"]);a!=null&&d(e,["totalTokenCount"],a);let l=u(t,["promptTokensDetails"]);if(l!=null){let y=l;Array.isArray(y)&&(y=y.map(_=>_)),d(e,["promptTokensDetails"],y)}let c=u(t,["cacheTokensDetails"]);if(c!=null){let y=c;Array.isArray(y)&&(y=y.map(_=>_)),d(e,["cacheTokensDetails"],y)}let f=u(t,["candidatesTokensDetails"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(_=>_)),d(e,["responseTokensDetails"],y)}let m=u(t,["toolUsePromptTokensDetails"]);if(m!=null){let y=m;Array.isArray(y)&&(y=y.map(_=>_)),d(e,["toolUsePromptTokensDetails"],y)}let h=u(t,["trafficType"]);return h!=null&&d(e,["trafficType"],h),e}function ZV(t){let e={},n=u(t,["type"]);return n!=null&&d(e,["voiceActivityType"],n),e}function e2(t,e){let n={},r=u(t,["data"]);if(r!=null&&d(n,["data"],r),u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let o=u(t,["mimeType"]);return o!=null&&d(n,["mimeType"],o),n}function t2(t,e){let n={},r=u(t,["content"]);r!=null&&d(n,["content"],r);let o=u(t,["citationMetadata"]);o!=null&&d(n,["citationMetadata"],n2(o));let i=u(t,["tokenCount"]);i!=null&&d(n,["tokenCount"],i);let s=u(t,["finishReason"]);s!=null&&d(n,["finishReason"],s);let a=u(t,["avgLogprobs"]);a!=null&&d(n,["avgLogprobs"],a);let l=u(t,["groundingMetadata"]);l!=null&&d(n,["groundingMetadata"],l);let c=u(t,["index"]);c!=null&&d(n,["index"],c);let f=u(t,["logprobsResult"]);f!=null&&d(n,["logprobsResult"],f);let m=u(t,["safetyRatings"]);if(m!=null){let y=m;Array.isArray(y)&&(y=y.map(_=>_)),d(n,["safetyRatings"],y)}let h=u(t,["urlContextMetadata"]);return h!=null&&d(n,["urlContextMetadata"],h),n}function n2(t,e){let n={},r=u(t,["citationSources"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),d(n,["citations"],o)}return n}function r2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let s=Vt(i);Array.isArray(s)&&(s=s.map(a=>a)),d(r,["contents"],s)}return r}function o2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["tokensInfo"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(n,["tokensInfo"],i)}return n}function i2(t,e){let n={},r=u(t,["values"]);r!=null&&d(n,["values"],r);let o=u(t,["statistics"]);return o!=null&&d(n,["statistics"],s2(o)),n}function s2(t,e){let n={},r=u(t,["truncated"]);r!=null&&d(n,["truncated"],r);let o=u(t,["token_count"]);return o!=null&&d(n,["tokenCount"],o),n}function uc(t,e){let n={},r=u(t,["parts"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>mW(s))),d(n,["parts"],i)}let o=u(t,["role"]);return o!=null&&d(n,["role"],o),n}function a2(t,e){let n={},r=u(t,["controlType"]);r!=null&&d(n,["controlType"],r);let o=u(t,["enableControlImageComputation"]);return o!=null&&d(n,["computeControl"],o),n}function l2(t,e){let n={};if(u(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(u(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(u(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return n}function u2(t,e,n){let r={},o=u(t,["systemInstruction"]);e!==void 0&&o!=null&&d(e,["systemInstruction"],Ke(o));let i=u(t,["tools"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>EC(l))),d(e,["tools"],a)}let s=u(t,["generationConfig"]);return e!==void 0&&s!=null&&d(e,["generationConfig"],eW(s)),r}function c2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let a=Vt(i);Array.isArray(a)&&(a=a.map(l=>uc(l))),d(r,["contents"],a)}let s=u(e,["config"]);return s!=null&&l2(s),r}function f2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let a=Vt(i);Array.isArray(a)&&(a=a.map(l=>l)),d(r,["contents"],a)}let s=u(e,["config"]);return s!=null&&u2(s,r),r}function d2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["totalTokens"]);o!=null&&d(n,["totalTokens"],o);let i=u(t,["cachedContentTokenCount"]);return i!=null&&d(n,["cachedContentTokenCount"],i),n}function p2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["totalTokens"]);return o!=null&&d(n,["totalTokens"],o),n}function h2(t,e,n){let r={},o=u(e,["model"]);return o!=null&&d(r,["_url","name"],_e(t,o)),r}function m2(t,e,n){let r={},o=u(e,["model"]);return o!=null&&d(r,["_url","name"],_e(t,o)),r}function g2(t,e){let n={},r=u(t,["sdkHttpResponse"]);return r!=null&&d(n,["sdkHttpResponse"],r),n}function y2(t,e){let n={},r=u(t,["sdkHttpResponse"]);return r!=null&&d(n,["sdkHttpResponse"],r),n}function _2(t,e,n){let r={},o=u(t,["outputGcsUri"]);e!==void 0&&o!=null&&d(e,["parameters","storageUri"],o);let i=u(t,["negativePrompt"]);e!==void 0&&i!=null&&d(e,["parameters","negativePrompt"],i);let s=u(t,["numberOfImages"]);e!==void 0&&s!=null&&d(e,["parameters","sampleCount"],s);let a=u(t,["aspectRatio"]);e!==void 0&&a!=null&&d(e,["parameters","aspectRatio"],a);let l=u(t,["guidanceScale"]);e!==void 0&&l!=null&&d(e,["parameters","guidanceScale"],l);let c=u(t,["seed"]);e!==void 0&&c!=null&&d(e,["parameters","seed"],c);let f=u(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&d(e,["parameters","safetySetting"],f);let m=u(t,["personGeneration"]);e!==void 0&&m!=null&&d(e,["parameters","personGeneration"],m);let h=u(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&d(e,["parameters","includeSafetyAttributes"],h);let y=u(t,["includeRaiReason"]);e!==void 0&&y!=null&&d(e,["parameters","includeRaiReason"],y);let _=u(t,["language"]);e!==void 0&&_!=null&&d(e,["parameters","language"],_);let T=u(t,["outputMimeType"]);e!==void 0&&T!=null&&d(e,["parameters","outputOptions","mimeType"],T);let E=u(t,["outputCompressionQuality"]);e!==void 0&&E!=null&&d(e,["parameters","outputOptions","compressionQuality"],E);let w=u(t,["addWatermark"]);e!==void 0&&w!=null&&d(e,["parameters","addWatermark"],w);let b=u(t,["labels"]);e!==void 0&&b!=null&&d(e,["labels"],b);let L=u(t,["editMode"]);e!==void 0&&L!=null&&d(e,["parameters","editMode"],L);let D=u(t,["baseSteps"]);return e!==void 0&&D!=null&&d(e,["parameters","editConfig","baseSteps"],D),r}function S2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["prompt"]);i!=null&&d(r,["instances[0]","prompt"],i);let s=u(e,["referenceImages"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>EW(c))),d(r,["instances[0]","referenceImages"],l)}let a=u(e,["config"]);return a!=null&&_2(a,r),r}function T2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>cc(s))),d(n,["generatedImages"],i)}return n}function E2(t,e,n){let r={},o=u(t,["taskType"]);e!==void 0&&o!=null&&d(e,["requests[]","taskType"],o);let i=u(t,["title"]);e!==void 0&&i!=null&&d(e,["requests[]","title"],i);let s=u(t,["outputDimensionality"]);if(e!==void 0&&s!=null&&d(e,["requests[]","outputDimensionality"],s),u(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return r}function w2(t,e,n){let r={},o=u(t,["taskType"]);e!==void 0&&o!=null&&d(e,["instances[]","task_type"],o);let i=u(t,["title"]);e!==void 0&&i!=null&&d(e,["instances[]","title"],i);let s=u(t,["outputDimensionality"]);e!==void 0&&s!=null&&d(e,["parameters","outputDimensionality"],s);let a=u(t,["mimeType"]);e!==void 0&&a!=null&&d(e,["instances[]","mimeType"],a);let l=u(t,["autoTruncate"]);return e!==void 0&&l!=null&&d(e,["parameters","autoTruncate"],l),r}function v2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let l=km(t,i);Array.isArray(l)&&(l=l.map(c=>c)),d(r,["requests[]","content"],l)}let s=u(e,["config"]);s!=null&&E2(s,r);let a=u(e,["model"]);return a!==void 0&&d(r,["requests[]","model"],_e(t,a)),r}function A2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let a=km(t,i);Array.isArray(a)&&(a=a.map(l=>l)),d(r,["instances[]","content"],a)}let s=u(e,["config"]);return s!=null&&w2(s,r),r}function C2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["embeddings"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>a)),d(n,["embeddings"],s)}let i=u(t,["metadata"]);return i!=null&&d(n,["metadata"],i),n}function b2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["predictions[]","embeddings"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>i2(a))),d(n,["embeddings"],s)}let i=u(t,["metadata"]);return i!=null&&d(n,["metadata"],i),n}function R2(t,e){let n={},r=u(t,["endpoint"]);r!=null&&d(n,["name"],r);let o=u(t,["deployedModelId"]);return o!=null&&d(n,["deployedModelId"],o),n}function I2(t,e){let n={};if(u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=u(t,["fileUri"]);r!=null&&d(n,["fileUri"],r);let o=u(t,["mimeType"]);return o!=null&&d(n,["mimeType"],o),n}function x2(t,e){let n={},r=u(t,["id"]);r!=null&&d(n,["id"],r);let o=u(t,["args"]);o!=null&&d(n,["args"],o);let i=u(t,["name"]);if(i!=null&&d(n,["name"],i),u(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return n}function P2(t,e){let n={},r=u(t,["allowedFunctionNames"]);r!=null&&d(n,["allowedFunctionNames"],r);let o=u(t,["mode"]);if(o!=null&&d(n,["mode"],o),u(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return n}function k2(t,e){let n={},r=u(t,["description"]);r!=null&&d(n,["description"],r);let o=u(t,["name"]);o!=null&&d(n,["name"],o);let i=u(t,["parameters"]);i!=null&&d(n,["parameters"],i);let s=u(t,["parametersJsonSchema"]);s!=null&&d(n,["parametersJsonSchema"],s);let a=u(t,["response"]);a!=null&&d(n,["response"],a);let l=u(t,["responseJsonSchema"]);if(l!=null&&d(n,["responseJsonSchema"],l),u(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return n}function N2(t,e,n,r){let o={},i=u(e,["systemInstruction"]);n!==void 0&&i!=null&&d(n,["systemInstruction"],uc(Ke(i)));let s=u(e,["temperature"]);s!=null&&d(o,["temperature"],s);let a=u(e,["topP"]);a!=null&&d(o,["topP"],a);let l=u(e,["topK"]);l!=null&&d(o,["topK"],l);let c=u(e,["candidateCount"]);c!=null&&d(o,["candidateCount"],c);let f=u(e,["maxOutputTokens"]);f!=null&&d(o,["maxOutputTokens"],f);let m=u(e,["stopSequences"]);m!=null&&d(o,["stopSequences"],m);let h=u(e,["responseLogprobs"]);h!=null&&d(o,["responseLogprobs"],h);let y=u(e,["logprobs"]);y!=null&&d(o,["logprobs"],y);let _=u(e,["presencePenalty"]);_!=null&&d(o,["presencePenalty"],_);let T=u(e,["frequencyPenalty"]);T!=null&&d(o,["frequencyPenalty"],T);let E=u(e,["seed"]);E!=null&&d(o,["seed"],E);let w=u(e,["responseMimeType"]);w!=null&&d(o,["responseMimeType"],w);let b=u(e,["responseSchema"]);b!=null&&d(o,["responseSchema"],Nm(b));let L=u(e,["responseJsonSchema"]);if(L!=null&&d(o,["responseJsonSchema"],L),u(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let D=u(e,["safetySettings"]);if(n!==void 0&&D!=null){let ue=D;Array.isArray(ue)&&(ue=ue.map(ye=>wW(ye))),d(n,["safetySettings"],ue)}let I=u(e,["tools"]);if(n!==void 0&&I!=null){let ue=ai(I);Array.isArray(ue)&&(ue=ue.map(ye=>xW(si(ye)))),d(n,["tools"],ue)}let P=u(e,["toolConfig"]);if(n!==void 0&&P!=null&&d(n,["toolConfig"],IW(P)),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let q=u(e,["cachedContent"]);n!==void 0&&q!=null&&d(n,["cachedContent"],Jn(t,q));let K=u(e,["responseModalities"]);K!=null&&d(o,["responseModalities"],K);let B=u(e,["mediaResolution"]);B!=null&&d(o,["mediaResolution"],B);let j=u(e,["speechConfig"]);if(j!=null&&d(o,["speechConfig"],Mm(j)),u(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Q=u(e,["thinkingConfig"]);Q!=null&&d(o,["thinkingConfig"],Q);let oe=u(e,["imageConfig"]);oe!=null&&d(o,["imageConfig"],iW(oe));let le=u(e,["enableEnhancedCivicAnswers"]);if(le!=null&&d(o,["enableEnhancedCivicAnswers"],le),u(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return o}function M2(t,e,n,r){let o={},i=u(e,["systemInstruction"]);n!==void 0&&i!=null&&d(n,["systemInstruction"],Ke(i));let s=u(e,["temperature"]);s!=null&&d(o,["temperature"],s);let a=u(e,["topP"]);a!=null&&d(o,["topP"],a);let l=u(e,["topK"]);l!=null&&d(o,["topK"],l);let c=u(e,["candidateCount"]);c!=null&&d(o,["candidateCount"],c);let f=u(e,["maxOutputTokens"]);f!=null&&d(o,["maxOutputTokens"],f);let m=u(e,["stopSequences"]);m!=null&&d(o,["stopSequences"],m);let h=u(e,["responseLogprobs"]);h!=null&&d(o,["responseLogprobs"],h);let y=u(e,["logprobs"]);y!=null&&d(o,["logprobs"],y);let _=u(e,["presencePenalty"]);_!=null&&d(o,["presencePenalty"],_);let T=u(e,["frequencyPenalty"]);T!=null&&d(o,["frequencyPenalty"],T);let E=u(e,["seed"]);E!=null&&d(o,["seed"],E);let w=u(e,["responseMimeType"]);w!=null&&d(o,["responseMimeType"],w);let b=u(e,["responseSchema"]);b!=null&&d(o,["responseSchema"],Nm(b));let L=u(e,["responseJsonSchema"]);L!=null&&d(o,["responseJsonSchema"],L);let D=u(e,["routingConfig"]);D!=null&&d(o,["routingConfig"],D);let I=u(e,["modelSelectionConfig"]);I!=null&&d(o,["modelConfig"],I);let P=u(e,["safetySettings"]);if(n!==void 0&&P!=null){let Pe=P;Array.isArray(Pe)&&(Pe=Pe.map(Oe=>Oe)),d(n,["safetySettings"],Pe)}let q=u(e,["tools"]);if(n!==void 0&&q!=null){let Pe=ai(q);Array.isArray(Pe)&&(Pe=Pe.map(Oe=>EC(si(Oe)))),d(n,["tools"],Pe)}let K=u(e,["toolConfig"]);n!==void 0&&K!=null&&d(n,["toolConfig"],K);let B=u(e,["labels"]);n!==void 0&&B!=null&&d(n,["labels"],B);let j=u(e,["cachedContent"]);n!==void 0&&j!=null&&d(n,["cachedContent"],Jn(t,j));let Q=u(e,["responseModalities"]);Q!=null&&d(o,["responseModalities"],Q);let oe=u(e,["mediaResolution"]);oe!=null&&d(o,["mediaResolution"],oe);let le=u(e,["speechConfig"]);le!=null&&d(o,["speechConfig"],Mm(le));let ue=u(e,["audioTimestamp"]);ue!=null&&d(o,["audioTimestamp"],ue);let ye=u(e,["thinkingConfig"]);ye!=null&&d(o,["thinkingConfig"],ye);let Te=u(e,["imageConfig"]);if(Te!=null&&d(o,["imageConfig"],sW(Te)),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let Ae=u(e,["modelArmorConfig"]);return n!==void 0&&Ae!=null&&d(n,["modelArmorConfig"],Ae),o}function FA(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let a=Vt(i);Array.isArray(a)&&(a=a.map(l=>uc(l))),d(r,["contents"],a)}let s=u(e,["config"]);return s!=null&&d(r,["generationConfig"],N2(t,s,r)),r}function LA(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["contents"]);if(i!=null){let a=Vt(i);Array.isArray(a)&&(a=a.map(l=>l)),d(r,["contents"],a)}let s=u(e,["config"]);return s!=null&&d(r,["generationConfig"],M2(t,s,r)),r}function UA(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["candidates"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(f=>t2(f))),d(n,["candidates"],c)}let i=u(t,["modelVersion"]);i!=null&&d(n,["modelVersion"],i);let s=u(t,["promptFeedback"]);s!=null&&d(n,["promptFeedback"],s);let a=u(t,["responseId"]);a!=null&&d(n,["responseId"],a);let l=u(t,["usageMetadata"]);return l!=null&&d(n,["usageMetadata"],l),n}function qA(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["candidates"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(m=>m)),d(n,["candidates"],f)}let i=u(t,["createTime"]);i!=null&&d(n,["createTime"],i);let s=u(t,["modelVersion"]);s!=null&&d(n,["modelVersion"],s);let a=u(t,["promptFeedback"]);a!=null&&d(n,["promptFeedback"],a);let l=u(t,["responseId"]);l!=null&&d(n,["responseId"],l);let c=u(t,["usageMetadata"]);return c!=null&&d(n,["usageMetadata"],c),n}function O2(t,e,n){let r={};if(u(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let o=u(t,["numberOfImages"]);e!==void 0&&o!=null&&d(e,["parameters","sampleCount"],o);let i=u(t,["aspectRatio"]);e!==void 0&&i!=null&&d(e,["parameters","aspectRatio"],i);let s=u(t,["guidanceScale"]);if(e!==void 0&&s!=null&&d(e,["parameters","guidanceScale"],s),u(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let a=u(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&d(e,["parameters","safetySetting"],a);let l=u(t,["personGeneration"]);e!==void 0&&l!=null&&d(e,["parameters","personGeneration"],l);let c=u(t,["includeSafetyAttributes"]);e!==void 0&&c!=null&&d(e,["parameters","includeSafetyAttributes"],c);let f=u(t,["includeRaiReason"]);e!==void 0&&f!=null&&d(e,["parameters","includeRaiReason"],f);let m=u(t,["language"]);e!==void 0&&m!=null&&d(e,["parameters","language"],m);let h=u(t,["outputMimeType"]);e!==void 0&&h!=null&&d(e,["parameters","outputOptions","mimeType"],h);let y=u(t,["outputCompressionQuality"]);if(e!==void 0&&y!=null&&d(e,["parameters","outputOptions","compressionQuality"],y),u(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(u(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let _=u(t,["imageSize"]);if(e!==void 0&&_!=null&&d(e,["parameters","sampleImageSize"],_),u(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return r}function D2(t,e,n){let r={},o=u(t,["outputGcsUri"]);e!==void 0&&o!=null&&d(e,["parameters","storageUri"],o);let i=u(t,["negativePrompt"]);e!==void 0&&i!=null&&d(e,["parameters","negativePrompt"],i);let s=u(t,["numberOfImages"]);e!==void 0&&s!=null&&d(e,["parameters","sampleCount"],s);let a=u(t,["aspectRatio"]);e!==void 0&&a!=null&&d(e,["parameters","aspectRatio"],a);let l=u(t,["guidanceScale"]);e!==void 0&&l!=null&&d(e,["parameters","guidanceScale"],l);let c=u(t,["seed"]);e!==void 0&&c!=null&&d(e,["parameters","seed"],c);let f=u(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&d(e,["parameters","safetySetting"],f);let m=u(t,["personGeneration"]);e!==void 0&&m!=null&&d(e,["parameters","personGeneration"],m);let h=u(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&d(e,["parameters","includeSafetyAttributes"],h);let y=u(t,["includeRaiReason"]);e!==void 0&&y!=null&&d(e,["parameters","includeRaiReason"],y);let _=u(t,["language"]);e!==void 0&&_!=null&&d(e,["parameters","language"],_);let T=u(t,["outputMimeType"]);e!==void 0&&T!=null&&d(e,["parameters","outputOptions","mimeType"],T);let E=u(t,["outputCompressionQuality"]);e!==void 0&&E!=null&&d(e,["parameters","outputOptions","compressionQuality"],E);let w=u(t,["addWatermark"]);e!==void 0&&w!=null&&d(e,["parameters","addWatermark"],w);let b=u(t,["labels"]);e!==void 0&&b!=null&&d(e,["labels"],b);let L=u(t,["imageSize"]);e!==void 0&&L!=null&&d(e,["parameters","sampleImageSize"],L);let D=u(t,["enhancePrompt"]);return e!==void 0&&D!=null&&d(e,["parameters","enhancePrompt"],D),r}function F2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["prompt"]);i!=null&&d(r,["instances[0]","prompt"],i);let s=u(e,["config"]);return s!=null&&O2(s,r),r}function L2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["prompt"]);i!=null&&d(r,["instances[0]","prompt"],i);let s=u(e,["config"]);return s!=null&&D2(s,r),r}function U2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["predictions"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>j2(a))),d(n,["generatedImages"],s)}let i=u(t,["positivePromptSafetyAttributes"]);return i!=null&&d(n,["positivePromptSafetyAttributes"],SC(i)),n}function q2(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["predictions"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>cc(a))),d(n,["generatedImages"],s)}let i=u(t,["positivePromptSafetyAttributes"]);return i!=null&&d(n,["positivePromptSafetyAttributes"],TC(i)),n}function B2(t,e,n){let r={},o=u(t,["numberOfVideos"]);if(e!==void 0&&o!=null&&d(e,["parameters","sampleCount"],o),u(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=u(t,["durationSeconds"]);if(e!==void 0&&i!=null&&d(e,["parameters","durationSeconds"],i),u(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=u(t,["aspectRatio"]);e!==void 0&&s!=null&&d(e,["parameters","aspectRatio"],s);let a=u(t,["resolution"]);e!==void 0&&a!=null&&d(e,["parameters","resolution"],a);let l=u(t,["personGeneration"]);if(e!==void 0&&l!=null&&d(e,["parameters","personGeneration"],l),u(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let c=u(t,["negativePrompt"]);e!==void 0&&c!=null&&d(e,["parameters","negativePrompt"],c);let f=u(t,["enhancePrompt"]);if(e!==void 0&&f!=null&&d(e,["parameters","enhancePrompt"],f),u(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let m=u(t,["lastFrame"]);e!==void 0&&m!=null&&d(e,["instances[0]","lastFrame"],fc(m));let h=u(t,["referenceImages"]);if(e!==void 0&&h!=null){let y=h;Array.isArray(y)&&(y=y.map(_=>HW(_))),d(e,["instances[0]","referenceImages"],y)}if(u(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(u(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return r}function G2(t,e,n){let r={},o=u(t,["numberOfVideos"]);e!==void 0&&o!=null&&d(e,["parameters","sampleCount"],o);let i=u(t,["outputGcsUri"]);e!==void 0&&i!=null&&d(e,["parameters","storageUri"],i);let s=u(t,["fps"]);e!==void 0&&s!=null&&d(e,["parameters","fps"],s);let a=u(t,["durationSeconds"]);e!==void 0&&a!=null&&d(e,["parameters","durationSeconds"],a);let l=u(t,["seed"]);e!==void 0&&l!=null&&d(e,["parameters","seed"],l);let c=u(t,["aspectRatio"]);e!==void 0&&c!=null&&d(e,["parameters","aspectRatio"],c);let f=u(t,["resolution"]);e!==void 0&&f!=null&&d(e,["parameters","resolution"],f);let m=u(t,["personGeneration"]);e!==void 0&&m!=null&&d(e,["parameters","personGeneration"],m);let h=u(t,["pubsubTopic"]);e!==void 0&&h!=null&&d(e,["parameters","pubsubTopic"],h);let y=u(t,["negativePrompt"]);e!==void 0&&y!=null&&d(e,["parameters","negativePrompt"],y);let _=u(t,["enhancePrompt"]);e!==void 0&&_!=null&&d(e,["parameters","enhancePrompt"],_);let T=u(t,["generateAudio"]);e!==void 0&&T!=null&&d(e,["parameters","generateAudio"],T);let E=u(t,["lastFrame"]);e!==void 0&&E!=null&&d(e,["instances[0]","lastFrame"],un(E));let w=u(t,["referenceImages"]);if(e!==void 0&&w!=null){let D=w;Array.isArray(D)&&(D=D.map(I=>$W(I))),d(e,["instances[0]","referenceImages"],D)}let b=u(t,["mask"]);e!==void 0&&b!=null&&d(e,["instances[0]","mask"],GW(b));let L=u(t,["compressionQuality"]);return e!==void 0&&L!=null&&d(e,["parameters","compressionQuality"],L),r}function H2(t,e){let n={},r=u(t,["name"]);r!=null&&d(n,["name"],r);let o=u(t,["metadata"]);o!=null&&d(n,["metadata"],o);let i=u(t,["done"]);i!=null&&d(n,["done"],i);let s=u(t,["error"]);s!=null&&d(n,["error"],s);let a=u(t,["response","generateVideoResponse"]);return a!=null&&d(n,["response"],J2(a)),n}function $2(t,e){let n={},r=u(t,["name"]);r!=null&&d(n,["name"],r);let o=u(t,["metadata"]);o!=null&&d(n,["metadata"],o);let i=u(t,["done"]);i!=null&&d(n,["done"],i);let s=u(t,["error"]);s!=null&&d(n,["error"],s);let a=u(t,["response"]);return a!=null&&d(n,["response"],z2(a)),n}function V2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["prompt"]);i!=null&&d(r,["instances[0]","prompt"],i);let s=u(e,["image"]);s!=null&&d(r,["instances[0]","image"],fc(s));let a=u(e,["video"]);a!=null&&d(r,["instances[0]","video"],wC(a));let l=u(e,["source"]);l!=null&&K2(l,r);let c=u(e,["config"]);return c!=null&&B2(c,r),r}function W2(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["prompt"]);i!=null&&d(r,["instances[0]","prompt"],i);let s=u(e,["image"]);s!=null&&d(r,["instances[0]","image"],un(s));let a=u(e,["video"]);a!=null&&d(r,["instances[0]","video"],vC(a));let l=u(e,["source"]);l!=null&&Y2(l,r);let c=u(e,["config"]);return c!=null&&G2(c,r),r}function J2(t,e){let n={},r=u(t,["generatedSamples"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(a=>Q2(a))),d(n,["generatedVideos"],s)}let o=u(t,["raiMediaFilteredCount"]);o!=null&&d(n,["raiMediaFilteredCount"],o);let i=u(t,["raiMediaFilteredReasons"]);return i!=null&&d(n,["raiMediaFilteredReasons"],i),n}function z2(t,e){let n={},r=u(t,["videos"]);if(r!=null){let s=r;Array.isArray(s)&&(s=s.map(a=>Z2(a))),d(n,["generatedVideos"],s)}let o=u(t,["raiMediaFilteredCount"]);o!=null&&d(n,["raiMediaFilteredCount"],o);let i=u(t,["raiMediaFilteredReasons"]);return i!=null&&d(n,["raiMediaFilteredReasons"],i),n}function K2(t,e,n){let r={},o=u(t,["prompt"]);e!==void 0&&o!=null&&d(e,["instances[0]","prompt"],o);let i=u(t,["image"]);e!==void 0&&i!=null&&d(e,["instances[0]","image"],fc(i));let s=u(t,["video"]);return e!==void 0&&s!=null&&d(e,["instances[0]","video"],wC(s)),r}function Y2(t,e,n){let r={},o=u(t,["prompt"]);e!==void 0&&o!=null&&d(e,["instances[0]","prompt"],o);let i=u(t,["image"]);e!==void 0&&i!=null&&d(e,["instances[0]","image"],un(i));let s=u(t,["video"]);return e!==void 0&&s!=null&&d(e,["instances[0]","video"],vC(s)),r}function j2(t,e){let n={},r=u(t,["_self"]);r!=null&&d(n,["image"],aW(r));let o=u(t,["raiFilteredReason"]);o!=null&&d(n,["raiFilteredReason"],o);let i=u(t,["_self"]);return i!=null&&d(n,["safetyAttributes"],SC(i)),n}function cc(t,e){let n={},r=u(t,["_self"]);r!=null&&d(n,["image"],_C(r));let o=u(t,["raiFilteredReason"]);o!=null&&d(n,["raiFilteredReason"],o);let i=u(t,["_self"]);i!=null&&d(n,["safetyAttributes"],TC(i));let s=u(t,["prompt"]);return s!=null&&d(n,["enhancedPrompt"],s),n}function X2(t,e){let n={},r=u(t,["_self"]);r!=null&&d(n,["mask"],_C(r));let o=u(t,["labels"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(n,["labels"],i)}return n}function Q2(t,e){let n={},r=u(t,["video"]);return r!=null&&d(n,["video"],qW(r)),n}function Z2(t,e){let n={},r=u(t,["_self"]);return r!=null&&d(n,["video"],BW(r)),n}function eW(t,e){let n={},r=u(t,["modelSelectionConfig"]);r!=null&&d(n,["modelConfig"],r);let o=u(t,["responseJsonSchema"]);o!=null&&d(n,["responseJsonSchema"],o);let i=u(t,["audioTimestamp"]);i!=null&&d(n,["audioTimestamp"],i);let s=u(t,["candidateCount"]);s!=null&&d(n,["candidateCount"],s);let a=u(t,["enableAffectiveDialog"]);a!=null&&d(n,["enableAffectiveDialog"],a);let l=u(t,["frequencyPenalty"]);l!=null&&d(n,["frequencyPenalty"],l);let c=u(t,["logprobs"]);c!=null&&d(n,["logprobs"],c);let f=u(t,["maxOutputTokens"]);f!=null&&d(n,["maxOutputTokens"],f);let m=u(t,["mediaResolution"]);m!=null&&d(n,["mediaResolution"],m);let h=u(t,["presencePenalty"]);h!=null&&d(n,["presencePenalty"],h);let y=u(t,["responseLogprobs"]);y!=null&&d(n,["responseLogprobs"],y);let _=u(t,["responseMimeType"]);_!=null&&d(n,["responseMimeType"],_);let T=u(t,["responseModalities"]);T!=null&&d(n,["responseModalities"],T);let E=u(t,["responseSchema"]);E!=null&&d(n,["responseSchema"],E);let w=u(t,["routingConfig"]);w!=null&&d(n,["routingConfig"],w);let b=u(t,["seed"]);b!=null&&d(n,["seed"],b);let L=u(t,["speechConfig"]);L!=null&&d(n,["speechConfig"],L);let D=u(t,["stopSequences"]);D!=null&&d(n,["stopSequences"],D);let I=u(t,["temperature"]);I!=null&&d(n,["temperature"],I);let P=u(t,["thinkingConfig"]);P!=null&&d(n,["thinkingConfig"],P);let q=u(t,["topK"]);q!=null&&d(n,["topK"],q);let K=u(t,["topP"]);if(K!=null&&d(n,["topP"],K),u(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function tW(t,e,n){let r={},o=u(e,["model"]);return o!=null&&d(r,["_url","name"],_e(t,o)),r}function nW(t,e,n){let r={},o=u(e,["model"]);return o!=null&&d(r,["_url","name"],_e(t,o)),r}function rW(t,e){let n={};if(u(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let r=u(t,["enableWidget"]);return r!=null&&d(n,["enableWidget"],r),n}function oW(t,e){let n={};if(u(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let r=u(t,["timeRangeFilter"]);return r!=null&&d(n,["timeRangeFilter"],r),n}function iW(t,e){let n={},r=u(t,["aspectRatio"]);r!=null&&d(n,["aspectRatio"],r);let o=u(t,["imageSize"]);if(o!=null&&d(n,["imageSize"],o),u(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(u(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return n}function sW(t,e){let n={},r=u(t,["aspectRatio"]);r!=null&&d(n,["aspectRatio"],r);let o=u(t,["imageSize"]);o!=null&&d(n,["imageSize"],o);let i=u(t,["personGeneration"]);i!=null&&d(n,["personGeneration"],i);let s=u(t,["outputMimeType"]);s!=null&&d(n,["imageOutputOptions","mimeType"],s);let a=u(t,["outputCompressionQuality"]);return a!=null&&d(n,["imageOutputOptions","compressionQuality"],a),n}function aW(t,e){let n={},r=u(t,["bytesBase64Encoded"]);r!=null&&d(n,["imageBytes"],Sr(r));let o=u(t,["mimeType"]);return o!=null&&d(n,["mimeType"],o),n}function _C(t,e){let n={},r=u(t,["gcsUri"]);r!=null&&d(n,["gcsUri"],r);let o=u(t,["bytesBase64Encoded"]);o!=null&&d(n,["imageBytes"],Sr(o));let i=u(t,["mimeType"]);return i!=null&&d(n,["mimeType"],i),n}function fc(t,e){let n={};if(u(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let r=u(t,["imageBytes"]);r!=null&&d(n,["bytesBase64Encoded"],Sr(r));let o=u(t,["mimeType"]);return o!=null&&d(n,["mimeType"],o),n}function un(t,e){let n={},r=u(t,["gcsUri"]);r!=null&&d(n,["gcsUri"],r);let o=u(t,["imageBytes"]);o!=null&&d(n,["bytesBase64Encoded"],Sr(o));let i=u(t,["mimeType"]);return i!=null&&d(n,["mimeType"],i),n}function lW(t,e,n,r){let o={},i=u(e,["pageSize"]);n!==void 0&&i!=null&&d(n,["_query","pageSize"],i);let s=u(e,["pageToken"]);n!==void 0&&s!=null&&d(n,["_query","pageToken"],s);let a=u(e,["filter"]);n!==void 0&&a!=null&&d(n,["_query","filter"],a);let l=u(e,["queryBase"]);return n!==void 0&&l!=null&&d(n,["_url","models_url"],fC(t,l)),o}function uW(t,e,n,r){let o={},i=u(e,["pageSize"]);n!==void 0&&i!=null&&d(n,["_query","pageSize"],i);let s=u(e,["pageToken"]);n!==void 0&&s!=null&&d(n,["_query","pageToken"],s);let a=u(e,["filter"]);n!==void 0&&a!=null&&d(n,["_query","filter"],a);let l=u(e,["queryBase"]);return n!==void 0&&l!=null&&d(n,["_url","models_url"],fC(t,l)),o}function cW(t,e,n){let r={},o=u(e,["config"]);return o!=null&&lW(t,o,r),r}function fW(t,e,n){let r={},o=u(e,["config"]);return o!=null&&uW(t,o,r),r}function dW(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["nextPageToken"]);o!=null&&d(n,["nextPageToken"],o);let i=u(t,["_self"]);if(i!=null){let s=dC(i);Array.isArray(s)&&(s=s.map(a=>om(a))),d(n,["models"],s)}return n}function pW(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["nextPageToken"]);o!=null&&d(n,["nextPageToken"],o);let i=u(t,["_self"]);if(i!=null){let s=dC(i);Array.isArray(s)&&(s=s.map(a=>im(a))),d(n,["models"],s)}return n}function hW(t,e){let n={},r=u(t,["maskMode"]);r!=null&&d(n,["maskMode"],r);let o=u(t,["segmentationClasses"]);o!=null&&d(n,["maskClasses"],o);let i=u(t,["maskDilation"]);return i!=null&&d(n,["dilation"],i),n}function om(t,e){let n={},r=u(t,["name"]);r!=null&&d(n,["name"],r);let o=u(t,["displayName"]);o!=null&&d(n,["displayName"],o);let i=u(t,["description"]);i!=null&&d(n,["description"],i);let s=u(t,["version"]);s!=null&&d(n,["version"],s);let a=u(t,["_self"]);a!=null&&d(n,["tunedModelInfo"],PW(a));let l=u(t,["inputTokenLimit"]);l!=null&&d(n,["inputTokenLimit"],l);let c=u(t,["outputTokenLimit"]);c!=null&&d(n,["outputTokenLimit"],c);let f=u(t,["supportedGenerationMethods"]);f!=null&&d(n,["supportedActions"],f);let m=u(t,["temperature"]);m!=null&&d(n,["temperature"],m);let h=u(t,["maxTemperature"]);h!=null&&d(n,["maxTemperature"],h);let y=u(t,["topP"]);y!=null&&d(n,["topP"],y);let _=u(t,["topK"]);_!=null&&d(n,["topK"],_);let T=u(t,["thinking"]);return T!=null&&d(n,["thinking"],T),n}function im(t,e){let n={},r=u(t,["name"]);r!=null&&d(n,["name"],r);let o=u(t,["displayName"]);o!=null&&d(n,["displayName"],o);let i=u(t,["description"]);i!=null&&d(n,["description"],i);let s=u(t,["versionId"]);s!=null&&d(n,["version"],s);let a=u(t,["deployedModels"]);if(a!=null){let h=a;Array.isArray(h)&&(h=h.map(y=>R2(y))),d(n,["endpoints"],h)}let l=u(t,["labels"]);l!=null&&d(n,["labels"],l);let c=u(t,["_self"]);c!=null&&d(n,["tunedModelInfo"],kW(c));let f=u(t,["defaultCheckpointId"]);f!=null&&d(n,["defaultCheckpointId"],f);let m=u(t,["checkpoints"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(y=>y)),d(n,["checkpoints"],h)}return n}function mW(t,e){let n={},r=u(t,["mediaResolution"]);r!=null&&d(n,["mediaResolution"],r);let o=u(t,["codeExecutionResult"]);o!=null&&d(n,["codeExecutionResult"],o);let i=u(t,["executableCode"]);i!=null&&d(n,["executableCode"],i);let s=u(t,["fileData"]);s!=null&&d(n,["fileData"],I2(s));let a=u(t,["functionCall"]);a!=null&&d(n,["functionCall"],x2(a));let l=u(t,["functionResponse"]);l!=null&&d(n,["functionResponse"],l);let c=u(t,["inlineData"]);c!=null&&d(n,["inlineData"],e2(c));let f=u(t,["text"]);f!=null&&d(n,["text"],f);let m=u(t,["thought"]);m!=null&&d(n,["thought"],m);let h=u(t,["thoughtSignature"]);h!=null&&d(n,["thoughtSignature"],h);let y=u(t,["videoMetadata"]);return y!=null&&d(n,["videoMetadata"],y),n}function gW(t,e){let n={},r=u(t,["productImage"]);return r!=null&&d(n,["image"],un(r)),n}function yW(t,e,n){let r={},o=u(t,["numberOfImages"]);e!==void 0&&o!=null&&d(e,["parameters","sampleCount"],o);let i=u(t,["baseSteps"]);e!==void 0&&i!=null&&d(e,["parameters","baseSteps"],i);let s=u(t,["outputGcsUri"]);e!==void 0&&s!=null&&d(e,["parameters","storageUri"],s);let a=u(t,["seed"]);e!==void 0&&a!=null&&d(e,["parameters","seed"],a);let l=u(t,["safetyFilterLevel"]);e!==void 0&&l!=null&&d(e,["parameters","safetySetting"],l);let c=u(t,["personGeneration"]);e!==void 0&&c!=null&&d(e,["parameters","personGeneration"],c);let f=u(t,["addWatermark"]);e!==void 0&&f!=null&&d(e,["parameters","addWatermark"],f);let m=u(t,["outputMimeType"]);e!==void 0&&m!=null&&d(e,["parameters","outputOptions","mimeType"],m);let h=u(t,["outputCompressionQuality"]);e!==void 0&&h!=null&&d(e,["parameters","outputOptions","compressionQuality"],h);let y=u(t,["enhancePrompt"]);e!==void 0&&y!=null&&d(e,["parameters","enhancePrompt"],y);let _=u(t,["labels"]);return e!==void 0&&_!=null&&d(e,["labels"],_),r}function _W(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["source"]);i!=null&&TW(i,r);let s=u(e,["config"]);return s!=null&&yW(s,r),r}function SW(t,e){let n={},r=u(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>cc(i))),d(n,["generatedImages"],o)}return n}function TW(t,e,n){let r={},o=u(t,["prompt"]);e!==void 0&&o!=null&&d(e,["instances[0]","prompt"],o);let i=u(t,["personImage"]);e!==void 0&&i!=null&&d(e,["instances[0]","personImage","image"],un(i));let s=u(t,["productImages"]);if(e!==void 0&&s!=null){let a=s;Array.isArray(a)&&(a=a.map(l=>gW(l))),d(e,["instances[0]","productImages"],a)}return r}function EW(t,e){let n={},r=u(t,["referenceImage"]);r!=null&&d(n,["referenceImage"],un(r));let o=u(t,["referenceId"]);o!=null&&d(n,["referenceId"],o);let i=u(t,["referenceType"]);i!=null&&d(n,["referenceType"],i);let s=u(t,["maskImageConfig"]);s!=null&&d(n,["maskImageConfig"],hW(s));let a=u(t,["controlImageConfig"]);a!=null&&d(n,["controlImageConfig"],a2(a));let l=u(t,["styleImageConfig"]);l!=null&&d(n,["styleImageConfig"],l);let c=u(t,["subjectImageConfig"]);return c!=null&&d(n,["subjectImageConfig"],c),n}function SC(t,e){let n={},r=u(t,["safetyAttributes","categories"]);r!=null&&d(n,["categories"],r);let o=u(t,["safetyAttributes","scores"]);o!=null&&d(n,["scores"],o);let i=u(t,["contentType"]);return i!=null&&d(n,["contentType"],i),n}function TC(t,e){let n={},r=u(t,["safetyAttributes","categories"]);r!=null&&d(n,["categories"],r);let o=u(t,["safetyAttributes","scores"]);o!=null&&d(n,["scores"],o);let i=u(t,["contentType"]);return i!=null&&d(n,["contentType"],i),n}function wW(t,e){let n={},r=u(t,["category"]);if(r!=null&&d(n,["category"],r),u(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let o=u(t,["threshold"]);return o!=null&&d(n,["threshold"],o),n}function vW(t,e){let n={},r=u(t,["image"]);return r!=null&&d(n,["image"],un(r)),n}function AW(t,e,n){let r={},o=u(t,["mode"]);e!==void 0&&o!=null&&d(e,["parameters","mode"],o);let i=u(t,["maxPredictions"]);e!==void 0&&i!=null&&d(e,["parameters","maxPredictions"],i);let s=u(t,["confidenceThreshold"]);e!==void 0&&s!=null&&d(e,["parameters","confidenceThreshold"],s);let a=u(t,["maskDilation"]);e!==void 0&&a!=null&&d(e,["parameters","maskDilation"],a);let l=u(t,["binaryColorThreshold"]);e!==void 0&&l!=null&&d(e,["parameters","binaryColorThreshold"],l);let c=u(t,["labels"]);return e!==void 0&&c!=null&&d(e,["labels"],c),r}function CW(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["source"]);i!=null&&RW(i,r);let s=u(e,["config"]);return s!=null&&AW(s,r),r}function bW(t,e){let n={},r=u(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>X2(i))),d(n,["generatedMasks"],o)}return n}function RW(t,e,n){let r={},o=u(t,["prompt"]);e!==void 0&&o!=null&&d(e,["instances[0]","prompt"],o);let i=u(t,["image"]);e!==void 0&&i!=null&&d(e,["instances[0]","image"],un(i));let s=u(t,["scribbleImage"]);return e!==void 0&&s!=null&&d(e,["instances[0]","scribble"],vW(s)),r}function IW(t,e){let n={},r=u(t,["retrievalConfig"]);r!=null&&d(n,["retrievalConfig"],r);let o=u(t,["functionCallingConfig"]);return o!=null&&d(n,["functionCallingConfig"],P2(o)),n}function xW(t,e){let n={};if(u(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=u(t,["computerUse"]);r!=null&&d(n,["computerUse"],r);let o=u(t,["fileSearch"]);o!=null&&d(n,["fileSearch"],o);let i=u(t,["codeExecution"]);if(i!=null&&d(n,["codeExecution"],i),u(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let s=u(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(h=>h)),d(n,["functionDeclarations"],m)}let a=u(t,["googleMaps"]);a!=null&&d(n,["googleMaps"],rW(a));let l=u(t,["googleSearch"]);l!=null&&d(n,["googleSearch"],oW(l));let c=u(t,["googleSearchRetrieval"]);c!=null&&d(n,["googleSearchRetrieval"],c);let f=u(t,["urlContext"]);return f!=null&&d(n,["urlContext"],f),n}function EC(t,e){let n={},r=u(t,["retrieval"]);r!=null&&d(n,["retrieval"],r);let o=u(t,["computerUse"]);if(o!=null&&d(n,["computerUse"],o),u(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let i=u(t,["codeExecution"]);i!=null&&d(n,["codeExecution"],i);let s=u(t,["enterpriseWebSearch"]);s!=null&&d(n,["enterpriseWebSearch"],s);let a=u(t,["functionDeclarations"]);if(a!=null){let h=a;Array.isArray(h)&&(h=h.map(y=>k2(y))),d(n,["functionDeclarations"],h)}let l=u(t,["googleMaps"]);l!=null&&d(n,["googleMaps"],l);let c=u(t,["googleSearch"]);c!=null&&d(n,["googleSearch"],c);let f=u(t,["googleSearchRetrieval"]);f!=null&&d(n,["googleSearchRetrieval"],f);let m=u(t,["urlContext"]);return m!=null&&d(n,["urlContext"],m),n}function PW(t,e){let n={},r=u(t,["baseModel"]);r!=null&&d(n,["baseModel"],r);let o=u(t,["createTime"]);o!=null&&d(n,["createTime"],o);let i=u(t,["updateTime"]);return i!=null&&d(n,["updateTime"],i),n}function kW(t,e){let n={},r=u(t,["labels","google-vertex-llm-tuning-base-model-id"]);r!=null&&d(n,["baseModel"],r);let o=u(t,["createTime"]);o!=null&&d(n,["createTime"],o);let i=u(t,["updateTime"]);return i!=null&&d(n,["updateTime"],i),n}function NW(t,e,n){let r={},o=u(t,["displayName"]);e!==void 0&&o!=null&&d(e,["displayName"],o);let i=u(t,["description"]);e!==void 0&&i!=null&&d(e,["description"],i);let s=u(t,["defaultCheckpointId"]);return e!==void 0&&s!=null&&d(e,["defaultCheckpointId"],s),r}function MW(t,e,n){let r={},o=u(t,["displayName"]);e!==void 0&&o!=null&&d(e,["displayName"],o);let i=u(t,["description"]);e!==void 0&&i!=null&&d(e,["description"],i);let s=u(t,["defaultCheckpointId"]);return e!==void 0&&s!=null&&d(e,["defaultCheckpointId"],s),r}function OW(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","name"],_e(t,o));let i=u(e,["config"]);return i!=null&&NW(i,r),r}function DW(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["config"]);return i!=null&&MW(i,r),r}function FW(t,e,n){let r={},o=u(t,["outputGcsUri"]);e!==void 0&&o!=null&&d(e,["parameters","storageUri"],o);let i=u(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&d(e,["parameters","safetySetting"],i);let s=u(t,["personGeneration"]);e!==void 0&&s!=null&&d(e,["parameters","personGeneration"],s);let a=u(t,["includeRaiReason"]);e!==void 0&&a!=null&&d(e,["parameters","includeRaiReason"],a);let l=u(t,["outputMimeType"]);e!==void 0&&l!=null&&d(e,["parameters","outputOptions","mimeType"],l);let c=u(t,["outputCompressionQuality"]);e!==void 0&&c!=null&&d(e,["parameters","outputOptions","compressionQuality"],c);let f=u(t,["enhanceInputImage"]);e!==void 0&&f!=null&&d(e,["parameters","upscaleConfig","enhanceInputImage"],f);let m=u(t,["imagePreservationFactor"]);e!==void 0&&m!=null&&d(e,["parameters","upscaleConfig","imagePreservationFactor"],m);let h=u(t,["labels"]);e!==void 0&&h!=null&&d(e,["labels"],h);let y=u(t,["numberOfImages"]);e!==void 0&&y!=null&&d(e,["parameters","sampleCount"],y);let _=u(t,["mode"]);return e!==void 0&&_!=null&&d(e,["parameters","mode"],_),r}function LW(t,e,n){let r={},o=u(e,["model"]);o!=null&&d(r,["_url","model"],_e(t,o));let i=u(e,["image"]);i!=null&&d(r,["instances[0]","image"],un(i));let s=u(e,["upscaleFactor"]);s!=null&&d(r,["parameters","upscaleConfig","upscaleFactor"],s);let a=u(e,["config"]);return a!=null&&FW(a,r),r}function UW(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["predictions"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>cc(s))),d(n,["generatedImages"],i)}return n}function qW(t,e){let n={},r=u(t,["uri"]);r!=null&&d(n,["uri"],r);let o=u(t,["encodedVideo"]);o!=null&&d(n,["videoBytes"],Sr(o));let i=u(t,["encoding"]);return i!=null&&d(n,["mimeType"],i),n}function BW(t,e){let n={},r=u(t,["gcsUri"]);r!=null&&d(n,["uri"],r);let o=u(t,["bytesBase64Encoded"]);o!=null&&d(n,["videoBytes"],Sr(o));let i=u(t,["mimeType"]);return i!=null&&d(n,["mimeType"],i),n}function GW(t,e){let n={},r=u(t,["image"]);r!=null&&d(n,["_self"],un(r));let o=u(t,["maskMode"]);return o!=null&&d(n,["maskMode"],o),n}function HW(t,e){let n={},r=u(t,["image"]);r!=null&&d(n,["image"],fc(r));let o=u(t,["referenceType"]);return o!=null&&d(n,["referenceType"],o),n}function $W(t,e){let n={},r=u(t,["image"]);r!=null&&d(n,["image"],un(r));let o=u(t,["referenceType"]);return o!=null&&d(n,["referenceType"],o),n}function wC(t,e){let n={},r=u(t,["uri"]);r!=null&&d(n,["uri"],r);let o=u(t,["videoBytes"]);o!=null&&d(n,["encodedVideo"],Sr(o));let i=u(t,["mimeType"]);return i!=null&&d(n,["encoding"],i),n}function vC(t,e){let n={},r=u(t,["uri"]);r!=null&&d(n,["gcsUri"],r);let o=u(t,["videoBytes"]);o!=null&&d(n,["bytesBase64Encoded"],Sr(o));let i=u(t,["mimeType"]);return i!=null&&d(n,["mimeType"],i),n}function VW(t,e){let n={},r=u(t,["displayName"]);return e!==void 0&&r!=null&&d(e,["displayName"],r),n}function WW(t){let e={},n=u(t,["config"]);return n!=null&&VW(n,e),e}function JW(t,e){let n={},r=u(t,["force"]);return e!==void 0&&r!=null&&d(e,["_query","force"],r),n}function zW(t){let e={},n=u(t,["name"]);n!=null&&d(e,["_url","name"],n);let r=u(t,["config"]);return r!=null&&JW(r,e),e}function KW(t){let e={},n=u(t,["name"]);return n!=null&&d(e,["_url","name"],n),e}function YW(t,e){let n={},r=u(t,["customMetadata"]);if(e!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["customMetadata"],i)}let o=u(t,["chunkingConfig"]);return e!==void 0&&o!=null&&d(e,["chunkingConfig"],o),n}function jW(t){let e={},n=u(t,["name"]);n!=null&&d(e,["name"],n);let r=u(t,["metadata"]);r!=null&&d(e,["metadata"],r);let o=u(t,["done"]);o!=null&&d(e,["done"],o);let i=u(t,["error"]);i!=null&&d(e,["error"],i);let s=u(t,["response"]);return s!=null&&d(e,["response"],QW(s)),e}function XW(t){let e={},n=u(t,["fileSearchStoreName"]);n!=null&&d(e,["_url","file_search_store_name"],n);let r=u(t,["fileName"]);r!=null&&d(e,["fileName"],r);let o=u(t,["config"]);return o!=null&&YW(o,e),e}function QW(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["parent"]);r!=null&&d(e,["parent"],r);let o=u(t,["documentName"]);return o!=null&&d(e,["documentName"],o),e}function ZW(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function eJ(t){let e={},n=u(t,["config"]);return n!=null&&ZW(n,e),e}function tJ(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["fileSearchStores"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["fileSearchStores"],i)}return e}function AC(t,e){let n={},r=u(t,["mimeType"]);e!==void 0&&r!=null&&d(e,["mimeType"],r);let o=u(t,["displayName"]);e!==void 0&&o!=null&&d(e,["displayName"],o);let i=u(t,["customMetadata"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(l=>l)),d(e,["customMetadata"],a)}let s=u(t,["chunkingConfig"]);return e!==void 0&&s!=null&&d(e,["chunkingConfig"],s),n}function nJ(t){let e={},n=u(t,["fileSearchStoreName"]);n!=null&&d(e,["_url","file_search_store_name"],n);let r=u(t,["config"]);return r!=null&&AC(r,e),e}function rJ(t){let e={},n=u(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}var oJ="Content-Type",iJ="X-Server-Timeout",sJ="User-Agent",sm="x-goog-api-client",aJ="1.39.0",lJ=`google-genai-sdk/${aJ}`,uJ="v1beta1",cJ="v1beta",am=class{constructor(e){var n,r,o;this.clientOptions=Object.assign({},e),this.customBaseUrl=(n=e.httpOptions)===null||n===void 0?void 0:n.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));let i={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");let a=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!a?(i.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?i.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:uJ}else{if(!this.clientOptions.apiKey)throw new ri({message:"API key must be set when using the Gemini API.",status:403});i.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:cJ,i.baseUrl="https://generativelanguage.googleapis.com/"}i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){let o=[this.getRequestUrlInternal(n)];return r&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e,n){return!(n.baseUrl&&n.baseUrlResourceScope===C.ResourceScope.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,n),o=this.constructUrl(e.path,n,r);if(e.queryParams)for(let[s,a]of Object.entries(e.queryParams))o.searchParams.append(s,String(a));let i={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.unaryApiCall(o,i,e.httpMethod)}patchHttpOptions(e,n){let r=JSON.parse(JSON.stringify(e));for(let[o,i]of Object.entries(n))typeof i=="object"?r[o]=Object.assign(Object.assign({},r[o]),i):i!==void 0&&(r[o]=i);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,n),o=this.constructUrl(e.path,n,r);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.streamApiCall(o,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,o){if(n&&n.timeout||o){let i=new AbortController,s=i.signal;if(n.timeout&&n?.timeout>0){let a=setTimeout(()=>i.abort(),n.timeout);a&&typeof a.unref=="function"&&a.unref()}o&&o.addEventListener("abort",()=>{i.abort()}),e.signal=s}return n&&n.extraBody!==null&&fJ(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await BA(o),new _r(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await BA(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return sn(this,arguments,function*(){var r;let o=(r=e?.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let s="",a="data:",l=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:c,value:f}=yield fe(o.read());if(c){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let m=i.decode(f,{stream:!0});try{let _=JSON.parse(m);if("error"in _){let T=JSON.parse(JSON.stringify(_.error)),E=T.status,w=T.code,b=`got status: ${E}. ${JSON.stringify(_)}`;if(w>=400&&w<600)throw new ri({message:b,status:w})}}catch(_){if(_.name==="ApiError")throw _}s+=m;let h=-1,y=0;for(;;){h=-1,y=0;for(let E of l){let w=s.indexOf(E);w!==-1&&(h===-1||w<h)&&(h=w,y=E.length)}if(h===-1)break;let _=s.substring(0,h);s=s.substring(h+y);let T=_.trim();if(T.startsWith(a)){let E=T.substring(a.length).trim();try{let w=new Response(E,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield fe(new _r(w))}catch(w){throw new Error(`exception parsing stream chunk ${E}. ${w}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){let e={},n=lJ+" "+this.clientOptions.userAgentExtra;return e[sJ]=n,e[sm]=n,e[oJ]="application/json",e}async getHeadersInternal(e,n){let r=new Headers;if(e&&e.headers){for(let[o,i]of Object.entries(e.headers))r.append(o,i);e.timeout&&e.timeout>0&&r.append(iJ,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;let o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);let i=this.clientOptions.uploader,s=await i.stat(e);o.sizeBytes=String(s.size);let a=(r=n?.mimeType)!==null&&r!==void 0?r:s.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=a;let l={file:o},c=this.getFileName(e),f=X("upload/v1beta/files",l._url),m=await this.fetchUploadUrl(f,o.sizeBytes,o.mimeType,c,l,n?.httpOptions);return i.upload(e,m,this)}async uploadFileToFileSearchStore(e,n,r){var o;let i=this.clientOptions.uploader,s=await i.stat(n),a=String(s.size),l=(o=r?.mimeType)!==null&&o!==void 0?o:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(n),m={};r!=null&&AC(r,m);let h=await this.fetchUploadUrl(c,a,l,f,m,r?.httpOptions);return i.uploadToFileSearchStore(n,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,o,i,s){var a;let l={};s?l=s:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},o?{"X-Goog-Upload-File-Name":o}:{})};let c=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:l});if(!c||!c?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let f=(a=c?.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}};async function BA(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){let n=t.status,r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};let o=JSON.stringify(r);throw n>=400&&n<600?new ri({message:o,status:n}):new Error(o)}}function fJ(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{let i=JSON.parse(t.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))n=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){let a=Object.assign({},i);for(let l in s)if(Object.prototype.hasOwnProperty.call(s,l)){let c=s[l],f=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&f&&typeof f=="object"&&!Array.isArray(f)?a[l]=r(f,c):(f&&c&&typeof f!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof f}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let o=r(n,e);t.body=JSON.stringify(o)}var dJ="mcp_used/unknown",CC=!1;function bC(t){for(let e of t)if(pJ(e)||typeof e=="object"&&"inputSchema"in e)return!0;return CC}function RC(t){var e;let n=(e=t[sm])!==null&&e!==void 0?e:"";t[sm]=(n+` ${dJ}`).trimStart()}function pJ(t){return t!==null&&typeof t=="object"&&t instanceof Bs}function hJ(t){return sn(this,arguments,function*(n,r=100){let o,i=0;for(;i<r;){let s=yield fe(n.listTools({cursor:o}));for(let a of s.tools)yield yield fe(a),i++;if(!s.nextCursor)break;o=s.nextCursor}})}var Bs=class t{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new t(e,n)}async initialize(){var e,n,r,o;if(this.mcpTools.length>0)return;let i={},s=[];for(let f of this.mcpClients)try{for(var a=!0,l=(n=void 0,an(hJ(f))),c;c=await l.next(),e=c.done,!e;a=!0){o=c.value,a=!1;let m=o;s.push(m);let h=m.name;if(i[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);i[h]=f}}catch(m){n={error:m}}finally{try{!a&&!e&&(r=l.return)&&await r.call(l)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),jH(this.mcpTools,this.config)}async callTool(e){await this.initialize();let n=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let o=this.functionNameToMcpClient[r.name],i;this.config.timeout&&(i={timeout:this.config.timeout});let s=await o.callTool({name:r.name,arguments:r.args},void 0,i);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}};function mJ(t){return t!==null&&typeof t=="object"&&"listTools"in t&&typeof t.listTools=="function"}function gJ(...t){if(CC=!0,t.length===0)throw new Error("No MCP clients provided");let e=t[t.length-1];return mJ(e)?Bs.create(t,{}):Bs.create(t.slice(0,t.length-1),e)}async function yJ(t,e,n){let r=new Fu,o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data),Object.assign(r,o),e(r)}var lm=class{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let o=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=SJ(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${o}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},f=new Promise(L=>{c=L}),m=e.callbacks,h=function(){c({})},y=this.apiClient,_={onopen:h,onmessage:L=>{yJ(y,m.onmessage,L)},onerror:(n=m?.onerror)!==null&&n!==void 0?n:function(L){},onclose:(r=m?.onclose)!==null&&r!==void 0?r:function(L){}},T=this.webSocketFactory.create(l,_J(s),_);T.connect(),await f;let b={setup:{model:_e(this.apiClient,e.model)}};return T.send(JSON.stringify(b)),new um(T,this.apiClient)}},um=class{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let n=VV(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let n=$V(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){let n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(C.LiveMusicPlaybackControl.PLAY)}pause(){this.sendPlaybackControl(C.LiveMusicPlaybackControl.PAUSE)}stop(){this.sendPlaybackControl(C.LiveMusicPlaybackControl.STOP)}resetContext(){this.sendPlaybackControl(C.LiveMusicPlaybackControl.RESET_CONTEXT)}close(){this.conn.close()}};function _J(t){let e={};return t.forEach((n,r)=>{e[r]=n}),e}function SJ(t){let e=new Headers;for(let[n,r]of Object.entries(t))e.append(n,r);return e}var TJ="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function EJ(t,e,n){let r=new Du,o;n.data instanceof Blob?o=await n.data.text():n.data instanceof ArrayBuffer?o=new TextDecoder().decode(n.data):o=n.data;let i=JSON.parse(o);if(t.isVertexAI()){let s=zV(i);Object.assign(r,s)}else Object.assign(r,i);e(r)}var Vu=class{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new lm(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,o,i,s,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),f,m=this.apiClient.getHeaders();e.config&&e.config.tools&&bC(e.config.tools)&&RC(m);let h=AJ(m);if(this.apiClient.isVertexAI()){let B=this.apiClient.getProject(),j=this.apiClient.getLocation(),Q=this.apiClient.getApiKey(),oe=!!B&&!!j||!!Q;this.apiClient.getCustomBaseUrl()&&!oe?f=l:(f=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,f))}else{let B=this.apiClient.getApiKey(),j="BidiGenerateContent",Q="key";B?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),j="BidiGenerateContentConstrained",Q="access_token"),f=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${j}?${Q}=${B}`}let y=()=>{},_=new Promise(B=>{y=B}),T=e.callbacks,E=function(){var B;(B=T?.onopen)===null||B===void 0||B.call(T),y({})},w=this.apiClient,b={onopen:E,onmessage:B=>{EJ(w,T.onmessage,B)},onerror:(n=T?.onerror)!==null&&n!==void 0?n:function(B){},onclose:(r=T?.onclose)!==null&&r!==void 0?r:function(B){}},L=this.webSocketFactory.create(f,vJ(h),b);L.connect(),await _;let D=_e(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&D.startsWith("publishers/")){let B=this.apiClient.getProject(),j=this.apiClient.getLocation();B&&j&&(D=`projects/${B}/locations/${j}/`+D)}let I={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[C.Modality.AUDIO]}:e.config.responseModalities=[C.Modality.AUDIO]),!((i=e.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let P=(a=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[],q=[];for(let B of P)if(this.isCallableTool(B)){let j=B;q.push(await j.tool())}else q.push(B);q.length>0&&(e.config.tools=q);let K={model:D,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?I=HV(this.apiClient,K):I=GV(this.apiClient,K),delete I.config,L.send(JSON.stringify(I)),new Wu(L,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},wJ={turnComplete:!0},Wu=class{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=Vt(n.turns),e.isVertexAI()||(r=r.map(o=>uc(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(let i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!e.isVertexAI()&&!("id"in i))throw new Error(TJ)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},wJ),e);let n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:JV(e)}:n={realtimeInput:WV(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}};function vJ(t){let e={};return t.forEach((n,r)=>{e[r]=n}),e}function AJ(t){let e=new Headers;for(let[n,r]of Object.entries(t))e.append(n,r);return e}var GA=10;function HA(t){var e,n,r;if(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(let s of(n=t?.tools)!==null&&n!==void 0?n:[])if(ni(s)){o=!0;break}if(!o)return!0;let i=(r=t?.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function ni(t){return"callTool"in t&&typeof t.callTool=="function"}function CJ(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>ni(o)))!==null&&r!==void 0?r:!1}function $A(t){var e;let n=[];return!((e=t?.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,o)=>{if(ni(r))return;let i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(o)}),n}function VA(t){var e;return!(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Ju=class extends ln{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,o,i,s,a;let l=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!CJ(n)||HA(n.config))return await this.generateContentInternal(l);let c=$A(n);if(c.length>0){let T=c.map(E=>`tools[${E}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${T}.`)}let f,m,h=Vt(l.contents),y=(i=(o=(r=l.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&i!==void 0?i:GA,_=0;for(;_<y&&(f=await this.generateContentInternal(l),!(!f.functionCalls||f.functionCalls.length===0));){let T=f.candidates[0].content,E=[];for(let w of(a=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[])if(ni(w)){let L=await w.callTool(f.functionCalls);E.push(...L)}_++,m={role:"user",parts:E},l.contents=Vt(l.contents),l.contents.push(T),l.contents.push(m),VA(l.config)&&(h.push(T),h.push(m))}return VA(l.config)&&(f.automaticFunctionCallingHistory=h),f},this.generateContentStream=async n=>{var r,o,i,s,a;if(this.maybeMoveToResponseJsonSchem(n),HA(n.config)){let m=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(m)}let l=$A(n);if(l.length>0){let m=l.map(h=>`tools[${h}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let c=(i=(o=(r=n?.config)===null||r===void 0?void 0:r.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,f=(a=(s=n?.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var o;let i,s=[];if(r?.generatedImages)for(let l of r.generatedImages)l&&l?.safetyAttributes&&((o=l?.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?i=l?.safetyAttributes:s.push(l);let a;return i?a={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:a={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},a}),this.list=async n=>{var r;let s={config:Object.assign(Object.assign({},{queryBase:!0}),n?.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new bn(C.PagedItem.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(s),s)},this.editImage=async n=>{let r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));let o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(o)},this.generateVideos=async n=>{var r,o,i,s,a,l;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((o=n.video)===null||o===void 0)&&o.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((s=(i=n.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((l=(a=n.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,o;let i=(n=e.config)===null||n===void 0?void 0:n.tools;if(!i)return e;let s=await Promise.all(i.map(async l=>ni(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(a.config.tools=s,e.config&&e.config.tools&&bC(e.config.tools)){let l=(o=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&o!==void 0?o:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),RC(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var n,r,o;let i=new Map;for(let s of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(ni(s)){let a=s,l=await a.tool();for(let c of(o=l.functionDeclarations)!==null&&o!==void 0?o:[]){if(!c.name)throw new Error("Function declaration name is required.");if(i.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);i.set(c.name,a)}}return i}async processAfcStream(e){var n,r,o;let i=(o=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:GA,s=!1,a=0,l=await this.initAfcToolsMap(e);return(function(c,f,m){return sn(this,arguments,function*(){for(var h,y,_,T,E,w;a<i;){s&&(a++,s=!1);let I=yield fe(c.processParamsMaybeAddMcpUsage(m)),P=yield fe(c.generateContentStreamInternal(I)),q=[],K=[];try{for(var b=!0,L=(y=void 0,an(P)),D;D=yield fe(L.next()),h=D.done,!h;b=!0){T=D.value,b=!1;let B=T;if(yield yield fe(B),B.candidates&&(!((E=B.candidates[0])===null||E===void 0)&&E.content)){K.push(B.candidates[0].content);for(let j of(w=B.candidates[0].content.parts)!==null&&w!==void 0?w:[])if(a<i&&j.functionCall){if(!j.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(j.functionCall.name)){let Q=yield fe(f.get(j.functionCall.name).callTool([j.functionCall]));q.push(...Q)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${j.functionCall.name}`)}}}}catch(B){y={error:B}}finally{try{!b&&!h&&(_=L.return)&&(yield fe(_.call(L)))}finally{if(y)throw y.error}}if(q.length>0){s=!0;let B=new gr;B.candidates=[{content:{role:"user",parts:q}}],yield yield fe(B);let j=[];j.push(...K),j.push({role:"user",parts:q});let Q=Vt(m.contents).concat(j);m.contents=Q}else break}})})(this,l,e)}async generateContentInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=LA(this.apiClient,e);return a=X("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=qA(f),h=new gr;return Object.assign(h,m),h})}else{let c=FA(this.apiClient,e);return a=X("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=UA(f),h=new gr;return Object.assign(h,m),h})}}async generateContentStreamInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=LA(this.apiClient,e);return a=X("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(m){return sn(this,arguments,function*(){var h,y,_,T;try{for(var E=!0,w=an(m),b;b=yield fe(w.next()),h=b.done,!h;E=!0){T=b.value,E=!1;let L=T,D=qA(yield fe(L.json()),e);D.sdkHttpResponse={headers:L.headers};let I=new gr;Object.assign(I,D),yield yield fe(I)}}catch(L){y={error:L}}finally{try{!E&&!h&&(_=w.return)&&(yield fe(_.call(w)))}finally{if(y)throw y.error}}})})}else{let c=FA(this.apiClient,e);return a=X("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(m){return sn(this,arguments,function*(){var h,y,_,T;try{for(var E=!0,w=an(m),b;b=yield fe(w.next()),h=b.done,!h;E=!0){T=b.value,E=!1;let L=T,D=UA(yield fe(L.json()),e);D.sdkHttpResponse={headers:L.headers};let I=new gr;Object.assign(I,D),yield yield fe(I)}}catch(L){y={error:L}}finally{try{!E&&!h&&(_=w.return)&&(yield fe(_.call(w)))}finally{if(y)throw y.error}}})})}}async embedContent(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=A2(this.apiClient,e);return a=X("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=b2(f),h=new Is;return Object.assign(h,m),h})}else{let c=v2(this.apiClient,e);return a=X("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=C2(f),h=new Is;return Object.assign(h,m),h})}}async generateImagesInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=L2(this.apiClient,e);return a=X("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=q2(f),h=new xs;return Object.assign(h,m),h})}else{let c=F2(this.apiClient,e);return a=X("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=U2(f),h=new xs;return Object.assign(h,m),h})}}async editImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=S2(this.apiClient,e);return i=X("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>{let c=T2(l),f=new wu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=LW(this.apiClient,e);return i=X("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>{let c=UW(l),f=new vu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=_W(this.apiClient,e);return i=X("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=SW(l),f=new Au;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=CW(this.apiClient,e);return i=X("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=bW(l),f=new Cu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=nW(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>im(f))}else{let c=tW(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>om(f))}}async listInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=fW(this.apiClient,e);return a=X("{models_url}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=pW(f),h=new Ps;return Object.assign(h,m),h})}else{let c=cW(this.apiClient,e);return a=X("{models_url}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=dW(f),h=new Ps;return Object.assign(h,m),h})}}async update(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=DW(this.apiClient,e);return a=X("{model}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>im(f))}else{let c=OW(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>om(f))}}async delete(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=m2(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=y2(f),h=new ks;return Object.assign(h,m),h})}else{let c=h2(this.apiClient,e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=g2(f),h=new ks;return Object.assign(h,m),h})}}async countTokens(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=f2(this.apiClient,e);return a=X("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=p2(f),h=new Ns;return Object.assign(h,m),h})}else{let c=c2(this.apiClient,e);return a=X("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=d2(f),h=new Ns;return Object.assign(h,m),h})}}async computeTokens(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=r2(this.apiClient,e);return i=X("{model}:computeTokens",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>{let c=o2(l),f=new bu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=W2(this.apiClient,e);return a=X("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s.then(f=>{let m=$2(f),h=new Ms;return Object.assign(h,m),h})}else{let c=V2(this.apiClient,e);return a=X("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s.then(f=>{let m=H2(f),h=new Ms;return Object.assign(h,m),h})}}};var zu=class extends ln{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=n.name.split("/operations/")[0],i;r&&"httpOptions"in r&&(i=r.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){let n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=n.name.split("/operations/")[0],i;r&&"httpOptions"in r&&(i=r.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=xH(e);return a=X("{operationName}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),s}else{let c=IH(e);return a=X("{operationName}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),s}}async fetchPredictVideosOperationInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=EH(e);return i=X("{resourceName}:fetchPredictOperation",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}};function bJ(t){let e={},n=u(t,["data"]);if(n!=null&&d(e,["data"],n),u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function RJ(t){let e={},n=u(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>FJ(i))),d(e,["parts"],o)}let r=u(t,["role"]);return r!=null&&d(e,["role"],r),e}function IJ(t,e,n){let r={},o=u(e,["expireTime"]);n!==void 0&&o!=null&&d(n,["expireTime"],o);let i=u(e,["newSessionExpireTime"]);n!==void 0&&i!=null&&d(n,["newSessionExpireTime"],i);let s=u(e,["uses"]);n!==void 0&&s!=null&&d(n,["uses"],s);let a=u(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&d(n,["bidiGenerateContentSetup"],DJ(t,a));let l=u(e,["lockAdditionalFields"]);return n!==void 0&&l!=null&&d(n,["fieldMask"],l),r}function xJ(t,e){let n={},r=u(e,["config"]);return r!=null&&d(n,["config"],IJ(t,r,n)),n}function PJ(t){let e={};if(u(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=u(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);let r=u(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function kJ(t){let e={},n=u(t,["id"]);n!=null&&d(e,["id"],n);let r=u(t,["args"]);r!=null&&d(e,["args"],r);let o=u(t,["name"]);if(o!=null&&d(e,["name"],o),u(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function NJ(t){let e={};if(u(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let n=u(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function MJ(t){let e={};if(u(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let n=u(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function OJ(t,e){let n={},r=u(t,["generationConfig"]);e!==void 0&&r!=null&&d(e,["setup","generationConfig"],r);let o=u(t,["responseModalities"]);e!==void 0&&o!=null&&d(e,["setup","generationConfig","responseModalities"],o);let i=u(t,["temperature"]);e!==void 0&&i!=null&&d(e,["setup","generationConfig","temperature"],i);let s=u(t,["topP"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig","topP"],s);let a=u(t,["topK"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","topK"],a);let l=u(t,["maxOutputTokens"]);e!==void 0&&l!=null&&d(e,["setup","generationConfig","maxOutputTokens"],l);let c=u(t,["mediaResolution"]);e!==void 0&&c!=null&&d(e,["setup","generationConfig","mediaResolution"],c);let f=u(t,["seed"]);e!==void 0&&f!=null&&d(e,["setup","generationConfig","seed"],f);let m=u(t,["speechConfig"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","speechConfig"],Om(m));let h=u(t,["thinkingConfig"]);e!==void 0&&h!=null&&d(e,["setup","generationConfig","thinkingConfig"],h);let y=u(t,["enableAffectiveDialog"]);e!==void 0&&y!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],y);let _=u(t,["systemInstruction"]);e!==void 0&&_!=null&&d(e,["setup","systemInstruction"],RJ(Ke(_)));let T=u(t,["tools"]);if(e!==void 0&&T!=null){let P=ai(T);Array.isArray(P)&&(P=P.map(q=>UJ(si(q)))),d(e,["setup","tools"],P)}let E=u(t,["sessionResumption"]);e!==void 0&&E!=null&&d(e,["setup","sessionResumption"],LJ(E));let w=u(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&d(e,["setup","inputAudioTranscription"],w);let b=u(t,["outputAudioTranscription"]);e!==void 0&&b!=null&&d(e,["setup","outputAudioTranscription"],b);let L=u(t,["realtimeInputConfig"]);e!==void 0&&L!=null&&d(e,["setup","realtimeInputConfig"],L);let D=u(t,["contextWindowCompression"]);e!==void 0&&D!=null&&d(e,["setup","contextWindowCompression"],D);let I=u(t,["proactivity"]);if(e!==void 0&&I!=null&&d(e,["setup","proactivity"],I),u(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function DJ(t,e){let n={},r=u(e,["model"]);r!=null&&d(n,["setup","model"],_e(t,r));let o=u(e,["config"]);return o!=null&&d(n,["config"],OJ(o,n)),n}function FJ(t){let e={},n=u(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);let r=u(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);let o=u(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);let i=u(t,["fileData"]);i!=null&&d(e,["fileData"],PJ(i));let s=u(t,["functionCall"]);s!=null&&d(e,["functionCall"],kJ(s));let a=u(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);let l=u(t,["inlineData"]);l!=null&&d(e,["inlineData"],bJ(l));let c=u(t,["text"]);c!=null&&d(e,["text"],c);let f=u(t,["thought"]);f!=null&&d(e,["thought"],f);let m=u(t,["thoughtSignature"]);m!=null&&d(e,["thoughtSignature"],m);let h=u(t,["videoMetadata"]);return h!=null&&d(e,["videoMetadata"],h),e}function LJ(t){let e={},n=u(t,["handle"]);if(n!=null&&d(e,["handle"],n),u(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function UJ(t){let e={};if(u(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let n=u(t,["computerUse"]);n!=null&&d(e,["computerUse"],n);let r=u(t,["fileSearch"]);r!=null&&d(e,["fileSearch"],r);let o=u(t,["codeExecution"]);if(o!=null&&d(e,["codeExecution"],o),u(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let i=u(t,["functionDeclarations"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(m=>m)),d(e,["functionDeclarations"],f)}let s=u(t,["googleMaps"]);s!=null&&d(e,["googleMaps"],NJ(s));let a=u(t,["googleSearch"]);a!=null&&d(e,["googleSearch"],MJ(a));let l=u(t,["googleSearchRetrieval"]);l!=null&&d(e,["googleSearchRetrieval"],l);let c=u(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}function qJ(t){let e=[];for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){let o=Object.keys(r).map(i=>`${n}.${i}`);e.push(...o)}else e.push(n)}return e.join(",")}function BJ(t,e){let n=null,r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){let i=r.setup;typeof i=="object"&&i!==null?(t.bidiGenerateContentSetup=i,n=i):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;let o=t.fieldMask;if(n){let i=qJ(n);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)i?t.fieldMask=i:delete t.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){let s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];o.length>0&&(a=o.map(c=>s.includes(c)?`generationConfig.${c}`:c));let l=[];i&&l.push(i),a.length>0&&l.push(...a),l.length>0?t.fieldMask=l.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}var Ku=class extends ln{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=xJ(this.apiClient,e);i=X("auth_tokens",a._url),s=a._query,delete a.config,delete a._url,delete a._query;let l=BJ(a,e.config);return o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>c)}}};function GJ(t,e){let n={},r=u(t,["force"]);return e!==void 0&&r!=null&&d(e,["_query","force"],r),n}function HJ(t){let e={},n=u(t,["name"]);n!=null&&d(e,["_url","name"],n);let r=u(t,["config"]);return r!=null&&GJ(r,e),e}function $J(t){let e={},n=u(t,["name"]);return n!=null&&d(e,["_url","name"],n),e}function VJ(t,e){let n={},r=u(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);let o=u(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function WJ(t){let e={},n=u(t,["parent"]);n!=null&&d(e,["_url","parent"],n);let r=u(t,["config"]);return r!=null&&VJ(r,e),e}function JJ(t){let e={},n=u(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);let r=u(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);let o=u(t,["documents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["documents"],i)}return e}var cm=class extends ln{constructor(e){super(),this.apiClient=e,this.list=async n=>new bn(C.PagedItem.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=$J(e);return i=X("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>l)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=HJ(e);o=X("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=WJ(e);return i=X("{parent}/documents",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=JJ(l),f=new Ru;return Object.assign(f,c),f})}}};var fm=class extends ln{constructor(e,n=new cm(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new bn(C.PagedItem.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=WW(e);return i=X("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>l)}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=KW(e);return i=X("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>l)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=zW(e);o=X("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=eJ(e);return i=X("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=tJ(l),f=new Iu;return Object.assign(f,c),f})}}async uploadToFileSearchStoreInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=nJ(e);return i=X("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=rJ(l),f=new xu;return Object.assign(f,c),f})}}async importFile(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=XW(e);return i=X("{file_search_store_name}:importFile",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json()),o.then(l=>{let c=jW(l),f=new Pu;return Object.assign(f,c),f})}}};var IC=function(){let{crypto:t}=globalThis;if(t?.randomUUID)return IC=t.randomUUID.bind(t),t.randomUUID();let e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))},zJ=()=>IC();function dm(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}var pm=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){let e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};var dt=class extends Error{},pt=class t extends dt{constructor(e,n,r,o){super(`${t.makeMessage(e,n,r)}`),this.status=e,this.headers=o,this.error=n}static makeMessage(e,n,r){let o=n?.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,n,r,o){if(!e||!o)return new oi({message:r,cause:pm(n)});let i=n;return e===400?new ju(e,i,r,o):e===401?new Xu(e,i,r,o):e===403?new Qu(e,i,r,o):e===404?new Zu(e,i,r,o):e===409?new ec(e,i,r,o):e===422?new tc(e,i,r,o):e===429?new nc(e,i,r,o):e>=500?new rc(e,i,r,o):new t(e,i,r,o)}},Gs=class extends pt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},oi=class extends pt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}},Yu=class extends oi{constructor({message:e}={}){super({message:e??"Request timed out."})}},ju=class extends pt{},Xu=class extends pt{},Qu=class extends pt{},Zu=class extends pt{},ec=class extends pt{},tc=class extends pt{},nc=class extends pt{},rc=class extends pt{};var KJ=/^[a-z][a-z0-9+.-]*:/i,YJ=t=>KJ.test(t),hm=t=>(hm=Array.isArray,hm(t)),jJ=hm,XJ=jJ,WA=XJ;function QJ(t){if(!t)return!0;for(let e in t)return!1;return!0}function ZJ(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ez=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new dt(`${t} must be an integer`);if(e<0)throw new dt(`${t} must be a positive integer`);return e},tz=t=>{try{return JSON.parse(t)}catch{return}};var nz=t=>new Promise(e=>setTimeout(e,t));var ei="0.0.1";function rz(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var oz=()=>{var t,e,n,r,o;let i=rz();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ei,"X-Stainless-OS":zA(Deno.build.os),"X-Stainless-Arch":JA(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ei,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ei,"X-Stainless-OS":zA((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":JA((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};let s=iz();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ei,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ei,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function iz(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:n}of t){let r=n.exec(navigator.userAgent);if(r){let o=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${o}.${i}.${s}`}}}return null}var JA=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",zA=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),mu,sz=()=>mu??(mu=oz());function az(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function xC(...t){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function lz(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return xC({start(){},async pull(n){let{done:r,value:o}=await e.next();r?n.close():n.enqueue(o)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function PC(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let n=await e.read();return n?.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){let n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function uz(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}let r=t.getReader(),o=r.cancel();r.releaseLock(),await o}var cz=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var kC=()=>{var t;if(typeof File>"u"){let{process:e}=globalThis,n=typeof((t=e?.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ph(t,e,n){return kC(),new File(t,e??"unknown_file",n)}function fz(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}var dz=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";var NC=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",pz=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&NC(t),hz=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function mz(t,e,n){if(kC(),t=await t,pz(t))return t instanceof File?t:Ph([await t.arrayBuffer()],t.name);if(hz(t)){let o=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Ph(await mm(o),e,n)}let r=await mm(t);if(e||(e=fz(t)),!n?.type){let o=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof o=="string"&&(n=Object.assign(Object.assign({},n),{type:o}))}return Ph(r,e,n)}async function mm(t){var e,n,r,o,i;let s=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)s.push(t);else if(NC(t))s.push(t instanceof Blob?t:await t.arrayBuffer());else if(dz(t))try{for(var a=!0,l=an(t),c;c=await l.next(),e=c.done,!e;a=!0){o=c.value,a=!1;let f=o;s.push(...await mm(f))}}catch(f){n={error:f}}finally{try{!a&&!e&&(r=l.return)&&await r.call(l)}finally{if(n)throw n.error}}else{let f=(i=t?.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof t}${f?`; constructor: ${f}`:""}${gz(t)}`)}return s}function gz(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}var oc=class{constructor(e){this._client=e}};oc._key=[];function MC(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var KA=Object.freeze(Object.create(null)),yz=(t=MC)=>(function(n,...r){if(n.length===1)return n[0];let o=!1,i=[],s=n.reduce((f,m,h)=>{var y,_,T;/[?#]/.test(m)&&(o=!0);let E=r[h],w=(o?encodeURIComponent:t)(""+E);return h!==r.length&&(E==null||typeof E=="object"&&E.toString===((T=Object.getPrototypeOf((_=Object.getPrototypeOf((y=E.hasOwnProperty)!==null&&y!==void 0?y:KA))!==null&&_!==void 0?_:KA))===null||T===void 0?void 0:T.toString))&&(w=E+"",i.push({start:f.length+m.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(E).slice(8,-1)} is not a valid path parameter`})),f+m+(h===r.length?"":w)},""),a=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=l.exec(a))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(i.sort((f,m)=>f.start-m.start),i.length>0){let f=0,m=i.reduce((h,y)=>{let _=" ".repeat(y.start-f),T="^".repeat(y.length);return f=y.start+y.length,h+_+T},"");throw new dt(`Path parameters result in path with invalid segments:
${i.map(h=>h.error).join(`
`)}
${s}
${m}`)}return s}),gu=yz(MC);var ic=class extends oc{create(e,n){var r;let{api_version:o=this._client.apiVersion}=e,i=Bu(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new dt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new dt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(gu`/${o}/interactions`,Object.assign(Object.assign({body:i},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){let{api_version:o=this._client.apiVersion}=n??{};return this._client.delete(gu`/${o}/interactions/${e}`,r)}cancel(e,n={},r){let{api_version:o=this._client.apiVersion}=n??{};return this._client.post(gu`/${o}/interactions/${e}/cancel`,r)}get(e,n={},r){var o;let i=n??{},{api_version:s=this._client.apiVersion}=i,a=Bu(i,["api_version"]);return this._client.get(gu`/${s}/interactions/${e}`,Object.assign(Object.assign({query:a},r),{stream:(o=n?.stream)!==null&&o!==void 0?o:!1}))}};ic._key=Object.freeze(["interactions"]);var sc=class extends ic{};function _z(t){let e=0;for(let o of t)e+=o.length;let n=new Uint8Array(e),r=0;for(let o of t)n.set(o,r),r+=o.length;return n}var yu;function Fm(t){let e;return(yu??(e=new globalThis.TextEncoder,yu=e.encode.bind(e)))(t)}var _u;function YA(t){let e;return(_u??(e=new globalThis.TextDecoder,_u=e.decode.bind(e)))(t)}var ii=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Fm(e):e;this.buffer=_z([this.buffer,n]);let r=[],o;for(;(o=Sz(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){r.push(YA(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let i=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,s=YA(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}};ii.NEWLINE_CHARS=new Set([`
`,"\r"]);ii.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Sz(t,e){for(let o=e??0;o<t.length;o++){if(t[o]===10)return{preceding:o,index:o+1,carriage:!1};if(t[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function Tz(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}var ac={off:0,error:200,warn:300,info:400,debug:500},jA=(t,e,n)=>{if(t){if(ZJ(ac,t))return t;rt(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(ac))}`)}};function Rs(){}function Su(t,e,n){return!e||ac[t]>ac[n]?Rs:e[t].bind(e)}var Ez={error:Rs,warn:Rs,info:Rs,debug:Rs},XA=new WeakMap;function rt(t){var e;let n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return Ez;let o=XA.get(n);if(o&&o[0]===r)return o[1];let i={error:Su("error",n,r),warn:Su("warn",n,r),info:Su("info",n,r),debug:Su("debug",n,r)};return XA.set(n,[r,i]),i}var Kr=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);var gm=class t{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let o=!1,i=r?rt(r):console;function s(){return sn(this,arguments,function*(){var l,c,f,m;if(o)throw new dt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let h=!1;try{try{for(var y=!0,_=an(wz(e,n)),T;T=yield fe(_.next()),l=T.done,!l;y=!0){m=T.value,y=!1;let E=m;if(!h)if(E.data.startsWith("[DONE]")){h=!0;continue}else try{yield yield fe(JSON.parse(E.data))}catch(w){throw i.error("Could not parse message into JSON:",E.data),i.error("From chunk:",E.raw),w}}}catch(E){c={error:E}}finally{try{!y&&!l&&(f=_.return)&&(yield fe(f.call(_)))}finally{if(c)throw c.error}}h=!0}catch(E){if(dm(E))return yield fe(void 0);throw E}finally{h||n.abort()}})}return new t(s,n,r)}static fromReadableStream(e,n,r){let o=!1;function i(){return sn(this,arguments,function*(){var l,c,f,m;let h=new ii,y=PC(e);try{for(var _=!0,T=an(y),E;E=yield fe(T.next()),l=E.done,!l;_=!0){m=E.value,_=!1;let w=m;for(let b of h.decode(w))yield yield fe(b)}}catch(w){c={error:w}}finally{try{!_&&!l&&(f=T.return)&&(yield fe(f.call(T)))}finally{if(c)throw c.error}}for(let w of h.flush())yield yield fe(w)})}function s(){return sn(this,arguments,function*(){var l,c,f,m;if(o)throw new dt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let h=!1;try{try{for(var y=!0,_=an(i()),T;T=yield fe(_.next()),l=T.done,!l;y=!0){m=T.value,y=!1;let E=m;h||E&&(yield yield fe(JSON.parse(E)))}}catch(E){c={error:E}}finally{try{!y&&!l&&(f=_.return)&&(yield fe(f.call(_)))}finally{if(c)throw c.error}}h=!0}catch(E){if(dm(E))return yield fe(void 0);throw E}finally{h||n.abort()}})}return new t(s,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],n=[],r=this.iterator(),o=i=>({next:()=>{if(i.length===0){let s=r.next();e.push(s),n.push(s)}return i.shift()}});return[new t(()=>o(e),this.controller,this.client),new t(()=>o(n),this.controller,this.client)]}toReadableStream(){let e=this,n;return xC({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{let{value:o,done:i}=await n.next();if(i)return r.close();let s=Fm(JSON.stringify(o)+`
`);r.enqueue(s)}catch(o){r.error(o)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}};function wz(t,e){return sn(this,arguments,function*(){var r,o,i,s;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new dt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new dt("Attempted to iterate over a response with no body");let a=new ym,l=new ii,c=PC(t.body);try{for(var f=!0,m=an(vz(c)),h;h=yield fe(m.next()),r=h.done,!r;f=!0){s=h.value,f=!1;let y=s;for(let _ of l.decode(y)){let T=a.decode(_);T&&(yield yield fe(T))}}}catch(y){o={error:y}}finally{try{!f&&!r&&(i=m.return)&&(yield fe(i.call(m)))}finally{if(o)throw o.error}}for(let y of l.flush()){let _=a.decode(y);_&&(yield yield fe(_))}})}function vz(t){return sn(this,arguments,function*(){var n,r,o,i;let s=new Uint8Array;try{for(var a=!0,l=an(t),c;c=yield fe(l.next()),n=c.done,!n;a=!0){i=c.value,a=!1;let f=i;if(f==null)continue;let m=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?Fm(f):f,h=new Uint8Array(s.length+m.length);h.set(s),h.set(m,s.length),s=h;let y;for(;(y=Tz(s))!==-1;)yield yield fe(s.slice(0,y)),s=s.slice(y)}}catch(f){r={error:f}}finally{try{!a&&!n&&(o=l.return)&&(yield fe(o.call(l)))}finally{if(r)throw r.error}}s.length>0&&(yield yield fe(s))})}var ym=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,o]=Az(e,":");return o.startsWith(" ")&&(o=o.substring(1)),n==="event"?this.event=o:n==="data"&&this.data.push(o),null}};function Az(t,e){let n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}async function Cz(t,e){let{response:n,requestLogID:r,retryOfRequestLogID:o,startTime:i}=e,s=await(async()=>{var a;if(e.options.stream)return rt(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):gm.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;let l=n.headers.get("content-type"),c=(a=l?.split(";")[0])===null||a===void 0?void 0:a.trim();return c?.includes("application/json")||c?.endsWith("+json")?await n.json():await n.text()})();return rt(t).debug(`[${r}] response parsed`,Kr({retryOfRequestLogID:o,url:n.url,status:n.status,body:s,durationMs:Date.now()-i})),s}var _m=class t extends Promise{constructor(e,n,r=Cz){super(o=>{o(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new t(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var OC=Symbol("brand.privateNullableHeaders");function*bz(t){if(!t)return;if(OC in t){let{values:r,nulls:o}=t;yield*r.entries();for(let i of o)yield[i,null];return}let e=!1,n;t instanceof Headers?n=t.entries():WA(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){let o=r[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let i=WA(r[1])?r[1]:[r[1]],s=!1;for(let a of i)a!==void 0&&(e&&!s&&(s=!0,yield[o,null]),yield[o,a])}}var Cs=t=>{let e=new Headers,n=new Set;for(let r of t){let o=new Set;for(let[i,s]of bz(r)){let a=i.toLowerCase();o.has(a)||(e.delete(i),o.add(a)),s===null?(e.delete(i),n.add(a)):(e.append(i,s),n.delete(a))}}return{[OC]:!0,values:e,nulls:n}};var kh=t=>{var e,n,r,o,i,s;if(typeof globalThis.process<"u")return(r=(n=(e=globalThis.process.env)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||i===void 0?void 0:i.call(o,t))===null||s===void 0?void 0:s.trim()};var DC,lc=class t{constructor(e){var n,r,o,i,s,a,l,{baseURL:c=kh("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:f=(n=kh("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:m="v1beta"}=e,h=Bu(e,["baseURL","apiKey","apiVersion"]);let y=Object.assign(Object.assign({apiKey:f,apiVersion:m},h),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=y.baseURL,this.timeout=(r=y.timeout)!==null&&r!==void 0?r:t.DEFAULT_TIMEOUT,this.logger=(o=y.logger)!==null&&o!==void 0?o:console;let _="warn";this.logLevel=_,this.logLevel=(s=(i=jA(y.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:jA(kh("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:_,this.fetchOptions=y.fetchOptions,this.maxRetries=(a=y.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(l=y.fetch)!==null&&l!==void 0?l:az(),this.encoder=cz,this._options=y,this.apiKey=f,this.apiVersion=m,this.clientAdapter=y.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let n=Cs([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return Cs([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Cs([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new dt(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${ei}`}defaultIdempotencyKey(){return`stainless-node-retry-${zJ()}`}makeStatusError(e,n,r,o){return pt.generate(e,n,r,o)}buildURL(e,n,r){let o=!this.baseURLOverridden()&&r||this.baseURL,i=YJ(e)?new URL(e):new URL(o+(o.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return QJ(s)||(n=Object.assign(Object.assign({},s),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(o=>Object.assign({method:e,path:n},o)))}request(e,n=null){return new _m(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var o,i,s;let a=await e,l=(o=a.maxRetries)!==null&&o!==void 0?o:this.maxRetries;n==null&&(n=l),await this.prepareOptions(a);let{req:c,url:f,timeout:m}=await this.buildRequest(a,{retryCount:l-n});await this.prepareRequest(c,{url:f,options:a});let h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),y=r===void 0?"":`, retryOf: ${r}`,_=Date.now();if(rt(this).debug(`[${h}] sending request`,Kr({retryOfRequestLogID:r,method:a.method,url:f,options:a,headers:c.headers})),!((i=a.signal)===null||i===void 0)&&i.aborted)throw new Gs;let T=new AbortController,E=await this.fetchWithTimeout(f,c,m,T).catch(pm),w=Date.now();if(E instanceof globalThis.Error){let L=`retrying, ${n} attempts remaining`;if(!((s=a.signal)===null||s===void 0)&&s.aborted)throw new Gs;let D=dm(E)||/timed? ?out/i.test(String(E)+("cause"in E?String(E.cause):""));if(n)return rt(this).info(`[${h}] connection ${D?"timed out":"failed"} - ${L}`),rt(this).debug(`[${h}] connection ${D?"timed out":"failed"} (${L})`,Kr({retryOfRequestLogID:r,url:f,durationMs:w-_,message:E.message})),this.retryRequest(a,n,r??h);throw rt(this).info(`[${h}] connection ${D?"timed out":"failed"} - error; no more retries left`),rt(this).debug(`[${h}] connection ${D?"timed out":"failed"} (error; no more retries left)`,Kr({retryOfRequestLogID:r,url:f,durationMs:w-_,message:E.message})),D?new Yu:new oi({cause:E})}let b=`[${h}${y}] ${c.method} ${f} ${E.ok?"succeeded":"failed"} with status ${E.status} in ${w-_}ms`;if(!E.ok){let L=await this.shouldRetry(E);if(n&&L){let B=`retrying, ${n} attempts remaining`;return await uz(E.body),rt(this).info(`${b} - ${B}`),rt(this).debug(`[${h}] response error (${B})`,Kr({retryOfRequestLogID:r,url:E.url,status:E.status,headers:E.headers,durationMs:w-_})),this.retryRequest(a,n,r??h,E.headers)}let D=L?"error; no more retries left":"error; not retryable";rt(this).info(`${b} - ${D}`);let I=await E.text().catch(B=>pm(B).message),P=tz(I),q=P?void 0:I;throw rt(this).debug(`[${h}] response error (${D})`,Kr({retryOfRequestLogID:r,url:E.url,status:E.status,headers:E.headers,message:q,durationMs:Date.now()-_})),this.makeStatusError(E.status,P,q,E.headers)}return rt(this).info(b),rt(this).debug(`[${h}] response start`,Kr({retryOfRequestLogID:r,url:E.url,status:E.status,headers:E.headers,durationMs:w-_})),{response:E,options:a,controller:T,requestLogID:h,retryOfRequestLogID:r,startTime:_}}async fetchWithTimeout(e,n,r,o){let i=n||{},{signal:s,method:a}=i,l=Bu(i,["signal","method"]);s&&s.addEventListener("abort",()=>o.abort());let c=setTimeout(()=>o.abort(),r),f=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,m=Object.assign(Object.assign(Object.assign({signal:o.signal},f?{duplex:"half"}:{}),{method:"GET"}),l);a&&(m.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(c)}}async shouldRetry(e){let n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,o){var i;let s,a=o?.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(s=c)}let l=o?.get("retry-after");if(l&&!s){let c=parseFloat(l);Number.isNaN(c)?s=Date.parse(l)-Date.now():s=c*1e3}if(!(s&&0<=s&&s<60*1e3)){let c=(i=e.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,c)}return await nz(s),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){let i=n-e,s=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return s*a*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,o,i;let s=Object.assign({},e),{method:a,path:l,query:c,defaultBaseURL:f}=s,m=this.buildURL(l,c,f);"timeout"in s&&ez("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;let{bodyHeaders:h,body:y}=this.buildBody({options:s}),_=await this.buildHeaders({options:e,method:a,bodyHeaders:h,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:_},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&y instanceof globalThis.ReadableStream&&{duplex:"half"}),y&&{body:y}),(o=this.fetchOptions)!==null&&o!==void 0?o:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:m,timeout:s.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:o}){let i={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let s=await this.authHeaders(e),a=Cs([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),sz()),this._options.defaultHeaders,r,e.headers,s]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=Cs([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:lz(e)}:this.encoder({body:e,headers:r})}};lc.DEFAULT_TIMEOUT=6e4;var Ne=class extends lc{constructor(){super(...arguments),this.interactions=new sc(this)}};DC=Ne;Ne.GeminiNextGenAPIClient=DC;Ne.GeminiNextGenAPIClientError=dt;Ne.APIError=pt;Ne.APIConnectionError=oi;Ne.APIConnectionTimeoutError=Yu;Ne.APIUserAbortError=Gs;Ne.NotFoundError=Zu;Ne.ConflictError=ec;Ne.RateLimitError=nc;Ne.BadRequestError=ju;Ne.AuthenticationError=Xu;Ne.InternalServerError=rc;Ne.PermissionDeniedError=Qu;Ne.UnprocessableEntityError=tc;Ne.toFile=mz;Ne.Interactions=sc;var QA="x-goog-api-key",bs="https://www.googleapis.com/auth/cloud-platform",Sm=class{constructor(e){if(e.apiKey!==void 0){this.apiKey=e.apiKey;return}let n=Rz(e.googleAuthOptions);this.googleAuth=new uH.GoogleAuth(n)}async addAuthHeaders(e,n){if(this.apiKey!==void 0){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,n)}addKeyHeader(e){if(e.get(QA)===null){if(this.apiKey===void 0)throw new Error("Trying to set API key header but apiKey is not set");e.append(QA,this.apiKey)}}async addGoogleAuthHeaders(e,n){if(this.googleAuth===void 0)throw new Error("Trying to set google-auth headers but googleAuth is unset");let r=await this.googleAuth.getRequestHeaders(n);for(let[o,i]of r)e.get(o)===null&&e.append(o,i)}};function Rz(t){let e;if(t){if(e=t,e.scopes){if(typeof e.scopes=="string"&&e.scopes!==bs||Array.isArray(e.scopes)&&e.scopes.indexOf(bs)<0)throw new Error(`Invalid auth scopes. Scopes must include: ${bs}`)}else return e.scopes=[bs],e;return e}else return e={scopes:[bs]},e}var Tm=class{async download(e,n){if(e.downloadPath){let r=await Iz(e,n);if(r instanceof _r){let o=cH.createWriteStream(e.downloadPath);fH.Readable.fromWeb(r.responseInternal.body).pipe(o),await dH.finished(o)}else try{await ZA.writeFile(e.downloadPath,r,{encoding:"base64"})}catch(o){throw new Error(`Failed to write file to ${e.downloadPath}: ${o}`)}}}};async function Iz(t,e){var n,r,o;let i=Dm(t.file);if(i!==void 0)return await e.request({path:`files/${i}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal});if(uC(t.file)){let s=(o=t.file.video)===null||o===void 0?void 0:o.videoBytes;if(typeof s=="string")return s;throw new Error("Failed to download generated video, Uri or videoBytes not found.")}else if(cC(t.file)){let s=t.file.videoBytes;if(typeof s=="string")return s;throw new Error("Failed to download video, Uri or videoBytes not found.")}else throw new Error("Unsupported file type")}var Em=class{create(e,n,r){return new wm(e,n,r)}},wm=class{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new mH.WebSocket(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};function xz(t,e){let n={},r=u(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function Pz(t,e){let n={},r=u(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function kz(t,e){let n={},r=u(t,["sdkHttpResponse"]);return r!=null&&d(n,["sdkHttpResponse"],r),n}function Nz(t,e){let n={},r=u(t,["sdkHttpResponse"]);return r!=null&&d(n,["sdkHttpResponse"],r),n}function Mz(t,e,n){let r={};if(u(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let o=u(t,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&d(e,["displayName"],o),u(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let i=u(t,["epochCount"]);e!==void 0&&i!=null&&d(e,["tuningTask","hyperparameters","epochCount"],i);let s=u(t,["learningRateMultiplier"]);if(s!=null&&d(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),u(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(u(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(u(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(u(t,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(u(t,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");let a=u(t,["batchSize"]);e!==void 0&&a!=null&&d(e,["tuningTask","hyperparameters","batchSize"],a);let l=u(t,["learningRate"]);if(e!==void 0&&l!=null&&d(e,["tuningTask","hyperparameters","learningRate"],l),u(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(u(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(u(t,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(u(t,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(u(t,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(u(t,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");return r}function Oz(t,e,n){let r={},o=u(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let I=u(t,["validationDataset"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec"],Nh(I))}else if(o==="PREFERENCE_TUNING"){let I=u(t,["validationDataset"]);e!==void 0&&I!=null&&d(e,["preferenceOptimizationSpec"],Nh(I))}else if(o==="DISTILLATION"){let I=u(t,["validationDataset"]);e!==void 0&&I!=null&&d(e,["distillationSpec"],Nh(I))}let i=u(t,["tunedModelDisplayName"]);e!==void 0&&i!=null&&d(e,["tunedModelDisplayName"],i);let s=u(t,["description"]);e!==void 0&&s!=null&&d(e,["description"],s);let a=u(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let I=u(t,["epochCount"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","hyperParameters","epochCount"],I)}else if(a==="PREFERENCE_TUNING"){let I=u(t,["epochCount"]);e!==void 0&&I!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],I)}else if(a==="DISTILLATION"){let I=u(t,["epochCount"]);e!==void 0&&I!=null&&d(e,["distillationSpec","hyperParameters","epochCount"],I)}let l=u(n,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let I=u(t,["learningRateMultiplier"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],I)}else if(l==="PREFERENCE_TUNING"){let I=u(t,["learningRateMultiplier"]);e!==void 0&&I!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],I)}else if(l==="DISTILLATION"){let I=u(t,["learningRateMultiplier"]);e!==void 0&&I!=null&&d(e,["distillationSpec","hyperParameters","learningRateMultiplier"],I)}let c=u(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let I=u(t,["exportLastCheckpointOnly"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","exportLastCheckpointOnly"],I)}else if(c==="PREFERENCE_TUNING"){let I=u(t,["exportLastCheckpointOnly"]);e!==void 0&&I!=null&&d(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],I)}else if(c==="DISTILLATION"){let I=u(t,["exportLastCheckpointOnly"]);e!==void 0&&I!=null&&d(e,["distillationSpec","exportLastCheckpointOnly"],I)}let f=u(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){let I=u(t,["adapterSize"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","hyperParameters","adapterSize"],I)}else if(f==="PREFERENCE_TUNING"){let I=u(t,["adapterSize"]);e!==void 0&&I!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],I)}else if(f==="DISTILLATION"){let I=u(t,["adapterSize"]);e!==void 0&&I!=null&&d(e,["distillationSpec","hyperParameters","adapterSize"],I)}let m=u(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){let I=u(t,["tuningMode"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","tuningMode"],I)}let h=u(t,["customBaseModel"]);e!==void 0&&h!=null&&d(e,["customBaseModel"],h);let y=u(n,["config","method"]);if(y===void 0&&(y="SUPERVISED_FINE_TUNING"),y==="SUPERVISED_FINE_TUNING"){let I=u(t,["batchSize"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","hyperParameters","batchSize"],I)}let _=u(n,["config","method"]);if(_===void 0&&(_="SUPERVISED_FINE_TUNING"),_==="SUPERVISED_FINE_TUNING"){let I=u(t,["learningRate"]);e!==void 0&&I!=null&&d(e,["supervisedTuningSpec","hyperParameters","learningRate"],I)}let T=u(t,["labels"]);e!==void 0&&T!=null&&d(e,["labels"],T);let E=u(t,["beta"]);e!==void 0&&E!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","beta"],E);let w=u(t,["baseTeacherModel"]);e!==void 0&&w!=null&&d(e,["distillationSpec","baseTeacherModel"],w);let b=u(t,["tunedTeacherModelSource"]);e!==void 0&&b!=null&&d(e,["distillationSpec","tunedTeacherModelSource"],b);let L=u(t,["sftLossWeightMultiplier"]);e!==void 0&&L!=null&&d(e,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],L);let D=u(t,["outputUri"]);return e!==void 0&&D!=null&&d(e,["outputUri"],D),r}function Dz(t,e){let n={},r=u(t,["baseModel"]);r!=null&&d(n,["baseModel"],r);let o=u(t,["preTunedModel"]);o!=null&&d(n,["preTunedModel"],o);let i=u(t,["trainingDataset"]);i!=null&&Jz(i);let s=u(t,["config"]);return s!=null&&Mz(s,n),n}function Fz(t,e){let n={},r=u(t,["baseModel"]);r!=null&&d(n,["baseModel"],r);let o=u(t,["preTunedModel"]);o!=null&&d(n,["preTunedModel"],o);let i=u(t,["trainingDataset"]);i!=null&&zz(i,n,e);let s=u(t,["config"]);return s!=null&&Oz(s,n,e),n}function Lz(t,e){let n={},r=u(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function Uz(t,e){let n={},r=u(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function qz(t,e,n){let r={},o=u(t,["pageSize"]);e!==void 0&&o!=null&&d(e,["_query","pageSize"],o);let i=u(t,["pageToken"]);e!==void 0&&i!=null&&d(e,["_query","pageToken"],i);let s=u(t,["filter"]);return e!==void 0&&s!=null&&d(e,["_query","filter"],s),r}function Bz(t,e,n){let r={},o=u(t,["pageSize"]);e!==void 0&&o!=null&&d(e,["_query","pageSize"],o);let i=u(t,["pageToken"]);e!==void 0&&i!=null&&d(e,["_query","pageToken"],i);let s=u(t,["filter"]);return e!==void 0&&s!=null&&d(e,["_query","filter"],s),r}function Gz(t,e){let n={},r=u(t,["config"]);return r!=null&&qz(r,n),n}function Hz(t,e){let n={},r=u(t,["config"]);return r!=null&&Bz(r,n),n}function $z(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["nextPageToken"]);o!=null&&d(n,["nextPageToken"],o);let i=u(t,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>FC(a))),d(n,["tuningJobs"],s)}return n}function Vz(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["nextPageToken"]);o!=null&&d(n,["nextPageToken"],o);let i=u(t,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>vm(a))),d(n,["tuningJobs"],s)}return n}function Wz(t,e){let n={},r=u(t,["name"]);r!=null&&d(n,["model"],r);let o=u(t,["name"]);return o!=null&&d(n,["endpoint"],o),n}function Jz(t,e){let n={};if(u(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=u(t,["examples"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),d(n,["examples","examples"],o)}return n}function zz(t,e,n){let r={},o=u(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let s=u(t,["gcsUri"]);e!==void 0&&s!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){let s=u(t,["gcsUri"]);e!==void 0&&s!=null&&d(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}else if(o==="DISTILLATION"){let s=u(t,["gcsUri"]);e!==void 0&&s!=null&&d(e,["distillationSpec","promptDatasetUri"],s)}let i=u(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let s=u(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){let s=u(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&d(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}else if(i==="DISTILLATION"){let s=u(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&d(e,["distillationSpec","promptDatasetUri"],s)}if(u(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function FC(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["name"]);o!=null&&d(n,["name"],o);let i=u(t,["state"]);i!=null&&d(n,["state"],lC(i));let s=u(t,["createTime"]);s!=null&&d(n,["createTime"],s);let a=u(t,["tuningTask","startTime"]);a!=null&&d(n,["startTime"],a);let l=u(t,["tuningTask","completeTime"]);l!=null&&d(n,["endTime"],l);let c=u(t,["updateTime"]);c!=null&&d(n,["updateTime"],c);let f=u(t,["description"]);f!=null&&d(n,["description"],f);let m=u(t,["baseModel"]);m!=null&&d(n,["baseModel"],m);let h=u(t,["_self"]);return h!=null&&d(n,["tunedModel"],Wz(h)),n}function vm(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["name"]);o!=null&&d(n,["name"],o);let i=u(t,["state"]);i!=null&&d(n,["state"],lC(i));let s=u(t,["createTime"]);s!=null&&d(n,["createTime"],s);let a=u(t,["startTime"]);a!=null&&d(n,["startTime"],a);let l=u(t,["endTime"]);l!=null&&d(n,["endTime"],l);let c=u(t,["updateTime"]);c!=null&&d(n,["updateTime"],c);let f=u(t,["error"]);f!=null&&d(n,["error"],f);let m=u(t,["description"]);m!=null&&d(n,["description"],m);let h=u(t,["baseModel"]);h!=null&&d(n,["baseModel"],h);let y=u(t,["tunedModel"]);y!=null&&d(n,["tunedModel"],y);let _=u(t,["preTunedModel"]);_!=null&&d(n,["preTunedModel"],_);let T=u(t,["supervisedTuningSpec"]);T!=null&&d(n,["supervisedTuningSpec"],T);let E=u(t,["preferenceOptimizationSpec"]);E!=null&&d(n,["preferenceOptimizationSpec"],E);let w=u(t,["distillationSpec"]);w!=null&&d(n,["distillationSpec"],w);let b=u(t,["tuningDataStats"]);b!=null&&d(n,["tuningDataStats"],b);let L=u(t,["encryptionSpec"]);L!=null&&d(n,["encryptionSpec"],L);let D=u(t,["partnerModelTuningSpec"]);D!=null&&d(n,["partnerModelTuningSpec"],D);let I=u(t,["customBaseModel"]);I!=null&&d(n,["customBaseModel"],I);let P=u(t,["experiment"]);P!=null&&d(n,["experiment"],P);let q=u(t,["labels"]);q!=null&&d(n,["labels"],q);let K=u(t,["outputUri"]);K!=null&&d(n,["outputUri"],K);let B=u(t,["pipelineJob"]);B!=null&&d(n,["pipelineJob"],B);let j=u(t,["serviceAccount"]);j!=null&&d(n,["serviceAccount"],j);let Q=u(t,["tunedModelDisplayName"]);Q!=null&&d(n,["tunedModelDisplayName"],Q);let oe=u(t,["veoTuningSpec"]);return oe!=null&&d(n,["veoTuningSpec"],oe),n}function Kz(t,e){let n={},r=u(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);let o=u(t,["name"]);o!=null&&d(n,["name"],o);let i=u(t,["metadata"]);i!=null&&d(n,["metadata"],i);let s=u(t,["done"]);s!=null&&d(n,["done"],s);let a=u(t,["error"]);return a!=null&&d(n,["error"],a),n}function Nh(t,e){let n={},r=u(t,["gcsUri"]);r!=null&&d(n,["validationDatasetUri"],r);let o=u(t,["vertexDatasetResource"]);return o!=null&&d(n,["validationDatasetUri"],o),n}var Am=class extends ln{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new bn(C.PagedItem.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){let o={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(o.checkpointId=n.config.preTunedModelCheckpointId);let i=Object.assign(Object.assign({},n),{preTunedModel:o});return i.baseModel=void 0,await this.tuneInternal(i)}else{let o=Object.assign({},n);return await this.tuneInternal(o)}else{let o=Object.assign({},n),i=await this.tuneMldevInternal(o),s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:C.JobState.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Uz(e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>vm(f))}else{let c=Lz(e);return a=X("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>FC(f))}}async listInternal(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Hz(e);return a=X("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=Vz(f),h=new Os;return Object.assign(h,m),h})}else{let c=Gz(e);return a=X("tunedModels",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=$z(f),h=new Os;return Object.assign(h,m),h})}}async cancel(e){var n,r,o,i;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Pz(e);return a=X("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=Nz(f),h=new Ds;return Object.assign(h,m),h})}else{let c=xz(e);return a=X("{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(m=>{let h=m;return h.sdkHttpResponse={headers:f.headers},h})),s.then(f=>{let m=kz(f),h=new Ds;return Object.assign(h,m),h})}}async tuneInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){let a=Fz(e,e);return i=X("tuningJobs",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>vm(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=Dz(e);return i=X("tunedModels",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(l=>l.json().then(c=>{let f=c;return f.sdkHttpResponse={headers:l.headers},f})),o.then(l=>Kz(l))}}},LC=1024*1024*8,UC=3,qC=1e3,BC=2,yr="x-goog-upload-status";async function Yz(t,e,n){var r;let o=await GC(t,e,n),i=await o?.json();if(((r=o?.headers)===null||r===void 0?void 0:r[yr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function jz(t,e,n){var r;let o=await GC(t,e,n),i=await o?.json();if(((r=o?.headers)===null||r===void 0?void 0:r[yr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let s=Pm(i),a=new qs;return Object.assign(a,s),a}async function GC(t,e,n){var r,o;let i=0,s=0,a=new _r(new Response),l="upload";for(i=t.size;s<i;){let c=Math.min(LC,i-s),f=t.slice(s,s+c);s+c>=i&&(l+=", finalize");let m=0,h=qC;for(;m<UC&&(a=await n.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(c)}}}),!(!((r=a?.headers)===null||r===void 0)&&r[yr]));)m++,await HC(h),h=h*BC;if(s+=c,((o=a?.headers)===null||o===void 0?void 0:o[yr])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function Xz(t){return{size:t.size,type:t.type}}function HC(t){return new Promise(e=>setTimeout(e,t))}var Cm=class{async stat(e){let n={size:0,type:void 0};if(typeof e=="string"){let r=await RA.stat(e);return n.size=r.size,n.type=this.inferMimeType(e),n}else return await Xz(e)}async upload(e,n,r){return typeof e=="string"?await this.uploadFileFromPath(e,n,r):Yz(e,n,r)}async uploadToFileSearchStore(e,n,r){return typeof e=="string"?await this.uploadFileToFileSearchStoreFromPath(e,n,r):jz(e,n,r)}inferMimeType(e){let n=e.slice(e.lastIndexOf(".")+1);return{aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}[n.toLowerCase()]}async uploadFileFromPath(e,n,r){var o;let i=await this.uploadFileFromPathInternal(e,n,r),s=await i?.json();if(((o=i?.headers)===null||o===void 0?void 0:o[yr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return s.file}async uploadFileToFileSearchStoreFromPath(e,n,r){var o;let i=await this.uploadFileFromPathInternal(e,n,r),s=await i?.json();if(((o=i?.headers)===null||o===void 0?void 0:o[yr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let a=Pm(s),l=new qs;return Object.assign(l,a),l}async uploadFileFromPathInternal(e,n,r){var o,i;let s=0,a=0,l=new _r(new Response),c="upload",f,m=gH.basename(e);try{if(f=await RA.open(e,"r"),!f)throw new Error("Failed to open file");for(s=(await f.stat()).size;a<s;){let h=Math.min(LC,s-a);a+h>=s&&(c+=", finalize");let y=new Uint8Array(h),{bytesRead:_}=await f.read(y,0,h,a);if(_!==h)throw new Error(`Failed to read ${h} bytes from file at offset ${a}. bytes actually read: ${_}`);let T=new Blob([y]),E=0,w=qC;for(;E<UC&&(l=await r.request({path:"",body:T,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:n,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(a),"Content-Length":String(_),"X-Goog-Upload-File-Name":m}}}),!(!((o=l?.headers)===null||o===void 0)&&o[yr]));)E++,await HC(w),w=w*BC;if(a+=_,((i=l?.headers)===null||i===void 0?void 0:i[yr])!=="active")break;if(s<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}finally{f&&await f.close()}}};var bm=class extends $u{async registerFiles(e){if(typeof process>"u"||!process.versions||!process.versions.node)throw new Error("registerFiles is only supported in Node.js environments.");let r=await e.auth.getRequestHeaders(),o=e.config||{},i=o.httpOptions||{},s=Object.assign({},i.headers||{});if(r)if(typeof r[Symbol.iterator]=="function")for(let[a,l]of r)s[a]=l;else for(let[a,l]of Object.entries(r))s[a]=l;return this._registerFiles({uris:e.uris,config:Object.assign(Object.assign({},o),{httpOptions:Object.assign(Object.assign({},i),{headers:s})})})}};var Qz="gl-node/",Rm=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let n=new Ne({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=n.interactions,this._interactions}constructor(e){var n,r,o,i,s,a;if((e.project||e.location)&&e.apiKey)throw new Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=(r=(n=e.vertexai)!==null&&n!==void 0?n:Zz("GOOGLE_GENAI_USE_VERTEXAI"))!==null&&r!==void 0?r:!1;let l=tK(),c=Yr("GOOGLE_CLOUD_PROJECT"),f=Yr("GOOGLE_CLOUD_LOCATION");if(this.apiKey=(o=e.apiKey)!==null&&o!==void 0?o:l,this.project=(i=e.project)!==null&&i!==void 0?i:c,this.location=(s=e.location)!==null&&s!==void 0?s:f,!this.vertexai&&!this.apiKey)throw new Error("API key must be set when using the Gemini API.");e.vertexai&&(!((a=e.googleAuthOptions)===null||a===void 0)&&a.credentials&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(c||f)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&l?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(c||f)&&l&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),!this.location&&!this.apiKey&&(this.location="global"));let m=SH(e.httpOptions,e.vertexai,Yr("GOOGLE_VERTEX_BASE_URL"),Yr("GOOGLE_GEMINI_BASE_URL"));m&&(e.httpOptions?e.httpOptions.baseUrl=m:e.httpOptions={baseUrl:m}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let h=new Sm({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new am({auth:h,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Qz+process.version,uploader:new Cm,downloader:new Tm}),this.models=new Ju(this.apiClient),this.live=new Vu(this.apiClient,h,new Em),this.batches=new Uu(this.apiClient),this.chats=new Gu(this.models,this.apiClient),this.caches=new qu(this.apiClient),this.files=new bm(this.apiClient),this.operations=new zu(this.apiClient),this.authTokens=new Ku(this.apiClient),this.tunings=new Am(this.apiClient),this.fileSearchStores=new fm(this.apiClient)}};function Yr(t){var e,n,r;return(r=(n=(e=process==null?void 0:process.env)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0}function Zz(t){return eK(Yr(t))}function eK(t){return t===void 0?!1:t.toLowerCase()==="true"}function tK(){let t=Yr("GOOGLE_API_KEY"),e=Yr("GEMINI_API_KEY");return t&&e&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),t||e||void 0}C.ApiError=ri;C.Batches=Uu;C.Caches=qu;C.CancelTuningJobResponse=Ds;C.Chat=Hu;C.Chats=Gu;C.ComputeTokensResponse=bu;C.ContentReferenceImage=Qh;C.ControlReferenceImage=Yh;C.CountTokensResponse=Ns;C.CreateFileResponse=Nu;C.DeleteCachedContentResponse=Fs;C.DeleteFileResponse=Mu;C.DeleteModelResponse=ks;C.EditImageResponse=wu;C.EmbedContentResponse=Is;C.Files=$u;C.FunctionResponse=Lh;C.FunctionResponseBlob=Oh;C.FunctionResponseFileData=Dh;C.FunctionResponsePart=Fh;C.GenerateContentResponse=gr;C.GenerateContentResponsePromptFeedback=qh;C.GenerateContentResponseUsageMetadata=Bh;C.GenerateImagesResponse=xs;C.GenerateVideosOperation=Ms;C.GenerateVideosResponse=Gh;C.GoogleGenAI=Rm;C.HttpResponse=_r;C.ImportFileOperation=Pu;C.ImportFileResponse=Hh;C.InlinedEmbedContentResponse=Wh;C.InlinedResponse=$h;C.ListBatchJobsResponse=Us;C.ListCachedContentsResponse=Ls;C.ListDocumentsResponse=Ru;C.ListFileSearchStoresResponse=Iu;C.ListFilesResponse=ku;C.ListModelsResponse=Ps;C.ListTuningJobsResponse=Os;C.Live=Vu;C.LiveClientToolResponse=Zh;C.LiveMusicServerMessage=Fu;C.LiveSendToolResponseParameters=em;C.LiveServerMessage=Du;C.MaskReferenceImage=Kh;C.Models=Ju;C.Operations=zu;C.Pager=bn;C.RawReferenceImage=zh;C.RecontextImageResponse=Au;C.RegisterFilesResponse=Ou;C.ReplayResponse=Jh;C.SegmentImageResponse=Cu;C.Session=Wu;C.SingleEmbedContentResponse=Vh;C.StyleReferenceImage=jh;C.SubjectReferenceImage=Xh;C.Tokens=Ku;C.UploadToFileSearchStoreOperation=qs;C.UploadToFileSearchStoreResponse=tm;C.UploadToFileSearchStoreResumableResponse=xu;C.UpscaleImageResponse=vu;C.createFunctionResponsePartFromBase64=DH;C.createFunctionResponsePartFromUri=FH;C.createModelContent=VH;C.createPartFromBase64=BH;C.createPartFromCodeExecutionResult=GH;C.createPartFromExecutableCode=HH;C.createPartFromFunctionCall=UH;C.createPartFromFunctionResponse=qH;C.createPartFromText=Uh;C.createPartFromUri=LH;C.createUserContent=$H;C.mcpToTool=gJ;C.setDefaultBaseUrls=yH});var WC=k((L9,VC)=>{function nK(t){if(!t)return!1;let e=t.status||t.code||t.response&&t.response.status,n=String(t.message||t),r=n.toLowerCase();return typeof e=="number"&&e>=500||e===429||e===503||n.includes("429")||n.includes("503")||r.includes("fetch failed")||r.includes("econnreset")||r.includes("etimedout")||r.includes("enotfound")||r.includes("network")||r.includes("rate limit")||r.includes("quota")||r.includes("exceeded your current quota")}function rK(t){let e=new Set,n=[];function r(i){if(i){if(typeof i=="string"){n.push(i);return}if(typeof i=="object"&&!e.has(i)){if(e.add(i),Array.isArray(i)){i.forEach(r);return}for(let s of Object.keys(i))try{r(i[s])}catch{}}}}r(t),t&&t.message&&n.unshift(String(t.message));let o=[/retryDelay\"\s*:\s*\"(\d+(?:\.\d+)?)s\"/i,/retryDelay\s*[:=]\s*\"?(\d+(?:\.\d+)?)s\"?/i,/please retry in\s+(\d+(?:\.\d+)?)s/i,/retry in\s+(\d+(?:\.\d+)?)s/i];for(let i of n)for(let s of o){let a=i.match(s);if(a&&a[1]){let l=Number(a[1]);if(Number.isFinite(l)&&l>0)return l}}return null}async function oK(t,e={}){let n=e.maxRetries||5,r=e.baseDelay||1e3,o=e.maxWaitSeconds||60,i=typeof e.bufferSeconds=="number"?e.bufferSeconds:5,s=typeof e.jitterMsMax=="number"?e.jitterMsMax:500,a=0;for(;;)try{return await t()}catch(l){if(nK(l)&&a<n){a++;let c=l&&(l.status||l.code||l.response&&l.response.status),f=rK(l),m;if(f){let h=Math.ceil(f+i);if(h>o)throw new Error(`Rate limited (status ${c||"Unknown"}). Retry suggested in ~${h}s which exceeds auto-wait limit (${o}s).`);m=h*1e3}else{let h=Math.pow(2,a)*r,y=Math.random()*s;m=Math.min(h+y,o*1e3)}if(console.warn(`[RetryHelper] Retryable error (Status: ${c||"Unknown"}). Retrying in ${Math.floor(m)}ms... (Attempt ${a}/${n})`),typeof e.onRetry=="function")try{e.onRetry({attempt:a,maxRetries:n,waitMs:m,error:l})}catch{}await new Promise(h=>setTimeout(h,m));continue}throw l}}VC.exports={executeWithRetry:oK}});var KC=k((U9,zC)=>{function JC(t){let e=new Set(["type","description","enum","items","properties","required","format","nullable","default","minimum","maximum","minItems","maxItems","minLength","maxLength","pattern"]),n=r=>{if(!r||typeof r!="object")return r;if(Array.isArray(r))return r.map(n);let o={};for(let[i,s]of Object.entries(r))if(e.has(i)){if(i==="properties"&&s&&typeof s=="object"&&!Array.isArray(s)){let a={};for(let[l,c]of Object.entries(s))a[l]=n(c);o.properties=a;continue}o[i]=n(s)}return o.type==="array"&&o.items==null&&(o.items={}),o};return n(t)}function iK(t){if(!(!t||t.length===0))return[{functionDeclarations:t.map(e=>{let n=e.parameters||{type:"object",properties:{}},r=JC(n)||{type:"object",properties:{}};return r.type||(r.type="object"),{name:e.name,description:e.description,parameters:r}})}]}function Lm(t){if(!t||typeof t!="object"||Array.isArray(t))return t;let e=t.content;if(!(Array.isArray(e)&&e.every(i=>i&&typeof i=="object"&&typeof i.type=="string")))return t;let r=e.filter(i=>i&&i.type==="text"&&typeof i.text=="string").map(i=>i.text).join(`
`),o={};return typeof t.isError=="boolean"&&(o.isError=t.isError),r&&(o.text=r),t.structuredContent!==void 0&&(o.structuredContent=t.structuredContent),o}function sK(t){let e=[],n=[],r=new Map;for(let o of t){if(o.role==="system"||o.role==="tool"){if(o.tool_call_id&&r.has(o.tool_call_id)){let c=r.get(o.tool_call_id),f;try{f=JSON.parse(o.content)}catch{f=o.content}let m=Lm(f),h=(()=>{try{return m&&typeof m=="object"?JSON.stringify(m,null,2):String(m)}catch{return String(m)}})(),y=(()=>{try{return JSON.stringify(c.args||{},null,2)}catch{return String(c.args||"")}})();n.length>0&&(e.push({role:"user",parts:n}),n=[]),e.push({role:"user",parts:[{text:`Tool result (degraded): ${c.name}
Args:
${y}
Result:
${h}`}]}),r.delete(o.tool_call_id);continue}let i;try{i=JSON.parse(o.content)}catch{i=o.content}let a={output:Lm(i)},l={name:o.name,response:a};o.tool_call_id&&(l.id=o.tool_call_id),n.push({functionResponse:l});continue}if(n.length>0&&(e.push({role:"user",parts:n}),n=[]),o.role==="user")e.push({role:"user",parts:[{text:o.content}]});else if(o.role==="assistant")if(o.tool_calls&&o.tool_calls.length>0){let i=Array.isArray(o.tool_calls)?o.tool_calls:[],s=i.some(f=>f&&!(f.thought_signature||f.thoughtSignature));if(typeof window<"u"&&s){let f=[];for(let y of i){if(!y||!y.name)continue;let _;try{_=typeof y.arguments=="string"?JSON.parse(y.arguments):y.arguments||{}}catch{_=y.arguments||{}}typeof y.id=="string"&&r.set(y.id,{name:String(y.name),args:_});try{f.push(`- ${String(y.name)} ${JSON.stringify(_)}`)}catch{f.push(`- ${String(y.name)}`)}}let m=typeof o.content=="string"&&o.content.trim()?o.content.trim():null,h=`Tool calls:
${f.join(`
`)}`;e.push({role:"model",parts:[{text:m?`${m}

${h}`:h}]});continue}let l=[],c=typeof o.content=="string"&&o.content.trim()?o.content:null;c&&l.push({text:c});for(let f of i){let m=typeof f.arguments=="string"?JSON.parse(f.arguments):f.arguments,h=f.thought_signature||f.thoughtSignature,y={functionCall:{name:f.name,args:m}};f.id&&(y.functionCall.id=f.id),h&&(y.thoughtSignature=h),l.push(y)}e.push({role:"model",parts:l})}else e.push({role:"model",parts:[{text:o.content||" "}]})}return n.length>0&&e.push({role:"user",parts:n}),e}zC.exports={sanitizeGeminiSchema:JC,formatToolsForGemini:iK,normalizeToolResultForGemini:Lm,convertHistory:sK}});var YC=k((q9,aK)=>{aK.exports={name:"dotenv",version:"17.2.3",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run tests/**/*.js --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run tests/**/*.js --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var tb=k((B9,zn)=>{var Um=require("fs"),dc=require("path"),lK=require("os"),uK=require("crypto"),cK=YC(),qm=cK.version,jC=["\u{1F510} encrypt with Dotenvx: https://dotenvx.com","\u{1F510} prevent committing .env to code: https://dotenvx.com/precommit","\u{1F510} prevent building .env in docker: https://dotenvx.com/prebuild","\u{1F4E1} add observability to secrets: https://dotenvx.com/ops","\u{1F465} sync secrets across teammates & machines: https://dotenvx.com/ops","\u{1F5C2}\uFE0F backup and recover secrets: https://dotenvx.com/ops","\u2705 audit secrets and track compliance: https://dotenvx.com/ops","\u{1F504} add secrets lifecycle management: https://dotenvx.com/ops","\u{1F511} add access controls to secrets: https://dotenvx.com/ops","\u{1F6E0}\uFE0F  run anywhere with `dotenvx run -- yourcommand`","\u2699\uFE0F  specify custom .env file path with { path: '/custom/path/.env' }","\u2699\uFE0F  enable debug logging with { debug: true }","\u2699\uFE0F  override existing env vars with { override: true }","\u2699\uFE0F  suppress all logs with { quiet: true }","\u2699\uFE0F  write to custom object with { processEnv: myObject }","\u2699\uFE0F  load multiple .env files with { path: ['.env.local', '.env'] }"];function fK(){return jC[Math.floor(Math.random()*jC.length)]}function ui(t){return typeof t=="string"?!["false","0","no","off",""].includes(t.toLowerCase()):!!t}function dK(){return process.stdout.isTTY}function pK(t){return dK()?`\x1B[2m${t}\x1B[0m`:t}var hK=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function mK(t){let e={},n=t.toString();n=n.replace(/\r\n?/mg,`
`);let r;for(;(r=hK.exec(n))!=null;){let o=r[1],i=r[2]||"";i=i.trim();let s=i[0];i=i.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),s==='"'&&(i=i.replace(/\\n/g,`
`),i=i.replace(/\\r/g,"\r")),e[o]=i}return e}function gK(t){t=t||{};let e=eb(t);t.path=e;let n=Ue.configDotenv(t);if(!n.parsed){let s=new Error(`MISSING_DATA: Cannot parse ${e} for an unknown reason`);throw s.code="MISSING_DATA",s}let r=ZC(t).split(","),o=r.length,i;for(let s=0;s<o;s++)try{let a=r[s].trim(),l=_K(n,a);i=Ue.decrypt(l.ciphertext,l.key);break}catch(a){if(s+1>=o)throw a}return Ue.parse(i)}function yK(t){console.error(`[dotenv@${qm}][WARN] ${t}`)}function Hs(t){console.log(`[dotenv@${qm}][DEBUG] ${t}`)}function QC(t){console.log(`[dotenv@${qm}] ${t}`)}function ZC(t){return t&&t.DOTENV_KEY&&t.DOTENV_KEY.length>0?t.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function _K(t,e){let n;try{n=new URL(e)}catch(a){if(a.code==="ERR_INVALID_URL"){let l=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw l.code="INVALID_DOTENV_KEY",l}throw a}let r=n.password;if(!r){let a=new Error("INVALID_DOTENV_KEY: Missing key part");throw a.code="INVALID_DOTENV_KEY",a}let o=n.searchParams.get("environment");if(!o){let a=new Error("INVALID_DOTENV_KEY: Missing environment part");throw a.code="INVALID_DOTENV_KEY",a}let i=`DOTENV_VAULT_${o.toUpperCase()}`,s=t.parsed[i];if(!s){let a=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);throw a.code="NOT_FOUND_DOTENV_ENVIRONMENT",a}return{ciphertext:s,key:r}}function eb(t){let e=null;if(t&&t.path&&t.path.length>0)if(Array.isArray(t.path))for(let n of t.path)Um.existsSync(n)&&(e=n.endsWith(".vault")?n:`${n}.vault`);else e=t.path.endsWith(".vault")?t.path:`${t.path}.vault`;else e=dc.resolve(process.cwd(),".env.vault");return Um.existsSync(e)?e:null}function XC(t){return t[0]==="~"?dc.join(lK.homedir(),t.slice(1)):t}function SK(t){let e=ui(process.env.DOTENV_CONFIG_DEBUG||t&&t.debug),n=ui(process.env.DOTENV_CONFIG_QUIET||t&&t.quiet);(e||!n)&&QC("Loading env from encrypted .env.vault");let r=Ue._parseVault(t),o=process.env;return t&&t.processEnv!=null&&(o=t.processEnv),Ue.populate(o,r,t),{parsed:r}}function TK(t){let e=dc.resolve(process.cwd(),".env"),n="utf8",r=process.env;t&&t.processEnv!=null&&(r=t.processEnv);let o=ui(r.DOTENV_CONFIG_DEBUG||t&&t.debug),i=ui(r.DOTENV_CONFIG_QUIET||t&&t.quiet);t&&t.encoding?n=t.encoding:o&&Hs("No encoding is specified. UTF-8 is used by default");let s=[e];if(t&&t.path)if(!Array.isArray(t.path))s=[XC(t.path)];else{s=[];for(let f of t.path)s.push(XC(f))}let a,l={};for(let f of s)try{let m=Ue.parse(Um.readFileSync(f,{encoding:n}));Ue.populate(l,m,t)}catch(m){o&&Hs(`Failed to load ${f} ${m.message}`),a=m}let c=Ue.populate(r,l,t);if(o=ui(r.DOTENV_CONFIG_DEBUG||o),i=ui(r.DOTENV_CONFIG_QUIET||i),o||!i){let f=Object.keys(c).length,m=[];for(let h of s)try{let y=dc.relative(process.cwd(),h);m.push(y)}catch(y){o&&Hs(`Failed to load ${h} ${y.message}`),a=y}QC(`injecting env (${f}) from ${m.join(",")} ${pK(`-- tip: ${fK()}`)}`)}return a?{parsed:l,error:a}:{parsed:l}}function EK(t){if(ZC(t).length===0)return Ue.configDotenv(t);let e=eb(t);return e?Ue._configVault(t):(yK(`You set DOTENV_KEY but you are missing a .env.vault file at ${e}. Did you forget to build it?`),Ue.configDotenv(t))}function wK(t,e){let n=Buffer.from(e.slice(-64),"hex"),r=Buffer.from(t,"base64"),o=r.subarray(0,12),i=r.subarray(-16);r=r.subarray(12,-16);try{let s=uK.createDecipheriv("aes-256-gcm",n,o);return s.setAuthTag(i),`${s.update(r)}${s.final()}`}catch(s){let a=s instanceof RangeError,l=s.message==="Invalid key length",c=s.message==="Unsupported state or unable to authenticate data";if(a||l){let f=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw f.code="INVALID_DOTENV_KEY",f}else if(c){let f=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw f.code="DECRYPTION_FAILED",f}else throw s}}function vK(t,e,n={}){let r=!!(n&&n.debug),o=!!(n&&n.override),i={};if(typeof e!="object"){let s=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw s.code="OBJECT_REQUIRED",s}for(let s of Object.keys(e))Object.prototype.hasOwnProperty.call(t,s)?(o===!0&&(t[s]=e[s],i[s]=e[s]),r&&Hs(o===!0?`"${s}" is already defined and WAS overwritten`:`"${s}" is already defined and was NOT overwritten`)):(t[s]=e[s],i[s]=e[s]);return i}var Ue={configDotenv:TK,_configVault:SK,_parseVault:gK,config:EK,decrypt:wK,parse:mK,populate:vK};zn.exports.configDotenv=Ue.configDotenv;zn.exports._configVault=Ue._configVault;zn.exports._parseVault=Ue._parseVault;zn.exports.config=Ue.config;zn.exports.decrypt=Ue.decrypt;zn.exports.parse=Ue.parse;zn.exports.populate=Ue.populate;zn.exports=Ue});var ob=k((G9,rb)=>{var{GoogleGenAI:AK}=$C(),{executeWithRetry:nb}=WC(),{formatToolsForGemini:CK,convertHistory:bK,normalizeToolResultForGemini:RK}=KC(),IK=require("path");try{let t=IK.join(__dirname,".env");tb().config({path:t})}catch(t){let e=t&&t.message?t.message:String(t);console.warn(`[System] dotenv config skipped: ${e}`)}var Bm=class{constructor({modelName:e="gemini-2.5-flash",apiKey:n,tools:r=[]}={}){if(this.apiKey=n||process.env.GOOGLE_API_KEY,!this.apiKey)throw new Error("GOOGLE_API_KEY is missing. Please set it in .env or pass it to constructor.");this.genAI=new AK({apiKey:this.apiKey}),this.modelName=e,this.tools=r,this._toolCallSeq=0}_formatToolsForGemini(e){return CK(e)}_convertParams(e){return e}async*chatStream(e,n,r={}){let o=this._convertHistory(n),i=this._buildGenerateConfig(e),s=r&&r.signal?r.signal:void 0,a=await nb(()=>this.genAI.models.generateContentStream({model:this.modelName,contents:o,config:i,...s?{signal:s}:null}),{maxRetries:2,baseDelay:250,maxWaitSeconds:5}),l="";for await(let c of a){let f=c.text||"";if(f){let h=f.startsWith(l)?f.slice(l.length):f;l=f,h&&(yield{type:"text",delta:h})}let m=this._extractFunctionCalls(c);m.length>0&&(yield{type:"tool_calls",tool_calls:m.map((h,y)=>({id:h.id||`call_${Date.now()}_${this._toolCallSeq++}`,name:h.name,arguments:h.args,thought_signature:h.thoughtSignature||h.thought_signature}))})}}async chat(e,n,r={}){return await nb(()=>this._chatInternal(e,n,r))}async _chatInternal(e,n,r={}){let o=this._convertHistory(n),i;try{i=await this.genAI.models.generateContent({model:this.modelName,contents:o,config:this._buildGenerateConfig(e),...r&&r.signal?{signal:r.signal}:null})}catch(f){throw console.error("Gemini Request Failed. Debug History:",JSON.stringify(o,null,2)),f}let s=i&&(i.usageMetadata||i.usage),a=s&&typeof s=="object"?{input_tokens:s.promptTokenCount??s.prompt_tokens,cached_input_tokens:s.cachedContentTokenCount??s.cached_prompt_tokens,output_tokens:s.candidatesTokenCount??s.completionTokenCount,reasoning_output_tokens:s.thoughtsTokenCount??s.reasoningTokenCount,total_tokens:s.totalTokenCount??s.total_tokens}:void 0,l={content:i.text||null,tool_calls:[],usage:a},c=this._extractFunctionCalls(i);return c.length>0&&(l.tool_calls=c.map((f,m)=>({id:f.id||`call_${Date.now()}_${this._toolCallSeq++}`,name:f.name,arguments:f.args,thought_signature:f.thoughtSignature||f.thought_signature})),l.content=null),l}_convertHistory(e){return bK(e)}_normalizeToolResultForGemini(e){return RK(e)}_buildGenerateConfig(e){let n=this._formatToolsForGemini(this.tools);return{temperature:.7,maxOutputTokens:2048,...e?{systemInstruction:[{text:e}]}:null,...n?{tools:n}:null}}_extractFunctionCalls(e){if(!e)return[];let n=e.candidates||[],r=n[0]&&n[0].content&&Array.isArray(n[0].content.parts)?n[0].content.parts:[],o=[];for(let i of r)i&&i.functionCall&&o.push({...i.functionCall,thoughtSignature:i.thoughtSignature});return o.length>0?o:e.functionCalls||[]}};rb.exports={GeminiLLM:Bm}});var ab=k((H9,sb)=>{var Gm=0;function xK(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function PK(t){Gm=(Gm+1)%1e6;let e=Math.random().toString(16).slice(2,10);return`${t}:${Date.now()}:${Gm}:${e}`}function kK(t){let e=t&&typeof t=="object"?t:null;return{...{"content-type":"application/json",accept:"application/json, text/event-stream",...xK()?{"user-agent":"agents-js/2.0"}:null},...e||null}}function NK(t){if(!(!t||typeof t!="object"))for(let[e,n]of Object.entries(t)){if(n==null)continue;let r=String(n);for(let o=0;o<r.length;o++)if(r.charCodeAt(o)>255)throw new Error(`[MCP] Invalid header value (non-ByteString) for "${e}" at char ${o}. Header values must be ASCII/ByteString; check API keys and env config.`)}}async function MK(t){try{return await t.text()}catch{return""}}function Hm(t,e){let n=String(t||"");return n.length<=e?n:n.slice(0,e)+"..."}async function ib(t,{method:e,params:n},r={}){let{timeoutMs:o=15e3,headers:i,signal:s}=r||{};if(typeof fetch!="function")throw new Error("[MCP] fetch() is not available in this runtime. Provide a fetch polyfill.");let a=typeof AbortController<"u"?new AbortController:null,l=typeof o=="number"&&Number.isFinite(o)&&o>0?o:15e3,c=null,f=(()=>{if(!a)return s;if(s&&typeof s=="object")try{s.aborted&&a.abort(),typeof s.addEventListener=="function"&&s.addEventListener("abort",()=>a.abort(),{once:!0})}catch{}return a.signal})();a&&(c=setTimeout(()=>a.abort(),l),c&&typeof c.unref=="function"&&c.unref());let m={jsonrpc:"2.0",id:PK(e),method:e,...n!==void 0?{params:n}:null};try{let h=kK(i);NK(h);let y;try{y=await fetch(t,{method:"POST",headers:h,body:JSON.stringify(m),signal:f})}catch(E){let w=E&&E.name?String(E.name):"Error",b=E&&E.message?String(E.message):String(E),L=E&&E.cause?E.cause.message?String(E.cause.message):String(E.cause):null;throw w==="AbortError"?new Error(`[MCP] Request aborted (timeout ${l}ms) for ${t} (${e}).`):new Error(`[MCP] fetch failed for ${t} (${e}): ${b}${L?` (cause: ${L})`:""}`)}let _=await MK(y);if(!y.ok)throw new Error(`[MCP] HTTP ${y.status} ${y.statusText}: ${Hm(_,1200)}`);let T;try{T=_?JSON.parse(_):null}catch{throw new Error(`[MCP] Invalid JSON response: ${Hm(_,1200)}`)}if(!T||typeof T!="object")throw new Error("[MCP] Empty or non-object JSON-RPC response.");if(T.error){let E=T.error&&T.error.code!==void 0?T.error.code:"unknown",w=T.error&&T.error.message?T.error.message:"Unknown JSON-RPC error",b=T.error&&T.error.data!==void 0?` data=${Hm(JSON.stringify(T.error.data),1200)}`:"";throw new Error(`[MCP] JSON-RPC error ${E}: ${w}${b}`)}return T.result}finally{c&&clearTimeout(c)}}async function OK(t,e={}){let n=await ib(t,{method:"tools/list",params:{}},e),r=n&&Array.isArray(n.tools)?n.tools:Array.isArray(n)?n:null;if(!r)throw new Error("[MCP] tools/list returned an unexpected shape. Expected { tools: [...] }.");return r}async function DK(t,e,n,r={}){if(!e||typeof e!="string")throw new Error("[MCP] tools/call requires a tool name string.");let i=await ib(t,{method:"tools/call",params:{name:e,arguments:n===void 0?{}:n}},r);if(!i||typeof i!="object")throw new Error("[MCP] tools/call returned an unexpected shape. Expected CallToolResult object.");return i}sb.exports={listRemoteTools:OK,callRemoteTool:DK}});var ub=k(($9,lb)=>{function FK(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function LK(){if(!FK())return null;let{spawn:t}=require("child_process");return{spawn:t}}var UK=1,$m=class{constructor({serverName:e,command:n,args:r,env:o,cwd:i,defaultTimeoutMs:s=6e4}={}){this.serverName=String(e||"mcp_stdio"),this.command=String(n||""),this.args=Array.isArray(r)?r.map(String):[],this.env=o&&typeof o=="object"&&!Array.isArray(o)?o:null,this.cwd=i?String(i):void 0,this.defaultTimeoutMs=typeof s=="number"&&Number.isFinite(s)&&s>0?s:6e4,this._proc=null,this._buffer="",this._pending=new Map,this._initPromise=null}isRunning(){return!!(this._proc&&!this._proc.killed)}async start(){if(this.isRunning())return;let e=LK();if(!e)throw new Error("[MCP][stdio] Not supported in this runtime.");if(!this.command)throw new Error("[MCP][stdio] Missing command.");let{spawn:n}=e,r=n(this.command,this.args,{stdio:["pipe","pipe","pipe"],env:{...process.env||{},...this.env?this.env:{}},cwd:this.cwd});this._proc=r,this._buffer="",r.stdout.setEncoding("utf8"),r.stdout.on("data",o=>this._onStdout(o)),r.stderr.setEncoding("utf8"),r.stderr.on("data",o=>{let i=String(o||"").trim();i&&console.warn(`[MCP][stdio:${this.serverName}] ${i}`)}),r.on("exit",(o,i)=>{let s=`[MCP][stdio:${this.serverName}] process exited (code=${o}, signal=${i||"none"})`;this._rejectAllPending(new Error(s)),this._proc=null,this._initPromise=null}),r.on("error",o=>{let i=`[MCP][stdio:${this.serverName}] process error: ${String(o&&o.message?o.message:o)}`;this._rejectAllPending(new Error(i)),this._proc=null,this._initPromise=null})}async stop(){if(this._proc){try{this._proc.kill()}catch{}this._rejectAllPending(new Error(`[MCP][stdio:${this.serverName}] stopped`)),this._proc=null,this._initPromise=null}}_rejectAllPending(e){for(let{reject:n,timer:r}of this._pending.values()){r&&clearTimeout(r);try{n(e)}catch{}}this._pending.clear()}_onStdout(e){for(this._buffer+=String(e||"");;){let n=this._buffer.indexOf(`
`);if(n===-1)break;let r=this._buffer.slice(0,n).trim();this._buffer=this._buffer.slice(n+1),r&&this._handleLine(r)}}_handleLine(e){if(!e.startsWith("{"))return;let n;try{n=JSON.parse(e)}catch{return}if(!n||typeof n!="object")return;let r=n.id;if(r==null)return;let o=this._pending.get(String(r));if(o){if(this._pending.delete(String(r)),o.timer&&clearTimeout(o.timer),n.error){let i=n.error&&n.error.code!==void 0?n.error.code:"unknown",s=n.error&&n.error.message?n.error.message:"JSON-RPC error";o.reject(new Error(`[MCP][stdio:${this.serverName}] JSON-RPC error ${i}: ${s}`));return}o.resolve(n.result)}}async request(e,n,{timeoutMs:r}={}){if(await this.start(),!this._proc||!this._proc.stdin)throw new Error("[MCP][stdio] process not running");let o=String(UK++),i={jsonrpc:"2.0",id:o,method:e,...n!==void 0?{params:n}:null},s=typeof r=="number"&&Number.isFinite(r)&&r>0?r:this.defaultTimeoutMs,a=new Promise((l,c)=>{let f=setTimeout(()=>{this._pending.delete(o),c(new Error(`[MCP][stdio:${this.serverName}] Timeout after ${s}ms (${e})`))},s);f&&typeof f.unref=="function"&&f.unref(),this._pending.set(o,{resolve:l,reject:c,timer:f})});return this._proc.stdin.write(JSON.stringify(i)+`
`),await a}async ensureInitialized(){return this._initPromise?this._initPromise:(this._initPromise=(async()=>{let e={protocolVersion:"2025-03-26",clientInfo:{name:"agents-js",version:"0.0.0"},capabilities:{tools:{}}};try{await this.request("initialize",e,{timeoutMs:this.defaultTimeoutMs})}catch{}})(),this._initPromise)}async listTools(e={}){await this.ensureInitialized();let n=await this.request("tools/list",{},e);return n&&Array.isArray(n.tools)?n.tools:Array.isArray(n)?n:[]}async callTool(e,n,r={}){return await this.ensureInitialized(),await this.request("tools/call",{name:String(e||""),arguments:n===void 0?{}:n},r)}};lb.exports={McpStdioClient:$m}});var hb=k((V9,pb)=>{function cb(){return ab()}function Wm(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function fb(t){let e=t&&t.transport?String(t.transport).toLowerCase():"";return e||(t&&t.command?"stdio":"http")}function pc(t){return t&&typeof t=="object"&&!Array.isArray(t)?t:null}var Vm=new Map;function db(t,{timeoutMs:e}={}){let n=JSON.stringify({serverName:t.serverName,command:t.command,args:t.args,env:t.env||null,cwd:t.cwd||null});if(Vm.has(n))return Vm.get(n);let{McpStdioClient:r}=ub(),o=new r({serverName:t.serverName,command:t.command,args:t.args,env:t.env,cwd:t.cwd,defaultTimeoutMs:e});return Vm.set(n,o),o}async function qK(t,e={}){let n=fb(t),r=e&&e.timeoutMs;if(n==="stdio"){if(!Wm())throw new Error("[MCP][stdio] Not supported in this runtime.");if(!t||!t.command)throw new Error("[MCP][stdio] Invalid server: missing command.");let a=db(t,{timeoutMs:r}),l=await a.listTools({timeoutMs:r});return t.keepAlive||await a.stop(),l}let o=t&&t.url?String(t.url).trim():"";if(!o)throw new Error("[MCP][http] Invalid server: missing url.");let i=pc(t&&t.headers)||pc(e&&e.headers),{listRemoteTools:s}=cb();return await s(o,{timeoutMs:r,headers:i})}async function BK(t,e,n,r={}){let o=fb(t),i=r&&r.timeoutMs;if(o==="stdio"){if(!Wm())throw new Error("[MCP][stdio] Not supported in this runtime.");if(!t||!t.command)throw new Error("[MCP][stdio] Invalid server: missing command.");return await db(t,{timeoutMs:i}).callTool(e,n,{timeoutMs:i})}let s=t&&t.url?String(t.url).trim():"";if(!s)throw new Error("[MCP][http] Invalid server: missing url.");let a=pc(t&&t.headers)||pc(r&&r.headers),{callRemoteTool:l}=cb();return await l(s,e,n,{timeoutMs:i,headers:a})}pb.exports={listTools:qK,callTool:BK,isNodeRuntime:Wm}});var _b=k((W9,yb)=>{var{listTools:GK,callTool:HK}=hb(),{RiskLevel:$s,normalizeRiskLevel:$K}=yt();function VK(t){try{let e=new URL(t),n=(e.host||"server").replace(/[^a-zA-Z0-9._-]/g,"_"),r=(e.pathname||"").replace(/[^a-zA-Z0-9/_-]/g,"_").replace(/\/+$/g,""),o=r&&r!=="/"?r.replace(/\//g,"_"):"";return o?`${n}${o}`:n}catch{return String(t||"server").replace(/[^a-zA-Z0-9._-]/g,"_").slice(0,60)||"server"}}function WK(t,e,n){let o=String(t||"").trim()||`${n}__tool`;if(!e.has(o))return e.add(o),o;for(let s=2;s<1e3;s++){let a=`${o}_${s}`;if(!e.has(a))return e.add(a),a}let i=`${o}_${Date.now()}`;return e.add(i),i}function JK(t){return t&&typeof t=="object"&&!Array.isArray(t)?t:{type:"object",properties:{}}}function mb(t){return Array.isArray(t)?t.map(e=>e?typeof e=="string"?{url:e}:typeof e=="object"?e:null:null).filter(Boolean):[]}function Jm(t){if(typeof t=="number"&&Number.isFinite(t))return $K(t,void 0);if(typeof t!="string")return;let e=t.trim().toLowerCase(),n={none:$s.NONE,low:$s.LOW,medium:$s.MEDIUM,high:$s.HIGH}[e];return typeof n=="number"?n:void 0}function zK(t){if(typeof t!="string")return;let e=t.trim().toLowerCase();if(e==="per_turn")return"per_turn";if(e==="per_call")return"per_call"}function KK(t,e){if(String(e||"").toLowerCase()!=="memory")return!1;let n=t&&t.transport?String(t.transport).toLowerCase():"";return n!=="stdio"&&n!==""?!1:(Array.isArray(t&&t.args)?t.args.map(String):[]).some(o=>o.includes("@modelcontextprotocol/server-memory"))}function YK({server:t,serverName:e,localName:n,remoteName:r}){let o=t&&t.toolRiskOverrides&&typeof t.toolRiskOverrides=="object"&&!Array.isArray(t.toolRiskOverrides)?t.toolRiskOverrides:null;if(o){let s=Jm(o[r]);if(typeof s=="number")return s;let a=Jm(o[n]);if(typeof a=="number")return a}if(KK(t,e)&&(r==="search_nodes"||r==="read_graph"))return $s.NONE;let i=Jm(t&&t.defaultToolRisk);return typeof i=="number"?i:void 0}async function jK(t,{quiet:e=!1,timeoutMs:n,headers:r}={}){let o=mb(t).map(i=>({...i,transport:"http",namespace:i.namespace!==void 0?i.namespace:!1}));return await gb(o,{quiet:e,timeoutMs:n,headers:r})}async function gb(t,{quiet:e=!1,timeoutMs:n,headers:r}={}){let o=mb(t),i=new Set,s=[];for(let a of o){let l=a.transport?String(a.transport).toLowerCase():"http",c=a.serverName&&String(a.serverName).trim()||(a.url?VK(a.url):a.name?String(a.name):"mcp"),f=a.namespace!==void 0?!!a.namespace:!0,m=c,h=l==="http"||l==="https"?String(a.url||"").trim():"";if((l==="http"||l==="https")&&!h)continue;let y;try{y=await GK({...a,transport:l,serverName:c},{timeoutMs:n,headers:r})}catch(_){e||console.warn(`[SkillManager] External MCP tools/list failed for ${l==="stdio"?c:h||c}: ${String(_&&_.message?_.message:_)}`);continue}if(Array.isArray(y))for(let _ of y){let T=_&&typeof _=="object"?_.name:null;if(!T||typeof T!="string")continue;let E=f?`${c}__${T}`:T,w=WK(E,i,`mcp_${m}`),b=_&&typeof _.description=="string"?_.description:"",L=JK(_&&_.inputSchema),D=YK({server:a,serverName:c,localName:w,remoteName:T}),I=zK(a&&a.approvalMode),P=l==="stdio"?`stdio:${c}`:`remote:${h}`,q=l==="stdio"?{transport:"stdio",serverName:c,remoteName:T}:{transport:"http",url:h,remoteName:T,serverName:c};s.push({name:w,description:b?`[MCP:${m}] ${b}`:`[MCP:${m}]`,...typeof D=="number"?{risk:D}:null,...I?{approvalMode:I}:null,parameters:L,_skillSource:P,_mcp:q,func:async K=>await HK({...a,transport:l,serverName:c},T,K,{timeoutMs:n,headers:r})})}}return s}yb.exports={createRemoteToolDefinitions:jK,createMcpToolDefinitions:gb}});var ci=k((J9,jr)=>{"use strict";function Sb(t){return typeof t>"u"||t===null}function XK(t){return typeof t=="object"&&t!==null}function QK(t){return Array.isArray(t)?t:Sb(t)?[]:[t]}function ZK(t,e){var n,r,o,i;if(e)for(i=Object.keys(e),n=0,r=i.length;n<r;n+=1)o=i[n],t[o]=e[o];return t}function eY(t,e){var n="",r;for(r=0;r<e;r+=1)n+=t;return n}function tY(t){return t===0&&Number.NEGATIVE_INFINITY===1/t}jr.exports.isNothing=Sb;jr.exports.isObject=XK;jr.exports.toArray=QK;jr.exports.repeat=eY;jr.exports.isNegativeZero=tY;jr.exports.extend=ZK});var fi=k((z9,Eb)=>{"use strict";function Tb(t,e){var n="",r=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(n+='in "'+t.mark.name+'" '),n+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(n+=`

`+t.mark.snippet),r+" "+n):r}function Vs(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=Tb(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Vs.prototype=Object.create(Error.prototype);Vs.prototype.constructor=Vs;Vs.prototype.toString=function(e){return this.name+": "+Tb(this,e)};Eb.exports=Vs});var vb=k((K9,wb)=>{"use strict";var Ws=ci();function zm(t,e,n,r,o){var i="",s="",a=Math.floor(o/2)-1;return r-e>a&&(i=" ... ",e=r-a+i.length),n-r>a&&(s=" ...",n=r+a-s.length),{str:i+t.slice(e,n).replace(/\t/g,"\u2192")+s,pos:r-e+i.length}}function Km(t,e){return Ws.repeat(" ",e-t.length)+t}function nY(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),typeof e.indent!="number"&&(e.indent=1),typeof e.linesBefore!="number"&&(e.linesBefore=3),typeof e.linesAfter!="number"&&(e.linesAfter=2);for(var n=/\r?\n|\r|\0/g,r=[0],o=[],i,s=-1;i=n.exec(t.buffer);)o.push(i.index),r.push(i.index+i[0].length),t.position<=i.index&&s<0&&(s=r.length-2);s<0&&(s=r.length-1);var a="",l,c,f=Math.min(t.line+e.linesAfter,o.length).toString().length,m=e.maxLength-(e.indent+f+3);for(l=1;l<=e.linesBefore&&!(s-l<0);l++)c=zm(t.buffer,r[s-l],o[s-l],t.position-(r[s]-r[s-l]),m),a=Ws.repeat(" ",e.indent)+Km((t.line-l+1).toString(),f)+" | "+c.str+`
`+a;for(c=zm(t.buffer,r[s],o[s],t.position,m),a+=Ws.repeat(" ",e.indent)+Km((t.line+1).toString(),f)+" | "+c.str+`
`,a+=Ws.repeat("-",e.indent+f+3+c.pos)+`^
`,l=1;l<=e.linesAfter&&!(s+l>=o.length);l++)c=zm(t.buffer,r[s+l],o[s+l],t.position-(r[s]-r[s+l]),m),a+=Ws.repeat(" ",e.indent)+Km((t.line+l+1).toString(),f)+" | "+c.str+`
`;return a.replace(/\n$/,"")}wb.exports=nY});var Ye=k((Y9,Cb)=>{"use strict";var Ab=fi(),rY=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],oY=["scalar","sequence","mapping"];function iY(t){var e={};return t!==null&&Object.keys(t).forEach(function(n){t[n].forEach(function(r){e[String(r)]=n})}),e}function sY(t,e){if(e=e||{},Object.keys(e).forEach(function(n){if(rY.indexOf(n)===-1)throw new Ab('Unknown option "'+n+'" is met in definition of "'+t+'" YAML type.')}),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(n){return n},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=iY(e.styleAliases||null),oY.indexOf(this.kind)===-1)throw new Ab('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')}Cb.exports=sY});var Xm=k((j9,Rb)=>{"use strict";var Js=fi(),Ym=Ye();function bb(t,e){var n=[];return t[e].forEach(function(r){var o=n.length;n.forEach(function(i,s){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(o=s)}),n[o]=r}),n}function aY(){var t={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,n;function r(o){o.multi?(t.multi[o.kind].push(o),t.multi.fallback.push(o)):t[o.kind][o.tag]=t.fallback[o.tag]=o}for(e=0,n=arguments.length;e<n;e+=1)arguments[e].forEach(r);return t}function jm(t){return this.extend(t)}jm.prototype.extend=function(e){var n=[],r=[];if(e instanceof Ym)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(n=n.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new Js("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(i){if(!(i instanceof Ym))throw new Js("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new Js("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new Js("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof Ym))throw new Js("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(jm.prototype);return o.implicit=(this.implicit||[]).concat(n),o.explicit=(this.explicit||[]).concat(r),o.compiledImplicit=bb(o,"implicit"),o.compiledExplicit=bb(o,"explicit"),o.compiledTypeMap=aY(o.compiledImplicit,o.compiledExplicit),o};Rb.exports=jm});var Qm=k((X9,Ib)=>{"use strict";var lY=Ye();Ib.exports=new lY("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return t!==null?t:""}})});var Zm=k((Q9,xb)=>{"use strict";var uY=Ye();xb.exports=new uY("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return t!==null?t:[]}})});var eg=k((Z9,Pb)=>{"use strict";var cY=Ye();Pb.exports=new cY("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return t!==null?t:{}}})});var tg=k((eX,kb)=>{"use strict";var fY=Xm();kb.exports=new fY({explicit:[Qm(),Zm(),eg()]})});var ng=k((tX,Nb)=>{"use strict";var dY=Ye();function pY(t){if(t===null)return!0;var e=t.length;return e===1&&t==="~"||e===4&&(t==="null"||t==="Null"||t==="NULL")}function hY(){return null}function mY(t){return t===null}Nb.exports=new dY("tag:yaml.org,2002:null",{kind:"scalar",resolve:pY,construct:hY,predicate:mY,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"})});var rg=k((nX,Mb)=>{"use strict";var gY=Ye();function yY(t){if(t===null)return!1;var e=t.length;return e===4&&(t==="true"||t==="True"||t==="TRUE")||e===5&&(t==="false"||t==="False"||t==="FALSE")}function _Y(t){return t==="true"||t==="True"||t==="TRUE"}function SY(t){return Object.prototype.toString.call(t)==="[object Boolean]"}Mb.exports=new gY("tag:yaml.org,2002:bool",{kind:"scalar",resolve:yY,construct:_Y,predicate:SY,represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"})});var og=k((rX,Ob)=>{"use strict";var TY=ci(),EY=Ye();function wY(t){return 48<=t&&t<=57||65<=t&&t<=70||97<=t&&t<=102}function vY(t){return 48<=t&&t<=55}function AY(t){return 48<=t&&t<=57}function CY(t){if(t===null)return!1;var e=t.length,n=0,r=!1,o;if(!e)return!1;if(o=t[n],(o==="-"||o==="+")&&(o=t[++n]),o==="0"){if(n+1===e)return!0;if(o=t[++n],o==="b"){for(n++;n<e;n++)if(o=t[n],o!=="_"){if(o!=="0"&&o!=="1")return!1;r=!0}return r&&o!=="_"}if(o==="x"){for(n++;n<e;n++)if(o=t[n],o!=="_"){if(!wY(t.charCodeAt(n)))return!1;r=!0}return r&&o!=="_"}if(o==="o"){for(n++;n<e;n++)if(o=t[n],o!=="_"){if(!vY(t.charCodeAt(n)))return!1;r=!0}return r&&o!=="_"}}if(o==="_")return!1;for(;n<e;n++)if(o=t[n],o!=="_"){if(!AY(t.charCodeAt(n)))return!1;r=!0}return!(!r||o==="_")}function bY(t){var e=t,n=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(n=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return n*parseInt(e.slice(2),2);if(e[1]==="x")return n*parseInt(e.slice(2),16);if(e[1]==="o")return n*parseInt(e.slice(2),8)}return n*parseInt(e,10)}function RY(t){return Object.prototype.toString.call(t)==="[object Number]"&&t%1===0&&!TY.isNegativeZero(t)}Ob.exports=new EY("tag:yaml.org,2002:int",{kind:"scalar",resolve:CY,construct:bY,predicate:RY,represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})});var ig=k((oX,Fb)=>{"use strict";var Db=ci(),IY=Ye(),xY=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function PY(t){return!(t===null||!xY.test(t)||t[t.length-1]==="_")}function kY(t){var e,n;return e=t.replace(/_/g,"").toLowerCase(),n=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:n*parseFloat(e,10)}var NY=/^[-+]?[0-9]+e/;function MY(t,e){var n;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Db.isNegativeZero(t))return"-0.0";return n=t.toString(10),NY.test(n)?n.replace("e",".e"):n}function OY(t){return Object.prototype.toString.call(t)==="[object Number]"&&(t%1!==0||Db.isNegativeZero(t))}Fb.exports=new IY("tag:yaml.org,2002:float",{kind:"scalar",resolve:PY,construct:kY,predicate:OY,represent:MY,defaultStyle:"lowercase"})});var sg=k((iX,Lb)=>{"use strict";Lb.exports=tg().extend({implicit:[ng(),rg(),og(),ig()]})});var ag=k((sX,Ub)=>{"use strict";Ub.exports=sg()});var lg=k((aX,Gb)=>{"use strict";var DY=Ye(),qb=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Bb=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function FY(t){return t===null?!1:qb.exec(t)!==null||Bb.exec(t)!==null}function LY(t){var e,n,r,o,i,s,a,l=0,c=null,f,m,h;if(e=qb.exec(t),e===null&&(e=Bb.exec(t)),e===null)throw new Error("Date resolve error");if(n=+e[1],r=+e[2]-1,o=+e[3],!e[4])return new Date(Date.UTC(n,r,o));if(i=+e[4],s=+e[5],a=+e[6],e[7]){for(l=e[7].slice(0,3);l.length<3;)l+="0";l=+l}return e[9]&&(f=+e[10],m=+(e[11]||0),c=(f*60+m)*6e4,e[9]==="-"&&(c=-c)),h=new Date(Date.UTC(n,r,o,i,s,a,l)),c&&h.setTime(h.getTime()-c),h}function UY(t){return t.toISOString()}Gb.exports=new DY("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:FY,construct:LY,instanceOf:Date,represent:UY})});var ug=k((lX,Hb)=>{"use strict";var qY=Ye();function BY(t){return t==="<<"||t===null}Hb.exports=new qY("tag:yaml.org,2002:merge",{kind:"scalar",resolve:BY})});var fg=k((uX,$b)=>{"use strict";var GY=Ye(),cg=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function HY(t){if(t===null)return!1;var e,n,r=0,o=t.length,i=cg;for(n=0;n<o;n++)if(e=i.indexOf(t.charAt(n)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}function $Y(t){var e,n,r=t.replace(/[\r\n=]/g,""),o=r.length,i=cg,s=0,a=[];for(e=0;e<o;e++)e%4===0&&e&&(a.push(s>>16&255),a.push(s>>8&255),a.push(s&255)),s=s<<6|i.indexOf(r.charAt(e));return n=o%4*6,n===0?(a.push(s>>16&255),a.push(s>>8&255),a.push(s&255)):n===18?(a.push(s>>10&255),a.push(s>>2&255)):n===12&&a.push(s>>4&255),new Uint8Array(a)}function VY(t){var e="",n=0,r,o,i=t.length,s=cg;for(r=0;r<i;r++)r%3===0&&r&&(e+=s[n>>18&63],e+=s[n>>12&63],e+=s[n>>6&63],e+=s[n&63]),n=(n<<8)+t[r];return o=i%3,o===0?(e+=s[n>>18&63],e+=s[n>>12&63],e+=s[n>>6&63],e+=s[n&63]):o===2?(e+=s[n>>10&63],e+=s[n>>4&63],e+=s[n<<2&63],e+=s[64]):o===1&&(e+=s[n>>2&63],e+=s[n<<4&63],e+=s[64],e+=s[64]),e}function WY(t){return Object.prototype.toString.call(t)==="[object Uint8Array]"}$b.exports=new GY("tag:yaml.org,2002:binary",{kind:"scalar",resolve:HY,construct:$Y,predicate:WY,represent:VY})});var dg=k((cX,Vb)=>{"use strict";var JY=Ye(),zY=Object.prototype.hasOwnProperty,KY=Object.prototype.toString;function YY(t){if(t===null)return!0;var e=[],n,r,o,i,s,a=t;for(n=0,r=a.length;n<r;n+=1){if(o=a[n],s=!1,KY.call(o)!=="[object Object]")return!1;for(i in o)if(zY.call(o,i))if(!s)s=!0;else return!1;if(!s)return!1;if(e.indexOf(i)===-1)e.push(i);else return!1}return!0}function jY(t){return t!==null?t:[]}Vb.exports=new JY("tag:yaml.org,2002:omap",{kind:"sequence",resolve:YY,construct:jY})});var pg=k((fX,Wb)=>{"use strict";var XY=Ye(),QY=Object.prototype.toString;function ZY(t){if(t===null)return!0;var e,n,r,o,i,s=t;for(i=new Array(s.length),e=0,n=s.length;e<n;e+=1){if(r=s[e],QY.call(r)!=="[object Object]"||(o=Object.keys(r),o.length!==1))return!1;i[e]=[o[0],r[o[0]]]}return!0}function e3(t){if(t===null)return[];var e,n,r,o,i,s=t;for(i=new Array(s.length),e=0,n=s.length;e<n;e+=1)r=s[e],o=Object.keys(r),i[e]=[o[0],r[o[0]]];return i}Wb.exports=new XY("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:ZY,construct:e3})});var hg=k((dX,Jb)=>{"use strict";var t3=Ye(),n3=Object.prototype.hasOwnProperty;function r3(t){if(t===null)return!0;var e,n=t;for(e in n)if(n3.call(n,e)&&n[e]!==null)return!1;return!0}function o3(t){return t!==null?t:{}}Jb.exports=new t3("tag:yaml.org,2002:set",{kind:"mapping",resolve:r3,construct:o3})});var hc=k((pX,zb)=>{"use strict";zb.exports=ag().extend({implicit:[lg(),ug()],explicit:[fg(),dg(),pg(),hg()]})});var cR=k((hX,_g)=>{"use strict";var Qr=ci(),eR=fi(),i3=vb(),s3=hc(),Er=Object.prototype.hasOwnProperty,mc=1,tR=2,nR=3,gc=4,mg=1,a3=2,Kb=3,l3=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,u3=/[\x85\u2028\u2029]/,c3=/[,\[\]\{\}]/,rR=/^(?:!|!!|![a-z\-]+!)$/i,oR=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Yb(t){return Object.prototype.toString.call(t)}function Rn(t){return t===10||t===13}function Zr(t){return t===9||t===32}function ht(t){return t===9||t===32||t===10||t===13}function di(t){return t===44||t===91||t===93||t===123||t===125}function f3(t){var e;return 48<=t&&t<=57?t-48:(e=t|32,97<=e&&e<=102?e-97+10:-1)}function d3(t){return t===120?2:t===117?4:t===85?8:0}function p3(t){return 48<=t&&t<=57?t-48:-1}function jb(t){return t===48?"\0":t===97?"\x07":t===98?"\b":t===116||t===9?"	":t===110?`
`:t===118?"\v":t===102?"\f":t===114?"\r":t===101?"\x1B":t===32?" ":t===34?'"':t===47?"/":t===92?"\\":t===78?"\x85":t===95?"\xA0":t===76?"\u2028":t===80?"\u2029":""}function h3(t){return t<=65535?String.fromCharCode(t):String.fromCharCode((t-65536>>10)+55296,(t-65536&1023)+56320)}function iR(t,e,n){e==="__proto__"?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,writable:!0,value:n}):t[e]=n}var sR=new Array(256),aR=new Array(256);for(Xr=0;Xr<256;Xr++)sR[Xr]=jb(Xr)?1:0,aR[Xr]=jb(Xr);var Xr;function m3(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||s3,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function lR(t,e){var n={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return n.snippet=i3(n),new eR(e,n)}function re(t,e){throw lR(t,e)}function yc(t,e){t.onWarning&&t.onWarning.call(null,lR(t,e))}var Xb={YAML:function(e,n,r){var o,i,s;e.version!==null&&re(e,"duplication of %YAML directive"),r.length!==1&&re(e,"YAML directive accepts exactly one argument"),o=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),o===null&&re(e,"ill-formed argument of the YAML directive"),i=parseInt(o[1],10),s=parseInt(o[2],10),i!==1&&re(e,"unacceptable YAML version of the document"),e.version=r[0],e.checkLineBreaks=s<2,s!==1&&s!==2&&yc(e,"unsupported YAML version of the document")},TAG:function(e,n,r){var o,i;r.length!==2&&re(e,"TAG directive accepts exactly two arguments"),o=r[0],i=r[1],rR.test(o)||re(e,"ill-formed tag handle (first argument) of the TAG directive"),Er.call(e.tagMap,o)&&re(e,'there is a previously declared suffix for "'+o+'" tag handle'),oR.test(i)||re(e,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch{re(e,"tag prefix is malformed: "+i)}e.tagMap[o]=i}};function Tr(t,e,n,r){var o,i,s,a;if(e<n){if(a=t.input.slice(e,n),r)for(o=0,i=a.length;o<i;o+=1)s=a.charCodeAt(o),s===9||32<=s&&s<=1114111||re(t,"expected valid JSON character");else l3.test(a)&&re(t,"the stream contains non-printable characters");t.result+=a}}function Qb(t,e,n,r){var o,i,s,a;for(Qr.isObject(n)||re(t,"cannot merge mappings; the provided source object is unacceptable"),o=Object.keys(n),s=0,a=o.length;s<a;s+=1)i=o[s],Er.call(e,i)||(iR(e,i,n[i]),r[i]=!0)}function pi(t,e,n,r,o,i,s,a,l){var c,f;if(Array.isArray(o))for(o=Array.prototype.slice.call(o),c=0,f=o.length;c<f;c+=1)Array.isArray(o[c])&&re(t,"nested arrays are not supported inside keys"),typeof o=="object"&&Yb(o[c])==="[object Object]"&&(o[c]="[object Object]");if(typeof o=="object"&&Yb(o)==="[object Object]"&&(o="[object Object]"),o=String(o),e===null&&(e={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(i))for(c=0,f=i.length;c<f;c+=1)Qb(t,e,i[c],n);else Qb(t,e,i,n);else!t.json&&!Er.call(n,o)&&Er.call(e,o)&&(t.line=s||t.line,t.lineStart=a||t.lineStart,t.position=l||t.position,re(t,"duplicated mapping key")),iR(e,o,i),delete n[o];return e}function gg(t){var e;e=t.input.charCodeAt(t.position),e===10?t.position++:e===13?(t.position++,t.input.charCodeAt(t.position)===10&&t.position++):re(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function Me(t,e,n){for(var r=0,o=t.input.charCodeAt(t.position);o!==0;){for(;Zr(o);)o===9&&t.firstTabInLine===-1&&(t.firstTabInLine=t.position),o=t.input.charCodeAt(++t.position);if(e&&o===35)do o=t.input.charCodeAt(++t.position);while(o!==10&&o!==13&&o!==0);if(Rn(o))for(gg(t),o=t.input.charCodeAt(t.position),r++,t.lineIndent=0;o===32;)t.lineIndent++,o=t.input.charCodeAt(++t.position);else break}return n!==-1&&r!==0&&t.lineIndent<n&&yc(t,"deficient indentation"),r}function _c(t){var e=t.position,n;return n=t.input.charCodeAt(e),!!((n===45||n===46)&&n===t.input.charCodeAt(e+1)&&n===t.input.charCodeAt(e+2)&&(e+=3,n=t.input.charCodeAt(e),n===0||ht(n)))}function yg(t,e){e===1?t.result+=" ":e>1&&(t.result+=Qr.repeat(`
`,e-1))}function g3(t,e,n){var r,o,i,s,a,l,c,f,m=t.kind,h=t.result,y;if(y=t.input.charCodeAt(t.position),ht(y)||di(y)||y===35||y===38||y===42||y===33||y===124||y===62||y===39||y===34||y===37||y===64||y===96||(y===63||y===45)&&(o=t.input.charCodeAt(t.position+1),ht(o)||n&&di(o)))return!1;for(t.kind="scalar",t.result="",i=s=t.position,a=!1;y!==0;){if(y===58){if(o=t.input.charCodeAt(t.position+1),ht(o)||n&&di(o))break}else if(y===35){if(r=t.input.charCodeAt(t.position-1),ht(r))break}else{if(t.position===t.lineStart&&_c(t)||n&&di(y))break;if(Rn(y))if(l=t.line,c=t.lineStart,f=t.lineIndent,Me(t,!1,-1),t.lineIndent>=e){a=!0,y=t.input.charCodeAt(t.position);continue}else{t.position=s,t.line=l,t.lineStart=c,t.lineIndent=f;break}}a&&(Tr(t,i,s,!1),yg(t,t.line-l),i=s=t.position,a=!1),Zr(y)||(s=t.position+1),y=t.input.charCodeAt(++t.position)}return Tr(t,i,s,!1),t.result?!0:(t.kind=m,t.result=h,!1)}function y3(t,e){var n,r,o;if(n=t.input.charCodeAt(t.position),n!==39)return!1;for(t.kind="scalar",t.result="",t.position++,r=o=t.position;(n=t.input.charCodeAt(t.position))!==0;)if(n===39)if(Tr(t,r,t.position,!0),n=t.input.charCodeAt(++t.position),n===39)r=t.position,t.position++,o=t.position;else return!0;else Rn(n)?(Tr(t,r,o,!0),yg(t,Me(t,!1,e)),r=o=t.position):t.position===t.lineStart&&_c(t)?re(t,"unexpected end of the document within a single quoted scalar"):(t.position++,o=t.position);re(t,"unexpected end of the stream within a single quoted scalar")}function _3(t,e){var n,r,o,i,s,a;if(a=t.input.charCodeAt(t.position),a!==34)return!1;for(t.kind="scalar",t.result="",t.position++,n=r=t.position;(a=t.input.charCodeAt(t.position))!==0;){if(a===34)return Tr(t,n,t.position,!0),t.position++,!0;if(a===92){if(Tr(t,n,t.position,!0),a=t.input.charCodeAt(++t.position),Rn(a))Me(t,!1,e);else if(a<256&&sR[a])t.result+=aR[a],t.position++;else if((s=d3(a))>0){for(o=s,i=0;o>0;o--)a=t.input.charCodeAt(++t.position),(s=f3(a))>=0?i=(i<<4)+s:re(t,"expected hexadecimal character");t.result+=h3(i),t.position++}else re(t,"unknown escape sequence");n=r=t.position}else Rn(a)?(Tr(t,n,r,!0),yg(t,Me(t,!1,e)),n=r=t.position):t.position===t.lineStart&&_c(t)?re(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}re(t,"unexpected end of the stream within a double quoted scalar")}function S3(t,e){var n=!0,r,o,i,s=t.tag,a,l=t.anchor,c,f,m,h,y,_=Object.create(null),T,E,w,b;if(b=t.input.charCodeAt(t.position),b===91)f=93,y=!1,a=[];else if(b===123)f=125,y=!0,a={};else return!1;for(t.anchor!==null&&(t.anchorMap[t.anchor]=a),b=t.input.charCodeAt(++t.position);b!==0;){if(Me(t,!0,e),b=t.input.charCodeAt(t.position),b===f)return t.position++,t.tag=s,t.anchor=l,t.kind=y?"mapping":"sequence",t.result=a,!0;n?b===44&&re(t,"expected the node content, but found ','"):re(t,"missed comma between flow collection entries"),E=T=w=null,m=h=!1,b===63&&(c=t.input.charCodeAt(t.position+1),ht(c)&&(m=h=!0,t.position++,Me(t,!0,e))),r=t.line,o=t.lineStart,i=t.position,hi(t,e,mc,!1,!0),E=t.tag,T=t.result,Me(t,!0,e),b=t.input.charCodeAt(t.position),(h||t.line===r)&&b===58&&(m=!0,b=t.input.charCodeAt(++t.position),Me(t,!0,e),hi(t,e,mc,!1,!0),w=t.result),y?pi(t,a,_,E,T,w,r,o,i):m?a.push(pi(t,null,_,E,T,w,r,o,i)):a.push(T),Me(t,!0,e),b=t.input.charCodeAt(t.position),b===44?(n=!0,b=t.input.charCodeAt(++t.position)):n=!1}re(t,"unexpected end of the stream within a flow collection")}function T3(t,e){var n,r,o=mg,i=!1,s=!1,a=e,l=0,c=!1,f,m;if(m=t.input.charCodeAt(t.position),m===124)r=!1;else if(m===62)r=!0;else return!1;for(t.kind="scalar",t.result="";m!==0;)if(m=t.input.charCodeAt(++t.position),m===43||m===45)mg===o?o=m===43?Kb:a3:re(t,"repeat of a chomping mode identifier");else if((f=p3(m))>=0)f===0?re(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):s?re(t,"repeat of an indentation width identifier"):(a=e+f-1,s=!0);else break;if(Zr(m)){do m=t.input.charCodeAt(++t.position);while(Zr(m));if(m===35)do m=t.input.charCodeAt(++t.position);while(!Rn(m)&&m!==0)}for(;m!==0;){for(gg(t),t.lineIndent=0,m=t.input.charCodeAt(t.position);(!s||t.lineIndent<a)&&m===32;)t.lineIndent++,m=t.input.charCodeAt(++t.position);if(!s&&t.lineIndent>a&&(a=t.lineIndent),Rn(m)){l++;continue}if(t.lineIndent<a){o===Kb?t.result+=Qr.repeat(`
`,i?1+l:l):o===mg&&i&&(t.result+=`
`);break}for(r?Zr(m)?(c=!0,t.result+=Qr.repeat(`
`,i?1+l:l)):c?(c=!1,t.result+=Qr.repeat(`
`,l+1)):l===0?i&&(t.result+=" "):t.result+=Qr.repeat(`
`,l):t.result+=Qr.repeat(`
`,i?1+l:l),i=!0,s=!0,l=0,n=t.position;!Rn(m)&&m!==0;)m=t.input.charCodeAt(++t.position);Tr(t,n,t.position,!1)}return!0}function Zb(t,e){var n,r=t.tag,o=t.anchor,i=[],s,a=!1,l;if(t.firstTabInLine!==-1)return!1;for(t.anchor!==null&&(t.anchorMap[t.anchor]=i),l=t.input.charCodeAt(t.position);l!==0&&(t.firstTabInLine!==-1&&(t.position=t.firstTabInLine,re(t,"tab characters must not be used in indentation")),!(l!==45||(s=t.input.charCodeAt(t.position+1),!ht(s))));){if(a=!0,t.position++,Me(t,!0,-1)&&t.lineIndent<=e){i.push(null),l=t.input.charCodeAt(t.position);continue}if(n=t.line,hi(t,e,nR,!1,!0),i.push(t.result),Me(t,!0,-1),l=t.input.charCodeAt(t.position),(t.line===n||t.lineIndent>e)&&l!==0)re(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break}return a?(t.tag=r,t.anchor=o,t.kind="sequence",t.result=i,!0):!1}function E3(t,e,n){var r,o,i,s,a,l,c=t.tag,f=t.anchor,m={},h=Object.create(null),y=null,_=null,T=null,E=!1,w=!1,b;if(t.firstTabInLine!==-1)return!1;for(t.anchor!==null&&(t.anchorMap[t.anchor]=m),b=t.input.charCodeAt(t.position);b!==0;){if(!E&&t.firstTabInLine!==-1&&(t.position=t.firstTabInLine,re(t,"tab characters must not be used in indentation")),r=t.input.charCodeAt(t.position+1),i=t.line,(b===63||b===58)&&ht(r))b===63?(E&&(pi(t,m,h,y,_,null,s,a,l),y=_=T=null),w=!0,E=!0,o=!0):E?(E=!1,o=!0):re(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,b=r;else{if(s=t.line,a=t.lineStart,l=t.position,!hi(t,n,tR,!1,!0))break;if(t.line===i){for(b=t.input.charCodeAt(t.position);Zr(b);)b=t.input.charCodeAt(++t.position);if(b===58)b=t.input.charCodeAt(++t.position),ht(b)||re(t,"a whitespace character is expected after the key-value separator within a block mapping"),E&&(pi(t,m,h,y,_,null,s,a,l),y=_=T=null),w=!0,E=!1,o=!1,y=t.tag,_=t.result;else if(w)re(t,"can not read an implicit mapping pair; a colon is missed");else return t.tag=c,t.anchor=f,!0}else if(w)re(t,"can not read a block mapping entry; a multiline key may not be an implicit key");else return t.tag=c,t.anchor=f,!0}if((t.line===i||t.lineIndent>e)&&(E&&(s=t.line,a=t.lineStart,l=t.position),hi(t,e,gc,!0,o)&&(E?_=t.result:T=t.result),E||(pi(t,m,h,y,_,T,s,a,l),y=_=T=null),Me(t,!0,-1),b=t.input.charCodeAt(t.position)),(t.line===i||t.lineIndent>e)&&b!==0)re(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return E&&pi(t,m,h,y,_,null,s,a,l),w&&(t.tag=c,t.anchor=f,t.kind="mapping",t.result=m),w}function w3(t){var e,n=!1,r=!1,o,i,s;if(s=t.input.charCodeAt(t.position),s!==33)return!1;if(t.tag!==null&&re(t,"duplication of a tag property"),s=t.input.charCodeAt(++t.position),s===60?(n=!0,s=t.input.charCodeAt(++t.position)):s===33?(r=!0,o="!!",s=t.input.charCodeAt(++t.position)):o="!",e=t.position,n){do s=t.input.charCodeAt(++t.position);while(s!==0&&s!==62);t.position<t.length?(i=t.input.slice(e,t.position),s=t.input.charCodeAt(++t.position)):re(t,"unexpected end of the stream within a verbatim tag")}else{for(;s!==0&&!ht(s);)s===33&&(r?re(t,"tag suffix cannot contain exclamation marks"):(o=t.input.slice(e-1,t.position+1),rR.test(o)||re(t,"named tag handle cannot contain such characters"),r=!0,e=t.position+1)),s=t.input.charCodeAt(++t.position);i=t.input.slice(e,t.position),c3.test(i)&&re(t,"tag suffix cannot contain flow indicator characters")}i&&!oR.test(i)&&re(t,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch{re(t,"tag name is malformed: "+i)}return n?t.tag=i:Er.call(t.tagMap,o)?t.tag=t.tagMap[o]+i:o==="!"?t.tag="!"+i:o==="!!"?t.tag="tag:yaml.org,2002:"+i:re(t,'undeclared tag handle "'+o+'"'),!0}function v3(t){var e,n;if(n=t.input.charCodeAt(t.position),n!==38)return!1;for(t.anchor!==null&&re(t,"duplication of an anchor property"),n=t.input.charCodeAt(++t.position),e=t.position;n!==0&&!ht(n)&&!di(n);)n=t.input.charCodeAt(++t.position);return t.position===e&&re(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function A3(t){var e,n,r;if(r=t.input.charCodeAt(t.position),r!==42)return!1;for(r=t.input.charCodeAt(++t.position),e=t.position;r!==0&&!ht(r)&&!di(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&re(t,"name of an alias node must contain at least one character"),n=t.input.slice(e,t.position),Er.call(t.anchorMap,n)||re(t,'unidentified alias "'+n+'"'),t.result=t.anchorMap[n],Me(t,!0,-1),!0}function hi(t,e,n,r,o){var i,s,a,l=1,c=!1,f=!1,m,h,y,_,T,E;if(t.listener!==null&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,i=s=a=gc===n||nR===n,r&&Me(t,!0,-1)&&(c=!0,t.lineIndent>e?l=1:t.lineIndent===e?l=0:t.lineIndent<e&&(l=-1)),l===1)for(;w3(t)||v3(t);)Me(t,!0,-1)?(c=!0,a=i,t.lineIndent>e?l=1:t.lineIndent===e?l=0:t.lineIndent<e&&(l=-1)):a=!1;if(a&&(a=c||o),(l===1||gc===n)&&(mc===n||tR===n?T=e:T=e+1,E=t.position-t.lineStart,l===1?a&&(Zb(t,E)||E3(t,E,T))||S3(t,T)?f=!0:(s&&T3(t,T)||y3(t,T)||_3(t,T)?f=!0:A3(t)?(f=!0,(t.tag!==null||t.anchor!==null)&&re(t,"alias node should not have any properties")):g3(t,T,mc===n)&&(f=!0,t.tag===null&&(t.tag="?")),t.anchor!==null&&(t.anchorMap[t.anchor]=t.result)):l===0&&(f=a&&Zb(t,E))),t.tag===null)t.anchor!==null&&(t.anchorMap[t.anchor]=t.result);else if(t.tag==="?"){for(t.result!==null&&t.kind!=="scalar"&&re(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),m=0,h=t.implicitTypes.length;m<h;m+=1)if(_=t.implicitTypes[m],_.resolve(t.result)){t.result=_.construct(t.result),t.tag=_.tag,t.anchor!==null&&(t.anchorMap[t.anchor]=t.result);break}}else if(t.tag!=="!"){if(Er.call(t.typeMap[t.kind||"fallback"],t.tag))_=t.typeMap[t.kind||"fallback"][t.tag];else for(_=null,y=t.typeMap.multi[t.kind||"fallback"],m=0,h=y.length;m<h;m+=1)if(t.tag.slice(0,y[m].tag.length)===y[m].tag){_=y[m];break}_||re(t,"unknown tag !<"+t.tag+">"),t.result!==null&&_.kind!==t.kind&&re(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+_.kind+'", not "'+t.kind+'"'),_.resolve(t.result,t.tag)?(t.result=_.construct(t.result,t.tag),t.anchor!==null&&(t.anchorMap[t.anchor]=t.result)):re(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return t.listener!==null&&t.listener("close",t),t.tag!==null||t.anchor!==null||f}function C3(t){var e=t.position,n,r,o,i=!1,s;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);(s=t.input.charCodeAt(t.position))!==0&&(Me(t,!0,-1),s=t.input.charCodeAt(t.position),!(t.lineIndent>0||s!==37));){for(i=!0,s=t.input.charCodeAt(++t.position),n=t.position;s!==0&&!ht(s);)s=t.input.charCodeAt(++t.position);for(r=t.input.slice(n,t.position),o=[],r.length<1&&re(t,"directive name must not be less than one character in length");s!==0;){for(;Zr(s);)s=t.input.charCodeAt(++t.position);if(s===35){do s=t.input.charCodeAt(++t.position);while(s!==0&&!Rn(s));break}if(Rn(s))break;for(n=t.position;s!==0&&!ht(s);)s=t.input.charCodeAt(++t.position);o.push(t.input.slice(n,t.position))}s!==0&&gg(t),Er.call(Xb,r)?Xb[r](t,r,o):yc(t,'unknown document directive "'+r+'"')}if(Me(t,!0,-1),t.lineIndent===0&&t.input.charCodeAt(t.position)===45&&t.input.charCodeAt(t.position+1)===45&&t.input.charCodeAt(t.position+2)===45?(t.position+=3,Me(t,!0,-1)):i&&re(t,"directives end mark is expected"),hi(t,t.lineIndent-1,gc,!1,!0),Me(t,!0,-1),t.checkLineBreaks&&u3.test(t.input.slice(e,t.position))&&yc(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&_c(t)){t.input.charCodeAt(t.position)===46&&(t.position+=3,Me(t,!0,-1));return}if(t.position<t.length-1)re(t,"end of the stream or a document separator is expected");else return}function uR(t,e){t=String(t),e=e||{},t.length!==0&&(t.charCodeAt(t.length-1)!==10&&t.charCodeAt(t.length-1)!==13&&(t+=`
`),t.charCodeAt(0)===65279&&(t=t.slice(1)));var n=new m3(t,e),r=t.indexOf("\0");for(r!==-1&&(n.position=r,re(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)C3(n);return n.documents}function b3(t,e,n){e!==null&&typeof e=="object"&&typeof n>"u"&&(n=e,e=null);var r=uR(t,n);if(typeof e!="function")return r;for(var o=0,i=r.length;o<i;o+=1)e(r[o])}function R3(t,e){var n=uR(t,e);if(n.length!==0){if(n.length===1)return n[0];throw new eR("expected a single document in the stream, but found more")}}_g.exports.loadAll=b3;_g.exports.load=R3});var kR=k((mX,PR)=>{"use strict";var Ec=ci(),Xs=fi(),I3=hc(),SR=Object.prototype.toString,TR=Object.prototype.hasOwnProperty,vg=65279,x3=9,Ks=10,P3=13,k3=32,N3=33,M3=34,Sg=35,O3=37,D3=38,F3=39,L3=42,ER=44,U3=45,Sc=58,q3=61,B3=62,G3=63,H3=64,wR=91,vR=93,$3=96,AR=123,V3=124,CR=125,je={};je[0]="\\0";je[7]="\\a";je[8]="\\b";je[9]="\\t";je[10]="\\n";je[11]="\\v";je[12]="\\f";je[13]="\\r";je[27]="\\e";je[34]='\\"';je[92]="\\\\";je[133]="\\N";je[160]="\\_";je[8232]="\\L";je[8233]="\\P";var W3=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],J3=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function z3(t,e){var n,r,o,i,s,a,l;if(e===null)return{};for(n={},r=Object.keys(e),o=0,i=r.length;o<i;o+=1)s=r[o],a=String(e[s]),s.slice(0,2)==="!!"&&(s="tag:yaml.org,2002:"+s.slice(2)),l=t.compiledTypeMap.fallback[s],l&&TR.call(l.styleAliases,a)&&(a=l.styleAliases[a]),n[s]=a;return n}function K3(t){var e,n,r;if(e=t.toString(16).toUpperCase(),t<=255)n="x",r=2;else if(t<=65535)n="u",r=4;else if(t<=4294967295)n="U",r=8;else throw new Xs("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+Ec.repeat("0",r-e.length)+e}var Y3=1,Ys=2;function j3(t){this.schema=t.schema||I3,this.indent=Math.max(1,t.indent||2),this.noArrayIndent=t.noArrayIndent||!1,this.skipInvalid=t.skipInvalid||!1,this.flowLevel=Ec.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=z3(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.lineWidth=t.lineWidth||80,this.noRefs=t.noRefs||!1,this.noCompatMode=t.noCompatMode||!1,this.condenseFlow=t.condenseFlow||!1,this.quotingType=t.quotingType==='"'?Ys:Y3,this.forceQuotes=t.forceQuotes||!1,this.replacer=typeof t.replacer=="function"?t.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function fR(t,e){for(var n=Ec.repeat(" ",e),r=0,o=-1,i="",s,a=t.length;r<a;)o=t.indexOf(`
`,r),o===-1?(s=t.slice(r),r=a):(s=t.slice(r,o+1),r=o+1),s.length&&s!==`
`&&(i+=n),i+=s;return i}function Tg(t,e){return`
`+Ec.repeat(" ",t.indent*e)}function X3(t,e){var n,r,o;for(n=0,r=t.implicitTypes.length;n<r;n+=1)if(o=t.implicitTypes[n],o.resolve(e))return!0;return!1}function Tc(t){return t===k3||t===x3}function js(t){return 32<=t&&t<=126||161<=t&&t<=55295&&t!==8232&&t!==8233||57344<=t&&t<=65533&&t!==vg||65536<=t&&t<=1114111}function dR(t){return js(t)&&t!==vg&&t!==P3&&t!==Ks}function pR(t,e,n){var r=dR(t),o=r&&!Tc(t);return(n?r:r&&t!==ER&&t!==wR&&t!==vR&&t!==AR&&t!==CR)&&t!==Sg&&!(e===Sc&&!o)||dR(e)&&!Tc(e)&&t===Sg||e===Sc&&o}function Q3(t){return js(t)&&t!==vg&&!Tc(t)&&t!==U3&&t!==G3&&t!==Sc&&t!==ER&&t!==wR&&t!==vR&&t!==AR&&t!==CR&&t!==Sg&&t!==D3&&t!==L3&&t!==N3&&t!==V3&&t!==q3&&t!==B3&&t!==F3&&t!==M3&&t!==O3&&t!==H3&&t!==$3}function Z3(t){return!Tc(t)&&t!==Sc}function zs(t,e){var n=t.charCodeAt(e),r;return n>=55296&&n<=56319&&e+1<t.length&&(r=t.charCodeAt(e+1),r>=56320&&r<=57343)?(n-55296)*1024+r-56320+65536:n}function bR(t){var e=/^\n* /;return e.test(t)}var RR=1,Eg=2,IR=3,xR=4,mi=5;function e6(t,e,n,r,o,i,s,a){var l,c=0,f=null,m=!1,h=!1,y=r!==-1,_=-1,T=Q3(zs(t,0))&&Z3(zs(t,t.length-1));if(e||s)for(l=0;l<t.length;c>=65536?l+=2:l++){if(c=zs(t,l),!js(c))return mi;T=T&&pR(c,f,a),f=c}else{for(l=0;l<t.length;c>=65536?l+=2:l++){if(c=zs(t,l),c===Ks)m=!0,y&&(h=h||l-_-1>r&&t[_+1]!==" ",_=l);else if(!js(c))return mi;T=T&&pR(c,f,a),f=c}h=h||y&&l-_-1>r&&t[_+1]!==" "}return!m&&!h?T&&!s&&!o(t)?RR:i===Ys?mi:Eg:n>9&&bR(t)?mi:s?i===Ys?mi:Eg:h?xR:IR}function t6(t,e,n,r,o){t.dump=(function(){if(e.length===0)return t.quotingType===Ys?'""':"''";if(!t.noCompatMode&&(W3.indexOf(e)!==-1||J3.test(e)))return t.quotingType===Ys?'"'+e+'"':"'"+e+"'";var i=t.indent*Math.max(1,n),s=t.lineWidth===-1?-1:Math.max(Math.min(t.lineWidth,40),t.lineWidth-i),a=r||t.flowLevel>-1&&n>=t.flowLevel;function l(c){return X3(t,c)}switch(e6(e,a,t.indent,s,l,t.quotingType,t.forceQuotes&&!r,o)){case RR:return e;case Eg:return"'"+e.replace(/'/g,"''")+"'";case IR:return"|"+hR(e,t.indent)+mR(fR(e,i));case xR:return">"+hR(e,t.indent)+mR(fR(n6(e,s),i));case mi:return'"'+r6(e,s)+'"';default:throw new Xs("impossible error: invalid scalar style")}})()}function hR(t,e){var n=bR(t)?String(e):"",r=t[t.length-1]===`
`,o=r&&(t[t.length-2]===`
`||t===`
`),i=o?"+":r?"":"-";return n+i+`
`}function mR(t){return t[t.length-1]===`
`?t.slice(0,-1):t}function n6(t,e){for(var n=/(\n+)([^\n]*)/g,r=(function(){var c=t.indexOf(`
`);return c=c!==-1?c:t.length,n.lastIndex=c,gR(t.slice(0,c),e)})(),o=t[0]===`
`||t[0]===" ",i,s;s=n.exec(t);){var a=s[1],l=s[2];i=l[0]===" ",r+=a+(!o&&!i&&l!==""?`
`:"")+gR(l,e),o=i}return r}function gR(t,e){if(t===""||t[0]===" ")return t;for(var n=/ [^ ]/g,r,o=0,i,s=0,a=0,l="";r=n.exec(t);)a=r.index,a-o>e&&(i=s>o?s:a,l+=`
`+t.slice(o,i),o=i+1),s=a;return l+=`
`,t.length-o>e&&s>o?l+=t.slice(o,s)+`
`+t.slice(s+1):l+=t.slice(o),l.slice(1)}function r6(t){for(var e="",n=0,r,o=0;o<t.length;n>=65536?o+=2:o++)n=zs(t,o),r=je[n],!r&&js(n)?(e+=t[o],n>=65536&&(e+=t[o+1])):e+=r||K3(n);return e}function o6(t,e,n){var r="",o=t.tag,i,s,a;for(i=0,s=n.length;i<s;i+=1)a=n[i],t.replacer&&(a=t.replacer.call(n,String(i),a)),(Kn(t,e,a,!1,!1)||typeof a>"u"&&Kn(t,e,null,!1,!1))&&(r!==""&&(r+=","+(t.condenseFlow?"":" ")),r+=t.dump);t.tag=o,t.dump="["+r+"]"}function yR(t,e,n,r){var o="",i=t.tag,s,a,l;for(s=0,a=n.length;s<a;s+=1)l=n[s],t.replacer&&(l=t.replacer.call(n,String(s),l)),(Kn(t,e+1,l,!0,!0,!1,!0)||typeof l>"u"&&Kn(t,e+1,null,!0,!0,!1,!0))&&((!r||o!=="")&&(o+=Tg(t,e)),t.dump&&Ks===t.dump.charCodeAt(0)?o+="-":o+="- ",o+=t.dump);t.tag=i,t.dump=o||"[]"}function i6(t,e,n){var r="",o=t.tag,i=Object.keys(n),s,a,l,c,f;for(s=0,a=i.length;s<a;s+=1)f="",r!==""&&(f+=", "),t.condenseFlow&&(f+='"'),l=i[s],c=n[l],t.replacer&&(c=t.replacer.call(n,l,c)),Kn(t,e,l,!1,!1)&&(t.dump.length>1024&&(f+="? "),f+=t.dump+(t.condenseFlow?'"':"")+":"+(t.condenseFlow?"":" "),Kn(t,e,c,!1,!1)&&(f+=t.dump,r+=f));t.tag=o,t.dump="{"+r+"}"}function s6(t,e,n,r){var o="",i=t.tag,s=Object.keys(n),a,l,c,f,m,h;if(t.sortKeys===!0)s.sort();else if(typeof t.sortKeys=="function")s.sort(t.sortKeys);else if(t.sortKeys)throw new Xs("sortKeys must be a boolean or a function");for(a=0,l=s.length;a<l;a+=1)h="",(!r||o!=="")&&(h+=Tg(t,e)),c=s[a],f=n[c],t.replacer&&(f=t.replacer.call(n,c,f)),Kn(t,e+1,c,!0,!0,!0)&&(m=t.tag!==null&&t.tag!=="?"||t.dump&&t.dump.length>1024,m&&(t.dump&&Ks===t.dump.charCodeAt(0)?h+="?":h+="? "),h+=t.dump,m&&(h+=Tg(t,e)),Kn(t,e+1,f,!0,m)&&(t.dump&&Ks===t.dump.charCodeAt(0)?h+=":":h+=": ",h+=t.dump,o+=h));t.tag=i,t.dump=o||"{}"}function _R(t,e,n){var r,o,i,s,a,l;for(o=n?t.explicitTypes:t.implicitTypes,i=0,s=o.length;i<s;i+=1)if(a=o[i],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof e=="object"&&e instanceof a.instanceOf)&&(!a.predicate||a.predicate(e))){if(n?a.multi&&a.representName?t.tag=a.representName(e):t.tag=a.tag:t.tag="?",a.represent){if(l=t.styleMap[a.tag]||a.defaultStyle,SR.call(a.represent)==="[object Function]")r=a.represent(e,l);else if(TR.call(a.represent,l))r=a.represent[l](e,l);else throw new Xs("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');t.dump=r}return!0}return!1}function Kn(t,e,n,r,o,i,s){t.tag=null,t.dump=n,_R(t,n,!1)||_R(t,n,!0);var a=SR.call(t.dump),l=r,c;r&&(r=t.flowLevel<0||t.flowLevel>e);var f=a==="[object Object]"||a==="[object Array]",m,h;if(f&&(m=t.duplicates.indexOf(n),h=m!==-1),(t.tag!==null&&t.tag!=="?"||h||t.indent!==2&&e>0)&&(o=!1),h&&t.usedDuplicates[m])t.dump="*ref_"+m;else{if(f&&h&&!t.usedDuplicates[m]&&(t.usedDuplicates[m]=!0),a==="[object Object]")r&&Object.keys(t.dump).length!==0?(s6(t,e,t.dump,o),h&&(t.dump="&ref_"+m+t.dump)):(i6(t,e,t.dump),h&&(t.dump="&ref_"+m+" "+t.dump));else if(a==="[object Array]")r&&t.dump.length!==0?(t.noArrayIndent&&!s&&e>0?yR(t,e-1,t.dump,o):yR(t,e,t.dump,o),h&&(t.dump="&ref_"+m+t.dump)):(o6(t,e,t.dump),h&&(t.dump="&ref_"+m+" "+t.dump));else if(a==="[object String]")t.tag!=="?"&&t6(t,t.dump,e,i,l);else{if(a==="[object Undefined]")return!1;if(t.skipInvalid)return!1;throw new Xs("unacceptable kind of an object to dump "+a)}t.tag!==null&&t.tag!=="?"&&(c=encodeURI(t.tag[0]==="!"?t.tag.slice(1):t.tag).replace(/!/g,"%21"),t.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",t.dump=c+" "+t.dump)}return!0}function a6(t,e){var n=[],r=[],o,i;for(wg(t,n,r),o=0,i=r.length;o<i;o+=1)e.duplicates.push(n[r[o]]);e.usedDuplicates=new Array(i)}function wg(t,e,n){var r,o,i;if(t!==null&&typeof t=="object")if(o=e.indexOf(t),o!==-1)n.indexOf(o)===-1&&n.push(o);else if(e.push(t),Array.isArray(t))for(o=0,i=t.length;o<i;o+=1)wg(t[o],e,n);else for(r=Object.keys(t),o=0,i=r.length;o<i;o+=1)wg(t[r[o]],e,n)}function l6(t,e){e=e||{};var n=new j3(e);n.noRefs||a6(t,n);var r=t;return n.replacer&&(r=n.replacer.call({"":r},"",r)),Kn(n,0,r,!0,!0)?n.dump+`
`:""}PR.exports.dump=l6});var MR=k((gX,ot)=>{"use strict";var NR=cR(),u6=kR();function Ag(t,e){return function(){throw new Error("Function yaml."+t+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}ot.exports.Type=Ye();ot.exports.Schema=Xm();ot.exports.FAILSAFE_SCHEMA=tg();ot.exports.JSON_SCHEMA=sg();ot.exports.CORE_SCHEMA=ag();ot.exports.DEFAULT_SCHEMA=hc();ot.exports.load=NR.load;ot.exports.loadAll=NR.loadAll;ot.exports.dump=u6.dump;ot.exports.YAMLException=fi();ot.exports.types={binary:fg(),float:ig(),map:eg(),null:ng(),pairs:pg(),set:hg(),timestamp:lg(),bool:rg(),int:og(),merge:ug(),omap:dg(),seq:Zm(),str:Qm()};ot.exports.safeLoad=Ag("safeLoad","load");ot.exports.safeLoadAll=Ag("safeLoadAll","loadAll");ot.exports.safeDump=Ag("safeDump","dump")});var Cg=k((yX,DR)=>{function OR(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function c6(){return OR()?{fs:require("fs"),path:require("path"),yaml:MR(),url:require("url")}:null}DR.exports={isNodeRuntime:OR,getNodeDeps:c6}});var BR=k((_X,qR)=>{var{getNodeDeps:wc}=Cg(),{RiskLevel:f6,normalizeRiskLevel:d6}=yt();function FR(){console.warn("[SkillManager] Non-Node runtime detected. Skipping disk scan; use list_available_skills/read_skill_documentation.")}function LR(t){console.warn(`[SkillManager] Skills directory not found: ${t}`)}function UR({filePath:t,directoryName:e,skills:n}){try{let r=wc();if(!r)return;let{fs:o,yaml:i}=r,a=o.readFileSync(t,"utf8").split(/^---$/m);if(a.length<3)return;let l=a[1],c=i.load(l);n.push({id:e,name:c.name||e,description:c.description||"",filePath:t})}catch(r){console.error(`[SkillManager] Error loading metadata for ${e}:`,r)}}function bg(t,e,n,{quiet:r=!1}={}){if(Array.isArray(t))for(let o of t){if(!o||!o.name||!o.func){console.warn(`[SkillManager] Invalid tool definition in skill "${e}": missing name or func`);continue}o._skillSource||(o._skillSource=e),o.risk=d6(o.risk,f6.MEDIUM),n.push(o),r||console.log(`  \u2713 Registered tool: ${o.name} (from skill: ${o._skillSource})`)}}function p6(t,e,n,{quiet:r=!1}={}){try{let o=require(t);if(!Array.isArray(o)){console.warn(`[SkillManager] tools.js in skill "${e}" must export an array of tool definitions.`);return}bg(o,e,n,{quiet:r})}catch(o){console.error(`[SkillManager] Error loading tools from ${t}:`,o)}}async function h6(t,e,n,{quiet:r=!1}={}){try{let o=wc();if(!o)return;let{url:i}=o,s;t.endsWith(".mjs")?s=await import(i.pathToFileURL(t).href):s=require(t);let a=Array.isArray(s)?s:s&&(s.default||s.tools);if(!Array.isArray(a)){console.warn(`[SkillManager] tools in skill "${e}" must export an array (default export for ESM).`);return}bg(a,e,n,{quiet:r})}catch(o){console.error(`[SkillManager] Error loading tools from ${t}:`,o)}}function m6({skillsDir:t,skills:e,tools:n,quiet:r=!1}={}){let o=wc();if(!o){FR();return}let{fs:i,path:s}=o;if(!i.existsSync(t)){LR(t);return}let a=i.readdirSync(t,{withFileTypes:!0});for(let l of a){if(!l.isDirectory())continue;let c=s.join(t,l.name),f=s.join(c,"SKILL.md");i.existsSync(f)&&UR({filePath:f,directoryName:l.name,skills:e});let m=s.join(c,"tools.js");i.existsSync(m)&&p6(m,l.name,n,{quiet:r})}}async function g6({skillsDir:t,skills:e,tools:n,preferEsmTools:r=!0,quiet:o=!1}={}){let i=wc();if(!i){FR();return}let{fs:s,path:a}=i;if(!s.existsSync(t)){LR(t);return}let l=s.readdirSync(t,{withFileTypes:!0});for(let c of l){if(!c.isDirectory())continue;let f=a.join(t,c.name),m=a.join(f,"SKILL.md");s.existsSync(m)&&UR({filePath:m,directoryName:c.name,skills:e});let h=a.join(f,"tools.mjs"),y=a.join(f,"tools.js"),_=r&&s.existsSync(h)?h:s.existsSync(y)?y:null;_&&await h6(_,c.name,n,{quiet:o})}}qR.exports={loadSkillsSync:m6,loadSkillsAsync:g6,registerToolDefinitions:bg}});var $R=k((SX,HR)=>{var{getNodeDeps:y6}=Cg();function GR(t){return t.map(e=>({id:e.id,name:e.name,description:e.description}))}function _6(t,e){let n=t.find(r=>r.id===e);if(!n)return null;try{let r=y6();if(!r)return null;let{fs:o,path:i}=r,l=o.readFileSync(n.filePath,"utf8").split(/^---$/m).slice(2).join("---").trim(),f=i.dirname(n.filePath).split(i.sep).join("/");return l=l.replace(/\{baseDir\}/g,f),{...n,instruction:l}}catch(r){return console.error(`[SkillManager] Error lazy loading skill ${e}:`,r),null}}function S6(t,e){if(t.length===0)return"";let n=e,r=GR(t).slice().sort((a,l)=>(a.id||"").localeCompare(l.id||"")),o=r.slice(0,n),i=Math.max(0,r.length-o.length),s=`

## Skill Catalog (Top ${o.length})
Only skill names and descriptions are listed to avoid context overflow.
If you need details, call read_skill_documentation for that specific skill.
If the needed skill is not listed here, you MUST call list_available_skills to discover the full list.

`;for(let a of o){let l=(a.description||"").trim();s+=`- ${a.id}: ${l||"(no description)"}
`}return i>0&&(s+=`
(${i} more skills not shown. Use list_available_skills to discover them.)
`),s}HR.exports={getSkillList:GR,getSkillDetail:_6,buildSystemPromptAddition:S6}});var WR=k((TX,VR)=>{var{createMcpToolDefinitions:T6}=_b(),{loadSkillsSync:E6,loadSkillsAsync:w6,registerToolDefinitions:v6}=BR(),{getSkillList:A6,getSkillDetail:C6,buildSystemPromptAddition:b6}=$R(),Rg=class{constructor(e,{catalogLimit:n=80}={}){this.skillsDir=e,this.skills=[],this.tools=[],this.catalogLimit=n,this._externalMcp=null}refreshSkills(e={}){this.skills=[],this.tools=[],this.loadSkills(e)}async refreshSkillsAsync(e={}){this.skills=[],this.tools=[],await this.loadSkillsAsync(e),this._externalMcp&&Array.isArray(this._externalMcp.servers)&&this._externalMcp.servers.length>0&&await this.loadExternalMcpToolsAsync(this._externalMcp)}async loadExternalMcpToolsAsync({urls:e,servers:n,quiet:r=!1,timeoutMs:o,headers:i}={}){let s=Array.isArray(e)?e.filter(Boolean).map(String):[],a=Array.isArray(n)?n.filter(Boolean):[],l=a.length>0?a:s.map(f=>({url:f,namespace:!1}));if(this._externalMcp={servers:l,quiet:r,timeoutMs:o,headers:i},l.length===0)return;let c=await T6(l,{quiet:r,timeoutMs:o,headers:i});v6(c,"external_mcp",this.tools,{quiet:r})}loadSkills({quiet:e=!1}={}){E6({skillsDir:this.skillsDir,skills:this.skills,tools:this.tools,quiet:e})}async loadSkillsAsync({preferEsmTools:e=!0,quiet:n=!1}={}){await w6({skillsDir:this.skillsDir,skills:this.skills,tools:this.tools,preferEsmTools:e,quiet:n})}getSkillList(){return A6(this.skills)}getSkillDetail(e){return C6(this.skills,e)}getTools(){return this.tools}getSystemPromptAddition(){return b6(this.skills,this.catalogLimit)}};VR.exports={SkillManager:Rg}});var zR=k((EX,JR)=>{function R6(t){for(let e=0;e<t.length;e+=1){let n=String(t[e]||"");if(n.startsWith("diff --git ")||n.startsWith("--- ")&&e+1<t.length&&String(t[e+1]||"").startsWith("+++ "))return!0}return!1}function I6(t){let e=[],n=0,r=(o,i)=>{if(!o.startsWith(i))return null;let s=o.slice(i.length).trim();return s==="/dev/null"?null:s.startsWith("a/")||s.startsWith("b/")?s.slice(2):s};for(;n<t.length;){let o=String(t[n]||"");if(!o){n+=1;continue}let i=null,s=null,a=!1,l=!1,c=null,f=null;if(o.startsWith("diff --git ")){let y=o.split(" ").slice(2);for(y.length>=2&&(i=y[0].startsWith("a/")?y[0].slice(2):y[0],s=y[1].startsWith("b/")?y[1].slice(2):y[1]),n+=1;n<t.length;){if(o=String(t[n]||""),o.startsWith("new file mode")){a=!0,n+=1;continue}if(o.startsWith("deleted file mode")){l=!0,n+=1;continue}if(o.startsWith("rename from ")){c=o.slice(12).trim(),n+=1;continue}if(o.startsWith("rename to ")){f=o.slice(10).trim(),n+=1;continue}if(o.startsWith("--- "))break;n+=1}}if(o=String(t[n]||""),o.startsWith("--- ")){if(i=r(o,"--- ")??i,n+=1,o=String(t[n]||""),!o.startsWith("+++ "))throw new Error("Unified diff missing +++ header");s=r(o,"+++ ")??s,n+=1}else if(!o.startsWith("diff --git ")){n+=1;continue}if(c&&(i=c),f&&(s=f),!i&&!s)throw new Error("Unified diff missing file paths");i===null&&(a=!0),s===null&&(l=!0);let m=[];for(;n<t.length&&(o=String(t[n]||""),!(o.startsWith("diff --git ")||o.startsWith("--- ")&&n+1<t.length&&String(t[n+1]||"").startsWith("+++ ")));){if(o.startsWith("@@")){n+=1;continue}if(o==="\\ No newline at end of file"){n+=1;continue}let y=o[0];if(y===" "||y==="+"||y==="-"){m.push({type:y,text:o.slice(1)}),n+=1;continue}n+=1}if(a){let y=m.filter(_=>_.type==="+").map(_=>_.text);if(y.length===0)throw new Error("Unified diff add requires content");e.push({type:"add",path:s||i,contentLines:y});continue}if(l){e.push({type:"delete",path:i||s});continue}if(m.length===0)throw new Error("Unified diff update requires diff lines");let h=i&&s&&i!==s?s:null;e.push({type:"update",path:i||s,movePath:h,diffLines:m})}return e}JR.exports={isUnifiedDiff:R6,parseUnifiedDiff:I6}});var QR=k((wX,XR)=>{var Yn=require("fs"),eo=require("path"),{isUnifiedDiff:x6,parseUnifiedDiff:P6}=zR();function KR(t){return typeof t=="string"&&t.startsWith("*** ")}function vc(t){return String(t||"").trimEnd()}function Ac(t,e){if(!e||typeof e!="string")throw new Error("Invalid path");if(eo.isAbsolute(e))throw new Error("Absolute paths are not allowed");let n=eo.normalize(e);if(n===".."||n.startsWith(`..${eo.sep}`))throw new Error("Path traversal is not allowed");let r=eo.resolve(t,n),o=eo.resolve(t);if(r!==o&&!r.startsWith(`${o}${eo.sep}`))throw new Error("Path is outside workspace");return r}function jR(t){let e=String(t||""),n=e.includes(`\r
`),r=n?`\r
`:`
`,o=n?e.split(/\r\n/):e.split(/\n/),i=e.endsWith(`
`);return{lines:o,eol:r,hasTrailingNewline:i}}function k6(t){let{lines:e}=jR(t),n=[],r=0;if(x6(e))return P6(e);if(vc(e[r])!=="*** Begin Patch")throw new Error('Patch must start with "*** Begin Patch"');for(r+=1;r<e.length;){let o=vc(e[r]);if(!o){r+=1;continue}if(o==="*** End Patch")return n;if(o.startsWith("*** Add File: ")){let i=o.slice(14).trim();r+=1;let s=[];for(;r<e.length&&!KR(e[r]);){let a=e[r];if(!a.startsWith("+"))throw new Error('Add File lines must start with "+"');s.push(a.slice(1)),r+=1}if(s.length===0)throw new Error("Add File requires at least one line");n.push({type:"add",path:i,contentLines:s});continue}if(o.startsWith("*** Delete File: ")){let i=o.slice(17).trim();r+=1,n.push({type:"delete",path:i});continue}if(o.startsWith("*** Update File: ")){let i=o.slice(17).trim();r+=1;let s=null;r<e.length&&vc(e[r]).startsWith("*** Move to: ")&&(s=vc(e[r]).slice(13).trim(),r+=1);let a=[];for(;r<e.length&&!KR(e[r]);){let l=e[r];if(l.startsWith("@@")){r+=1;continue}if(l==="*** End of File"){r+=1;continue}let c=l[0];if(c===" "||c==="+"||c==="-")a.push({type:c,text:l.slice(1)});else throw l.trim()===""?new Error('Update File lines must start with " ", "+", or "-"'):new Error("Invalid Update File line");r+=1}if(a.length===0)throw new Error("Update File requires at least one diff line");n.push({type:"update",path:i,movePath:s,diffLines:a});continue}throw new Error(`Unknown patch header: ${o}`)}throw new Error('Patch missing "*** End Patch"')}function N6(t,e){let n=0,r=Array.isArray(t)?t.slice():[],o=(i,s)=>{for(let a=i;a<r.length;a+=1)if(r[a]===s)return a;return-1};for(let i of e){if(i.type===" "){let s=r[n]===i.text?n:o(n,i.text);if(s===-1)throw new Error(`Context line not found: ${i.text}`);n=s+1;continue}if(i.type==="-"){let s=r[n]===i.text?n:o(n,i.text);if(s===-1)throw new Error(`Removal line not found: ${i.text}`);r.splice(s,1),n=s;continue}if(i.type==="+"){r.splice(n,0,i.text),n+=1;continue}throw new Error("Unknown diff operation")}return r}function YR(t){let e=eo.dirname(t);Yn.mkdirSync(e,{recursive:!0})}function M6(t){let e=Yn.readFileSync(t,"utf8"),{lines:n,eol:r,hasTrailingNewline:o}=jR(e);return o&&n.length>0&&n[n.length-1]===""&&n.pop(),{lines:n,eol:r,hasTrailingNewline:o}}function O6(t,e,n,r){let o=e.join(n);r&&(o+=n),Yn.writeFileSync(t,o,"utf8")}function D6({input:t,cwd:e}){let n=e||process.cwd(),r=k6(t),o=[];for(let i of r){if(i.type==="add"){let s=Ac(n,i.path);if(Yn.existsSync(s))throw new Error(`File already exists: ${i.path}`);YR(s);let a=i.contentLines.join(`
`)+`
`;Yn.writeFileSync(s,a,"utf8"),o.push({action:"add",path:i.path,status:"added"});continue}if(i.type==="delete"){let s=Ac(n,i.path);if(!Yn.existsSync(s))throw new Error(`File not found: ${i.path}`);Yn.unlinkSync(s),o.push({action:"delete",path:i.path,status:"deleted"});continue}if(i.type==="update"){let s=Ac(n,i.path);if(!Yn.existsSync(s))throw new Error(`File not found: ${i.path}`);let{lines:a,eol:l,hasTrailingNewline:c}=M6(s),f=N6(a,i.diffLines);if(O6(s,f,l,c),i.movePath){let m=Ac(n,i.movePath);if(m!==s){YR(m),Yn.renameSync(s,m),o.push({action:"move",from:i.path,to:i.movePath,status:"moved"});continue}}o.push({action:"update",path:i.path,status:"updated"});continue}throw new Error(`Unsupported operation: ${i.type}`)}return{ok:!0,applied:o}}XR.exports={applyPatch:D6}});var eI=k((vX,ZR)=>{var{RiskLevel:gi}=yt();async function yi(t,e,n){if(!t||typeof t[e]!="function")return{error:"rag_unavailable",message:"RAG service is not initialized"};try{return await t[e](n||{})}catch(r){return{error:"rag_error",message:String(r&&r.message?r.message:r)}}}function F6(t){return[{name:"memory_search",description:"Search local memory (episodic/fixed) using semantic similarity.",risk:gi.NONE,meta:{intentTemplate:"search memory: {query}"},parameters:{type:"object",properties:{query:{type:"string"},topK:{type:"number"},tags:{type:"array",items:{type:"string"}},minScore:{type:"number"},scope:{type:"string",enum:["episodic","fixed","all"]}},required:["query"]},func:async e=>yi(t,"search",e)},{name:"kb_search",description:"Search fixed read-only knowledge base.",risk:gi.NONE,meta:{intentTemplate:"search fixed knowledge: {query}"},parameters:{type:"object",properties:{query:{type:"string"},topK:{type:"number"},tags:{type:"array",items:{type:"string"}},minScore:{type:"number"}},required:["query"]},func:async e=>yi(t,"searchKnowledge",e)},{name:"memory_save",description:"Save a memory entry into episodic memory only.",risk:gi.LOW,meta:{intentTemplate:"save memory: {title}"},parameters:{type:"object",properties:{type:{type:"string",enum:["note","preference","fact","task"]},title:{type:"string"},content:{type:"string"},metadata:{type:"object"},ttlDays:{type:"number"}},required:["type","title","content"]},func:async e=>yi(t,"saveMemory",e)},{name:"memory_read_graph",description:"Read local memory graph/nodes (fixed + episodic).",risk:gi.NONE,meta:{intentTemplate:"read memory graph"},parameters:{type:"object",properties:{limit:{type:"number"}}},func:async e=>yi(t,"readGraph",e)},{name:"memory__search_nodes",description:"Compatibility alias of memory_search for legacy memory MCP path.",risk:gi.NONE,meta:{intentTemplate:"search memory nodes: {query}"},parameters:{type:"object",properties:{query:{type:"string"},topK:{type:"number"},top_k:{type:"number"},minScore:{type:"number"},scope:{type:"string",enum:["episodic","fixed","all"]},tags:{type:"array",items:{type:"string"}}},required:["query"]},func:async(e={})=>{let n=await yi(t,"search",{query:e.query,topK:e.topK!=null?e.topK:e.top_k,minScore:e.minScore,scope:e.scope,tags:e.tags});return n&&Array.isArray(n.hits)?{nodes:n.hits}:n}},{name:"memory__read_graph",description:"Compatibility alias of memory_read_graph for legacy memory MCP path.",risk:gi.NONE,meta:{intentTemplate:"read memory graph (compat)"},parameters:{type:"object",properties:{limit:{type:"number"}}},func:async(e={})=>yi(t,"readGraph",e)}]}ZR.exports={getRagBuiltInTools:F6}});var rI=k((AX,nI)=>{var{SecurityValidator:tI}=Sf(),{DEFAULT_TOOL_TIMEOUT_MS:L6}=Nt(),{applyPatch:U6}=QR(),{exec:q6}=require("child_process"),{RiskLevel:_i}=yt(),{getRagBuiltInTools:B6}=eI();function G6(t,e={}){let n=e&&e.ragService?e.ragService:null;return[{name:"run_command",description:"Execute a shell command on the host system. Use this to run scripts, list files, etc.",risk:_i.HIGH,meta:{intentTemplate:'run command "{command}"'},parameters:{type:"object",properties:{command:{type:"string",description:"The command to run (e.g. 'ls', 'node script.js')"},timeoutMs:{type:"number",description:"Optional timeout in milliseconds (default 30000)."}},required:["command"]},func:async({command:r,timeoutMs:o})=>{let i=tI.validateTool("run_command",{command:r});if(!i.safe)return{error:"Access Denied",reason:i.reason||"Restricted command",platform:i.platform};let s=typeof o=="number"&&Number.isFinite(o)&&o>0?o:L6;return new Promise(a=>{q6(r,{timeout:s},(l,c,f)=>{let m={stdout:String(c||"").trim(),stderr:String(f||"").trim(),exitCode:l?l.code:0};if(l&&String(l.code).toUpperCase()==="ETIMEDOUT"){a({...m,error:"Timeout",timeoutMs:s});return}a(m)})})}},{name:"apply_patch",description:"Apply a patch to local files using the apply_patch format.",risk:_i.HIGH,meta:{intentTemplate:"apply patch"},parameters:{type:"object",properties:{input:{type:"string",description:"The full apply_patch payload."}},required:["input"]},func:async({input:r})=>{let o=tI.validateTool("apply_patch",{input:r});if(!o.safe)return{error:"Access Denied",reason:o.reason||"Restricted tool",platform:o.platform};try{return U6({input:r,cwd:process.cwd()})}catch(i){return{error:"ApplyPatchError",message:String(i&&i.message?i.message:i)}}}},{name:"list_available_skills",description:"List all specialized skills available in the system. Use this if you encounter a task you don't know how to handle.",risk:_i.NONE,meta:{intentTemplate:"list available skills"},parameters:{type:"object",properties:{}},func:async()=>(typeof t.refreshSkillsAsync=="function"?await t.refreshSkillsAsync({preferEsmTools:!0,quiet:!0}):t.refreshSkills(),t.getSkillList())},{name:"read_skill_documentation",description:"Read the detailed documentation/instructions for a specific skill.",risk:_i.NONE,meta:{intentTemplate:"read skill docs {skillId}"},parameters:{type:"object",properties:{skillId:{type:"string",description:"The unique ID of the skill (from list_available_skills)"}},required:["skillId"]},func:async({skillId:r})=>t.getSkillDetail(r)||{error:"Skill not found"}},...B6(n),{name:"update_plan",description:"Update the current execution plan with steps and statuses.",risk:_i.LOW,meta:{intentTemplate:"update plan"},parameters:{type:"object",properties:{explanation:{type:"string",description:"Brief overview of the current plan or changes."},plan:{type:"array",description:"Ordered list of plan items.",items:{type:"object",properties:{step:{type:"string",description:"Task description."},status:{type:"string",enum:["pending","in_progress","completed"]}},required:["step","status"]}}},required:["plan"]},func:async()=>"Plan updated."},{name:"request_user_input",description:"Request user input when clarification is needed.",risk:_i.LOW,meta:{intentTemplate:"request user input: {question}"},parameters:{type:"object",properties:{question:{type:"string",description:"Single clarification question."},options:{type:"array",description:"Optional choices for the user.",items:{type:"string"}},questions:{type:"array",description:"Multiple questions to ask the user.",items:{type:"object",properties:{question:{type:"string"},options:{type:"array",items:{type:"string"}}},required:["question"]}}}},func:async()=>"User input requested."}]}nI.exports={getBuiltInTools:G6}});var iI=k((CX,oI)=>{var H6=["You are a helpful AI assistant. You operate in a dynamic environment where new capabilities (skills) can be added at any time.","","Always follow this response structure:","Thought: Briefly analyze the request and identify the key problem.","Plan: List the steps you will take to solve it.","Action: If a tool is needed, call it after Thought and Plan.","Conclusion: Provide the final response to the user.","- Every assistant message MUST include a Thought: line (even when you immediately call tools).","- When you are responding to the user (no more tool calls needed), output ONLY a <final_answer>...</final_answer> block.","- Do NOT include Thought/Plan/Action outside the <final_answer> block.","","If you need to use tools, include Thought and Plan before the tool call.","You will be given a compact Skill Catalog (names + descriptions only).","If the needed skill is not listed in the catalog, you MUST call 'list_available_skills' to discover the full list.","If you decide to use a skill, you MUST call 'read_skill_documentation' before using it.","","IF YOU ENCOUNTER A TASK OR SYSTEM YOU ARE UNFAMILIAR WITH:","1. Use 'list_available_skills' to see if there is a relevant specialized skill.","2. Use 'read_skill_documentation' to learn how to use that skill properly.","3. Then execute the learned tools or procedures.","","TOOL INTEGRITY RULES:","- NEVER invent tool names or tool arguments.","- Only call tools that exist in the provided tool list or were discovered via 'list_available_skills' + 'read_skill_documentation'.","","CLARIFICATION RULES:","- If the user request is ambiguous or missing critical details (file paths, targets, constraints), you MUST call 'request_user_input'.","- Do NOT ask clarification questions in plain text. Use the tool so the client can collect structured answers.","","PLANNING RULES:","- For tasks that require 2+ steps, you MUST first call 'update_plan' with a concise, structured plan.","","FACTS VS SYNTHESIS RULES:","- For factual data that requires tools (weather, postcode->coordinates, FX rates, definitions), ALWAYS use the relevant tools. NEVER guess.","- For synthesis tasks (planning, recommendations, analysis) where no dedicated tool exists, DO NOT refuse.","  Use tool results as inputs, then use your internal knowledge to produce a helpful plan.","","REAL-TIME FRESHNESS RULES:","- Each turn includes a <environment_context> message with the latest timestamp.","- If the user asks for real-time data (time, weather, FX rates, news, prices), you MUST use tools to refresh it.","- Do not reuse older tool outputs for real-time data if they predate the latest <environment_context>."].join(`
`);oI.exports={DEFAULT_SYSTEM_PROMPT:H6}});var uI=k((bX,lI)=>{var{RiskLevel:Wt,normalizeRiskLevel:$6}=yt();function Si(t){if(!t||typeof t!="string")return{value:null,error:null};try{return{value:JSON.parse(t),error:null}}catch(e){return{value:null,error:e&&e.message?String(e.message):"Invalid JSON"}}}function V6(){return typeof window>"u"&&typeof process<"u"&&!!(process.versions&&process.versions.node)}function sI(){return V6()?{fs:require("fs")}:null}function aI(t){if(!t||typeof t!="object"||Array.isArray(t))return null;let e={};for(let[n,r]of Object.entries(t))n&&r!=null&&(e[String(n)]=String(r));return Object.keys(e).length>0?e:null}function W6(t){if(!t||typeof t!="object"||Array.isArray(t))return null;let e={};for(let[n,r]of Object.entries(t))n&&r!=null&&(e[String(n)]=String(r));return Object.keys(e).length>0?e:null}function Cc(t){if(typeof t=="number"&&Number.isFinite(t)){let r=$6(t,null);return r===null?void 0:r}if(typeof t!="string")return;let e=t.trim().toLowerCase(),n={none:Wt.NONE,low:Wt.LOW,medium:Wt.MEDIUM,high:Wt.HIGH,tier0:Wt.NONE,"tier 0":Wt.NONE,tier1:Wt.LOW,"tier 1":Wt.LOW,tier2:Wt.MEDIUM,"tier 2":Wt.MEDIUM,tier3:Wt.HIGH,"tier 3":Wt.HIGH}[e];return typeof n=="number"?n:void 0}function Ig(t){if(!t||typeof t!="object"||Array.isArray(t))return;let e={};for(let[n,r]of Object.entries(t)){if(!n)continue;let o=Cc(r);typeof o=="number"&&(e[String(n)]=o)}return Object.keys(e).length>0?e:void 0}function xg(t){if(typeof t!="string")return;let e=t.trim().toLowerCase();if(e==="per_turn")return"per_turn";if(e==="per_call")return"per_call"}function J6(){let t=typeof window<"u"?window:typeof globalThis<"u"?globalThis:null,e=t&&t.EXTERNAL_MCP_CONFIG;if(!e||typeof e!="object")return[];let n=e.mcpServers&&typeof e.mcpServers=="object"?e.mcpServers:null;if(!n)return[];let r=[];for(let[o,i]of Object.entries(n)){if(!i||typeof i!="object")continue;let s=i.transport?String(i.transport).toLowerCase():"",a=i.url?String(i.url):"";a&&(s&&s!=="http"||r.push({serverName:o,url:a,headers:aI(i.headers)||void 0,...(()=>{let l=Cc(i.defaultToolRisk),c=Ig(i.toolRiskOverrides||i.toolRisks),f=xg(i.approvalMode);return{...typeof l=="number"?{defaultToolRisk:l}:null,...c?{toolRiskOverrides:c}:null,...f?{approvalMode:f}:null}})(),namespace:!0}))}return r}function Pg(t){let n=Si(t).value;if(!n||typeof n!="object")return[];let r=n.mcpServers&&typeof n.mcpServers=="object"?n.mcpServers:null;if(!r)return[];let o=[];for(let[i,s]of Object.entries(r)){if(!s||typeof s!="object")continue;let a=s.transport?String(s.transport).toLowerCase():"",l=s.url?String(s.url):"";l&&(a&&a!=="http"||o.push({serverName:i,url:l,headers:aI(s.headers)||void 0,...(()=>{let c=Cc(s.defaultToolRisk),f=Ig(s.toolRiskOverrides||s.toolRisks),m=xg(s.approvalMode);return{...typeof c=="number"?{defaultToolRisk:c}:null,...f?{toolRiskOverrides:f}:null,...m?{approvalMode:m}:null}})(),namespace:!0}))}return o}function kg(t){let n=Si(t).value;if(!n||typeof n!="object")return[];let r=n.mcpServers&&typeof n.mcpServers=="object"?n.mcpServers:null;if(!r)return[];let o=[];for(let[i,s]of Object.entries(r)){if(!s||typeof s!="object"||(s.transport?String(s.transport).toLowerCase():"")!=="stdio")continue;let l=s.command?String(s.command):"";l&&o.push({serverName:i,transport:"stdio",command:l,args:Array.isArray(s.args)?s.args.map(String):[],env:W6(s.env)||void 0,...(()=>{let c=Cc(s.defaultToolRisk),f=Ig(s.toolRiskOverrides||s.toolRisks),m=xg(s.approvalMode);return{...typeof c=="number"?{defaultToolRisk:c}:null,...f?{toolRiskOverrides:f}:null,...m?{approvalMode:m}:null}})(),namespace:!0})}return o}function z6(){if(typeof process>"u"||!process||!process.env)return[];let t=process.env.MCP_CONFIG_JSON;if(!t)return[];let e=Si(t);return e.value?Pg(t):(console.error(`[MCP] MCP_CONFIG_JSON parse failed: ${e.error||"Invalid JSON"}`),[])}function K6(){if(typeof process>"u"||!process||!process.env)return[];let t=process.env.MCP_CONFIG_JSON;if(!t)return[];let e=Si(t);return e.value?kg(t):(console.error(`[MCP] MCP_CONFIG_JSON parse failed: ${e.error||"Invalid JSON"}`),[])}function Y6(t){let e=sI();if(!e)return[];let{fs:n}=e,r=String(t||"").trim();if(!r)return[];try{if(!n.existsSync(r))return[];let o=n.readFileSync(r,"utf8"),i=Si(o);return i.value?Pg(o):(console.error(`[MCP] MCP config file parse failed (${r}): ${i.error||"Invalid JSON"}`),[])}catch(o){let i=o&&o.message?String(o.message):String(o);return console.error(`[MCP] MCP config file read failed (${r}): ${i}`),[]}}function j6(t){let e=sI();if(!e)return[];let{fs:n}=e,r=String(t||"").trim();if(!r)return[];try{if(!n.existsSync(r))return[];let o=n.readFileSync(r,"utf8"),i=Si(o);return i.value?kg(o):(console.error(`[MCP] MCP config file parse failed (${r}): ${i.error||"Invalid JSON"}`),[])}catch(o){let i=o&&o.message?String(o.message):String(o);return console.error(`[MCP] MCP config file read failed (${r}): ${i}`),[]}}lI.exports={readNodeMcpHttpServersFromEnv:z6,readNodeMcpHttpServersFromJson:Pg,readBrowserMcpHttpServersFromGlobal:J6,readNodeMcpHttpServersFromFile:Y6,readNodeMcpStdioServersFromEnv:K6,readNodeMcpStdioServersFromJson:kg,readNodeMcpStdioServersFromFile:j6}});var fI=k((RX,cI)=>{var{readNodeMcpHttpServersFromEnv:X6,readNodeMcpHttpServersFromJson:Q6,readBrowserMcpHttpServersFromGlobal:Z6,readNodeMcpHttpServersFromFile:e4,readNodeMcpStdioServersFromEnv:t4,readNodeMcpStdioServersFromJson:n4,readNodeMcpStdioServersFromFile:r4}=uI();function Ng(t){return t?Array.isArray(t)?t.filter(Boolean).map(String):typeof t!="string"?[]:t.split(/[\n,]/g).map(e=>e.trim()).filter(Boolean):[]}function o4(t={}){let{mcpConfigJson:e,mcpConfigPath:n,externalMcpUrls:r,isBrowserRuntime:o,isTestRuntime:i}=t,s=typeof o=="boolean"?o:typeof window<"u",a=typeof i=="boolean"?i:!s&&typeof process<"u"&&process&&process.env&&(process.env.NODE_ENV==="test"||process.env.VITEST_WORKER_ID),l=(()=>{if(typeof e=="string"&&e.trim())return Q6(e).concat(n4(e));if(s)return Z6();let y=X6().concat(t4());if(y.length>0)return y;let _=typeof n=="string"&&n.trim()?n:typeof process<"u"&&process&&process.env&&process.env.MCP_CONFIG_PATH?process.env.MCP_CONFIG_PATH:a?"":(()=>{if(typeof window<"u")return"";try{return require("path").join(process.cwd(),"mcp-config.json")}catch{return""}})();return _?e4(_).concat(r4(_)):[]})(),c=typeof process<"u"&&process&&process.env?Ng(process.env.EXTERNAL_MCP_URLS):[],f=Ng(r),m=f.length>0?f:c,h=l.concat(m.map(y=>({url:y,namespace:!1})));return{configServers:l,mergedUrls:m,combinedServers:h,isBrowserRuntime:s,isTestRuntime:a}}cI.exports={resolveMcpServers:o4,parseExternalMcpUrls:Ng}});var Og=k((IX,gI)=>{var dI=require("fs"),bc=require("path"),i4="Xenova/all-MiniLM-L6-v2",s4=384,hI="memory/episodic-memory.jsonl",wr=Object.freeze({enabled:!0,topK:5,minScore:.2,maxContextChars:6e3,autoSave:!0,fixedJsonlPaths:[],episodicStoreNodePath:hI,browserStoreName:"agents_memory_v1"});function pI(t,e){if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t!="string")return e;let n=t.trim().toLowerCase();return["1","true","yes","on"].includes(n)?!0:["0","false","no","off"].includes(n)?!1:e}function Mg(t,e,{min:n=null,max:r=null}={}){let o=Number(t);return!Number.isFinite(o)||n!==null&&o<n||r!==null&&o>r?e:o}function a4(t){return Array.isArray(t)?Array.from(new Set(t.map(e=>String(e||"").trim()).filter(Boolean))):typeof t=="string"&&t.trim()?Array.from(new Set(t.split(",").map(e=>e.trim()).filter(Boolean))):[]}function mI(t){let e=typeof t=="string"&&t.trim()?t:bc.join(process.cwd(),"skills");if(!dI.existsSync(e))return[];let n=[],r=[e];for(;r.length>0;){let o=r.pop(),i=[];try{i=dI.readdirSync(o,{withFileTypes:!0})}catch{continue}for(let s of i){let a=bc.join(o,s.name);if(s.isDirectory()){r.push(a);continue}s.isFile()&&s.name.toLowerCase().endsWith(".jsonl")&&a.includes(`${bc.sep}knowledge${bc.sep}`)&&n.push(a)}}return n.sort(),n}function l4(t={},{skillsDir:e}={}){let n=t&&typeof t=="object"?t:{},r={enabled:pI(n.enabled,wr.enabled),topK:Math.floor(Mg(n.topK,wr.topK,{min:1,max:50})),minScore:Mg(n.minScore,wr.minScore,{min:-1,max:1}),maxContextChars:Math.floor(Mg(n.maxContextChars,wr.maxContextChars,{min:256,max:5e4})),autoSave:pI(n.autoSave,wr.autoSave),fixedJsonlPaths:a4(n.fixedJsonlPaths),episodicStoreNodePath:String(n.episodicStoreNodePath||wr.episodicStoreNodePath),browserStoreName:String(n.browserStoreName||wr.browserStoreName)};return r.fixedJsonlPaths.length===0&&(r.fixedJsonlPaths=mI(e)),r}gI.exports={DEFAULT_EMBEDDING_MODEL:i4,DEFAULT_EMBEDDING_DIM:s4,DEFAULT_EPISODIC_NODE_PATH:hI,RAG_DEFAULTS:wr,discoverFixedJsonlPaths:mI,normalizeRagConfig:l4}});var SI=k((xX,_I)=>{var Rc=require("fs"),u4=require("path"),c4=require("readline");function yI(t,{filePath:e="",lineNumber:n=0}={}){let r=String(t||"").trim();if(!r)return{value:null,error:null};try{return{value:JSON.parse(r),error:null}}catch(o){return{value:null,error:{filePath:e,lineNumber:n,message:String(o&&o.message?o.message:o)}}}}async function f4(t,e={}){let{onRecord:n=null,maxRecords:r=Number.POSITIVE_INFINITY,skipInvalid:o=!0}=e,i=[],s=[];if(!t||!Rc.existsSync(t))return{records:i,errors:s,totalLines:0,parsedRecords:0};let a=0,l=0,c=Rc.createReadStream(t,{encoding:"utf8"}),f=c4.createInterface({input:c,crlfDelay:1/0});for await(let m of f){if(a+=1,l>=r)break;let h=yI(m,{filePath:t,lineNumber:a});if(h.error){if(s.push(h.error),!o)throw new Error(`Invalid JSONL at ${h.error.filePath}:${h.error.lineNumber} (${h.error.message})`);continue}h.value&&(l+=1,typeof n=="function"?await n(h.value,l):i.push(h.value))}return{records:i,errors:s,totalLines:a,parsedRecords:l}}async function d4(t,e){let n=JSON.stringify(e),r=u4.dirname(t);await Rc.promises.mkdir(r,{recursive:!0}),await Rc.promises.appendFile(t,`${n}
`,"utf8")}_I.exports={appendJsonlRecord:d4,parseJsonLine:yI,readJsonlFile:f4}});var Dg=k((PX,EI)=>{var{DEFAULT_EMBEDDING_DIM:Ic,DEFAULT_EMBEDDING_MODEL:TI}=Og();function Qs(t){return typeof t=="string"?t:""}function p4(t){if(!t||typeof t!="object")return[];let e=Array.isArray(t.tags)?t.tags:[];return Array.from(new Set(e.map(n=>String(n||"").trim()).filter(Boolean)))}function h4(t){return!t||typeof t!="object"?[]:(Array.isArray(t.source_pages)?t.source_pages:[]).map(n=>Number(n)).filter(n=>Number.isFinite(n)).map(n=>Math.trunc(n))}function m4(t){if(!t||typeof t!="object")return null;let e=t.updated_at,n=t.metadata&&typeof t.metadata=="object"?t.metadata.updated_at:null,r=typeof e=="string"&&e.trim()?e:n;return typeof r=="string"&&r.trim()?r:null}function g4(t){let e=t&&typeof t=="object"?t:null;if(!e)return{hasVector:!1,reason:"missing_embedding",model:null,dimension:null,vector:null};let n=Qs(e.model),r=Number(e.dimension),o=Array.isArray(e.vector)?e.vector:null;if(n!==TI)return{hasVector:!1,reason:"model_mismatch",model:n,dimension:r,vector:null};if(!Number.isFinite(r)||Number(r)!==Ic)return{hasVector:!1,reason:"dimension_mismatch",model:n,dimension:r,vector:null};if(!o||o.length!==Ic)return{hasVector:!1,reason:"vector_length_mismatch",model:n,dimension:r,vector:null};let i=o.map(a=>Number(a));return i.some(a=>!Number.isFinite(a))?{hasVector:!1,reason:"vector_invalid_number",model:n,dimension:r,vector:null}:{hasVector:!0,reason:null,model:n,dimension:Ic,vector:i}}function y4(t,e={}){let{source:n=null,requireVector:r=!1}=e;if(!t||typeof t!="object")return{ok:!1,reason:"invalid_record",hasVector:!1};let o=Qs(t.id).trim(),i=Qs(t.title).trim(),s=Qs(t.content).trim(),a=Qs(t.type).trim()||"note";if(!o||!s)return{ok:!1,reason:"missing_required_fields",hasVector:!1};let l=t.metadata&&typeof t.metadata=="object"?t.metadata:{},c=p4(l),f=h4(l),m=g4(t.embedding);if(r&&!m.hasVector)return{ok:!1,reason:m.reason||"missing_vector",hasVector:!1};let h={id:o,type:a,title:i||o,content:s,tags:c,source_pages:f,updated_at:m4(t),vector:m.vector,embedding_model:m.model,embedding_dim:m.dimension,source:n,rawRecord:t};return{ok:!0,hasVector:m.hasVector,reason:m.reason,searchDoc:h}}function _4(t){return!t||typeof t!="object"?null:{id:t.id,title:t.title,content:t.content,type:t.type,metadata:{tags:Array.isArray(t.tags)?t.tags:[],source_pages:Array.isArray(t.source_pages)?t.source_pages:[],updated_at:t.updated_at||null,source:t.source||null}}}EI.exports={DEFAULT_EMBEDDING_DIM:Ic,DEFAULT_EMBEDDING_MODEL:TI,normalizeRecord:y4,toMemoryNode:_4}});var AI=k((kX,vI)=>{var{readJsonlFile:wI,appendJsonlRecord:S4}=SI(),{normalizeRecord:Fg,toMemoryNode:Lg}=Dg(),Ug=class{constructor({fixedJsonlPaths:e=[],episodicStoreNodePath:n=""}={}){this.fixedJsonlPaths=Array.isArray(e)?e:[],this.episodicStoreNodePath=String(n||""),this.fixedDocs=[],this.episodicDocs=[],this.fixedNodes=[],this.episodicNodes=[],this.loaded=!1}async loadFixed(){let e=[],n=[];for(let r of this.fixedJsonlPaths)await wI(r,{onRecord:async o=>{let i=Fg(o,{source:`fixed:${r}`,requireVector:!1});!i.ok||!i.searchDoc||(n.push(Lg(i.searchDoc)),i.hasVector&&e.push(i.searchDoc))}});this.fixedDocs=e,this.fixedNodes=n}async loadEpisodic(){let e=[],n=[];if(!this.episodicStoreNodePath){this.episodicDocs=e,this.episodicNodes=n;return}await wI(this.episodicStoreNodePath,{onRecord:async r=>{let o=Fg(r,{source:`episodic:${this.episodicStoreNodePath}`,requireVector:!1});!o.ok||!o.searchDoc||(n.push(Lg(o.searchDoc)),o.hasVector&&e.push(o.searchDoc))}}),this.episodicDocs=e,this.episodicNodes=n}async refresh(){await this.loadFixed(),await this.loadEpisodic(),this.loaded=!0}async ensureLoaded(){this.loaded||await this.refresh()}getDocs(e="all"){return e==="fixed"?this.fixedDocs.slice():e==="episodic"?this.episodicDocs.slice():[...this.fixedDocs,...this.episodicDocs]}getNodes({scope:e="all",limit:n=100}={}){let r=[];e==="fixed"?r=this.fixedNodes:e==="episodic"?r=this.episodicNodes:r=[...this.fixedNodes,...this.episodicNodes];let o=Number.isFinite(Number(n))?Math.max(1,Math.floor(Number(n))):100;return r.slice(0,o)}async saveEpisodicRecord(e){if(!this.episodicStoreNodePath)throw new Error("episodicStoreNodePath is not configured");await S4(this.episodicStoreNodePath,e);let n=Fg(e,{source:`episodic:${this.episodicStoreNodePath}`,requireVector:!1});return n.ok&&n.searchDoc&&(this.episodicNodes.unshift(Lg(n.searchDoc)),n.hasVector&&this.episodicDocs.unshift(n.searchDoc)),n}};vI.exports={NodeMemoryStore:Ug}});var qg=k((NX,CI)=>{function T4(t){if(!Array.isArray(t)||t.length===0)return[];let e=t.map(o=>Number(o)),n=0;for(let o of e){if(!Number.isFinite(o))return[];n+=o*o}if(!Number.isFinite(n)||n<=0)return e.map(()=>0);let r=1/Math.sqrt(n);return e.map(o=>o*r)}function E4(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length===0||e.length===0||t.length!==e.length)return-1;let n=0,r=0,o=0;for(let i=0;i<t.length;i+=1){let s=Number(t[i]),a=Number(e[i]);if(!Number.isFinite(s)||!Number.isFinite(a))return-1;n+=s*a,r+=s*s,o+=a*a}return r<=0||o<=0?-1:n/(Math.sqrt(r)*Math.sqrt(o))}function w4(t,e,n){let r=Array.isArray(t)?t.slice():[],o=Number.isFinite(e)&&e>0?Math.floor(e):5,i=Number.isFinite(n)?Number(n):-1;return r.filter(s=>s&&Number.isFinite(Number(s.score))&&Number(s.score)>=i).sort((s,a)=>Number(a.score)-Number(s.score)).slice(0,o)}CI.exports={cosineSimilarity:E4,normalizeVector:T4,topKByScore:w4}});var II=k((MX,RI)=>{var{DEFAULT_EMBEDDING_DIM:xc,DEFAULT_EMBEDDING_MODEL:Pc}=Dg(),{normalizeVector:v4}=qg(),Xe={loaded:!1,mode:"pending",model:Pc,error:null,fn:null};function A4(t){let e=2166136261;for(let n=0;n<t.length;n+=1)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}function bI(t){let e=new Array(xc).fill(0),n=String(t||"").toLowerCase().replace(/[^a-z0-9\s_-]/g," ").split(/\s+/).filter(Boolean);if(n.length===0)return e;for(let r of n){let o=A4(r),i=o%xc,s=(o>>8&1)===0?1:-1,a=.5+(o>>16)%1e3/1e3;e[i]+=s*a}return v4(e)}async function C4(){let n=await new Function("specifier","return import(specifier)")("@xenova/transformers");if(!n||typeof n.pipeline!="function")throw new Error("Invalid @xenova/transformers export");let r=n.env||{};r.allowLocalModels=!1,r.useBrowserCache=!0;let o=await n.pipeline("feature-extraction",Pc,{quantized:!0});return async function(s){let a=await o(String(s||""),{pooling:"mean",normalize:!0}),l=a&&a.data?Array.from(a.data):[];if(!Array.isArray(l)||l.length!==xc)throw new Error(`Unexpected embedding dimension: ${l.length}`);return l.map(c=>Number(c))}}async function b4(){if(!Xe.loaded){Xe.loaded=!0;try{Xe.fn=await C4(),Xe.mode="xenova",Xe.model=Pc,Xe.error=null}catch(t){Xe.fn=async e=>bI(e),Xe.mode="fallback",Xe.model=Pc,Xe.error=String(t&&t.message?t.message:t)}}}function R4(){return{async embedQuery(t){return await b4(),{vector:await Xe.fn(String(t||"")),model:Xe.model,dimension:xc,mode:Xe.mode}},getStatus(){return{mode:Xe.mode,model:Xe.model,error:Xe.error}}}}RI.exports={buildFallbackVector:bI,getQueryEmbedderNode:R4}});var kI=k((OX,PI)=>{var I4=require("path"),{normalizeRagConfig:x4}=Og(),{NodeMemoryStore:P4}=AI(),{getQueryEmbedderNode:k4}=II(),{cosineSimilarity:N4,topKByScore:M4}=qg();function O4(t){return Array.isArray(t)?Array.from(new Set(t.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean))):[]}function xI(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\s_-]/g," ").split(/\s+/).filter(Boolean)}function D4(t,e){let n=xI(t),r=new Set(xI(e));if(n.length===0||r.size===0)return 0;let o=0;for(let i of n)r.has(i)&&(o+=1);return o/n.length}function F4(t){let e=String(t||"all").toLowerCase();return e==="episodic"||e==="fixed"||e==="all"?e:"all"}function L4(){let t=Math.random().toString(36).slice(2,8);return`memory-${Date.now()}-${t}`}var kc=class{constructor(e={}){let n=e.skillsDir||I4.join(process.cwd(),"skills");this.config=x4(e.ragConfig||{},{skillsDir:n}),this.store=new P4({fixedJsonlPaths:this.config.fixedJsonlPaths,episodicStoreNodePath:this.config.episodicStoreNodePath}),this.embedder=k4()}getConfig(){return{...this.config}}async init(){await this.store.ensureLoaded()}async refresh(){await this.store.refresh()}async search(e={}){if(!this.config.enabled)return{hits:[],meta:{disabled:!0}};let n=String(e.query||"").trim();if(!n)return{hits:[],meta:{reason:"empty_query"}};let r=Number.isFinite(Number(e.topK))?Math.max(1,Math.floor(Number(e.topK))):this.config.topK,o=Number.isFinite(Number(e.minScore))?Number(e.minScore):this.config.minScore,i=F4(e.scope||"all"),s=O4(e.tags);await this.store.ensureLoaded();let a=this.store.getDocs(i),l=await this.embedder.embedQuery(n),c=[];for(let h of a){if(!h||typeof h!="object")continue;let y=Array.isArray(h.tags)?h.tags.map(T=>String(T).toLowerCase()):[];if(s.length>0&&!s.some(T=>y.includes(T)))continue;let _=-1;l.mode==="xenova"&&Array.isArray(h.vector)?_=N4(l.vector,h.vector):_=D4(n,`${h.title||""}
${h.content||""}`),c.push({doc:h,score:_})}return{hits:M4(c,r,o).map(({doc:h,score:y})=>({id:h.id,title:h.title,content:h.content,score:y,tags:h.tags||[],source_pages:h.source_pages||[],type:h.type,updated_at:h.updated_at||null})),meta:{query:n,topK:r,minScore:o,scope:i,mode:l.mode,indexed:a.length,fixedIndexed:this.store.fixedDocs.length,episodicIndexed:this.store.episodicDocs.length}}}async searchKnowledge(e={}){return this.search({...e,scope:"fixed"})}async saveMemory(e={}){if(!this.config.enabled)return{ok:!1,error:"rag_disabled"};if(String(e.scope||e.target||"").toLowerCase()==="fixed")return{ok:!1,error:"fixed_memory_read_only",message:"fixed memory is read-only; use episodic memory only"};let r=String(e.type||"note"),o=String(e.title||"").trim(),i=String(e.content||"").trim();if(!o||!i)return{ok:!1,error:"invalid_payload",message:"title and content are required"};let s=e.metadata&&typeof e.metadata=="object"?{...e.metadata}:{},a=Number.isFinite(Number(e.ttlDays))?Math.floor(Number(e.ttlDays)):null,l=Array.isArray(s.tags)?Array.from(new Set(s.tags.map(h=>String(h||"").trim()).filter(Boolean))):[],c=`${o}
${i}`,f=await this.embedder.embedQuery(c),m={id:L4(),type:r,title:o,content:i,metadata:{...s,tags:l,updated_at:new Date().toISOString(),...a!==null?{ttl_days:a}:null},embedding:{model:f.model,dimension:f.dimension,vector:f.vector}};return await this.store.ensureLoaded(),await this.store.saveEpisodicRecord(m),{ok:!0,id:m.id,mode:f.mode}}async readGraph(e={}){await this.store.ensureLoaded();let n=Number.isFinite(Number(e.limit))?Math.max(1,Math.floor(Number(e.limit))):100;return{nodes:this.store.getNodes({scope:"all",limit:n}),meta:{limit:n,fixed:this.store.fixedNodes.length,episodic:this.store.episodicNodes.length}}}};function U4(t={}){return new kc(t)}PI.exports={createRagSearchService:U4,RagSearchService:kc}});var LI=k((DX,FI)=>{var{Agent:q4}=hT(),{GeminiLLM:B4}=ob(),{SkillManager:NI}=WR(),{getBuiltInTools:MI}=rI(),{DEFAULT_SYSTEM_PROMPT:Bg}=iI(),{resolveMcpServers:G4}=fI(),{getAgentConfig:H4}=Of(),{createRagSearchService:$4}=kI(),OI=require("path"),V4=new Set(["run_command","apply_patch","list_available_skills","read_skill_documentation"]);function DI({modelName:t,baseSystemPrompt:e,skillManager:n,snapshot:r,maxTurns:o,compaction:i,maxProtectedRecentMessages:s,toolOutputLimits:a,identity:l,riskProfile:c}){let f=H4(),m=f&&f.agent&&f.agent.rag?f.agent.rag:{},h=$4({ragConfig:m,skillsDir:n.skillsDir}),y=MI(n,{ragService:h}),_=n.getTools(),T={},E={};for(let P of y)!P||!P.name||(T[P.name]?console.warn(`[AgentFactory] Duplicate built-in tool ignored: ${P.name}`):(T[P.name]=P,E[P.name]="built-in"));for(let P of _){if(!P||!P.name)continue;if(!T[P.name]){T[P.name]=P,E[P.name]="skill";continue}let q=E[P.name]||"unknown";V4.has(P.name)&&q==="built-in"||console.warn(`[AgentFactory] Duplicate tool ignored: ${P.name}`)}let w=Object.values(T);console.log(`[AgentFactory] Total tools available: ${w.length} (Deduplicated)`),console.log(`  - Built-in tools: ${y.length}`),console.log(`  - Unique skill tools: ${w.length-y.length}`);let b=new B4({modelName:t,tools:w}),L=w.some(P=>!P||typeof P.name!="string"?!1:P.name.startsWith("memory__")||P.name==="memory_search"||P.name==="kb_search")?`

Memory tools are available. For factual/company/domain queries, you MUST call kb_search or memory_search first. Only use web tools (e.g. searxng_query/read_url) after local memory is insufficient.`:"",D=`${e}${n.getSystemPromptAddition()}${L}`;return{agent:new q4({llm:b,tools:w,systemPrompt:D,snapshot:r,maxTurns:o,compaction:i,maxProtectedRecentMessages:s,toolOutputLimits:a,identity:l,riskProfile:c,ragConfig:m,ragService:h,skillsDir:n.skillsDir}),skillManager:n,tools:w}}function W4(t={}){let{modelName:e="gemini-2.5-flash",skillsDir:n=OI.join(__dirname,"skills"),catalogLimit:r=80,baseSystemPrompt:o=Bg,snapshot:i,maxTurns:s,compaction:a,maxProtectedRecentMessages:l,toolOutputLimits:c,identity:f,riskProfile:m}=t,h=new NI(n,{catalogLimit:r});return h.loadSkills(),DI({modelName:e,baseSystemPrompt:o,skillManager:h,snapshot:i,maxTurns:s,compaction:a,maxProtectedRecentMessages:l,toolOutputLimits:c,identity:f,riskProfile:m})}async function J4(t={}){let{modelName:e="gemini-2.5-flash",skillsDir:n=OI.join(__dirname,"skills"),catalogLimit:r=80,baseSystemPrompt:o=Bg,preferEsmTools:i=!0,externalMcpUrls:s,mcpConfigJson:a,mcpConfigPath:l,snapshot:c,quiet:f=!1,maxTurns:m,compaction:h,maxProtectedRecentMessages:y,toolOutputLimits:_,identity:T,riskProfile:E}=t,w=new NI(n,{catalogLimit:r});await w.loadSkillsAsync({preferEsmTools:i,quiet:f});let{combinedServers:b}=G4({mcpConfigJson:a,mcpConfigPath:l,externalMcpUrls:s});return typeof w.loadExternalMcpToolsAsync=="function"&&b.length>0&&await w.loadExternalMcpToolsAsync({servers:b,quiet:f}),DI({modelName:e,baseSystemPrompt:o,skillManager:w,snapshot:c,maxTurns:m,compaction:h,maxProtectedRecentMessages:y,toolOutputLimits:_,identity:T,riskProfile:E})}FI.exports={createAgent:W4,createAgentAsync:J4,getBuiltInTools:MI,DEFAULT_SYSTEM_PROMPT:Bg}});var{createAgentAsync:z4}=LI(),Gg=require("fs"),K4=require("path"),UI=require("readline");async function Y4(){let t=process.env.GEMINI_MODEL,e=K4.join(process.cwd(),"agent_session.json"),n,r=process.argv.slice(2),o=!1,i=[];for(let y of r){if(y==="--resume"||y==="-r"){o=!0;continue}(y==="--help"||y==="-h")&&(console.log('Usage: node index.js [--resume|-r] "<your prompt>"'),console.log("  --resume: load ./agent_session.json to continue a prior session"),process.exit(0)),i.push(y)}if(o&&Gg.existsSync(e))try{let y=Gg.readFileSync(e,"utf8");n=JSON.parse(y),console.log(`[System] Restored session snapshot from ${e}`)}catch(y){console.warn(`[System] Failed to load snapshot: ${y&&y.message?y.message:y}`)}let{agent:s,skillManager:a}=await z4({...t?{modelName:t}:void 0,...n?{snapshot:n}:void 0});s.on("state_changed",({status:y,previous:_,metadata:T,timestamp:E})=>{let w=E?new Date(E).toLocaleTimeString():new Date().toLocaleTimeString();if(console.log(`
[${w}] Agent Status: ${_} -> ${y}`),T&&typeof T.estimatedTokens=="number"&&console.log(`[Stats] Tokens: ~${T.estimatedTokens} | History: ${T.historyLength} msgs`),y==="executing"&&T&&Array.isArray(T.active))for(let b of T.active){if(!b||!b.name)continue;let L=b.id?` (${b.id})`:"",D=typeof b.elapsedMs=="number"?` ${b.elapsedMs}ms`:"";console.log(`[Executing] ${b.name}${L}${D}`)}y==="awaiting_input"&&console.log("[System] Agent is waiting for your response...")}),s.on("tool_call_end",({name:y,durationMs:_,success:T})=>{let E=T?"\u2705":"\u274C",w=typeof _=="number"?`${_}ms`:"n/a";console.log(`  \u2514\u2500 ${E} ${y||"unknown_tool"} finished in ${w}`)});let l=!["0","false"].includes(String(process.env.AGENTS_DECISION_TRACE||"").toLowerCase());s.on("decision_trace",({step:y,thought:_,planSteps:T})=>{if(!l)return;let E=typeof y=="number"?`Step ${y}`:"Step",w=_?`Thought: ${_}`:"Thought: (redacted)",b=typeof T=="number"?` | Plan steps: ${T}`:"";console.log(`[Decision] ${E}: ${w}${b}`)}),s.on("autosave",y=>{try{Gg.writeFileSync(e,JSON.stringify(y,null,2)),console.log(`[System] Session snapshot saved to ${e}`)}catch(_){console.warn(`[System] Failed to save snapshot: ${_&&_.message?_.message:_}`)}}),console.log(`
[System] Agent Initialized Successfully`),console.log(`[System] Skills discovered: ${a.getSkillList().length}`),console.log(a.getSystemPromptAddition());let c=i.length>0?i.join(" "):"Write a Javascript function to calculate fibonacci. Be an expert.",f=UI.createInterface({input:process.stdin,output:process.stdout});process.stdin&&process.stdin.isTTY&&(UI.emitKeypressEvents(process.stdin),typeof process.stdin.setRawMode=="function"&&process.stdin.setRawMode(!0),process.stdin.on("keypress",(y,_)=>{_&&_.name==="escape"&&(s.stop("esc"),console.log("[System] Stop requested (Esc)."))}));let m=y=>new Promise(_=>f.question(y,_)),h=Promise.resolve();s.on("user_input_requested",y=>{h=h.then(async()=>{let _=Array.isArray(y&&y.questions)?y.questions:[],T=_.length>0?_:[{question:"Please provide input."}],E=[];for(let b of T){let L=b&&b.question?String(b.question):"Please provide input.",D=b&&Array.isArray(b.options)?b.options:[],I=b&&b.inputType?String(b.inputType):"",P=D.map(q=>q&&typeof q=="object"&&"title"in q&&"value"in q?{title:String(q.title),value:q.value}:{title:String(q),value:q});if(D.length>0&&I==="multi_select"){let q=P.map((Q,oe)=>`${oe+1}. ${Q.title}`).join(`
`),K=await m(`${L}
${q}
Pick (comma separated), or 'a' for all, or empty for none:
> `),B=String(K||"").trim();if(!B){E.push({approvedCallIds:[]});continue}if(B.toLowerCase()==="a"){E.push({approvedCallIds:P.map(Q=>Q.value)});continue}let j=B.split(",").map(Q=>parseInt(Q.trim(),10)).filter(Q=>Number.isFinite(Q)&&Q>=1&&Q<=P.length).map(Q=>P[Q-1].value);E.push({approvedCallIds:j})}else if(D.length>0){let q=P.map((oe,le)=>`${le+1}. ${oe.title}`).join(`
`),K=await m(`${L}
${q}
> `),B=String(K||"").trim(),j=parseInt(B,10),Q=!Number.isNaN(j)&&j>=1&&j<=P.length?P[j-1].value:B;E.push(Q)}else{let q=await m(`${L}
> `);E.push(q)}}let w=E.length<=1?E[0]||"":{answers:E};s.respondToUserInput(y&&y.callId,w)})});try{let y=await s.run(c);console.log(`
--- Final Result ---`),console.log(y)}catch(y){console.error("Agent failed:",y)}finally{await h,f.close(),process.stdin&&process.stdin.isTTY&&typeof process.stdin.setRawMode=="function"&&process.stdin.setRawMode(!1)}}Y4();
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)

@google/genai/dist/node/index.cjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
